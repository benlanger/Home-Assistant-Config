[{"id":"666f64b87ddc48a7","type":"tab","label":"test","disabled":false,"info":"","env":[]},{"id":"8ab98f5aa8b2c325","type":"tab","label":"tests","disabled":false,"info":""},{"id":"90585768a7a619f8","type":"tab","label":"Face Reco 8.0","disabled":true,"info":"","env":[]},{"id":"14484d2a357fa501","type":"tab","label":"Face Reco 7.0","disabled":true,"info":""},{"id":"dc434684164184f3","type":"tab","label":"Facial Reco 6.0 Double-Stack","disabled":true,"info":""},{"id":"904d418a12e6a4b0","type":"tab","label":"Face Reco 6.1","disabled":true,"info":""},{"id":"62914984f579d881","type":"tab","label":"Bathroom 2.0","disabled":true,"info":""},{"id":"2cc7bfce9974187b","type":"tab","label":"Bathroom Old","disabled":true,"info":""},{"id":"933f5581a37dd52c","type":"tab","label":"Dimmer/Dial/Tap","disabled":false,"info":""},{"id":"17e87e6a7428d034","type":"tab","label":"Lights","disabled":false,"info":""},{"id":"1926984267e0fec1","type":"tab","label":"Back door","disabled":false,"info":""},{"id":"ecbd17e87fcc158a","type":"tab","label":"Server/Patio","disabled":false,"info":""},{"id":"6b01a9ccd3fa048b","type":"tab","label":"Nate cube","disabled":false,"info":""},{"id":"5906a7fb2733fdfc","type":"tab","label":"Vacuum","disabled":false,"info":""},{"id":"c6790bfa88a3b330","type":"tab","label":"PTZ Camera","disabled":false,"info":""},{"id":"5f920ffe83bd9adf","type":"tab","label":"test light","disabled":false,"info":""},{"id":"4e6f57edbb2d3314","type":"tab","label":"Carla","disabled":false,"info":""},{"id":"d5c4f13f05d3870d","type":"tab","label":"Fay","disabled":false,"info":"","env":[]},{"id":"413612f0b83809d5","type":"tab","label":"Nate","disabled":true,"info":"","env":[]},{"id":"e5efe01f033acec0","type":"tab","label":"Flow 1","disabled":false,"info":"","env":[]},{"id":"92fbb69b279db47c","type":"tab","label":"Phone","disabled":false,"info":""},{"id":"b961c3ee719fff16","type":"tab","label":"Kitchen","disabled":false,"info":""},{"id":"f34519812e7522cf","type":"tab","label":"Announcements","disabled":false,"info":""},{"id":"60d15080ad880ed5","type":"tab","label":"subflow testing","disabled":false,"info":"","env":[]},{"id":"4c06c8ed0ae6cd3a","type":"tab","label":"Closet","disabled":false,"info":"","env":[]},{"id":"af76f8fdc5fbe12b","type":"tab","label":"Automations","disabled":false,"info":""},{"id":"dd89857c15f353c7","type":"tab","label":"Face Reco 9.0","disabled":false,"info":"","env":[]},{"id":"4cbffab723828705","type":"tab","label":"Hotbox ze ","disabled":false,"info":""},{"id":"dddedf805803d84c","type":"tab","label":"Living Room","disabled":false,"info":""},{"id":"9129ecb0b2e786b5","type":"tab","label":"Front door","disabled":false,"info":""},{"id":"fbee724e036776a8","type":"tab","label":"Bathroom 3.0","disabled":false,"info":""},{"id":"2d6a330c11854cb5","type":"tab","label":"Security/conditions","disabled":false,"info":""},{"id":"a63e8f060776799f","type":"tab","label":"Bedroom","disabled":false,"info":""},{"id":"89a78322a7b36ae2","type":"tab","label":"Security","disabled":false,"info":"","env":[]},{"id":"56c911ff62a860ba","type":"tab","label":"Bedroom","disabled":false,"info":"","env":[]},{"id":"881898b44ee6eb81","type":"tab","label":"Bathroom","disabled":false,"info":"","env":[]},{"id":"effe1ca3bbc31144","type":"tab","label":"Tablets","disabled":false,"info":""},{"id":"cc94640ec8e547cb","type":"tab","label":"Front Door","disabled":false,"info":"","env":[]},{"id":"7a1172b433a6cf9c","type":"tab","label":"Living Room","disabled":false,"info":"","env":[]},{"id":"ad8c570ec4ac394a","type":"tab","label":"Automations","disabled":false,"info":"","env":[]},{"id":"3ad1e0957e6ec22e","type":"tab","label":"House-Wide","disabled":false,"info":"","env":[]},{"id":"f8abdd9653af834e","type":"tab","label":"Chilling Room","disabled":false,"info":"","env":[]},{"id":"3d9405faee8bc840","type":"tab","label":"Closet","disabled":false,"info":"","env":[]},{"id":"5d4e860e6cd2bc1e","type":"tab","label":"Kitchen","disabled":false,"info":"","env":[]},{"id":"f9b109c0bb255002","type":"tab","label":"hallway","disabled":false,"info":"","env":[]},{"id":"45ec21e855a2c144","type":"tab","label":"Hotbox Top","disabled":false,"info":"","env":[]},{"id":"a17f73eee8c0a729","type":"tab","label":"Hotbox Down","disabled":false,"info":"","env":[]},{"id":"adab22047f9bb868","type":"tab","label":"Office","disabled":false,"info":"","env":[]},{"id":"1e308a06b84891ef","type":"tab","label":"Myriam","disabled":false,"info":"","env":[]},{"id":"ae1618571fe55cb8","type":"tab","label":"Flow 2","disabled":false,"info":"","env":[]},{"id":"eb3b6592c8406c0d","type":"subflow","name":"TV Anouncements","info":"","category":"","in":[{"x":260,"y":240,"wires":[{"id":"707a9031aaac3456"}]}],"out":[],"env":[],"meta":{},"color":"#DDAA99"},{"id":"cd4b600533b9308c","type":"subflow","name":"Auto Lights 2.0","info":"","category":"","in":[{"x":100,"y":120,"wires":[{"id":"e200c956be50b58a"}]}],"out":[],"env":[],"meta":{},"color":"#DDAA99","status":{"x":700,"y":80,"wires":[{"id":"ba1bb1c238035d63","port":0}]}},{"id":"dfb97c6505f003d9","type":"subflow","name":"Light Alerts old","info":"","category":"","in":[{"x":200,"y":700,"wires":[{"id":"ac96ceaf6db5e36c"}]}],"out":[],"env":[],"meta":{},"color":"#DDAA99"},{"id":"233ac7dcd801a802","type":"subflow","name":"Improved Alerts 1.0","info":"","category":"","in":[{"x":140,"y":900,"wires":[{"id":"2d00197d6062613a"},{"id":"2fad2062613570e7"},{"id":"366af0d006ca31e2"}]}],"out":[],"env":[],"meta":{},"color":"#DDAA99"},{"id":"a4f0ac9a6eed6b71","type":"subflow","name":"TV Alert","info":"","category":"","in":[{"x":60,"y":220,"wires":[]}],"out":[],"env":[],"meta":{},"color":"#DDAA99"},{"id":"61f53235c712b2c2","type":"subflow","name":"Dial Subflow","info":"","category":"","in":[{"x":20,"y":1760,"wires":[{"id":"d50c859d07692e50"}]}],"out":[],"env":[],"meta":{},"color":"#DDAA99"},{"id":"9e515b8aa75a9cdd","type":"subflow","name":"Auto lights off","info":"","category":"","in":[{"x":160,"y":180,"wires":[{"id":"5dbfe54c1c9e0349"}]}],"out":[],"env":[],"meta":{},"color":"#DDAA99"},{"id":"824fe4cb22842d7f","type":"group","z":"9e515b8aa75a9cdd","name":"","style":{"label":true},"nodes":["5dbfe54c1c9e0349","57eb4ea18bc4f55b","2080c99162556dc0","21add955f677d2b7","ad814cbe9abc19f5","a87e55e132644e6c","342cb1090e8f530b","0cb211a18508e0ab","e8e8db56dab8adcc","6131a2c1c3af7050","27cd90e7ad99d55c","f0de34106b389b4a","c7f2980adaee37b4","9c396755fe1cb910","1189f4b6f680b126","cf8ff618865df435","25f4aad1cd60ab2a","d5e2a24c6ce71e38","57b7936054b0b5cc","db1017a7cb93fa99","cb125f4b50582619","e91a19e1d4d03076","deb1c3f277dffa05","bc2e357cd21ccadd","18d49bad3d314fbb","6da1158175acc54a","924efdd72ef016a6","6d38d52715aeb7ef","2ae78b52a82bf9e5","d3c382301395300b","62fcc1a1fce54141","d22cea5a615c3b79","ee596aba36f6626b","33b091aa899cef65"],"x":194,"y":79},{"id":"8d7549550611cb06","type":"junction","z":"60d15080ad880ed5","x":1700,"y":920,"wires":[["8426df596c13d4de","be1856fa89c02c1c"]]},{"id":"2f63b042f67c086c","type":"junction","z":"ecbd17e87fcc158a","x":420,"y":3380,"wires":[["5702a016541fe225"]]},{"id":"c567a425829271f3","type":"junction","z":"3ad1e0957e6ec22e","x":180,"y":100,"wires":[["2f2e8679067c06af"]]},{"id":"6372d64da4e99c42","type":"junction","z":"3ad1e0957e6ec22e","x":180,"y":180,"wires":[["581fd4c7ce035d72"]]},{"id":"e2670ef9a6f08eeb","type":"junction","z":"3ad1e0957e6ec22e","x":2760,"y":580,"wires":[["5d19ca682dd18d58"]]},{"id":"1c819bd84e568a03","type":"junction","z":"3ad1e0957e6ec22e","x":2760,"y":660,"wires":[["be293fd5728c4e6e"]]},{"id":"6805035056bd8cee","type":"junction","z":"3ad1e0957e6ec22e","x":3360,"y":580,"wires":[["2e0553a4becdcb11"]]},{"id":"a8bbac8ba01b6fd2","type":"junction","z":"3ad1e0957e6ec22e","x":3360,"y":660,"wires":[["2e0553a4becdcb11"]]},{"id":"fc518af82d06d8bc","type":"junction","z":"3ad1e0957e6ec22e","x":160,"y":280,"wires":[["5e73e5e7fc269891"]]},{"id":"b1880ea06e93f832","type":"junction","z":"3ad1e0957e6ec22e","x":980,"y":1380,"wires":[["fc4eb7aaf1a49466"]]},{"id":"2792555ece4458cd","type":"junction","z":"3ad1e0957e6ec22e","x":1080,"y":1440,"wires":[["3996bd2645bd3ea2"]]},{"id":"46d3285b345e72df","type":"junction","z":"3ad1e0957e6ec22e","x":1400,"y":1380,"wires":[["a25d3f0c73d9050d"]]},{"id":"62cf47fb999346aa","type":"junction","z":"3ad1e0957e6ec22e","x":1260,"y":1340,"wires":[["ef1d3af5aec4c6ad"]]},{"id":"bb71b092d9c74860","type":"junction","z":"3ad1e0957e6ec22e","x":1260,"y":1380,"wires":[["46d3285b345e72df"]]},{"id":"ef1d3af5aec4c6ad","type":"junction","z":"3ad1e0957e6ec22e","x":1400,"y":1340,"wires":[["dfbcd81831907951"]]},{"id":"ac09ae6273c851a3","type":"junction","z":"3ad1e0957e6ec22e","x":1620,"y":1400,"wires":[["afec6aacb9655c5b"]]},{"id":"fc4eb7aaf1a49466","type":"junction","z":"3ad1e0957e6ec22e","x":1080,"y":1380,"wires":[["cad47fe6566c23a7"]]},{"id":"1b04206a65cea813","type":"junction","z":"cc94640ec8e547cb","x":260,"y":260,"wires":[["0ac23590a7b82122","ec38337bc4762c2a"]]},{"id":"6dae17c627907e37","type":"junction","z":"cc94640ec8e547cb","x":260,"y":180,"wires":[["ec38337bc4762c2a"]]},{"id":"b2b40cd2583e9dcd","type":"junction","z":"cc94640ec8e547cb","x":840,"y":520,"wires":[["64b624557a59f61e"]]},{"id":"bf61178d1208f913","type":"junction","z":"cc94640ec8e547cb","x":840,"y":440,"wires":[["0f9702216925a495"]]},{"id":"598cbca76ab38a02","type":"junction","z":"3ad1e0957e6ec22e","x":560,"y":1160,"wires":[["adc9dfdbe4ca7285"]]},{"id":"5b05cae4ba55b8ee","type":"junction","z":"3ad1e0957e6ec22e","x":300,"y":1160,"wires":[["598cbca76ab38a02"]]},{"id":"de24400af7fb8682","type":"junction","z":"7a1172b433a6cf9c","x":400,"y":120,"wires":[["2dd272c9b019b4cb"]]},{"id":"b659f5b0b0949237","type":"junction","z":"7a1172b433a6cf9c","x":400,"y":200,"wires":[["70c42437dc758335"]]},{"id":"6c667b04c18e0b33","type":"junction","z":"5d4e860e6cd2bc1e","x":1300,"y":260,"wires":[["72a594d88c84876d"]]},{"id":"fba35d3bdbb3a641","type":"junction","z":"5d4e860e6cd2bc1e","x":2040,"y":2760,"wires":[["8628ef491109f67c"]]},{"id":"a4165723d67e441d","type":"junction","z":"5d4e860e6cd2bc1e","x":1920,"y":2900,"wires":[["a37355ef9606ec1f"]]},{"id":"f4694759a1bfdc7c","type":"junction","z":"5d4e860e6cd2bc1e","x":2600,"y":2900,"wires":[["1f85692114ea2aff"]]},{"id":"9442e076db99a2e1","type":"junction","z":"ad8c570ec4ac394a","x":2620,"y":1780,"wires":[["2c54900f0bdbbea5"]]},{"id":"630088e66f7238a1","type":"junction","z":"ad8c570ec4ac394a","x":720,"y":1800,"wires":[["74b80452ecae5b16"]]},{"id":"6ab4316b4ec28a96","type":"junction","z":"ad8c570ec4ac394a","x":1180,"y":1920,"wires":[["e216d39e85bfde74"]]},{"id":"9b5bc74d89ac6854","type":"junction","z":"dd89857c15f353c7","x":740,"y":1400,"wires":[["3c28784c1321d67d"]]},{"id":"177471418c06f764","type":"junction","z":"dd89857c15f353c7","x":1120,"y":1400,"wires":[["3c28784c1321d67d"]]},{"id":"9c935c7956118916","type":"junction","z":"dd89857c15f353c7","x":3540,"y":1560,"wires":[["cc9b4a03e1350d55"]]},{"id":"0cfa322e2f86ac01","type":"junction","z":"dd89857c15f353c7","x":3500,"y":1560,"wires":[["cc9b4a03e1350d55"]]},{"id":"8494a9adf85edace","type":"junction","z":"dd89857c15f353c7","x":3620,"y":1480,"wires":[["7cb1321035bbdb44"]]},{"id":"7cb1321035bbdb44","type":"junction","z":"dd89857c15f353c7","x":3720,"y":1480,"wires":[["001784db32fff1e2"]]},{"id":"e2c29f7712b2d101","type":"junction","z":"dd89857c15f353c7","x":1020,"y":1560,"wires":[["2aafb5ed5fb7221d","8b8ab6894608285c"]]},{"id":"4e5d3d8a6660d120","type":"junction","z":"3ad1e0957e6ec22e","x":1660,"y":3740,"wires":[["aad9f82ac2bb5718"]]},{"id":"e968bcc4b1e19f07","type":"junction","z":"3ad1e0957e6ec22e","x":1160,"y":3820,"wires":[["4366061e3225ad93"]]},{"id":"d3b3815d4b23e5d8","type":"junction","z":"3ad1e0957e6ec22e","x":1180,"y":3740,"wires":[["ad69111471edb2d4","70a6e7c8a629e5bd"]]},{"id":"033f0d48a6296b1f","type":"junction","z":"3ad1e0957e6ec22e","x":440,"y":3820,"wires":[["fa5c0b45b91d9b2a"]]},{"id":"6e473c3db94d48de","type":"junction","z":"3ad1e0957e6ec22e","x":1240,"y":3900,"wires":[["033f0d48a6296b1f"]]},{"id":"2627ce3651ca571c","type":"junction","z":"3ad1e0957e6ec22e","x":1380,"y":3840,"wires":[["6e473c3db94d48de","aad9f82ac2bb5718"]]},{"id":"de9f4c34e00835c7","type":"junction","z":"881898b44ee6eb81","x":400,"y":740,"wires":[["8a87371543b31002"]]},{"id":"12dd6306bdf52a97","type":"junction","z":"881898b44ee6eb81","x":400,"y":780,"wires":[["cf3320ead9bdaf99"]]},{"id":"6c7ad1714992bdd3","type":"junction","z":"881898b44ee6eb81","x":400,"y":460,"wires":[["e921ceff2ed05761"]]},{"id":"ed840b70957315b2","type":"junction","z":"881898b44ee6eb81","x":400,"y":500,"wires":[["68230369115ebbb3"]]},{"id":"8ecacc3680df8a66","type":"junction","z":"881898b44ee6eb81","x":300,"y":1200,"wires":[["c21d3f05ccdb3e9f"]]},{"id":"c21d3f05ccdb3e9f","type":"junction","z":"881898b44ee6eb81","x":400,"y":1200,"wires":[["c7d7869cf88446c1"]]},{"id":"471b6b35d2f07b2f","type":"junction","z":"881898b44ee6eb81","x":340,"y":1300,"wires":[["1e251d84255e0657"]]},{"id":"d26eadfb6228a626","type":"junction","z":"881898b44ee6eb81","x":780,"y":1100,"wires":[["1823da52dbb438b3"]]},{"id":"695dbd47c25a51cc","type":"junction","z":"881898b44ee6eb81","x":780,"y":1180,"wires":[["73508ebeaf49e873"]]},{"id":"73508ebeaf49e873","type":"junction","z":"881898b44ee6eb81","x":1560,"y":1180,"wires":[["40902a85fa0988ab"]]},{"id":"1823da52dbb438b3","type":"junction","z":"881898b44ee6eb81","x":1560,"y":1100,"wires":[["2676640708d0f3db"]]},{"id":"1e251d84255e0657","type":"junction","z":"881898b44ee6eb81","x":420,"y":1300,"wires":[["ade0768cb997a2b3"]]},{"id":"7fcd0180ea269945","type":"junction","z":"881898b44ee6eb81","x":880,"y":1280,"wires":[["3c2838394f50a39a"]]},{"id":"340260f5e20a06a1","type":"junction","z":"881898b44ee6eb81","x":880,"y":1320,"wires":[["cf3f9442d8a57374"]]},{"id":"6886824c46b97a7c","type":"junction","z":"881898b44ee6eb81","x":560,"y":1540,"wires":[[]]},{"id":"3502a2624820f68a","type":"junction","z":"881898b44ee6eb81","x":500,"y":1640,"wires":[[]]},{"id":"b6b49543ca03433b","type":"junction","z":"881898b44ee6eb81","x":440,"y":1560,"wires":[["9b337d8762637eaa"]]},{"id":"5391dd8b0174feca","type":"junction","z":"881898b44ee6eb81","x":440,"y":1600,"wires":[["0b8ee3f939557602"]]},{"id":"717a4409aab31cce","type":"junction","z":"881898b44ee6eb81","x":1120,"y":1500,"wires":[["4ce58926e7976eb0"]]},{"id":"eb2007c7b6292a41","type":"junction","z":"881898b44ee6eb81","x":1000,"y":1500,"wires":[["717a4409aab31cce"]]},{"id":"2474feca55a52fa6","type":"junction","z":"89a78322a7b36ae2","x":380,"y":220,"wires":[["3aab6d918795a654"]]},{"id":"8122f10a246c277c","type":"junction","z":"89a78322a7b36ae2","x":240,"y":220,"wires":[["2474feca55a52fa6"]]},{"id":"abb0c74fb33494a7","type":"junction","z":"89a78322a7b36ae2","x":780,"y":220,"wires":[["9912d2deccb46658"]]},{"id":"feda33fbeb16ebd6","type":"junction","z":"89a78322a7b36ae2","x":640,"y":220,"wires":[["abb0c74fb33494a7"]]},{"id":"0afd2f2b2352a909","type":"junction","z":"56c911ff62a860ba","x":820,"y":2720,"wires":[["3829f58e5346acbe"]]},{"id":"f3c1d585e8c1c7aa","type":"junction","z":"56c911ff62a860ba","x":680,"y":2720,"wires":[["0afd2f2b2352a909"]]},{"id":"e711a4aa970a9ae5","type":"junction","z":"56c911ff62a860ba","x":440,"y":2720,"wires":[["236198ebec8250eb"]]},{"id":"45ba6c7a5dc2c856","type":"junction","z":"56c911ff62a860ba","x":300,"y":2720,"wires":[["e711a4aa970a9ae5"]]},{"id":"f639bebfc53ab0ca","type":"junction","z":"56c911ff62a860ba","x":460,"y":2880,"wires":[["78975ac16646d1d2"]]},{"id":"5a87f306db7cc2d8","type":"junction","z":"56c911ff62a860ba","x":300,"y":2880,"wires":[["f639bebfc53ab0ca"]]},{"id":"7f9505f93fed223b","type":"junction","z":"56c911ff62a860ba","x":300,"y":2940,"wires":[["585bc0c792956184"]]},{"id":"1b950bf56691e980","type":"junction","z":"56c911ff62a860ba","x":880,"y":2840,"wires":[["e0576eb5e30134c2"]]},{"id":"62afc933c5ab4425","type":"junction","z":"56c911ff62a860ba","x":740,"y":2840,"wires":[["1b950bf56691e980"]]},{"id":"585bc0c792956184","type":"junction","z":"56c911ff62a860ba","x":460,"y":2940,"wires":[["64d6748ddd537f10"]]},{"id":"51e1ef0d6364a338","type":"junction","z":"56c911ff62a860ba","x":1380,"y":2940,"wires":[["60a1fa9156969f48"]]},{"id":"fac8de6c16c3bc0d","type":"junction","z":"56c911ff62a860ba","x":880,"y":3020,"wires":[["37d18c429fbbf77d"]]},{"id":"422962b5a886c434","type":"junction","z":"56c911ff62a860ba","x":1020,"y":2940,"wires":[["b782f8d84067fbe5"]]},{"id":"dc9de2460902cda5","type":"junction","z":"56c911ff62a860ba","x":880,"y":2940,"wires":[["422962b5a886c434"]]},{"id":"37d18c429fbbf77d","type":"junction","z":"56c911ff62a860ba","x":1020,"y":3020,"wires":[["53028653048fea96"]]},{"id":"6f3b1854aba9221a","type":"junction","z":"f9b109c0bb255002","x":1060,"y":400,"wires":[["4a33f81d6476ee85"]]},{"id":"e0cf5c45b188f5cf","type":"junction","z":"f9b109c0bb255002","x":1580,"y":260,"wires":[["ec295a52cb3eda1e"]]},{"id":"b3185c68d8b2faf4","type":"junction","z":"f9b109c0bb255002","x":1040,"y":400,"wires":[["6f3b1854aba9221a"]]},{"id":"820f24cc65413b0e","type":"junction","z":"f9b109c0bb255002","x":980,"y":260,"wires":[["46f8eec09a9ff3aa","afecf1399e86a3be"]]},{"id":"dfbabf05fa5cf92e","type":"junction","z":"f9b109c0bb255002","x":1860,"y":400,"wires":[["9a3f87263f09b0b2"]]},{"id":"4a33f81d6476ee85","type":"junction","z":"f9b109c0bb255002","x":1580,"y":400,"wires":[["093f80f9b2b1e66a"]]},{"id":"d5f57a683303872c","type":"junction","z":"56c911ff62a860ba","x":980,"y":2500,"wires":[["09b22e59ecc224df"]]},{"id":"5518bc361860479b","type":"junction","z":"56c911ff62a860ba","x":1500,"y":2360,"wires":[["0c4a805dea4c7427"]]},{"id":"bd147fda0c88cc70","type":"junction","z":"56c911ff62a860ba","x":960,"y":2500,"wires":[["d5f57a683303872c"]]},{"id":"79b4373c7f81277b","type":"junction","z":"56c911ff62a860ba","x":900,"y":2360,"wires":[["1fe679033954ae4e"]]},{"id":"7259d2ee7447680a","type":"junction","z":"56c911ff62a860ba","x":1780,"y":2500,"wires":[["fb2143f4c309b849"]]},{"id":"09b22e59ecc224df","type":"junction","z":"56c911ff62a860ba","x":1500,"y":2500,"wires":[["deb09c33c273799c"]]},{"id":"765511fe394ed79e","type":"junction","z":"7a1172b433a6cf9c","x":920,"y":1540,"wires":[["90b3946ea1f5990a"]]},{"id":"13f083aa7fcdbbb3","type":"junction","z":"7a1172b433a6cf9c","x":1400,"y":1500,"wires":[["245f575b08d9315b"]]},{"id":"245f575b08d9315b","type":"junction","z":"7a1172b433a6cf9c","x":1440,"y":1500,"wires":[["90b3946ea1f5990a"]]},{"id":"b5fde2ec0dccab1b","type":"junction","z":"7a1172b433a6cf9c","x":1400,"y":1460,"wires":[["f1aded9aa1d31244"]]},{"id":"f1aded9aa1d31244","type":"junction","z":"7a1172b433a6cf9c","x":1660,"y":1460,"wires":[["d3684aa0d6eaa2ca"]]},{"id":"cd427e4cb5e4cc78","type":"junction","z":"7a1172b433a6cf9c","x":800,"y":1540,"wires":[["765511fe394ed79e"]]},{"id":"551085e979e7ad02","type":"junction","z":"7a1172b433a6cf9c","x":800,"y":1480,"wires":[["0c930675da160858"]]},{"id":"3af98f6b32a696f8","type":"junction","z":"7a1172b433a6cf9c","x":1680,"y":1540,"wires":[["5a5442d1f23b7408"]]},{"id":"2abb54a8f58fc02a","type":"junction","z":"7a1172b433a6cf9c","x":2500,"y":1580,"wires":[["8d18e180fa3f69b9"]]},{"id":"767790809a831eac","type":"junction","z":"56c911ff62a860ba","x":260,"y":3300,"wires":[["8350009f75c56ebb"]]},{"id":"52d630b4e77d7e77","type":"junction","z":"56c911ff62a860ba","x":240,"y":3540,"wires":[["d369acf347893c0c"]]},{"id":"0532ec8d34489382","type":"junction","z":"3ad1e0957e6ec22e","x":3320,"y":1940,"wires":[["e0565cdb0b796f1c"]]},{"id":"d6ae8e021a14f1f8","type":"junction","z":"7a1172b433a6cf9c","x":1040,"y":4520,"wires":[["fef3b8cf92956479"]]},{"id":"e2b164490e261b2e","type":"junction","z":"7a1172b433a6cf9c","x":2220,"y":4380,"wires":[["1adbf020674aa718"]]},{"id":"c287b382e15e5f08","type":"junction","z":"7a1172b433a6cf9c","x":1020,"y":4520,"wires":[["d6ae8e021a14f1f8"]]},{"id":"39d5c9e4758c7fc9","type":"junction","z":"7a1172b433a6cf9c","x":960,"y":4380,"wires":[["562eea6d12260ef5"]]},{"id":"0fce605628cae6c5","type":"junction","z":"7a1172b433a6cf9c","x":2500,"y":4520,"wires":[["c7328ff3b3210812"]]},{"id":"a859c56203270a9a","type":"junction","z":"7a1172b433a6cf9c","x":2220,"y":4520,"wires":[["014a7b93174a807c"]]},{"id":"8cf03937998b2895","type":"junction","z":"7a1172b433a6cf9c","x":1460,"y":4440,"wires":[["6b2d7e53cc62aa9a"]]},{"id":"6b2d7e53cc62aa9a","type":"junction","z":"7a1172b433a6cf9c","x":1500,"y":4440,"wires":[["fef3b8cf92956479"]]},{"id":"0f1734c3bbff9470","type":"junction","z":"7a1172b433a6cf9c","x":1500,"y":4360,"wires":[["f576f956d8ad0354"]]},{"id":"f576f956d8ad0354","type":"junction","z":"7a1172b433a6cf9c","x":1720,"y":4360,"wires":[["428acc7d03d3dd65"]]},{"id":"e87ed38d9ebaa6cc","type":"junction","z":"7a1172b433a6cf9c","x":1760,"y":4520,"wires":[["a859c56203270a9a"]]},{"id":"32e9a8f85df1ac27","type":"junction","z":"7a1172b433a6cf9c","x":1300,"y":3920,"wires":[["50d2465a2959808d"]]},{"id":"82c6c7d0bf3c6b93","type":"junction","z":"7a1172b433a6cf9c","x":1900,"y":3820,"wires":[["9edf5b12d774a90a"]]},{"id":"1fc38a6d436e5401","type":"junction","z":"89a78322a7b36ae2","x":1420,"y":1000,"wires":[["995c67a6597ab468","73634a14fd698218","26c3ccc9500c7846"]]},{"id":"82192b37abcc4854","type":"junction","z":"61f53235c712b2c2","x":1020,"y":1780,"wires":[["697afaa0745ef2cf"]]},{"id":"985a99418a6a34d8","type":"junction","z":"61f53235c712b2c2","x":1160,"y":1740,"wires":[["d27830fb5c6874f8"]]},{"id":"d27830fb5c6874f8","type":"junction","z":"61f53235c712b2c2","x":1320,"y":1760,"wires":[["23db831f71fb38a9"]]},{"id":"645eaecd29665487","type":"junction","z":"61f53235c712b2c2","x":1020,"y":1860,"wires":[["9d53d8bd58c36ae9"]]},{"id":"45e7615f1c4e98d2","type":"junction","z":"61f53235c712b2c2","x":1000,"y":1820,"wires":[["c7f8c03f4e7f1a1c"]]},{"id":"b00632a9d37853c4","type":"junction","z":"61f53235c712b2c2","x":1260,"y":1820,"wires":[["66bd23e455ac06d5"]]},{"id":"4ab99af8e3afe60d","type":"junction","z":"61f53235c712b2c2","x":1620,"y":1860,"wires":[["8ba7a0ebb6af727d"]]},{"id":"9d53d8bd58c36ae9","type":"junction","z":"61f53235c712b2c2","x":1260,"y":1860,"wires":[["b88d2595c62a74bb"]]},{"id":"2df99d0cff89b14c","type":"junction","z":"61f53235c712b2c2","x":1520,"y":1860,"wires":[["4ab99af8e3afe60d"]]},{"id":"21c70b070ae3c784","type":"junction","z":"61f53235c712b2c2","x":1940,"y":1760,"wires":[["0e8c29a971f690ca"]]},{"id":"d22cea5a615c3b79","type":"junction","z":"9e515b8aa75a9cdd","g":"824fe4cb22842d7f","x":1460,"y":260,"wires":[["d3c382301395300b"]]},{"id":"ee596aba36f6626b","type":"junction","z":"9e515b8aa75a9cdd","g":"824fe4cb22842d7f","x":1440,"y":180,"wires":[["d22cea5a615c3b79"]]},{"id":"33b091aa899cef65","type":"junction","z":"9e515b8aa75a9cdd","g":"824fe4cb22842d7f","x":1440,"y":160,"wires":[["21add955f677d2b7"]]},{"id":"728e32141df06317","type":"junction","z":"3ad1e0957e6ec22e","x":2480,"y":2180,"wires":[["23b7b5e9abb68123"]]},{"id":"e54b3fc56024cd1a","type":"junction","z":"3ad1e0957e6ec22e","x":2460,"y":2100,"wires":[["728e32141df06317"]]},{"id":"dd035c8734eac537","type":"junction","z":"3ad1e0957e6ec22e","x":2460,"y":2080,"wires":[["f57e09b77107a479"]]},{"id":"d736b69a3bfefc64","type":"junction","z":"3d9405faee8bc840","x":3300,"y":860,"wires":[["7f44ed3d3506189c"]]},{"id":"af4dc432adbed8da","type":"junction","z":"3d9405faee8bc840","x":3960,"y":840,"wires":[["547bf6bc39892b92"]]},{"id":"7f44ed3d3506189c","type":"junction","z":"3d9405faee8bc840","x":3700,"y":860,"wires":[["3c26495151dca113"]]},{"id":"54cb7c6c4d239427","type":"junction","z":"3d9405faee8bc840","x":3160,"y":860,"wires":[["d736b69a3bfefc64"]]},{"id":"bf81e69c2972b1f4","type":"junction","z":"f8abdd9653af834e","x":920,"y":740,"wires":[["adf3d5e1856c236a","9a82ab90b85d2bb3"]]},{"id":"9b28eff28ebee678","type":"junction","z":"f8abdd9653af834e","x":660,"y":740,"wires":[["4ff95a5111ec8084","ad58ae9a58134317"]]},{"id":"71fabfca7b4822f8","type":"junction","z":"f8abdd9653af834e","x":900,"y":920,"wires":[["490b9a310e45b569"]]},{"id":"d94be274450d8367","type":"junction","z":"f8abdd9653af834e","x":640,"y":920,"wires":[["8abcf914f5cd4f9f"]]},{"id":"72ad3c21a0eccc80","type":"junction","z":"56c911ff62a860ba","x":1020,"y":4520,"wires":[["19134c9f6301f620"]]},{"id":"3e8a41b674122b66","type":"junction","z":"56c911ff62a860ba","x":1160,"y":4480,"wires":[["7465762f5efa9bd6"]]},{"id":"7465762f5efa9bd6","type":"junction","z":"56c911ff62a860ba","x":1320,"y":4500,"wires":[["b8f8b3ddd7dd6fc0"]]},{"id":"f819df21174b26ee","type":"junction","z":"56c911ff62a860ba","x":1000,"y":4600,"wires":[["860a651fd82196b2"]]},{"id":"5d43ee01bb7b15cd","type":"junction","z":"56c911ff62a860ba","x":1000,"y":4560,"wires":[["ce0f449abcde3750"]]},{"id":"039a10fd2af9f969","type":"junction","z":"56c911ff62a860ba","x":1260,"y":4560,"wires":[["55f0a526ba729d77"]]},{"id":"bb1bca2bc9621ec6","type":"junction","z":"56c911ff62a860ba","x":1620,"y":4600,"wires":[["424cf08b2a94875d","b715c3cb842ad2a5","83deeefdbbac5a61"]]},{"id":"860a651fd82196b2","type":"junction","z":"56c911ff62a860ba","x":1260,"y":4600,"wires":[["0ac503a61ccf454c"]]},{"id":"a0cb7613100fad18","type":"junction","z":"56c911ff62a860ba","x":1520,"y":4600,"wires":[["bb1bca2bc9621ec6"]]},{"id":"bd1bb829a3c241ee","type":"junction","z":"56c911ff62a860ba","x":1940,"y":4500,"wires":[["98702dbb26e3ab8b"]]},{"id":"d3f50841c197172b","type":"junction","z":"666f64b87ddc48a7","x":1010,"y":980,"wires":[["b86acc1242fde04d"]]},{"id":"9c5e34bd3f7d518e","type":"junction","z":"666f64b87ddc48a7","x":1150,"y":940,"wires":[["406fa8a8e97a3295"]]},{"id":"406fa8a8e97a3295","type":"junction","z":"666f64b87ddc48a7","x":1310,"y":960,"wires":[["f8d9c3dd34151818"]]},{"id":"844393205939ad55","type":"junction","z":"666f64b87ddc48a7","x":1010,"y":1060,"wires":[["87c7a55fa57cbabf"]]},{"id":"aa0122737509c6fc","type":"junction","z":"666f64b87ddc48a7","x":990,"y":1020,"wires":[["88b10389f6548132"]]},{"id":"9c1a91c047dcd429","type":"junction","z":"666f64b87ddc48a7","x":1250,"y":1020,"wires":[["c76d55840f276476"]]},{"id":"4f95f32186f6bb15","type":"junction","z":"666f64b87ddc48a7","x":1610,"y":1060,"wires":[["cd18b173fc618309"]]},{"id":"87c7a55fa57cbabf","type":"junction","z":"666f64b87ddc48a7","x":1250,"y":1060,"wires":[["40474d998686368b"]]},{"id":"3c2ed831098ee12d","type":"junction","z":"666f64b87ddc48a7","x":1510,"y":1060,"wires":[["4f95f32186f6bb15"]]},{"id":"c63977aa6eb88db6","type":"junction","z":"666f64b87ddc48a7","x":1930,"y":960,"wires":[["6929e531e3c5a8ea"]]},{"id":"209ff8ef.59a5d8","type":"server","name":"Home Assistant","version":5,"addon":true,"rejectUnauthorizedCerts":true,"ha_boolean":"y|yes|true|on|home|open","connectionDelay":true,"cacheJson":true,"heartbeat":false,"heartbeatInterval":30,"areaSelector":"friendlyName","deviceSelector":"friendlyName","entitySelector":"friendlyName","statusSeparator":"at: ","statusYear":"hidden","statusMonth":"short","statusDay":"numeric","statusHourCycle":"h23","statusTimeFormat":"h:m","enableGlobalContextStore":true},{"id":"7ab5c227.a3ce8c","type":"server","name":"Home Assistant","version":5,"addon":true,"rejectUnauthorizedCerts":true,"ha_boolean":"y|yes|true|on|home|open","connectionDelay":true,"cacheJson":true,"heartbeat":false,"heartbeatInterval":"30","areaSelector":"friendlyName","deviceSelector":"friendlyName","entitySelector":"friendlyName","statusSeparator":"at: ","statusYear":"hidden","statusMonth":"short","statusDay":"numeric","statusHourCycle":"h23","statusTimeFormat":"h:m","enableGlobalContextStore":true},{"id":"21000c19b97da572","type":"mqtt-broker","name":"Mqtt Server","broker":"127.0.0.1","port":"1883","clientid":"","autoConnect":true,"usetls":false,"compatmode":false,"protocolVersion":"4","keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","birthMsg":{},"closeTopic":"","closeQos":"0","closePayload":"","closeMsg":{},"willTopic":"","willQos":"0","willPayload":"","willMsg":{},"userProps":"","sessionExpiry":""},{"id":"224349d2603c916d","type":"api-call-service","z":"eb3b6592c8406c0d","name":"cast to display","server":"7ab5c227.a3ce8c","version":5,"debugenabled":true,"domain":"media_player","service":"play_media","areaId":[],"deviceId":[],"entityId":["media_player.livingroom_chromecast"],"data":"{\"media_content_type\":\"image\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1360,"y":300,"wires":[["c0dd1bf693615888"]]},{"id":"c0dd1bf693615888","type":"trigger","z":"eb3b6592c8406c0d","name":"","op1":"","op2":"1","op1type":"nul","op2type":"num","duration":"20","extend":false,"units":"s","reset":"closed","bytopic":"all","outputs":1,"x":1550,"y":300,"wires":[["f9563b83d9917e68"]]},{"id":"f9563b83d9917e68","type":"api-call-service","z":"eb3b6592c8406c0d","name":"change source","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"select_source","areaId":[],"deviceId":[],"entityId":["media_player.living_room_lg"],"data":"{\"source\":\"HDMI 2\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1720,"y":300,"wires":[[]]},{"id":"e34932fd524f4fc2","type":"api-current-state","z":"eb3b6592c8406c0d","name":"Hotbox TV?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"idle","halt_if_type":"str","halt_if_compare":"is_not","entity_id":"media_player.hotbox_top_chromecast","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":810,"y":500,"wires":[["f1bc8dbc651cc925"],["e2cbd9ca626a07c0"]]},{"id":"f1bc8dbc651cc925","type":"change","z":"eb3b6592c8406c0d","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":980,"y":500,"wires":[["e22a4d57d9df6967"]]},{"id":"e2cbd9ca626a07c0","type":"api-call-service","z":"eb3b6592c8406c0d","name":"cast to display","server":"7ab5c227.a3ce8c","version":5,"debugenabled":true,"domain":"media_player","service":"play_media","areaId":[],"deviceId":[],"entityId":["media_player.hotbox_top_chromecast"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":980,"y":540,"wires":[["389277edde2f7713"]]},{"id":"e22a4d57d9df6967","type":"api-call-service","z":"eb3b6592c8406c0d","name":"hotbox tv","server":"7ab5c227.a3ce8c","version":5,"debugenabled":true,"domain":"media_player","service":"media_pause","areaId":[],"deviceId":[],"entityId":[],"data":"{\"entity_id\":\"media_player.hotbox_tv\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1140,"y":500,"wires":[[]]},{"id":"389277edde2f7713","type":"trigger","z":"eb3b6592c8406c0d","name":"","op1":"","op2":"1","op1type":"nul","op2type":"num","duration":"20","extend":false,"units":"s","reset":"closed","bytopic":"all","outputs":1,"x":1150,"y":540,"wires":[["e8ac07aa3bb01b82"]]},{"id":"e8ac07aa3bb01b82","type":"api-call-service","z":"eb3b6592c8406c0d","name":"stop cast","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"turn_off","areaId":[],"deviceId":[],"entityId":["media_player.hotbox_top_chromecast"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1300,"y":540,"wires":[[]]},{"id":"707a9031aaac3456","type":"delay","z":"eb3b6592c8406c0d","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":550,"y":240,"wires":[["e34932fd524f4fc2","8ea772f3a7865a10","16559f64d09f6a4c","98921ce2a949a88f"]]},{"id":"8ea772f3a7865a10","type":"api-current-state","z":"eb3b6592c8406c0d","name":"Living Room  TV?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"playing","halt_if_type":"str","halt_if_compare":"is","entity_id":"media_player.living_room_chromecast","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"input","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":810,"y":280,"wires":[["abca03ae387e14c4"],["7b5e66492d54fed8"]]},{"id":"9ca31051c3c34499","type":"api-current-state","z":"eb3b6592c8406c0d","name":"Patio TV?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"idle","halt_if_type":"str","halt_if_compare":"is_not","entity_id":"media_player.patio_chromecast","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":1180,"y":160,"wires":[["a0030c9551cb7906"],["1df70d22a7b1e659"]]},{"id":"a0030c9551cb7906","type":"change","z":"eb3b6592c8406c0d","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1360,"y":160,"wires":[["baa39e8c2f86ee28"]]},{"id":"1df70d22a7b1e659","type":"api-call-service","z":"eb3b6592c8406c0d","name":"cast to display","server":"7ab5c227.a3ce8c","version":5,"debugenabled":true,"domain":"media_player","service":"play_media","areaId":[],"deviceId":[],"entityId":["media_player.patio_chromecast"],"data":"{\"media_content_type\":\"image\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1360,"y":200,"wires":[["2dafd6dbb68cb168"]]},{"id":"baa39e8c2f86ee28","type":"api-call-service","z":"eb3b6592c8406c0d","name":"pause patio TV","server":"7ab5c227.a3ce8c","version":5,"debugenabled":true,"domain":"media_player","service":"media_pause","areaId":[],"deviceId":[],"entityId":["media_player.patio_chromecast"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1540,"y":160,"wires":[[]]},{"id":"2dafd6dbb68cb168","type":"trigger","z":"eb3b6592c8406c0d","name":"","op1":"","op2":"1","op1type":"nul","op2type":"num","duration":"40","extend":false,"overrideDelay":false,"units":"s","reset":"closed","bytopic":"all","topic":"topic","outputs":1,"x":1530,"y":200,"wires":[["1a1dba7b1cca12a0"]]},{"id":"1a1dba7b1cca12a0","type":"api-call-service","z":"eb3b6592c8406c0d","name":"stop cast","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"turn_off","areaId":[],"deviceId":[],"entityId":["media_player.patio_chromecast"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1680,"y":200,"wires":[[]]},{"id":"16559f64d09f6a4c","type":"api-current-state","z":"eb3b6592c8406c0d","name":"Patio tv?","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is_not","entity_id":"media_player.patio_chromecast","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"input","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":860,"y":160,"wires":[["9ca31051c3c34499"]]},{"id":"98921ce2a949a88f","type":"api-current-state","z":"eb3b6592c8406c0d","name":"Bedroom TV?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"idle","halt_if_type":"str","halt_if_compare":"is_not","entity_id":"media_player.bedroom_chromecast","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":840,"y":620,"wires":[["7a2d4a5d5aa8e751"],["51cda7c866f682df"]]},{"id":"7a2d4a5d5aa8e751","type":"change","z":"eb3b6592c8406c0d","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1020,"y":620,"wires":[["97b924081c955582"]]},{"id":"51cda7c866f682df","type":"api-call-service","z":"eb3b6592c8406c0d","name":"cast to display","server":"7ab5c227.a3ce8c","version":5,"debugenabled":true,"domain":"media_player","service":"play_media","areaId":[],"deviceId":[],"entityId":["media_player.bedroom_chromecast"],"data":"{\"media_content_type\":\"image\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1020,"y":660,"wires":[["013846de371efed4"]]},{"id":"97b924081c955582","type":"api-call-service","z":"eb3b6592c8406c0d","name":"pause patio TV","server":"7ab5c227.a3ce8c","version":5,"debugenabled":true,"domain":"media_player","service":"media_pause","areaId":[],"deviceId":[],"entityId":["media_player.bedroom_chromecast"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1200,"y":620,"wires":[[]]},{"id":"013846de371efed4","type":"trigger","z":"eb3b6592c8406c0d","name":"","op1":"","op2":"1","op1type":"nul","op2type":"num","duration":"20","extend":false,"units":"s","reset":"closed","bytopic":"all","outputs":1,"x":1190,"y":660,"wires":[["5454772741f9301f"]]},{"id":"5454772741f9301f","type":"api-call-service","z":"eb3b6592c8406c0d","name":"stop cast","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"turn_off","areaId":[],"deviceId":[],"entityId":["media_player.bedroom_chromecast"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1340,"y":660,"wires":[[]]},{"id":"abca03ae387e14c4","type":"change","z":"eb3b6592c8406c0d","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1020,"y":260,"wires":[["23dc244ef1c23367"]]},{"id":"23dc244ef1c23367","type":"api-call-service","z":"eb3b6592c8406c0d","name":"pause living room tv","server":"7ab5c227.a3ce8c","version":5,"debugenabled":true,"domain":"media_player","service":"media_pause","areaId":[],"deviceId":[],"entityId":["media_player.living_room_chromecast"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1220,"y":260,"wires":[[]]},{"id":"7b5e66492d54fed8","type":"api-current-state","z":"eb3b6592c8406c0d","name":"Living Room LG?","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"media_player.living_room_lg","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"input","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":1030,"y":300,"wires":[["f045c367f79fa779"]]},{"id":"f045c367f79fa779","type":"switch","z":"eb3b6592c8406c0d","name":"","property":"payload.attributes.source","propertyType":"msg","rules":[{"t":"eq","v":"HDMI 2","vt":"str"},{"t":"neq","v":"HDMI 2","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1190,"y":300,"wires":[["224349d2603c916d"],["65b5586a5a9a4c80"]]},{"id":"65b5586a5a9a4c80","type":"api-call-service","z":"eb3b6592c8406c0d","name":"cast to display","server":"7ab5c227.a3ce8c","version":5,"debugenabled":true,"domain":"media_player","service":"play_media","areaId":[],"deviceId":[],"entityId":["media_player.living_room_chromecast"],"data":"{\"media_content_type\":\"image\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1360,"y":340,"wires":[["0dde2d864d9d91ed"]]},{"id":"0dde2d864d9d91ed","type":"trigger","z":"eb3b6592c8406c0d","name":"","op1":"","op2":"1","op1type":"nul","op2type":"num","duration":"20","extend":false,"units":"s","reset":"closed","bytopic":"all","outputs":1,"x":1550,"y":340,"wires":[["4dc106bc3b4f42b6"]]},{"id":"4dc106bc3b4f42b6","type":"api-call-service","z":"eb3b6592c8406c0d","name":"stop","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"media_stop","areaId":[],"deviceId":[],"entityId":["media_player.living_room_chromecast"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1690,"y":340,"wires":[[]]},{"id":"e200c956be50b58a","type":"function","z":"cd4b600533b9308c","name":"Time","func":"var d = new Date();\nvar h = d.getHours();\nvar entity = msg.entity.entity_id\nvar sensor = msg.sensor\nvar sensorstate = msg.sensorstate\nif (h > 22){\n    var brightness = \"80\";\n}\nelse if (h >= 0 && h <= 2 ){\n    var brightness = \"70\";\n}\nelse if (h>2 && h<7){\n    var brightness = \"50\";\n}\nelse{\n    var brightness = \"100\";\n}\n\nvar newMsg = \n\n{ \n    \"payload\": {\n                data: {\n                         \"brightness_pct\": brightness,\n                         \"entity_id\": entity,\n                         \"color_name\": \"white\"\n                }\n               },\n               sensor: sensor,\n               sensorstate: sensorstate\n};\nreturn newMsg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":190,"y":120,"wires":[["8446e240fea72b05"]]},{"id":"8446e240fea72b05","type":"api-call-service","z":"cd4b600533b9308c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload.entity_id","propertyType":"msg","value":"sensor","valueType":"msg"}],"queue":"none","x":370,"y":120,"wires":[["ba1bb1c238035d63","8410cab5f0ef75fb"]]},{"id":"ba1bb1c238035d63","type":"ha-wait-until","z":"cd4b600533b9308c","name":"","server":"7ab5c227.a3ce8c","version":2,"outputs":1,"entityId":"","entityIdFilterType":"exact","property":"state","comparator":"is","value":"off","valueType":"str","timeout":"","timeoutType":"num","timeoutUnits":"seconds","checkCurrentState":true,"blockInputOverrides":false,"outputProperties":[],"x":600,"y":80,"wires":[["cbbfb444b8ddacab"]]},{"id":"cbbfb444b8ddacab","type":"trigger","z":"cd4b600533b9308c","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"5","extend":false,"overrideDelay":false,"units":"min","reset":"on","bytopic":"all","topic":"topic","outputs":1,"x":790,"y":120,"wires":[["51fe06785e465053"]]},{"id":"e82daf089875cb7f","type":"api-call-service","z":"cd4b600533b9308c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload.entity_id","propertyType":"msg","value":"sensor","valueType":"msg"}],"queue":"none","x":1890,"y":120,"wires":[[]]},{"id":"8410cab5f0ef75fb","type":"change","z":"cd4b600533b9308c","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"sensorstate","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":610,"y":140,"wires":[["cbbfb444b8ddacab"]]},{"id":"51fe06785e465053","type":"change","z":"cd4b600533b9308c","name":"delete brightness","rules":[{"t":"delete","p":"payload.data.brightness_pct","pt":"msg"},{"t":"delete","p":"payload.data.color_name","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1010,"y":120,"wires":[["d360eb355a7a9c3c"]]},{"id":"d360eb355a7a9c3c","type":"api-current-state","z":"cd4b600533b9308c","name":"Kink","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.kink_party","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"entity.entity_id","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":1210,"y":120,"wires":[["7e7cd0983214d0ef"],[]]},{"id":"7e7cd0983214d0ef","type":"api-current-state","z":"cd4b600533b9308c","name":"Party","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.party_mode","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"entity.entity_id","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":1330,"y":120,"wires":[["435c8172eadcee36"],[]]},{"id":"089cb36f61ae5734","type":"comment","z":"cd4b600533b9308c","name":"Light turn on","info":"","x":370,"y":80,"wires":[]},{"id":"7330ec350dd8db98","type":"comment","z":"cd4b600533b9308c","name":"Brightness selector","info":"","x":170,"y":80,"wires":[]},{"id":"c0b199f4552e2bb0","type":"comment","z":"cd4b600533b9308c","name":"wait motionn off","info":"","x":600,"y":40,"wires":[]},{"id":"e55294af08fb27c0","type":"comment","z":"cd4b600533b9308c","name":"set reset","info":"","x":600,"y":180,"wires":[]},{"id":"31a0e62d277ec267","type":"comment","z":"cd4b600533b9308c","name":"wait 5 minutes","info":"","x":790,"y":160,"wires":[]},{"id":"da09a98c9f8f89bd","type":"comment","z":"cd4b600533b9308c","name":"delete brightness payload","info":"","x":990,"y":80,"wires":[]},{"id":"8b54536692505205","type":"comment","z":"cd4b600533b9308c","name":"Condfitions check","info":"","x":1260,"y":80,"wires":[]},{"id":"bcfdca0959ea0c5f","type":"comment","z":"cd4b600533b9308c","name":"Turn light off","info":"","x":1890,"y":80,"wires":[]},{"id":"435c8172eadcee36","type":"api-current-state","z":"cd4b600533b9308c","name":"psychs","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.acid_time","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"entity.entity_id","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":1490,"y":120,"wires":[["e82daf089875cb7f"],[]]},{"id":"11f21ab76a3a546b","type":"debug","z":"dfb97c6505f003d9","name":"test ici 2","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2540,"y":500,"wires":[]},{"id":"ac96ceaf6db5e36c","type":"delay","z":"dfb97c6505f003d9","name":"Lights","pauseType":"rate","timeout":"1","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"5","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"allowrate":false,"outputs":1,"x":330,"y":700,"wires":[["07dc2e9ad30b5777","e6854572b01c4317","158b49848844d1b0","2a9ca44eddcc7884","a28f7b4e5938455a","79b5832995dc742f"]]},{"id":"07dc2e9ad30b5777","type":"api-current-state","z":"dfb97c6505f003d9","name":"light.patio","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.patio_notification_light","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"status","propertyType":"msg","value":"","valueType":"entityState"},{"property":"entity_old","propertyType":"msg","value":"","valueType":"entity"},{"property":"entity_id","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":500,"y":960,"wires":[["7f74db0678fe88b5"]],"outputLabels":["data.attributes"]},{"id":"e6854572b01c4317","type":"api-current-state","z":"dfb97c6505f003d9","name":"light.hotbox_lights","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.hotbox_lights","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"status","propertyType":"msg","value":"","valueType":"entityState"},{"property":"entity_old","propertyType":"msg","value":"","valueType":"entity"},{"property":"entity_id","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":530,"y":880,"wires":[["322fdae5fabd2958"]],"outputLabels":["data.attributes"]},{"id":"158b49848844d1b0","type":"api-current-state","z":"dfb97c6505f003d9","name":"light.kitchen_lights","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.group_kitchen_lights","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"status","propertyType":"msg","value":"","valueType":"entityState"},{"property":"entity_old","propertyType":"msg","value":"","valueType":"entity"},{"property":"entity_id","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":530,"y":800,"wires":[["e95dc67ec2ac1da0"]],"outputLabels":["data.attributes"]},{"id":"2a9ca44eddcc7884","type":"api-current-state","z":"dfb97c6505f003d9","name":"light.entrance_in","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.group_entrance_lights","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"status","propertyType":"msg","value":"","valueType":"entityState"},{"property":"entity_old","propertyType":"msg","value":"","valueType":"entity"},{"property":"entity_id","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":520,"y":720,"wires":[["1071993451a1b643"]],"outputLabels":["data.attributes"]},{"id":"7f74db0678fe88b5","type":"change","z":"dfb97c6505f003d9","name":"rules","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.data.rgb_color","pt":"msg","to":"color_value","tot":"msg"},{"t":"set","p":"payload.data.brightness_pct","pt":"msg","to":"dbrigthness","tot":"msg"},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":710,"y":960,"wires":[["93cc7873913fe128"]]},{"id":"322fdae5fabd2958","type":"change","z":"dfb97c6505f003d9","name":"rules","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.data.rgb_color","pt":"msg","to":"color_value","tot":"msg"},{"t":"set","p":"payload.data.brightness_pct","pt":"msg","to":"dbrigthness","tot":"msg"},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":710,"y":880,"wires":[["a4b755ee5b36c49c"]]},{"id":"e95dc67ec2ac1da0","type":"change","z":"dfb97c6505f003d9","name":"rules","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.data.rgb_color","pt":"msg","to":"color_value","tot":"msg"},{"t":"set","p":"payload.data.brightness_pct","pt":"msg","to":"dbrigthness","tot":"msg"},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":710,"y":800,"wires":[["810f3685e8436eda"]]},{"id":"1071993451a1b643","type":"change","z":"dfb97c6505f003d9","name":"rules","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.data.rgb_color","pt":"msg","to":"color_value","tot":"msg"},{"t":"set","p":"payload.data.brightness_pct","pt":"msg","to":"dbrigthness","tot":"msg"},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":710,"y":720,"wires":[["4907adb9b35b3037"]]},{"id":"93cc7873913fe128","type":"api-call-service","z":"dfb97c6505f003d9","name":"Change Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":920,"y":960,"wires":[["29e689216c49f3db"]]},{"id":"a4b755ee5b36c49c","type":"api-call-service","z":"dfb97c6505f003d9","name":"Change Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":920,"y":880,"wires":[["a2ba28437ceb0e1a"]]},{"id":"810f3685e8436eda","type":"api-call-service","z":"dfb97c6505f003d9","name":"Change Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":920,"y":800,"wires":[["7cdd1d739d989e9f"]]},{"id":"4907adb9b35b3037","type":"api-call-service","z":"dfb97c6505f003d9","name":"Change Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":920,"y":720,"wires":[["5be63b0010fbf37e"]]},{"id":"29e689216c49f3db","type":"delay","z":"dfb97c6505f003d9","name":"","pauseType":"random","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"1","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1080,"y":960,"wires":[["a7cb77d8af35aa95"]]},{"id":"a2ba28437ceb0e1a","type":"delay","z":"dfb97c6505f003d9","name":"","pauseType":"random","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"1","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1080,"y":880,"wires":[["46fd7f4081e96254"]]},{"id":"7cdd1d739d989e9f","type":"delay","z":"dfb97c6505f003d9","name":"","pauseType":"random","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"1","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1080,"y":800,"wires":[["325804bf9f3917a8"]]},{"id":"5be63b0010fbf37e","type":"delay","z":"dfb97c6505f003d9","name":"","pauseType":"random","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"1","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1080,"y":720,"wires":[["9062ea12d3fd7fb7"]]},{"id":"a7cb77d8af35aa95","type":"change","z":"dfb97c6505f003d9","name":"","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.data.rgb_color","pt":"msg","to":"entity_old.attributes.rgb_color","tot":"msg"},{"t":"set","p":"payload.data.brightness","pt":"msg","to":"entity_old.attributes.brightness","tot":"msg"},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1240,"y":960,"wires":[["f13be4bf5a0730a7"]]},{"id":"46fd7f4081e96254","type":"change","z":"dfb97c6505f003d9","name":"","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.data.rgb_color","pt":"msg","to":"entity_old.attributes.rgb_color","tot":"msg"},{"t":"set","p":"payload.data.brightness","pt":"msg","to":"entity_old.attributes.brightness","tot":"msg"},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1240,"y":880,"wires":[["61dfbc1428636755"]]},{"id":"325804bf9f3917a8","type":"change","z":"dfb97c6505f003d9","name":"","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.data.rgb_color","pt":"msg","to":"entity_old.attributes.rgb_color","tot":"msg"},{"t":"set","p":"payload.data.brightness","pt":"msg","to":"entity_old.attributes.brightness","tot":"msg"},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1240,"y":800,"wires":[["e4bef3e05a0edb82"]]},{"id":"9062ea12d3fd7fb7","type":"change","z":"dfb97c6505f003d9","name":"","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.data.rgb_color","pt":"msg","to":"entity_old.attributes.rgb_color","tot":"msg"},{"t":"set","p":"payload.data.brightness","pt":"msg","to":"entity_old.attributes.brightness","tot":"msg"},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1240,"y":720,"wires":[["b61ba7719812f140"]]},{"id":"f13be4bf5a0730a7","type":"template","z":"dfb97c6505f003d9","name":"Extract status","field":"payload.service","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"\"turn_{{status}}\"","output":"json","x":1440,"y":960,"wires":[["e4926f5a6a42c3cf"]]},{"id":"61dfbc1428636755","type":"template","z":"dfb97c6505f003d9","name":"Extract status","field":"payload.service","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"\"turn_{{status}}\"","output":"json","x":1440,"y":880,"wires":[["a981a3acda3bf7f2"]]},{"id":"e4bef3e05a0edb82","type":"template","z":"dfb97c6505f003d9","name":"Extract status","field":"payload.service","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"\"turn_{{status}}\"","output":"json","x":1440,"y":800,"wires":[["1242d3d4030389f5"]]},{"id":"b61ba7719812f140","type":"template","z":"dfb97c6505f003d9","name":"Extract status","field":"payload.service","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"\"turn_{{status}}\"","output":"json","x":1440,"y":720,"wires":[["82ccf490a0bd5dbf"]]},{"id":"e4926f5a6a42c3cf","type":"api-call-service","z":"dfb97c6505f003d9","name":"Change Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1640,"y":960,"wires":[["2e686d1b8ac123ef"]]},{"id":"a981a3acda3bf7f2","type":"api-call-service","z":"dfb97c6505f003d9","name":"Change Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1640,"y":880,"wires":[["3fa979185b00a86c"]]},{"id":"1242d3d4030389f5","type":"api-call-service","z":"dfb97c6505f003d9","name":"Change Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1640,"y":800,"wires":[["a6453d0cdf185a00"]]},{"id":"82ccf490a0bd5dbf","type":"api-call-service","z":"dfb97c6505f003d9","name":"Change Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1640,"y":720,"wires":[["3dd2b1f3ac581194"]]},{"id":"593a650c23e05eda","type":"switch","z":"dfb97c6505f003d9","name":"!=rain","property":"data.attributes.rgb_color","propertyType":"msg","rules":[{"t":"eq","v":"color_value","vt":"msg"}],"checkall":"true","repair":false,"outputs":1,"x":1750,"y":920,"wires":[["e4926f5a6a42c3cf"]]},{"id":"2e686d1b8ac123ef","type":"api-current-state","z":"dfb97c6505f003d9","name":"light.patio","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.patio_notification_light","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":1820,"y":960,"wires":[["593a650c23e05eda"]]},{"id":"8b669eb0ffc4fdc0","type":"switch","z":"dfb97c6505f003d9","name":"!=rain","property":"data.attributes.rgb_color","propertyType":"msg","rules":[{"t":"eq","v":"color_value","vt":"msg"}],"checkall":"true","repair":false,"outputs":1,"x":1750,"y":840,"wires":[["a981a3acda3bf7f2"]]},{"id":"3fa979185b00a86c","type":"api-current-state","z":"dfb97c6505f003d9","name":"light.hotbox_lights","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.hotbox_lights","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":1850,"y":880,"wires":[["8b669eb0ffc4fdc0"]]},{"id":"4756af2cf9966227","type":"switch","z":"dfb97c6505f003d9","name":"!=rain","property":"data.attributes.rgb_color","propertyType":"msg","rules":[{"t":"eq","v":"color_value","vt":"msg"}],"checkall":"true","repair":false,"outputs":1,"x":1750,"y":760,"wires":[["1242d3d4030389f5"]]},{"id":"a6453d0cdf185a00","type":"api-current-state","z":"dfb97c6505f003d9","name":"light.kitchen_lights","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.group_kitchen_lights","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":1850,"y":800,"wires":[["4756af2cf9966227"]]},{"id":"09de7d2338bffacc","type":"switch","z":"dfb97c6505f003d9","name":"!=rain","property":"data.attributes.rgb_color","propertyType":"msg","rules":[{"t":"eq","v":"color_value","vt":"msg"}],"checkall":"true","repair":false,"outputs":1,"x":1750,"y":680,"wires":[["82ccf490a0bd5dbf"]]},{"id":"3dd2b1f3ac581194","type":"api-current-state","z":"dfb97c6505f003d9","name":"light.entrance_in","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.group_entrance_lights","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":1840,"y":720,"wires":[["09de7d2338bffacc"]]},{"id":"a28f7b4e5938455a","type":"api-current-state","z":"dfb97c6505f003d9","name":"light.livingroom_lights","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.group_livingroom_lights","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"status","propertyType":"msg","value":"","valueType":"entityState"},{"property":"entity_old","propertyType":"msg","value":"","valueType":"entity"},{"property":"entity_id","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":540,"y":640,"wires":[["f6eab789cbd882e3"]],"outputLabels":["data.attributes"]},{"id":"33a55975615f8545","type":"api-call-service","z":"dfb97c6505f003d9","name":"Change Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1640,"y":640,"wires":[["cc4c3fcc17a0914e"]]},{"id":"d4085f68174c73d8","type":"change","z":"dfb97c6505f003d9","name":"","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.data.rgb_color","pt":"msg","to":"entity_old.attributes.rgb_color","tot":"msg"},{"t":"set","p":"payload.data.brightness","pt":"msg","to":"entity_old.attributes.brightness","tot":"msg"},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1240,"y":640,"wires":[["7921d8c3beb64e57"]]},{"id":"7921d8c3beb64e57","type":"template","z":"dfb97c6505f003d9","name":"Extract status","field":"payload.service","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"\"turn_{{status}}\"","output":"json","x":1440,"y":640,"wires":[["33a55975615f8545"]]},{"id":"da340bab1bfeabb6","type":"delay","z":"dfb97c6505f003d9","name":"","pauseType":"random","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"1","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1080,"y":640,"wires":[["d4085f68174c73d8"]]},{"id":"f6eab789cbd882e3","type":"change","z":"dfb97c6505f003d9","name":"rules","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.data.rgb_color","pt":"msg","to":"color_value","tot":"msg"},{"t":"set","p":"payload.data.brightness_pct","pt":"msg","to":"dbrigthness","tot":"msg"},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":710,"y":640,"wires":[["d0e9bcb81e15c2e3"]]},{"id":"d0e9bcb81e15c2e3","type":"api-call-service","z":"dfb97c6505f003d9","name":"Change Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":920,"y":640,"wires":[["da340bab1bfeabb6"]]},{"id":"cc4c3fcc17a0914e","type":"api-current-state","z":"dfb97c6505f003d9","name":"light.livingroom_lights","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.group_livingroom_lights","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":1860,"y":640,"wires":[["cb4d9f0c4110702b"]]},{"id":"cb4d9f0c4110702b","type":"switch","z":"dfb97c6505f003d9","name":"!=rain","property":"data.attributes.rgb_color","propertyType":"msg","rules":[{"t":"eq","v":"color_value","vt":"msg"}],"checkall":"true","repair":false,"outputs":1,"x":1750,"y":600,"wires":[["33a55975615f8545"]]},{"id":"8c7456abb749808a","type":"api-current-state","z":"dfb97c6505f003d9","name":"light.bedroom_lights","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.bedroom_lights","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"status","propertyType":"msg","value":"","valueType":"entityState"},{"property":"entity_old","propertyType":"msg","value":"","valueType":"entity"},{"property":"entity_id","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":1060,"y":560,"wires":[["37bcb81b399086ae","151efa7534923119"]],"outputLabels":["data.attributes"]},{"id":"56de61e0d809ba77","type":"api-call-service","z":"dfb97c6505f003d9","name":"Change Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2160,"y":560,"wires":[["895d6a84e56f8bfe","11f21ab76a3a546b"]]},{"id":"7912b9b681500142","type":"change","z":"dfb97c6505f003d9","name":"","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.data.rgb_color","pt":"msg","to":"entity_old.attributes.rgb_color","tot":"msg"},{"t":"set","p":"payload.data.brightness","pt":"msg","to":"entity_old.attributes.brightness","tot":"msg"},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1760,"y":560,"wires":[["864c932a3c4c250b"]]},{"id":"864c932a3c4c250b","type":"template","z":"dfb97c6505f003d9","name":"Extract status","field":"payload.service","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"\"turn_{{status}}\"","output":"json","x":1960,"y":560,"wires":[["56de61e0d809ba77"]]},{"id":"fbaa2e568aba0ee0","type":"delay","z":"dfb97c6505f003d9","name":"","pauseType":"random","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"1","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1600,"y":560,"wires":[["7912b9b681500142"]]},{"id":"37bcb81b399086ae","type":"change","z":"dfb97c6505f003d9","name":"rules","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.data.rgb_color","pt":"msg","to":"color_value","tot":"msg"},{"t":"set","p":"payload.data.brightness_pct","pt":"msg","to":"dbrigthness","tot":"msg"},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1230,"y":560,"wires":[["92e1ed806843cd80"]]},{"id":"92e1ed806843cd80","type":"api-call-service","z":"dfb97c6505f003d9","name":"Change Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1400,"y":560,"wires":[["fbaa2e568aba0ee0"]]},{"id":"895d6a84e56f8bfe","type":"api-current-state","z":"dfb97c6505f003d9","name":"light.bedroom_lights","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.bedroom_lights","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":2380,"y":560,"wires":[["9e0951868dbe15d2","11f21ab76a3a546b"]]},{"id":"9e0951868dbe15d2","type":"switch","z":"dfb97c6505f003d9","name":"!=rain","property":"data.attributes.rgb_color","propertyType":"msg","rules":[{"t":"eq","v":"color_value","vt":"msg"}],"checkall":"true","repair":false,"outputs":1,"x":2270,"y":520,"wires":[["56de61e0d809ba77"]]},{"id":"6402fc45aa975a92","type":"api-current-state","z":"dfb97c6505f003d9","name":"light.thierry","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.thierry","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"status","propertyType":"msg","value":"","valueType":"entityState"},{"property":"entity_old","propertyType":"msg","value":"","valueType":"entity"},{"property":"entity_id","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":530,"y":160,"wires":[["2a504003bec81b1e"]],"outputLabels":["data.attributes"]},{"id":"2a504003bec81b1e","type":"change","z":"dfb97c6505f003d9","name":"rules","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.data.rgb_color","pt":"msg","to":"color_value","tot":"msg"},{"t":"set","p":"payload.data.brightness_pct","pt":"msg","to":"dbrigthness","tot":"msg"},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":730,"y":160,"wires":[["54c3cd8409cbec5b"]]},{"id":"54c3cd8409cbec5b","type":"api-call-service","z":"dfb97c6505f003d9","name":"Change Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":940,"y":160,"wires":[["1e0f35ee233412c3"]]},{"id":"1e0f35ee233412c3","type":"delay","z":"dfb97c6505f003d9","name":"","pauseType":"random","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"2","randomLast":"3","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1100,"y":160,"wires":[["fd54554c87c115e3"]]},{"id":"fd54554c87c115e3","type":"change","z":"dfb97c6505f003d9","name":"","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.data.rgb_color","pt":"msg","to":"entity_old.attributes.rgb_color","tot":"msg"},{"t":"set","p":"payload.data.brightness","pt":"msg","to":"entity_old.attributes.brightness","tot":"msg"},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1260,"y":160,"wires":[["83717d1cae286c12"]]},{"id":"83717d1cae286c12","type":"template","z":"dfb97c6505f003d9","name":"Extract status","field":"payload.service","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"\"turn_{{status}}\"","output":"json","x":1460,"y":160,"wires":[["2f76e4ae9f417e7b"]]},{"id":"2f76e4ae9f417e7b","type":"api-call-service","z":"dfb97c6505f003d9","name":"Change Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1660,"y":160,"wires":[["2ca583cbae66cdd5"]]},{"id":"6da73629a705f36c","type":"switch","z":"dfb97c6505f003d9","name":"!=rain","property":"data.attributes.rgb_color","propertyType":"msg","rules":[{"t":"eq","v":"color_value","vt":"msg"}],"checkall":"true","repair":false,"outputs":1,"x":1770,"y":120,"wires":[["2f76e4ae9f417e7b"]]},{"id":"2ca583cbae66cdd5","type":"api-current-state","z":"dfb97c6505f003d9","name":"light.thierry","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.thierry","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":1850,"y":160,"wires":[["6da73629a705f36c"]]},{"id":"79b5832995dc742f","type":"api-current-state","z":"dfb97c6505f003d9","name":"sleeping","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.maxi_sleeping","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":520,"y":560,"wires":[["8c7456abb749808a"],["759db47b11b97885"]],"outputLabels":["data.attributes",""]},{"id":"151efa7534923119","type":"debug","z":"dfb97c6505f003d9","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1090,"y":500,"wires":[]},{"id":"759db47b11b97885","type":"switch","z":"dfb97c6505f003d9","name":"!=green","property":"color_name","propertyType":"msg","rules":[{"t":"neq","v":"green","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":840,"y":580,"wires":[["8c7456abb749808a"]]},{"id":"bfbfd266d4db3ff6","type":"trigger","z":"233ac7dcd801a802","name":"Lights fuse","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"10","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":530,"y":840,"wires":[["a8a6083a8c86c955"]]},{"id":"d7fadd0a9fdb8db7","type":"switch","z":"233ac7dcd801a802","name":"","property":"message","propertyType":"msg","rules":[{"t":"nempty"}],"checkall":"true","repair":false,"outputs":1,"x":470,"y":1460,"wires":[["aae981aced5c3ffa"]]},{"id":"2d00197d6062613a","type":"trigger","z":"233ac7dcd801a802","name":"MEssage fuse","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"10","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":320,"y":1460,"wires":[["d7fadd0a9fdb8db7"]]},{"id":"2fad2062613570e7","type":"trigger","z":"233ac7dcd801a802","name":"TV Fuse","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"10","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":440,"y":640,"wires":[["f62429ddd9325d05"]]},{"id":"366af0d006ca31e2","type":"switch","z":"233ac7dcd801a802","name":"","property":"color_value","propertyType":"msg","rules":[{"t":"nempty"}],"checkall":"true","repair":false,"outputs":1,"x":310,"y":900,"wires":[["bfbfd266d4db3ff6"]]},{"id":"bf7d2f2b92acac90","type":"api-current-state","z":"233ac7dcd801a802","name":"Living Room  TV?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"playing","halt_if_type":"str","halt_if_compare":"is","entity_id":"media_player.livingroom_chromecast","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"input","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":950,"y":480,"wires":[["1b5cdf8f1e17773d"],["b611fb8c2500ad1c"]]},{"id":"178917f15c37ce39","type":"api-current-state","z":"233ac7dcd801a802","name":"Patio TV?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is_not","entity_id":"media_player.patio_chromecast","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":920,"y":100,"wires":[["83889f97b2da30fd"],["da32748bdce2049d"]]},{"id":"83889f97b2da30fd","type":"change","z":"233ac7dcd801a802","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1160,"y":100,"wires":[["c47c0b6ee6e75dc7"]]},{"id":"c47c0b6ee6e75dc7","type":"api-call-service","z":"233ac7dcd801a802","name":"pause patio TV","server":"7ab5c227.a3ce8c","version":5,"debugenabled":true,"domain":"media_player","service":"media_pause","areaId":[],"deviceId":[],"entityId":["media_player.patio_chromecast"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1340,"y":100,"wires":[[]]},{"id":"1b5cdf8f1e17773d","type":"change","z":"233ac7dcd801a802","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1160,"y":460,"wires":[["1a229f2742b5b7c7"]]},{"id":"1a229f2742b5b7c7","type":"api-call-service","z":"233ac7dcd801a802","name":"pause living room tv","server":"7ab5c227.a3ce8c","version":5,"debugenabled":true,"domain":"media_player","service":"media_pause","areaId":[],"deviceId":[],"entityId":["media_player.livingroom_chromecast"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1360,"y":460,"wires":[[]]},{"id":"b611fb8c2500ad1c","type":"api-current-state","z":"233ac7dcd801a802","name":"Living Room LG?","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"media_player.living_room_lg","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"input","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":1170,"y":500,"wires":[["f84a71c80a329df7"]]},{"id":"f84a71c80a329df7","type":"switch","z":"233ac7dcd801a802","name":"","property":"payload.attributes.source","propertyType":"msg","rules":[{"t":"eq","v":"HDMI 2","vt":"str"},{"t":"neq","v":"HDMI 2","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1330,"y":500,"wires":[["dfc94fd3cd6d7d0a"],["eda23319b792cf54"]]},{"id":"97c68e4e60fb929b","type":"api-call-service","z":"233ac7dcd801a802","name":"stop","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"turn_off","areaId":[],"deviceId":[],"entityId":["media_player.livingroom_chromecast"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2350,"y":560,"wires":[[]]},{"id":"da32748bdce2049d","type":"exec","z":"233ac7dcd801a802","command":"/root/.local/bin/catt -d 'Patio TV' cast_site 'http://192.168.0.15:8123/local/reolink.jpg'","addpay":false,"append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"","x":1370,"y":140,"wires":[["d74b74afb767cedd"],[],["d74b74afb767cedd"]]},{"id":"d74b74afb767cedd","type":"ha-wait-until","z":"233ac7dcd801a802","name":"","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"lock.lock_front_door","entityIdFilterType":"exact","property":"state","comparator":"is","value":"unlocked","valueType":"str","timeout":"120","timeoutType":"num","timeoutUnits":"seconds","checkCurrentState":false,"blockInputOverrides":true,"outputProperties":[],"x":1880,"y":140,"wires":[["f168877252b94675"],["f168877252b94675"]]},{"id":"f168877252b94675","type":"api-call-service","z":"233ac7dcd801a802","name":"stop","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"turn_off","areaId":[],"deviceId":[],"entityId":["media_player.patio_chromecast"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2090,"y":140,"wires":[[]]},{"id":"e04a239b215f585b","type":"api-current-state","z":"233ac7dcd801a802","name":"Hotbox TV Down","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is_not","entity_id":"media_player.hotbox_down_chromecast","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":950,"y":180,"wires":[["49b3ba815ee85189"],["e1aed2ba45691dde"]]},{"id":"49b3ba815ee85189","type":"change","z":"233ac7dcd801a802","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1160,"y":180,"wires":[["d0c96c0e8a77727a"]]},{"id":"d0c96c0e8a77727a","type":"api-call-service","z":"233ac7dcd801a802","name":"pause","server":"7ab5c227.a3ce8c","version":5,"debugenabled":true,"domain":"media_player","service":"media_pause","areaId":[],"deviceId":[],"entityId":["media_player.hotbox_down_chromecast"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1310,"y":180,"wires":[[]]},{"id":"e1aed2ba45691dde","type":"exec","z":"233ac7dcd801a802","command":"/root/.local/bin/catt -d 'Hotbox Top TV' cast_site 'http://192.168.0.15:8123/local/reolink.jpg'","addpay":false,"append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"","x":1390,"y":220,"wires":[["9649f5547bece956"],[],["9649f5547bece956"]]},{"id":"9649f5547bece956","type":"ha-wait-until","z":"233ac7dcd801a802","name":"lock opens","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"lock.lock_front_door, ","entityIdFilterType":"exact","property":"state","comparator":"is","value":"unlocked","valueType":"str","timeout":"120","timeoutType":"num","timeoutUnits":"seconds","checkCurrentState":false,"blockInputOverrides":true,"outputProperties":[],"x":1830,"y":220,"wires":[["aaddf35feb5a8563"],["aaddf35feb5a8563"]]},{"id":"aaddf35feb5a8563","type":"api-call-service","z":"233ac7dcd801a802","name":"stop","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"turn_off","areaId":[],"deviceId":[],"entityId":["media_player.hotbox_down_chromecast"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2150,"y":220,"wires":[[]]},{"id":"158c278da7a41073","type":"api-current-state","z":"233ac7dcd801a802","name":"Hotbox TV","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is_not","entity_id":"media_player.hotbox_top_chromecast","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":930,"y":260,"wires":[["79580208474f7ae3"],["0c49ca6c6b92d452"]]},{"id":"79580208474f7ae3","type":"change","z":"233ac7dcd801a802","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1160,"y":260,"wires":[["e4b90b70cc03b2d3"]]},{"id":"e4b90b70cc03b2d3","type":"api-call-service","z":"233ac7dcd801a802","name":"pause","server":"7ab5c227.a3ce8c","version":5,"debugenabled":true,"domain":"media_player","service":"media_pause","areaId":[],"deviceId":[],"entityId":["media_player.hotbox_top_chromecast"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1310,"y":260,"wires":[[]]},{"id":"0c49ca6c6b92d452","type":"exec","z":"233ac7dcd801a802","command":"/root/.local/bin/catt -d 'Hotbox Down TV' cast_site 'http://192.168.0.15:8123/local/reolink.jpg'","addpay":false,"append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"","x":1400,"y":300,"wires":[["10a6fcba37970a19"],[],["10a6fcba37970a19"]]},{"id":"10a6fcba37970a19","type":"ha-wait-until","z":"233ac7dcd801a802","name":"lock opens","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"lock.lock_front_door, ","entityIdFilterType":"exact","property":"state","comparator":"is","value":"unlocked","valueType":"str","timeout":"120","timeoutType":"num","timeoutUnits":"seconds","checkCurrentState":false,"blockInputOverrides":true,"outputProperties":[],"x":1830,"y":300,"wires":[["fb7e21f4de7de77a"],["fb7e21f4de7de77a"]]},{"id":"fb7e21f4de7de77a","type":"api-call-service","z":"233ac7dcd801a802","name":"stop","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"turn_off","areaId":[],"deviceId":[],"entityId":["media_player.hotbox_top_chromecast"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2150,"y":300,"wires":[[]]},{"id":"5d7c0bbeb450ee8f","type":"api-current-state","z":"233ac7dcd801a802","name":"Bedroom TV","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"idle","halt_if_type":"str","halt_if_compare":"is_not","entity_id":"media_player.bedroom_chromecast","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":930,"y":360,"wires":[["8ca4f5e04813679b"],["aa5449613c09ed95"]]},{"id":"8ca4f5e04813679b","type":"change","z":"233ac7dcd801a802","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1160,"y":360,"wires":[["12caa4d321f7d9b7"]]},{"id":"12caa4d321f7d9b7","type":"api-call-service","z":"233ac7dcd801a802","name":"pause","server":"7ab5c227.a3ce8c","version":5,"debugenabled":true,"domain":"media_player","service":"media_pause","areaId":[],"deviceId":[],"entityId":["media_player.bedroom_chromecast"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1310,"y":360,"wires":[[]]},{"id":"aa5449613c09ed95","type":"exec","z":"233ac7dcd801a802","command":"/root/.local/bin/catt -d 'Bedroom TV' cast_site 'http://192.168.0.15:8123/local/reolink.jpg'","addpay":false,"append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"","x":1380,"y":400,"wires":[["772fa04af2eddebf"],[],["772fa04af2eddebf"]]},{"id":"4f565ee6c651e601","type":"ha-wait-until","z":"233ac7dcd801a802","name":"lock opens","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"lock.lock_front_door","entityIdFilterType":"exact","property":"state","comparator":"is","value":"unlocked","valueType":"str","timeout":"120","timeoutType":"num","timeoutUnits":"seconds","checkCurrentState":false,"blockInputOverrides":true,"outputProperties":[],"x":2010,"y":400,"wires":[["464fea57697c8ec1"],["464fea57697c8ec1"]]},{"id":"464fea57697c8ec1","type":"api-call-service","z":"233ac7dcd801a802","name":"stop","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"turn_off","areaId":[],"deviceId":[],"entityId":["media_player.bedroom_chromecast"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2190,"y":380,"wires":[["41dc25cd3027a91b"]]},{"id":"dfc94fd3cd6d7d0a","type":"exec","z":"233ac7dcd801a802","command":"/root/.local/bin/catt -d 'Living Room TV' cast_site 'http://192.168.0.15:8123/local/reolink.jpg'","addpay":false,"append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"","x":1730,"y":500,"wires":[["ba1ee1d7102dc2a3"],[],[]]},{"id":"ba1ee1d7102dc2a3","type":"ha-wait-until","z":"233ac7dcd801a802","name":"lock opens","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"lock.lock_front_door, ","entityIdFilterType":"exact","property":"state","comparator":"is","value":"unlocked","valueType":"str","timeout":"120","timeoutType":"num","timeoutUnits":"seconds","checkCurrentState":false,"blockInputOverrides":true,"outputProperties":[],"x":2190,"y":500,"wires":[["7707fca3eae09981"],["7707fca3eae09981"]]},{"id":"7707fca3eae09981","type":"api-call-service","z":"233ac7dcd801a802","name":"stop","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"turn_off","areaId":[],"deviceId":[],"entityId":["media_player.livingroom_chromecast"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2350,"y":500,"wires":[["f971d0de1bc27714"]]},{"id":"eda23319b792cf54","type":"exec","z":"233ac7dcd801a802","command":"/root/.local/bin/catt -d 'Living Room TV' cast_site 'http://192.168.0.15:8123/local/reolink.jpg'","addpay":false,"append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"","x":1730,"y":560,"wires":[["cf6628393222d924"],[],[]]},{"id":"cf6628393222d924","type":"ha-wait-until","z":"233ac7dcd801a802","name":"lock opens","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"lock.lock_front_door","entityIdFilterType":"exact","property":"state","comparator":"is","value":"unlocked","valueType":"str","timeout":"120","timeoutType":"num","timeoutUnits":"seconds","checkCurrentState":false,"blockInputOverrides":true,"outputProperties":[],"x":2190,"y":560,"wires":[["97c68e4e60fb929b"],["97c68e4e60fb929b"]]},{"id":"f971d0de1bc27714","type":"api-call-service","z":"233ac7dcd801a802","name":"change source","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"select_source","areaId":[],"deviceId":[],"entityId":["media_player.living_room_lg"],"data":"{\"source\":\"HDMI 2\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2500,"y":500,"wires":[[]]},{"id":"41dc25cd3027a91b","type":"api-call-service","z":"233ac7dcd801a802","name":"change source","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"select_source","areaId":[],"deviceId":[],"entityId":["media_player.bedroom_tv"],"data":"{\"source\":\"PC\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2520,"y":380,"wires":[[]]},{"id":"772fa04af2eddebf","type":"api-call-service","z":"233ac7dcd801a802","name":"change source","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"lock.lock_front_door, ","areaId":[],"deviceId":[],"entityId":["media_player.bedroom_tv"],"data":"{\"source\":\"chromecast\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1820,"y":420,"wires":[["4f565ee6c651e601"]]},{"id":"661df899720949f1","type":"api-current-state","z":"233ac7dcd801a802","name":"Party","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.party_mode","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":730,"y":240,"wires":[["178917f15c37ce39","e04a239b215f585b","158c278da7a41073","5d7c0bbeb450ee8f","bf7d2f2b92acac90"],[]]},{"id":"09496c934e88c4f4","type":"api-current-state","z":"233ac7dcd801a802","name":"Party","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.kink_party","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":590,"y":240,"wires":[["661df899720949f1"],[]]},{"id":"f62429ddd9325d05","type":"switch","z":"233ac7dcd801a802","name":"","property":"video","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":530,"y":520,"wires":[["09496c934e88c4f4"]]},{"id":"aae981aced5c3ffa","type":"function","z":"233ac7dcd801a802","name":" Set payload for play media ","func":"var msg = {\n    \"payload\":\n      {\"data\": {\n      \"message\":  msg.message\n}}\n\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":740,"y":1460,"wires":[["acc1eafbadde8fb3"]]},{"id":"50a7f2755bc28aae","type":"http request","z":"233ac7dcd801a802","name":"POST request","method":"POST","ret":"obj","paytoqs":"ignore","url":"http://192.168.0.14:8085/broadcast","tls":"","persist":false,"proxy":"","authType":"","senderr":false,"headers":[],"x":1060,"y":1540,"wires":[[]]},{"id":"a8a6083a8c86c955","type":"ha-get-entities","z":"233ac7dcd801a802","name":"Get Lights","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"entity_id","logic":"is","value":"^light(?!.*?door.*?)(?!.*?group.*?)(?!.*?k95_rgb_2_led.*?)(?!.*?lights.*?).*[a-z].*(?<!s)$","valueType":"re"},{"property":"state","logic":"is_not","value":"unavailable","valueType":"str"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":950,"y":880,"wires":[["034a2839d16f1399"]]},{"id":"034a2839d16f1399","type":"switch","z":"233ac7dcd801a802","name":"Check color support","property":"payload.attributes.supported_color_modes","propertyType":"msg","rules":[{"t":"cont","v":"xy","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1160,"y":880,"wires":[["7f4b36bf2feb4669"]]},{"id":"7f4b36bf2feb4669","type":"switch","z":"233ac7dcd801a802","name":"Check initial light state","property":"payload.state","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1440,"y":880,"wires":[["b44c7449af1ef506"],["78c8f3f8edd7aa43"]]},{"id":"07ecb0bec4f1f33d","type":"comment","z":"233ac7dcd801a802","name":"Pull all individual lights","info":"","x":920,"y":840,"wires":[]},{"id":"beacf96bb661fbc2","type":"comment","z":"233ac7dcd801a802","name":"Check if they support color","info":"","x":1170,"y":840,"wires":[]},{"id":"e34bfbd72ae412d4","type":"api-call-service","z":"233ac7dcd801a802","name":"Change Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1900,"y":840,"wires":[["dc4a72805e937312"]]},{"id":"b44c7449af1ef506","type":"change","z":"233ac7dcd801a802","name":"Set desired Values","rules":[{"t":"set","p":"payload.data.rgb_color","pt":"msg","to":"color_value","tot":"msg","dc":true},{"t":"set","p":"payload.data.brightness_pct","pt":"msg","to":"dbrigthness","tot":"msg","dc":true},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"payload.entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1670,"y":840,"wires":[["e34bfbd72ae412d4"]]},{"id":"b71d1ddde35c7c33","type":"change","z":"233ac7dcd801a802","name":"Set Initial color","rules":[{"t":"delete","p":"payload.data.brightness_pct","pt":"msg"},{"t":"set","p":"payload.data.rgb_color","pt":"msg","to":"payload.attributes.rgb_color","tot":"msg","dc":true},{"t":"set","p":"payload.data.brightness","pt":"msg","to":"payload.attributes.brightness","tot":"msg","dc":true},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"payload.entity_id","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":2380,"y":840,"wires":[["7068646d68382b1f"]]},{"id":"7068646d68382b1f","type":"api-call-service","z":"233ac7dcd801a802","name":"Change Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2600,"y":840,"wires":[[]]},{"id":"dc4a72805e937312","type":"delay","z":"233ac7dcd801a802","name":"","pauseType":"delay","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":2160,"y":840,"wires":[["b71d1ddde35c7c33"]]},{"id":"2068eafd7c4838ef","type":"api-call-service","z":"233ac7dcd801a802","name":"Change Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2900,"y":740,"wires":[["ad2b99dbad3094c3"]]},{"id":"ad2b99dbad3094c3","type":"api-current-state","z":"233ac7dcd801a802","name":"light.nate_ceiling_light","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.nate_ceiling_light","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":2920,"y":820,"wires":[["03261b357f39059e"]]},{"id":"03261b357f39059e","type":"switch","z":"233ac7dcd801a802","name":"!=same color","property":"data.attributes.rgb_color","propertyType":"msg","rules":[{"t":"eq","v":"color_value","vt":"msg"}],"checkall":"true","repair":false,"outputs":1,"x":2910,"y":780,"wires":[["2068eafd7c4838ef"]]},{"id":"b00729f34334e07c","type":"api-call-service","z":"233ac7dcd801a802","name":"Change Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1900,"y":920,"wires":[["70258176652e91f7"]]},{"id":"78c8f3f8edd7aa43","type":"change","z":"233ac7dcd801a802","name":"Set desired Values","rules":[{"t":"set","p":"payload.data.rgb_color","pt":"msg","to":"color_value","tot":"msg","dc":true},{"t":"set","p":"payload.data.brightness_pct","pt":"msg","to":"dbrigthness","tot":"msg","dc":true},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"payload.entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1670,"y":920,"wires":[["b00729f34334e07c"]]},{"id":"0cede15e04a1f947","type":"api-call-service","z":"233ac7dcd801a802","name":"Turn off lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2580,"y":920,"wires":[[]]},{"id":"70258176652e91f7","type":"delay","z":"233ac7dcd801a802","name":"","pauseType":"delay","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":2160,"y":920,"wires":[["3808b692f02d438e"]]},{"id":"3808b692f02d438e","type":"change","z":"233ac7dcd801a802","name":"Set entity","rules":[{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"payload.entity_id","tot":"msg","dc":true},{"t":"delete","p":"payload.data.rgb_color","pt":"msg"},{"t":"delete","p":"payload.data.brightness_pct","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2380,"y":920,"wires":[["0cede15e04a1f947"]]},{"id":"acc1eafbadde8fb3","type":"api-call-service","z":"233ac7dcd801a802","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"google_assistant_sdk","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1090,"y":1460,"wires":[[]]},{"id":"d50c859d07692e50","type":"function","z":"61f53235c712b2c2","name":"Extract room from dial mqtt name and set regex to find chromecast playing","func":"var group_light_entity_id = msg.payload.device.friendlyName; // light group\nvar room = group_light_entity_id.replace(\"remote_\", \"\").replace(\"_dial\", \"\");\nvar action = msg.payload.action\n\nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': \"media_player.\" + room + \"_chromecast\" ,  'valueType': 're' },{ 'property': 'state' ,  'logic': 'is' , 'value': \"playing\" ,  'valueType': 'str' }];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object},\n     \"action\": action,\n     \"room\": room\n\n}\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":360,"y":1760,"wires":[["00bcec74e6a8608c"]]},{"id":"00bcec74e6a8608c","type":"ha-get-entities","z":"61f53235c712b2c2","name":"","server":"7ab5c227.a3ce8c","version":0,"rules":[],"output_type":"array","output_empty_results":true,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":710,"y":1760,"wires":[["37f2592b86cd8d0c"]]},{"id":"37f2592b86cd8d0c","type":"switch","z":"61f53235c712b2c2","name":"Device present?","property":"payload","propertyType":"msg","rules":[{"t":"nempty"},{"t":"empty"}],"checkall":"true","repair":false,"outputs":2,"x":880,"y":1760,"wires":[["1d3f0314994a9da9"],["82192b37abcc4854"]]},{"id":"1d3f0314994a9da9","type":"switch","z":"61f53235c712b2c2","name":"muted?","property":"payload[0].attributes.is_volume_muted","propertyType":"msg","rules":[{"t":"false"},{"t":"true"}],"checkall":"true","repair":false,"outputs":2,"x":1060,"y":1740,"wires":[["985a99418a6a34d8"],["82192b37abcc4854"]]},{"id":"697afaa0745ef2cf","type":"function","z":"61f53235c712b2c2","name":"Extract room from dial mqtt name and set regex to find speaker playing","func":"\nvar room = msg.room\nvar action = msg.action\n\nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': \"media_player.\" + room + \".*_speaker\" ,  'valueType': 're' },{ 'property': 'state' ,  'logic': 'is_not' , 'value': \"off\" ,  'valueType': 'str' }];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object},\n     \"action\": action,\n     \"room\": room\n\n}\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":350,"y":1820,"wires":[["411cea78bfbf43c6"]]},{"id":"411cea78bfbf43c6","type":"ha-get-entities","z":"61f53235c712b2c2","name":"","server":"7ab5c227.a3ce8c","version":0,"rules":[],"output_type":"array","output_empty_results":true,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":710,"y":1820,"wires":[["faf1148d7535690a"]]},{"id":"23db831f71fb38a9","type":"split","z":"61f53235c712b2c2","name":"Split entities","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":1430,"y":1760,"wires":[["80f93e25dae94b3b"]]},{"id":"faf1148d7535690a","type":"switch","z":"61f53235c712b2c2","name":"Device present?","property":"payload","propertyType":"msg","rules":[{"t":"nempty"},{"t":"empty"}],"checkall":"true","repair":false,"outputs":2,"x":880,"y":1820,"wires":[["45e7615f1c4e98d2"],["645eaecd29665487"]]},{"id":"66bd23e455ac06d5","type":"switch","z":"61f53235c712b2c2","name":"muted?","property":"payload[0].attributes.is_volume_muted","propertyType":"msg","rules":[{"t":"false"},{"t":"true"}],"checkall":"true","repair":false,"outputs":2,"x":1520,"y":1820,"wires":[["23db831f71fb38a9"],["4ab99af8e3afe60d"]]},{"id":"80f93e25dae94b3b","type":"change","z":"61f53235c712b2c2","name":"set entity data","rules":[{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"payload.entity_id","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":1620,"y":1760,"wires":[["806e3b9d9faad10c"]]},{"id":"b88d2595c62a74bb","type":"switch","z":"61f53235c712b2c2","name":"Play_Pause action?","property":"action","propertyType":"msg","rules":[{"t":"eq","v":"play_pause","vt":"str"},{"t":"nnull"}],"checkall":"false","repair":false,"outputs":2,"x":1380,"y":1860,"wires":[["2df99d0cff89b14c"],["2df99d0cff89b14c"]]},{"id":"806e3b9d9faad10c","type":"switch","z":"61f53235c712b2c2","name":"Light mode off?","property":"lightmode","propertyType":"flow","rules":[{"t":"neq","v":"1","vt":"num"},{"t":"null"},{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":3,"x":1800,"y":1760,"wires":[["21c70b070ae3c784"],["21c70b070ae3c784"],["8ba7a0ebb6af727d"]]},{"id":"c7f8c03f4e7f1a1c","type":"switch","z":"61f53235c712b2c2","name":"paused?","property":"payload[0].state","propertyType":"msg","rules":[{"t":"eq","v":"playing","vt":"str"},{"t":"eq","v":"paused","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":1160,"y":1820,"wires":[["b00632a9d37853c4"],["9d53d8bd58c36ae9"]]},{"id":"8ba7a0ebb6af727d","type":"trigger","z":"61f53235c712b2c2","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"100","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2020,"y":1860,"wires":[["5aeb80d3605ce6ee"]]},{"id":"5aeb80d3605ce6ee","type":"switch","z":"61f53235c712b2c2","name":"","property":"action","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":2170,"y":1860,"wires":[["27a437252540a153"]]},{"id":"0e8c29a971f690ca","type":"switch","z":"61f53235c712b2c2","name":"","property":"action","propertyType":"msg","rules":[{"t":"eq","v":"rotate_right","vt":"str"},{"t":"eq","v":"play_pause","vt":"str"},{"t":"eq","v":"rotate_left","vt":"str"},{"t":"eq","v":"skip_forward","vt":"str"},{"t":"eq","v":"skip_backward","vt":"str"}],"checkall":"false","repair":false,"outputs":5,"x":2030,"y":1760,"wires":[["4424801d977abd4e"],["af1c3efc9e357f15"],["c98edceffd1f5956"],["a1f2dbb312f8c0d5"],["7f8686ac5272a336"]]},{"id":"27a437252540a153","type":"function","z":"61f53235c712b2c2","name":"Extract room from dial mqtt name and set regex to find light groups","func":"\nvar room = msg.room;\nvar action = msg.action\n\nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': \"light.group_\" + room + \"_lights\" ,  'valueType': 're' }];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object},\n     \"action\": action,\n     \"room\": room\n\n}\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2480,"y":1860,"wires":[["27cf2b308e923713"]]},{"id":"4424801d977abd4e","type":"api-call-service","z":"61f53235c712b2c2","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_up","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2250,"y":1640,"wires":[[]]},{"id":"af1c3efc9e357f15","type":"api-call-service","z":"61f53235c712b2c2","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"media_play_pause","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2290,"y":1680,"wires":[[]]},{"id":"c98edceffd1f5956","type":"api-call-service","z":"61f53235c712b2c2","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_down","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2280,"y":1720,"wires":[[]]},{"id":"a1f2dbb312f8c0d5","type":"api-call-service","z":"61f53235c712b2c2","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"media_next_track","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2310,"y":1760,"wires":[[]]},{"id":"7f8686ac5272a336","type":"change","z":"61f53235c712b2c2","name":"set flow light mode = 1","rules":[{"t":"set","p":"lightmode","pt":"flow","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":2220,"y":1800,"wires":[["816ee8a2d7efb417"]]},{"id":"27cf2b308e923713","type":"ha-get-entities","z":"61f53235c712b2c2","name":"","server":"7ab5c227.a3ce8c","version":0,"rules":[],"output_type":"array","output_empty_results":true,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":2830,"y":1860,"wires":[["cb2f053ba723116e"]]},{"id":"816ee8a2d7efb417","type":"trigger","z":"61f53235c712b2c2","name":"","op1":"","op2":"0","op1type":"nul","op2type":"str","duration":"10","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2430,"y":1800,"wires":[["9854703ac26fa0bd"]]},{"id":"cb2f053ba723116e","type":"split","z":"61f53235c712b2c2","name":"Split entities","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":3010,"y":1860,"wires":[["40c07034a2af8e39","bf76484668438f0e"]]},{"id":"9854703ac26fa0bd","type":"change","z":"61f53235c712b2c2","name":"set flow light mode = 0","rules":[{"t":"set","p":"lightmode","pt":"flow","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":2640,"y":1800,"wires":[[]]},{"id":"40c07034a2af8e39","type":"change","z":"61f53235c712b2c2","name":"set entity data","rules":[{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"payload.entity_id","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":3200,"y":1860,"wires":[["35eded21f6831c88","8a15fec47048385f"]]},{"id":"35eded21f6831c88","type":"switch","z":"61f53235c712b2c2","name":"","property":"action","propertyType":"msg","rules":[{"t":"eq","v":"rotate_right","vt":"str"},{"t":"eq","v":"rotate_left","vt":"str"},{"t":"eq","v":"play_pause","vt":"str"},{"t":"eq","v":"skip_forward","vt":"str"},{"t":"eq","v":"skip_backward","vt":"str"}],"checkall":"true","repair":false,"outputs":5,"x":3350,"y":1860,"wires":[["d56f1d268cdd4ed3"],["d174cd53af839e44"],["da6e3b258224e935","8a15fec47048385f"],["cee47118121c3fef"],[]]},{"id":"d56f1d268cdd4ed3","type":"function","z":"61f53235c712b2c2","name":"Extract room from motion sensor entity an extract off lights to regex","func":"var room = msg.room;\n\n\nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': \"light.\" + room ,  'valueType': 're' }];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object}\n\n}\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3680,"y":1800,"wires":[["bce46683bf6a0688","25adb9358a07e767"]]},{"id":"d174cd53af839e44","type":"api-call-service","z":"61f53235c712b2c2","name":"Dim light","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"{\"brightness_step_pct\": -10}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3500,"y":1840,"wires":[[]]},{"id":"da6e3b258224e935","type":"api-call-service","z":"61f53235c712b2c2","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"toggle","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3520,"y":1880,"wires":[[]]},{"id":"cee47118121c3fef","type":"api-call-service","z":"61f53235c712b2c2","name":"Max white brightness","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"{\"brightness_pct\": 100,\"color_name\": \"white\"}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3540,"y":1920,"wires":[[]]},{"id":"bce46683bf6a0688","type":"debug","z":"61f53235c712b2c2","name":"debug 129","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":4080,"y":1840,"wires":[]},{"id":"25adb9358a07e767","type":"ha-get-entities","z":"61f53235c712b2c2","name":"","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"","logic":"is","value":"","valueType":"str"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":4090,"y":1780,"wires":[["eea455aff3d14d56","dd0d9bc4533a2076"]]},{"id":"eea455aff3d14d56","type":"trigger","z":"61f53235c712b2c2","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"600","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"topic","topic":"payload.entity_id","outputs":1,"x":4320,"y":1800,"wires":[["9bf93457728ad597"]]},{"id":"dd0d9bc4533a2076","type":"debug","z":"61f53235c712b2c2","name":"debug 130","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":4320,"y":1840,"wires":[]},{"id":"9bf93457728ad597","type":"switch","z":"61f53235c712b2c2","name":"Brightness?","property":"payload.attributes.brightness","propertyType":"msg","rules":[{"t":"null"},{"t":"lt","v":"250","vt":"str"},{"t":"gte","v":"250","vt":"str"}],"checkall":"false","repair":false,"outputs":3,"x":4510,"y":1800,"wires":[["96da2312a19b24b4"],["96da2312a19b24b4"],["1e30b4233afd16d2","7997e2085f42d86d"]]},{"id":"96da2312a19b24b4","type":"change","z":"61f53235c712b2c2","name":"set entity","rules":[{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"payload.entity_id","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":4680,"y":1800,"wires":[["69bee88c57b950a2"]]},{"id":"1e30b4233afd16d2","type":"debug","z":"61f53235c712b2c2","name":"debug 131","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":4680,"y":1840,"wires":[]},{"id":"7997e2085f42d86d","type":"function","z":"61f53235c712b2c2","name":"White addist","func":"// Declare variation\nvar saturation = msg.payload.attributes.hs_color[1];\nvar colorfinal = msg.payload.attributes.hs_color[0];\nvar entity_id = msg.payload.entity_id;\n\n// If saturation is over 10\nif(saturation > 10){\nvar saturationlesser = saturation - 10;\n} else if(saturation < 10){// If saturation is under 10\nvar saturationlesser = 0;\nvar colorfinal = 0;\n}\n else {\nvar saturationlesser = saturation;}\n\n\n\n\n\n\nvar newMsg = {\n    \"payload\": {\n            \"data\": {\n            \"hs_color\": [colorfinal, saturationlesser],\n            \"entity_id\": entity_id\n            }\n            }\n            \n   }\n\nreturn newMsg;\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4690,"y":1880,"wires":[["d01b9290923b5955","3c10261e713e31a8"]]},{"id":"69bee88c57b950a2","type":"api-call-service","z":"61f53235c712b2c2","name":"Brightnen light","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"{\"brightness_step_pct\": 10}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4920,"y":1800,"wires":[[]]},{"id":"d01b9290923b5955","type":"debug","z":"61f53235c712b2c2","name":"debug 132","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":4900,"y":1840,"wires":[]},{"id":"3c10261e713e31a8","type":"api-call-service","z":"61f53235c712b2c2","name":"Add white","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4900,"y":1880,"wires":[[]]},{"id":"44f221cfd84fa705","type":"trigger","z":"61f53235c712b2c2","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"200","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"topic","topic":"topic","outputs":1,"x":2060,"y":1600,"wires":[["4424801d977abd4e"]]},{"id":"bf76484668438f0e","type":"debug","z":"61f53235c712b2c2","name":"split entity","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3200,"y":1760,"wires":[]},{"id":"8a15fec47048385f","type":"debug","z":"61f53235c712b2c2","name":"debug 152","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":3530,"y":2000,"wires":[]},{"id":"5dbfe54c1c9e0349","type":"function","z":"9e515b8aa75a9cdd","g":"824fe4cb22842d7f","name":"Extract room from motion sensor entity an extract on lights to regex","func":"var motion_entity_id = msg.data.event.new_state.entity_id; // binary_sensor.sensor_bedroom_motion_occupancy\nvar motion_entity_id_split = motion_entity_id.split(\".\");// split on the dot to separate domain and entity\nvar motion_entity_id_wihtout_binary = motion_entity_id_split[1].replace(\"sensor_\", \"\").replace(\"_motion\", \"\").replace(\"_fp1\", \"\").replace(\"_presence\", \"\").replace(\"_occupancy\", \"\").replace(\"_entry\", \"\").replace(\"_exit\", \"\");// remove sensor_ and more substrings\nvar regex = \"^light\\\\.(?!.*?group.*?)(?!.*?lights.*?).*\" + motion_entity_id_wihtout_binary + \".*\"; \nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': regex ,  'valueType': 're' },{ 'property': 'state' ,  'logic': 'is' , 'value': \"on\" ,  'valueType': 'str' }];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object},\"room\": motion_entity_id_wihtout_binary\n\n}\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":460,"y":160,"wires":[["57eb4ea18bc4f55b"]]},{"id":"57eb4ea18bc4f55b","type":"ha-get-entities","z":"9e515b8aa75a9cdd","g":"824fe4cb22842d7f","name":"Get entities","server":"7ab5c227.a3ce8c","version":0,"rules":[],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload.results","output_results_count":1,"x":850,"y":160,"wires":[["2080c99162556dc0"]]},{"id":"2080c99162556dc0","type":"change","z":"9e515b8aa75a9cdd","g":"824fe4cb22842d7f","name":"rules","rules":[{"t":"move","p":"payload","pt":"msg","to":"lights","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1070,"y":160,"wires":[["25f4aad1cd60ab2a"]]},{"id":"21add955f677d2b7","type":"function","z":"9e515b8aa75a9cdd","g":"824fe4cb22842d7f","name":"prepare Regex to check other motion sensors","func":"var room = msg.room\nvar regex = \"binary_sensor\\.*\" + room + \".*_occupancy$\"; \nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': regex ,  'valueType': 're' },{ 'property': 'state' ,  'logic': 'is' , 'value': \"on\" ,  'valueType': 'str' }];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object},\n    \"entity\": msg.entity,\n    \"room\": room,\n    \"lights\": msg.lights\n\n}\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1670,"y":160,"wires":[["ad814cbe9abc19f5"]]},{"id":"ad814cbe9abc19f5","type":"ha-get-entities","z":"9e515b8aa75a9cdd","g":"824fe4cb22842d7f","name":"Get entities","server":"7ab5c227.a3ce8c","version":0,"rules":[],"output_type":"array","output_empty_results":true,"output_location_type":"msg","output_location":"payload.results","output_results_count":1,"x":2090,"y":160,"wires":[["a87e55e132644e6c"]]},{"id":"a87e55e132644e6c","type":"switch","z":"9e515b8aa75a9cdd","g":"824fe4cb22842d7f","name":"","property":"payload.results","propertyType":"msg","rules":[{"t":"empty"}],"checkall":"true","repair":false,"outputs":1,"x":2370,"y":160,"wires":[["342cb1090e8f530b"]]},{"id":"342cb1090e8f530b","type":"change","z":"9e515b8aa75a9cdd","g":"824fe4cb22842d7f","name":"rules","rules":[{"t":"move","p":"lights.entity_id","pt":"msg","to":"payload.data.entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2590,"y":160,"wires":[["0cb211a18508e0ab"]]},{"id":"0cb211a18508e0ab","type":"api-call-service","z":"9e515b8aa75a9cdd","g":"824fe4cb22842d7f","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":[],"data":"{\"transition\": 30}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2810,"y":160,"wires":[[]]},{"id":"e8e8db56dab8adcc","type":"comment","z":"9e515b8aa75a9cdd","g":"824fe4cb22842d7f","name":"Generate the regex for the get entity node","info":"","x":500,"y":120,"wires":[]},{"id":"6131a2c1c3af7050","type":"comment","z":"9e515b8aa75a9cdd","g":"824fe4cb22842d7f","name":"Get on light entities","info":"","x":850,"y":120,"wires":[]},{"id":"27cd90e7ad99d55c","type":"comment","z":"9e515b8aa75a9cdd","g":"824fe4cb22842d7f","name":"Move payload to lights","info":"","x":1080,"y":120,"wires":[]},{"id":"f0de34106b389b4a","type":"comment","z":"9e515b8aa75a9cdd","g":"824fe4cb22842d7f","name":"Prepare regex to check if another motion sensor is on in the room","info":"","x":1730,"y":120,"wires":[]},{"id":"c7f2980adaee37b4","type":"comment","z":"9e515b8aa75a9cdd","g":"824fe4cb22842d7f","name":"Get motion on entities in an array","info":"","x":2110,"y":120,"wires":[]},{"id":"9c396755fe1cb910","type":"comment","z":"9e515b8aa75a9cdd","g":"824fe4cb22842d7f","name":"Make sure the array is empty","info":"","x":2380,"y":120,"wires":[]},{"id":"1189f4b6f680b126","type":"comment","z":"9e515b8aa75a9cdd","g":"824fe4cb22842d7f","name":"Set entity","info":"","x":2600,"y":120,"wires":[]},{"id":"cf8ff618865df435","type":"comment","z":"9e515b8aa75a9cdd","g":"824fe4cb22842d7f","name":"Turn the lights off","info":"","x":2800,"y":120,"wires":[]},{"id":"25f4aad1cd60ab2a","type":"switch","z":"9e515b8aa75a9cdd","g":"824fe4cb22842d7f","name":"","property":"lights.attributes.hs_color[1]","propertyType":"msg","rules":[{"t":"lt","v":"35","vt":"num"},{"t":"gt","v":"35","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":1330,"y":160,"wires":[["33b091aa899cef65"],["ee596aba36f6626b"]]},{"id":"d5e2a24c6ce71e38","type":"comment","z":"9e515b8aa75a9cdd","g":"824fe4cb22842d7f","name":"Send white light up","info":"","x":1330,"y":120,"wires":[]},{"id":"57b7936054b0b5cc","type":"comment","z":"9e515b8aa75a9cdd","g":"824fe4cb22842d7f","name":"Send colored light down","info":"","x":1340,"y":200,"wires":[]},{"id":"db1017a7cb93fa99","type":"function","z":"9e515b8aa75a9cdd","g":"824fe4cb22842d7f","name":"prepare Regex to check other motion sensors","func":"var room = msg.room\nvar regex = \"binary_sensor\\.*\" + room + \".*_occupancy$\"; \nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': regex ,  'valueType': 're' },{ 'property': 'state' ,  'logic': 'is' , 'value': \"on\" ,  'valueType': 'str' }];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object},\n    \"entity\": msg.entity,\n    \"room\": room,\n    \"lights\": msg.lights\n\n}\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1850,"y":260,"wires":[["cb125f4b50582619"]]},{"id":"cb125f4b50582619","type":"ha-get-entities","z":"9e515b8aa75a9cdd","g":"824fe4cb22842d7f","name":"Get entities","server":"7ab5c227.a3ce8c","version":0,"rules":[],"output_type":"array","output_empty_results":true,"output_location_type":"msg","output_location":"payload.results","output_results_count":1,"x":2310,"y":260,"wires":[["e91a19e1d4d03076"]]},{"id":"e91a19e1d4d03076","type":"switch","z":"9e515b8aa75a9cdd","g":"824fe4cb22842d7f","name":"","property":"payload.results","propertyType":"msg","rules":[{"t":"empty"}],"checkall":"true","repair":false,"outputs":1,"x":2590,"y":260,"wires":[["deb1c3f277dffa05"]]},{"id":"deb1c3f277dffa05","type":"change","z":"9e515b8aa75a9cdd","g":"824fe4cb22842d7f","name":"rules","rules":[{"t":"move","p":"lights.entity_id","pt":"msg","to":"payload.data.entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2810,"y":260,"wires":[["bc2e357cd21ccadd"]]},{"id":"bc2e357cd21ccadd","type":"api-call-service","z":"9e515b8aa75a9cdd","g":"824fe4cb22842d7f","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":[],"data":"{\"transition\": 30}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3030,"y":260,"wires":[[]]},{"id":"18d49bad3d314fbb","type":"comment","z":"9e515b8aa75a9cdd","g":"824fe4cb22842d7f","name":"Prepare regex to check if another motion sensor is on in the room","info":"","x":1910,"y":220,"wires":[]},{"id":"6da1158175acc54a","type":"comment","z":"9e515b8aa75a9cdd","g":"824fe4cb22842d7f","name":"Get motion on entities in an array","info":"","x":2330,"y":220,"wires":[]},{"id":"924efdd72ef016a6","type":"comment","z":"9e515b8aa75a9cdd","g":"824fe4cb22842d7f","name":"Make sure the array is empty","info":"","x":2600,"y":220,"wires":[]},{"id":"6d38d52715aeb7ef","type":"comment","z":"9e515b8aa75a9cdd","g":"824fe4cb22842d7f","name":"Set entity","info":"","x":2820,"y":220,"wires":[]},{"id":"2ae78b52a82bf9e5","type":"comment","z":"9e515b8aa75a9cdd","g":"824fe4cb22842d7f","name":"Turn the lights off","info":"","x":3020,"y":220,"wires":[]},{"id":"d3c382301395300b","type":"ha-wait-until","z":"9e515b8aa75a9cdd","g":"824fe4cb22842d7f","name":"","server":"7ab5c227.a3ce8c","version":2,"outputs":1,"entityId":"binary_sensor.all_present_sleeping","entityIdFilterType":"exact","property":"state","comparator":"is","value":"on","valueType":"str","timeout":0,"timeoutType":"num","timeoutUnits":"seconds","checkCurrentState":true,"blockInputOverrides":true,"outputProperties":[],"x":1560,"y":260,"wires":[["db1017a7cb93fa99"]]},{"id":"62fcc1a1fce54141","type":"comment","z":"9e515b8aa75a9cdd","g":"824fe4cb22842d7f","name":"Wait until all asleep","info":"","x":1550,"y":220,"wires":[]},{"id":"76f4df1a17d50f22","type":"function","z":"666f64b87ddc48a7","name":"Extract room from dial mqtt name and set regex to find chromecast playing","func":"var group_light_entity_id = msg.payload.device.friendlyName; // light group\nvar room = group_light_entity_id.replace(\"remote_\", \"\").replace(\"_dial\", \"\");\nvar action = msg.payload.action\n\nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': \"media_player.\" + room + \"_chromecast\" ,  'valueType': 're' },{ 'property': 'state' ,  'logic': 'is' , 'value': \"playing\" ,  'valueType': 'str' }];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object},\n     \"action\": action,\n     \"room\": room\n\n}\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":350,"y":960,"wires":[["b2e0769320cf1a45"]]},{"id":"b2e0769320cf1a45","type":"ha-get-entities","z":"666f64b87ddc48a7","name":"","server":"7ab5c227.a3ce8c","version":0,"rules":[],"output_type":"array","output_empty_results":true,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":700,"y":960,"wires":[["7d14cd218af3b9e3"]]},{"id":"7d14cd218af3b9e3","type":"switch","z":"666f64b87ddc48a7","name":"Device present?","property":"payload","propertyType":"msg","rules":[{"t":"nempty"},{"t":"empty"}],"checkall":"true","repair":false,"outputs":2,"x":870,"y":960,"wires":[["7e75e7741c2f50f9"],["d3f50841c197172b"]]},{"id":"7e75e7741c2f50f9","type":"switch","z":"666f64b87ddc48a7","name":"muted?","property":"payload[0].attributes.is_volume_muted","propertyType":"msg","rules":[{"t":"false"},{"t":"true"}],"checkall":"true","repair":false,"outputs":2,"x":1050,"y":940,"wires":[["9c5e34bd3f7d518e"],["d3f50841c197172b"]]},{"id":"b86acc1242fde04d","type":"function","z":"666f64b87ddc48a7","name":"Extract room from dial mqtt name and set regex to find speaker playing","func":"\nvar room = msg.room\nvar action = msg.action\n\nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': \"media_player.\" + room + \".*_speaker\" ,  'valueType': 're' },{ 'property': 'state' ,  'logic': 'is_not' , 'value': \"off\" ,  'valueType': 'str' }];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object},\n     \"action\": action,\n     \"room\": room\n\n}\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":340,"y":1020,"wires":[["920759e21d136d70"]]},{"id":"920759e21d136d70","type":"ha-get-entities","z":"666f64b87ddc48a7","name":"","server":"7ab5c227.a3ce8c","version":0,"rules":[],"output_type":"array","output_empty_results":true,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":700,"y":1020,"wires":[["6886b00579a47ca9"]]},{"id":"f8d9c3dd34151818","type":"split","z":"666f64b87ddc48a7","name":"Split entities","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":1420,"y":960,"wires":[["b664b74523b4dce4"]]},{"id":"6886b00579a47ca9","type":"switch","z":"666f64b87ddc48a7","name":"Device present?","property":"payload","propertyType":"msg","rules":[{"t":"nempty"},{"t":"empty"}],"checkall":"true","repair":false,"outputs":2,"x":870,"y":1020,"wires":[["aa0122737509c6fc"],["844393205939ad55"]]},{"id":"c76d55840f276476","type":"switch","z":"666f64b87ddc48a7","name":"muted?","property":"payload[0].attributes.is_volume_muted","propertyType":"msg","rules":[{"t":"false"},{"t":"true"}],"checkall":"true","repair":false,"outputs":2,"x":1510,"y":1020,"wires":[["f8d9c3dd34151818"],["4f95f32186f6bb15"]]},{"id":"b664b74523b4dce4","type":"change","z":"666f64b87ddc48a7","name":"set entity data","rules":[{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"payload.entity_id","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":1610,"y":960,"wires":[["32d0d5d8310eaba4"]]},{"id":"40474d998686368b","type":"switch","z":"666f64b87ddc48a7","name":"Play_Pause action?","property":"action","propertyType":"msg","rules":[{"t":"eq","v":"play_pause","vt":"str"},{"t":"nnull"}],"checkall":"false","repair":false,"outputs":2,"x":1370,"y":1060,"wires":[["3c2ed831098ee12d"],["3c2ed831098ee12d"]]},{"id":"32d0d5d8310eaba4","type":"switch","z":"666f64b87ddc48a7","name":"Light mode off?","property":"lightmode","propertyType":"flow","rules":[{"t":"neq","v":"1","vt":"num"},{"t":"null"},{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":3,"x":1790,"y":960,"wires":[["c63977aa6eb88db6"],["c63977aa6eb88db6"],["cd18b173fc618309"]]},{"id":"88b10389f6548132","type":"switch","z":"666f64b87ddc48a7","name":"paused?","property":"payload[0].state","propertyType":"msg","rules":[{"t":"eq","v":"playing","vt":"str"},{"t":"eq","v":"paused","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":1150,"y":1020,"wires":[["9c1a91c047dcd429"],["87c7a55fa57cbabf"]]},{"id":"cd18b173fc618309","type":"trigger","z":"666f64b87ddc48a7","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"100","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2010,"y":1060,"wires":[["087d14d5c0216afd"]]},{"id":"087d14d5c0216afd","type":"switch","z":"666f64b87ddc48a7","name":"","property":"action","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":2160,"y":1060,"wires":[["9fcaf489e80646c3"]]},{"id":"6929e531e3c5a8ea","type":"switch","z":"666f64b87ddc48a7","name":"","property":"action","propertyType":"msg","rules":[{"t":"eq","v":"rotate_right","vt":"str"},{"t":"eq","v":"play_pause","vt":"str"},{"t":"eq","v":"rotate_left","vt":"str"},{"t":"eq","v":"skip_forward","vt":"str"},{"t":"eq","v":"skip_backward","vt":"str"}],"checkall":"false","repair":false,"outputs":5,"x":2020,"y":960,"wires":[["2a2581429ae16074"],["242a14df38fedce3"],["ce1c08617f001569"],["7b4a2d1d1dc42f60"],["7776b6611621c5e5"]]},{"id":"9fcaf489e80646c3","type":"function","z":"666f64b87ddc48a7","name":"Extract room from dial mqtt name and set regex to find light groups","func":"\nvar room = msg.room;\nvar action = msg.action\n\nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': \"light.group_\" + room + \"_lights\" ,  'valueType': 're' }];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object},\n     \"action\": action,\n     \"room\": room\n\n}\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2470,"y":1060,"wires":[["e53874f76b06bda5"]]},{"id":"2a2581429ae16074","type":"api-call-service","z":"666f64b87ddc48a7","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_up","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2250,"y":840,"wires":[[]]},{"id":"242a14df38fedce3","type":"api-call-service","z":"666f64b87ddc48a7","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"media_play_pause","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2290,"y":880,"wires":[[]]},{"id":"ce1c08617f001569","type":"api-call-service","z":"666f64b87ddc48a7","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_down","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2280,"y":920,"wires":[[]]},{"id":"7b4a2d1d1dc42f60","type":"api-call-service","z":"666f64b87ddc48a7","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"media_next_track","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2310,"y":960,"wires":[[]]},{"id":"7776b6611621c5e5","type":"change","z":"666f64b87ddc48a7","name":"set flow light mode = 1","rules":[{"t":"set","p":"lightmode","pt":"flow","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":2210,"y":1000,"wires":[["d7c88abb12326fc8"]]},{"id":"e53874f76b06bda5","type":"ha-get-entities","z":"666f64b87ddc48a7","name":"","server":"7ab5c227.a3ce8c","version":0,"rules":[],"output_type":"array","output_empty_results":true,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":2820,"y":1060,"wires":[["bb985f9aba92f8a6"]]},{"id":"d7c88abb12326fc8","type":"trigger","z":"666f64b87ddc48a7","name":"","op1":"","op2":"0","op1type":"nul","op2type":"str","duration":"10","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2420,"y":1000,"wires":[["c1c0b6369d83c057"]]},{"id":"bb985f9aba92f8a6","type":"split","z":"666f64b87ddc48a7","name":"Split entities","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":3000,"y":1060,"wires":[["3e54994220490d3a","30645abb471b56d1"]]},{"id":"c1c0b6369d83c057","type":"change","z":"666f64b87ddc48a7","name":"set flow light mode = 0","rules":[{"t":"set","p":"lightmode","pt":"flow","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":2630,"y":1000,"wires":[[]]},{"id":"3e54994220490d3a","type":"change","z":"666f64b87ddc48a7","name":"set entity data","rules":[{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"payload.entity_id","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":3190,"y":1060,"wires":[["3ef8200c53c76f1f","1ff19ddb17d47b19"]]},{"id":"3ef8200c53c76f1f","type":"switch","z":"666f64b87ddc48a7","name":"","property":"action","propertyType":"msg","rules":[{"t":"eq","v":"rotate_right","vt":"str"},{"t":"eq","v":"rotate_left","vt":"str"},{"t":"eq","v":"play_pause","vt":"str"},{"t":"eq","v":"skip_forward","vt":"str"},{"t":"eq","v":"skip_backward","vt":"str"}],"checkall":"true","repair":false,"outputs":5,"x":3340,"y":1060,"wires":[["c1e92ce79f8e7fa3"],["811772d3b5e3969d"],["e56541c01e9d0fe0","1ff19ddb17d47b19"],["d5f7812fe85ed96f"],[]]},{"id":"c1e92ce79f8e7fa3","type":"function","z":"666f64b87ddc48a7","name":"Extract room from motion sensor entity an extract off lights to regex","func":"var room = msg.room;\n\n\nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': \"light.\" + room ,  'valueType': 're' }];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object}\n\n}\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3670,"y":1000,"wires":[["a2568ab72dbc24e7","13417d21e5cd4e79"]]},{"id":"811772d3b5e3969d","type":"api-call-service","z":"666f64b87ddc48a7","name":"Dim light","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"{\"brightness_step_pct\": -10}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3490,"y":1040,"wires":[[]]},{"id":"e56541c01e9d0fe0","type":"api-call-service","z":"666f64b87ddc48a7","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"toggle","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3490,"y":1080,"wires":[[]]},{"id":"d5f7812fe85ed96f","type":"api-call-service","z":"666f64b87ddc48a7","name":"Max white brightness","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"{\"brightness_pct\": 100,\"color_name\": \"white\"}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3530,"y":1120,"wires":[[]]},{"id":"a2568ab72dbc24e7","type":"debug","z":"666f64b87ddc48a7","name":"debug 170","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":4070,"y":1040,"wires":[]},{"id":"13417d21e5cd4e79","type":"ha-get-entities","z":"666f64b87ddc48a7","name":"","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"","logic":"is","value":"","valueType":"str"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":4080,"y":980,"wires":[["030613d112c5662c","11cbcd9fb8c1493c"]]},{"id":"030613d112c5662c","type":"trigger","z":"666f64b87ddc48a7","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"600","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"topic","topic":"payload.entity_id","outputs":1,"x":4310,"y":1000,"wires":[["5a66ccaf3495c8d7"]]},{"id":"11cbcd9fb8c1493c","type":"debug","z":"666f64b87ddc48a7","name":"debug 171","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":4310,"y":1040,"wires":[]},{"id":"5a66ccaf3495c8d7","type":"switch","z":"666f64b87ddc48a7","name":"Brightness?","property":"payload.attributes.brightness","propertyType":"msg","rules":[{"t":"null"},{"t":"lt","v":"250","vt":"str"},{"t":"gte","v":"250","vt":"str"}],"checkall":"false","repair":false,"outputs":3,"x":4500,"y":1000,"wires":[["a36198bb98f4cb55"],["a36198bb98f4cb55"],["9b17715cb05ed67d","1f7ecca76d41a053"]]},{"id":"a36198bb98f4cb55","type":"change","z":"666f64b87ddc48a7","name":"set entity","rules":[{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"payload.entity_id","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":4670,"y":1000,"wires":[["ed5e552d790d42df"]]},{"id":"9b17715cb05ed67d","type":"debug","z":"666f64b87ddc48a7","name":"debug 172","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":4670,"y":1040,"wires":[]},{"id":"1f7ecca76d41a053","type":"function","z":"666f64b87ddc48a7","name":"White addist","func":"// Declare variation\nvar saturation = msg.payload.attributes.hs_color[1];\nvar colorfinal = msg.payload.attributes.hs_color[0];\nvar entity_id = msg.payload.entity_id;\n\n// If saturation is over 10\nif(saturation > 10){\nvar saturationlesser = saturation - 10;\n} else if(saturation < 10){// If saturation is under 10\nvar saturationlesser = 0;\nvar colorfinal = 0;\n}\n else {\nvar saturationlesser = saturation;}\n\n\n\n\n\n\nvar newMsg = {\n    \"payload\": {\n            \"data\": {\n            \"hs_color\": [colorfinal, saturationlesser],\n            \"entity_id\": entity_id\n            }\n            }\n            \n   }\n\nreturn newMsg;\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4680,"y":1080,"wires":[["b003e527cc5191d2","464c3aef41a01f3c"]]},{"id":"ed5e552d790d42df","type":"api-call-service","z":"666f64b87ddc48a7","name":"Brightnen light","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"{\"brightness_step_pct\": 10}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4910,"y":1000,"wires":[[]]},{"id":"b003e527cc5191d2","type":"debug","z":"666f64b87ddc48a7","name":"debug 173","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":4890,"y":1040,"wires":[]},{"id":"464c3aef41a01f3c","type":"api-call-service","z":"666f64b87ddc48a7","name":"Add white","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4890,"y":1080,"wires":[[]]},{"id":"4fc6eced1ccf8c63","type":"trigger","z":"666f64b87ddc48a7","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"200","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"topic","topic":"topic","outputs":1,"x":2050,"y":800,"wires":[["2a2581429ae16074"]]},{"id":"30645abb471b56d1","type":"debug","z":"666f64b87ddc48a7","name":"split entity","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3190,"y":960,"wires":[]},{"id":"1ff19ddb17d47b19","type":"debug","z":"666f64b87ddc48a7","name":"debug 174","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":3520,"y":1200,"wires":[]},{"id":"71bafc01e112cb08","type":"ha-get-entities","z":"666f64b87ddc48a7","name":"","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"attributes.administrative_area","logic":"is","value":"bedroom","valueType":"str"}],"output_type":"array","output_empty_results":true,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":570,"y":380,"wires":[[]]},{"id":"292eb5d6f4873bb9","type":"inject","z":"666f64b87ddc48a7","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":280,"y":380,"wires":[["71bafc01e112cb08"]]},{"id":"a404217aeb08935f","type":"ha-api","z":"666f64b87ddc48a7","name":"","server":"7ab5c227.a3ce8c","version":1,"debugenabled":false,"protocol":"websocket","method":"get","path":"","data":"{\t   \"type\":\"search/related\",\t   \"item_type\":\"area\",\t   \"item_id\":\"bedroom\"\t}","dataType":"jsonata","responseType":"json","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"results"}],"x":1610,"y":300,"wires":[["696a8e8a3cce56e6"]]},{"id":"75729b60dae90b9b","type":"inject","z":"666f64b87ddc48a7","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1440,"y":300,"wires":[["a404217aeb08935f"]]},{"id":"696a8e8a3cce56e6","type":"debug","z":"666f64b87ddc48a7","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1786,"y":300,"wires":[]},{"id":"da74958588158efb","type":"ha-api","z":"666f64b87ddc48a7","name":"areas","server":"7ab5c227.a3ce8c","version":1,"debugenabled":false,"protocol":"websocket","method":"get","path":"","data":"{\"type\": \"config/area_registry/list\"}","dataType":"json","responseType":"json","outputProperties":[{"property":"areas","propertyType":"msg","value":"","valueType":"results"}],"x":450,"y":1480,"wires":[["78390cbd36dc001c"]]},{"id":"7756634998b883de","type":"inject","z":"666f64b87ddc48a7","name":"Manual Update","repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":256,"y":1480,"wires":[["da74958588158efb"]]},{"id":"78390cbd36dc001c","type":"ha-api","z":"666f64b87ddc48a7","name":"devices","server":"7ab5c227.a3ce8c","version":1,"debugenabled":false,"protocol":"websocket","method":"get","path":"","data":"{\"type\": \"config/device_registry/list\"}","dataType":"json","responseType":"json","outputProperties":[{"property":"devices","propertyType":"msg","value":"","valueType":"results"}],"x":590,"y":1480,"wires":[["f7fb1e72f2d14e41"]]},{"id":"f7fb1e72f2d14e41","type":"ha-api","z":"666f64b87ddc48a7","name":"entities","server":"7ab5c227.a3ce8c","version":1,"debugenabled":false,"protocol":"websocket","method":"get","path":"","data":"{\"type\": \"config/entity_registry/list\"}","dataType":"json","responseType":"json","outputProperties":[{"property":"entities","propertyType":"msg","value":"","valueType":"results"}],"x":734,"y":1480,"wires":[["51b6dfaab15b2105"]]},{"id":"979e7ae642fd5c8f","type":"debug","z":"666f64b87ddc48a7","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1080,"y":1480,"wires":[]},{"id":"51b6dfaab15b2105","type":"function","z":"666f64b87ddc48a7","name":"","func":"const entities = {};\n\nmsg.entities.forEach(e => {\n    if(!e.device_id) return;\n    \n    const device = msg.devices.find(d => d.id === e.device_id);\n    const area = msg.areas.find(a => a.area_id === device.area_id);\n    if(area) {\n        entities[e.entity_id] = {\n            area_id: area.area_id,\n            name: area.name\n        };\n    }\n});\n\nmsg.payload = entities;\nmsg.update = true;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":900,"y":1480,"wires":[["979e7ae642fd5c8f"]]},{"id":"d25214652b418a9d","type":"function","z":"666f64b87ddc48a7","name":"Extract room from dial mqtt name","func":"var friendly_name = msg.payload.device.friendlyName; // light group\n\nvar room = friendly_name.replace(\"remote_\", \"\").replace(\"_dial\", \"\");\n\n\nvar msg = {\n     \"room\": room\n\n}\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":440,"y":580,"wires":[["ee1766d1823c38f7"]]},{"id":"773842d02f82815c","type":"debug","z":"666f64b87ddc48a7","name":"debug 175","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1410,"y":580,"wires":[]},{"id":"468bf60284fc76a3","type":"inject","z":"666f64b87ddc48a7","name":"dial office play pause","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"zigbee2mqtt/remote_office_dial","payload":"{\"action\":\"play_pause\",\"battery\":null,\"brightness\":255,\"device\":{\"applicationVersion\":33,\"dateCode\":\"20190710\",\"friendlyName\":\"remote_office_dial\",\"hardwareVersion\":1,\"ieeeAddr\":\"0xec1bbdfffe325670\",\"manufacturerID\":4476,\"manufacturerName\":\"IKEA of Sweden\",\"model\":\"E1744\",\"networkAddress\":6245,\"powerSource\":\"Battery\",\"softwareBuildID\":\"2.1.024\",\"stackVersion\":98,\"type\":\"EndDevice\",\"zclVersion\":3},\"linkquality\":18,\"rate\":195,\"update\":{\"state\":\"available\"},\"update_available\":true}","payloadType":"json","x":180,"y":580,"wires":[["d25214652b418a9d"]]},{"id":"c43875db375f2289","type":"mqtt in","z":"666f64b87ddc48a7","name":"","topic":"zigbee2mqtt/remote_hallway_dial","qos":"2","datatype":"json","broker":"21000c19b97da572","nl":false,"rap":true,"rh":0,"inputs":0,"x":230,"y":900,"wires":[[]]},{"id":"959943a513c0031d","type":"debug","z":"666f64b87ddc48a7","name":"debug 176","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":370,"y":800,"wires":[]},{"id":"810966ab9127b7fe","type":"ha-get-entities","z":"666f64b87ddc48a7","name":"","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"attributes.administrative_area","logic":"is","value":"bedroom","valueType":"str"}],"output_type":"array","output_empty_results":true,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":1190,"y":340,"wires":[[]]},{"id":"ee1766d1823c38f7","type":"ha-api","z":"666f64b87ddc48a7","name":"Pull entities with msg.room","server":"7ab5c227.a3ce8c","version":1,"debugenabled":false,"protocol":"websocket","method":"get","path":"","data":"{\t   \"type\":\"search/related\",\t   \"item_type\":\"area\",\t   \"item_id\":msg.room\t}","dataType":"jsonata","responseType":"json","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"results"}],"x":720,"y":580,"wires":[["c2487c20d3b1c407"]]},{"id":"c2487c20d3b1c407","type":"split","z":"666f64b87ddc48a7","name":"Split results","splt":"\\n","spltType":"str","arraySplt":"1","arraySpltType":"len","stream":false,"addname":"category","x":930,"y":580,"wires":[["a240543331165622"]]},{"id":"a240543331165622","type":"switch","z":"666f64b87ddc48a7","name":"","property":"category","propertyType":"msg","rules":[{"t":"eq","v":"entity","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1070,"y":580,"wires":[["ecae28babb68cfb1"]]},{"id":"ecae28babb68cfb1","type":"split","z":"666f64b87ddc48a7","name":"Split entities","splt":"\\n","spltType":"str","arraySplt":"1","arraySpltType":"len","stream":false,"addname":"","x":1210,"y":580,"wires":[["773842d02f82815c"]]},{"id":"df873c131b2cadc4","type":"ha-get-entities","z":"666f64b87ddc48a7","name":"Get ChromecastMedia players","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"entity_id","logic":"is","value":"media_player\\.(?!plex).*_chromecast","valueType":"re"},{"property":"state","logic":"is","value":"off","valueType":"str"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":810,"y":1960,"wires":[["2af3bd24cdf558c2"]]},{"id":"f56f20395b6bac36","type":"trigger","z":"666f64b87ddc48a7","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"15","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":490,"y":1960,"wires":[["df873c131b2cadc4"]]},{"id":"9894413c2f0d344e","type":"inject","z":"666f64b87ddc48a7","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":640,"y":1860,"wires":[["df873c131b2cadc4"]]},{"id":"2af3bd24cdf558c2","type":"delay","z":"666f64b87ddc48a7","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"8","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1060,"y":1960,"wires":[["e7713a1ab76f5647"]]},{"id":"c9373437014bbef6","type":"server-state-changed","z":"666f64b87ddc48a7","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.acid_time","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":160,"y":1960,"wires":[["f56f20395b6bac36"],[]]},{"id":"e7713a1ab76f5647","type":"change","z":"666f64b87ddc48a7","name":"","rules":[{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"payload.entity_id","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":1310,"y":1960,"wires":[["a1eec6f70193a63a"]]},{"id":"a1eec6f70193a63a","type":"api-call-service","z":"666f64b87ddc48a7","name":"play visuals","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"play_media","areaId":[],"deviceId":[],"entityId":[],"data":"{\"media_content_id\":\"plex://{ \\\"playlist_name\\\": \\\"4k visuals\\\", \\\"shuffle\\\": 1 }\",\"media_content_type\":\"playlist\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1550,"y":1960,"wires":[["18d9335d8fcfb58a"]]},{"id":"18d9335d8fcfb58a","type":"api-call-service","z":"666f64b87ddc48a7","name":"Set volume to 0.1","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_set","areaId":[],"deviceId":[],"entityId":[],"data":"{\"volume_level\":\"0.1\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1750,"y":1960,"wires":[["ba6de1af01422f84"]]},{"id":"ba6de1af01422f84","type":"api-call-service","z":"666f64b87ddc48a7","name":"Mute Volume","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_mute","areaId":[],"deviceId":[],"entityId":[],"data":"{\"is_volume_muted\": \"true\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1950,"y":1960,"wires":[[]]},{"id":"727c5ffbee28d542","type":"server-state-changed","z":"666f64b87ddc48a7","name":"office speaker","server":"209ff8ef.59a5d8","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"media_player.office_speaker","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"playing","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":150,"y":340,"wires":[[],[]]},{"id":"8595d2e42518f921","type":"http request","z":"666f64b87ddc48a7","name":"","method":"GET","ret":"obj","paytoqs":"body","url":"192.168.0.20:8686/api/v1/metadataprofile","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"bearer","senderr":false,"headers":[],"x":990,"y":440,"wires":[["0b5c1e2134b252a9"]]},{"id":"0b5c1e2134b252a9","type":"debug","z":"666f64b87ddc48a7","name":"debug 186","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1150,"y":440,"wires":[]},{"id":"5deba4b586c02662","type":"inject","z":"666f64b87ddc48a7","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":840,"y":440,"wires":[["8595d2e42518f921"]]},{"id":"2c8492c9e2889acd","type":"http request","z":"8ab98f5aa8b2c325","name":"POST request","method":"PUT","ret":"txt","paytoqs":"ignore","url":"http://192.168.0.15:6100/v1/lifx/command","tls":"","persist":false,"proxy":"","authType":"","senderr":false,"headers":[],"x":1200,"y":1080,"wires":[["a907fb5a44b8cc10"]]},{"id":"485c9e7a7b788b50","type":"function","z":"8ab98f5aa8b2c325","name":"Help","func":"var newMsg = {\n    \"payload\":        {\"command\": \"help\", \"args\": {\"command\": \"animation\"}}\n};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":930,"y":1120,"wires":[["2c8492c9e2889acd"]]},{"id":"1cbdc0925815f62b","type":"inject","z":"8ab98f5aa8b2c325","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":700,"y":1160,"wires":[["26cbaebe28fd5cab"]]},{"id":"a907fb5a44b8cc10","type":"debug","z":"8ab98f5aa8b2c325","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1370,"y":1120,"wires":[]},{"id":"91e2c7797d282c73","type":"function","z":"8ab98f5aa8b2c325","name":"stopping effect","func":"var newMsg = {\n    \"payload\":         {\n        \"command\": \"effects/stop\"\n        }\n};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":940,"y":1080,"wires":[["2c8492c9e2889acd"]]},{"id":"475b3eddd6ecef1f","type":"function","z":"8ab98f5aa8b2c325","name":"Discover","func":"var newMsg = {\n    \"payload\":         {\n        \"command\": \"discover\"\n        }\n};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":940,"y":1040,"wires":[["2c8492c9e2889acd"]]},{"id":"f56aad64d35e1b79","type":"function","z":"8ab98f5aa8b2c325","name":"red","func":"var newMsg = {\n    \"payload\":               {\n        \"command\": \"transform\",\n        \"args\": {\n          \"transform\": {\n            \"color\": \"red saturation:1.0 brightness:0.5\"\n          }\n        }\n      }\n};\nreturn newMsg;\n","outputs":1,"noerr":0,"x":950,"y":1000,"wires":[["2c8492c9e2889acd"]]},{"id":"26cbaebe28fd5cab","type":"function","z":"8ab98f5aa8b2c325","name":"start animation on bedroom","func":"var newMsg = {\n    \"payload\":         {\n      \"command\": \"animation/start\",\n      \"args\": {\n        \"matcher\": {\"serial\": \"d073d53df5e6\"},\n        \"animations\": [\"asd\"],\n        \"run_options\": {\"reinstate_on_end\": true, \"animation_limit\": 3}\n      }\n    }\n};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1000,"y":1160,"wires":[["2c8492c9e2889acd"]]},{"id":"273d7c2a22c6abee","type":"inject","z":"8ab98f5aa8b2c325","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"1","payloadType":"str","x":330,"y":220,"wires":[["52d6ae1fc56701c4"]]},{"id":"4207b7e1aa329ee1","type":"http request","z":"8ab98f5aa8b2c325","name":"POST request","method":"POST","ret":"txt","paytoqs":"ignore","url":"http://192.168.0.14:5050/v1/vision/face/register","tls":"","persist":false,"proxy":"","authType":"","senderr":false,"headers":[],"x":760,"y":220,"wires":[["78c0882e7a439cbe"]]},{"id":"78c0882e7a439cbe","type":"debug","z":"8ab98f5aa8b2c325","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":910,"y":120,"wires":[]},{"id":"52d6ae1fc56701c4","type":"function","z":"8ab98f5aa8b2c325","name":"Set image","func":"var newMsg = {\n    \"payload\":{\n        \"files\":{ \"file_path\": \"http://192.168.0.15:8123/local/maxi.jpg\"},\n        \"data\":{\"userid\":\"Maxi\"}\n        \n    }\n};\nreturn newMsg;\n","outputs":1,"noerr":0,"x":480,"y":220,"wires":[["4207b7e1aa329ee1"]]},{"id":"c1b1b39ee9e7b715","type":"inject","z":"8ab98f5aa8b2c325","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"1","payloadType":"str","x":330,"y":320,"wires":[["37d924dd8bff3492"]]},{"id":"9e2adc0d8aeca04d","type":"http request","z":"8ab98f5aa8b2c325","name":"POST request","method":"POST","ret":"txt","paytoqs":"ignore","url":"http://192.168.0.14:5050/v1/vision/face/recognize","tls":"","persist":true,"proxy":"","authType":"","senderr":false,"headers":[],"x":760,"y":320,"wires":[["3470211e811be856"]]},{"id":"3470211e811be856","type":"debug","z":"8ab98f5aa8b2c325","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":950,"y":320,"wires":[]},{"id":"37d924dd8bff3492","type":"function","z":"8ab98f5aa8b2c325","name":"Set image","func":"var newMsg = {\n    \"payload\":{\n  \"name\": \"Maxi\",\n  \"file_path\": \"http://192.168.0.15:8123/local/maxi.jpg\"\n}\n};\nreturn newMsg;\n","outputs":1,"noerr":0,"x":480,"y":320,"wires":[["9e2adc0d8aeca04d"]]},{"id":"9763d29c9106db72","type":"inject","z":"8ab98f5aa8b2c325","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":700,"y":1120,"wires":[["485c9e7a7b788b50"]]},{"id":"5af4ba4d4a8483a9","type":"inject","z":"8ab98f5aa8b2c325","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":700,"y":1080,"wires":[["91e2c7797d282c73"]]},{"id":"cd31cc528ac759d2","type":"inject","z":"8ab98f5aa8b2c325","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":700,"y":1040,"wires":[["475b3eddd6ecef1f"]]},{"id":"8e379bab15c24f29","type":"inject","z":"8ab98f5aa8b2c325","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":700,"y":1000,"wires":[["f56aad64d35e1b79"]]},{"id":"564c40d106ea5c6e","type":"function","z":"8ab98f5aa8b2c325","name":"stop animation on bedroom","func":"var newMsg = {\n    \"payload\":         {\n      \"command\": \"animation/stop\",\n      \"args\": {\n        \"matcher\": {\"serial\": \"d073d53df5e6\"},\n        \"animations\": [\"nan\"],\n        \"run_options\": {\"reinstate_on_end\": true, \"animation_limit\": 3}\n      }\n    }\n};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":980,"y":1200,"wires":[["2c8492c9e2889acd"]]},{"id":"14662096d24bcd39","type":"inject","z":"8ab98f5aa8b2c325","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":720,"y":1220,"wires":[["564c40d106ea5c6e"]]},{"id":"b919acc13c6761d4","type":"function","z":"8ab98f5aa8b2c325","name":"Help animate","func":"var newMsg = {\n    \"payload\":        {\"command\": \"animation/info\", \"args\": {\"command\": \"animation/list\"}}\n};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":970,"y":940,"wires":[["2c8492c9e2889acd"]]},{"id":"b47aedbb9254e7e4","type":"inject","z":"8ab98f5aa8b2c325","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":720,"y":940,"wires":[["b919acc13c6761d4"]]},{"id":"ec5ee7adb195d6a1","type":"function","z":"8ab98f5aa8b2c325","name":"Help other","func":"var newMsg = {\n    \"payload\":        {\"command\": \"help\", \"args\": {\"command\": \"transform\"}}\n};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":990,"y":880,"wires":[["2c8492c9e2889acd"]]},{"id":"82f38dbdc47c28ad","type":"inject","z":"8ab98f5aa8b2c325","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":740,"y":880,"wires":[["ec5ee7adb195d6a1"]]},{"id":"af63b1c9e776cfa6","type":"function","z":"8ab98f5aa8b2c325","name":"start transform on bedroom","func":"var newMsg = {\n    \"payload\":               {\n        \"command\": \"transform\",\n        \"args\": {\n          \"transform\": {\n            \"color\": \"red saturation:1.0 brightness:0.5\",\n            \"effect\": \"breathe\", \n            \"cycles\": 50\n          }\n        }\n      }\n};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":980,"y":1280,"wires":[["2c8492c9e2889acd"]]},{"id":"148b94c687d18162","type":"inject","z":"8ab98f5aa8b2c325","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":740,"y":1300,"wires":[["af63b1c9e776cfa6"]]},{"id":"7c9a8b6e062c05a6","type":"function","z":"8ab98f5aa8b2c325","name":"start transform on bedroom","func":"var newMsg = {\n    \"payload\":               {\n        \"command\": \"transform\",\n        \"args\": {\n          \"transform\": {\n            \"color\": \"red saturation:1.0 brightness:0.5\",\n            \"effect\": \"triangle\", \n            \"cycles\": 50\n          }\n        }\n      }\n};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":960,"y":1340,"wires":[["2c8492c9e2889acd"]]},{"id":"b88929809f6eeea4","type":"inject","z":"8ab98f5aa8b2c325","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":720,"y":1360,"wires":[["7c9a8b6e062c05a6"]]},{"id":"c6a30bac55fafa49","type":"http request","z":"8ab98f5aa8b2c325","name":"POST request","method":"POST","ret":"txt","paytoqs":"ignore","url":"http://192.168.0.15:6100/v1/lights/all/effects/morph","tls":"","persist":false,"proxy":"","authType":"","x":1000,"y":1460,"wires":[["cc7107656c191004"]]},{"id":"7cfb7c5074dd3392","type":"function","z":"8ab98f5aa8b2c325","name":"start transform on bedroom","func":"var newMsg = {\n    \"payload\":               {\n        \"command\": \"transform\",\n        \"args\": {\n          \"transform\": {\n            \"color\": \"red saturation:1.0 brightness:0.5\",\n            \"effect\": \"triangle\", \n            \"cycles\": 50\n          }\n        }\n      }\n};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":760,"y":1500,"wires":[["c6a30bac55fafa49"]]},{"id":"42290e9141851995","type":"inject","z":"8ab98f5aa8b2c325","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":660,"y":1420,"wires":[["7cfb7c5074dd3392"]]},{"id":"cc7107656c191004","type":"debug","z":"8ab98f5aa8b2c325","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1190,"y":1460,"wires":[]},{"id":"8ec61da1e806f88a","type":"function","z":"8ab98f5aa8b2c325","name":" Set payload for play media ","func":"var msg = {\n    \"payload\": {\n      \"message\": \"hoy\"\n}\n\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":880,"y":2040,"wires":[["89cd2bba1ebcdc1e"]]},{"id":"89cd2bba1ebcdc1e","type":"http request","z":"8ab98f5aa8b2c325","name":"POST request","method":"POST","ret":"obj","paytoqs":"ignore","url":"http://192.168.0.14:8085/broadcast","tls":"","persist":false,"proxy":"","authType":"","senderr":false,"headers":[],"x":1200,"y":2040,"wires":[["d2a3ea3f9ca95bc2"]]},{"id":"9efcc6094bf22087","type":"inject","z":"8ab98f5aa8b2c325","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":580,"y":2040,"wires":[["8ec61da1e806f88a"]]},{"id":"d2a3ea3f9ca95bc2","type":"debug","z":"8ab98f5aa8b2c325","name":"debug 30","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1640,"y":1960,"wires":[]},{"id":"6148ec1ebee3cc91","type":"function","z":"8ab98f5aa8b2c325","name":" Set payload for play media ","func":"var msg = {\n    \"payload\": {\n    \"data\": {\n      \"message\": \"test\"\n}}\n\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1420,"y":700,"wires":[["16132327bd2d415a"]]},{"id":"16132327bd2d415a","type":"api-call-service","z":"8ab98f5aa8b2c325","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"tts","service":"google_translate_say","areaId":[],"deviceId":[],"entityId":["media_player.group_home_speakers"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1720,"y":700,"wires":[[]]},{"id":"e5e1f15a659ccc75","type":"inject","z":"8ab98f5aa8b2c325","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"1","payloadType":"str","x":1130,"y":720,"wires":[["6148ec1ebee3cc91"]]},{"id":"12ee852fee6fc0cf","type":"ha-get-entities","z":"8ab98f5aa8b2c325","name":"Get ChromecastMedia players","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"entity_id","logic":"is","value":"media_player\\.(?!plex).*_chromecast","valueType":"re"},{"property":"state","logic":"is","value":"off","valueType":"str"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":890,"y":1760,"wires":[["985d0469249533f6"]]},{"id":"985d0469249533f6","type":"delay","z":"8ab98f5aa8b2c325","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"8","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1140,"y":1760,"wires":[["f14eb625a6d4f161"]]},{"id":"f14eb625a6d4f161","type":"change","z":"8ab98f5aa8b2c325","name":"","rules":[{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"payload.entity_id","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":1390,"y":1760,"wires":[["63a57df1a95c168c"]]},{"id":"63a57df1a95c168c","type":"api-call-service","z":"8ab98f5aa8b2c325","name":"play visuals","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"play_media","areaId":[],"deviceId":[],"entityId":[],"data":"{\"media_content_id\":\"plex://{ \\\"playlist_name\\\": \\\"Automatic 4k Visuals\\\", \\\"shuffle\\\": 1 }\",\"media_content_type\":\"playlist\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1630,"y":1760,"wires":[["10adc392a90025a6"]]},{"id":"10adc392a90025a6","type":"api-call-service","z":"8ab98f5aa8b2c325","name":"Set volume to 0.1","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_set","areaId":[],"deviceId":[],"entityId":[],"data":"{\"volume_level\":\"0.1\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1830,"y":1760,"wires":[["95a32241e207eb9a"]]},{"id":"95a32241e207eb9a","type":"api-call-service","z":"8ab98f5aa8b2c325","name":"Mute Volume","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_mute","areaId":[],"deviceId":[],"entityId":[],"data":"{\"is_volume_muted\": \"true\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2030,"y":1760,"wires":[[]]},{"id":"708d9669756e700e","type":"comment","z":"8ab98f5aa8b2c325","name":"Pull all inactive Chromecasts entities","info":"","x":880,"y":1720,"wires":[]},{"id":"d746cd305bd77262","type":"comment","z":"8ab98f5aa8b2c325","name":"rate limit at 1 per 8s","info":"","x":1130,"y":1720,"wires":[]},{"id":"ac58cce6c851f9d7","type":"comment","z":"8ab98f5aa8b2c325","name":"Extract the entity id","info":"","x":1390,"y":1720,"wires":[]},{"id":"8399c939f27fcad9","type":"comment","z":"8ab98f5aa8b2c325","name":"Start the 4k visuals playlist","info":"","x":1630,"y":1720,"wires":[]},{"id":"438f63998b84b673","type":"comment","z":"8ab98f5aa8b2c325","name":"Set volume to 0.1","info":"","x":1840,"y":1720,"wires":[]},{"id":"177099fbcc15ce6c","type":"comment","z":"8ab98f5aa8b2c325","name":"(bug mitigation)","info":"The Google chromecasts don't always give the right volume, this forces an update","x":1840,"y":1800,"wires":[]},{"id":"165a3ae62bb0e7b4","type":"comment","z":"8ab98f5aa8b2c325","name":"Mute the Tv","info":"","x":2030,"y":1720,"wires":[]},{"id":"ac6060195e0707e6","type":"inject","z":"8ab98f5aa8b2c325","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":560,"y":1800,"wires":[["12ee852fee6fc0cf"]]},{"id":"01a38adc2883b0ed","type":"inject","z":"8ab98f5aa8b2c325","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"1","payloadType":"str","x":270,"y":120,"wires":[["25740908779ed89b"]]},{"id":"25740908779ed89b","type":"ha-get-entities","z":"8ab98f5aa8b2c325","name":"","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"attributes.administrative_area","logic":"is","value":"Bedroom","valueType":"str"}],"output_type":"array","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":450,"y":120,"wires":[["78c0882e7a439cbe"]]},{"id":"af599bf2cf3b63a0","type":"ha-api","z":"8ab98f5aa8b2c325","name":"areas","server":"7ab5c227.a3ce8c","version":1,"debugenabled":false,"protocol":"websocket","method":"get","path":"","data":"{\"type\": \"config/area_registry/list\"}","dataType":"json","responseType":"json","outputProperties":[{"property":"areas","propertyType":"msg","value":"","valueType":"results"}],"x":374,"y":604,"wires":[["1692dc0f68fe3616"]]},{"id":"7f2838c4075f8656","type":"inject","z":"8ab98f5aa8b2c325","name":"Manual Update","repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":180,"y":604,"wires":[["af599bf2cf3b63a0"]]},{"id":"1692dc0f68fe3616","type":"ha-api","z":"8ab98f5aa8b2c325","name":"devices","server":"7ab5c227.a3ce8c","version":1,"debugenabled":false,"protocol":"websocket","method":"get","path":"","data":"{\"type\": \"config/device_registry/list\"}","dataType":"json","responseType":"json","outputProperties":[{"property":"devices","propertyType":"msg","value":"","valueType":"results"}],"x":520,"y":560,"wires":[["9b32c5bff6401de8"]]},{"id":"9b32c5bff6401de8","type":"ha-api","z":"8ab98f5aa8b2c325","name":"entities","server":"7ab5c227.a3ce8c","version":1,"debugenabled":false,"protocol":"websocket","method":"get","path":"","data":"{\"type\": \"config/entity_registry/list\"}","dataType":"json","responseType":"json","outputProperties":[{"property":"entities","propertyType":"msg","value":"","valueType":"results"}],"x":680,"y":500,"wires":[["8daadb6602ec1528"]]},{"id":"a032bafbe360c775","type":"debug","z":"8ab98f5aa8b2c325","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1004,"y":604,"wires":[]},{"id":"8daadb6602ec1528","type":"function","z":"8ab98f5aa8b2c325","name":"","func":"const entities = {};\n\nmsg.entities.forEach(e => {\n    if(!e.device_id) return;\n    \n    const device = msg.devices.find(d => d.id === e.device_id);\n    const area = msg.areas.find(a => a.area_id === device.area_id);\n    if(area) {\n        entities[e.entity_id] = {\n            area_id: area.area_id,\n            name: area.name\n        };\n    }\n});\n\nmsg.payload = entities;\nmsg.update = true;\nreturn msg;","outputs":1,"noerr":0,"x":824,"y":604,"wires":[["a032bafbe360c775"]]},{"id":"6adcadcb1d6f6c25","type":"ha-api","z":"8ab98f5aa8b2c325","name":"","server":"7ab5c227.a3ce8c","version":1,"debugenabled":false,"protocol":"websocket","method":"get","path":"","data":"{\t   \"type\":\"search/related\",\t   \"item_type\":\"area\",\t   \"item_id\":\"kitchen\"\t}","dataType":"jsonata","responseType":"json","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"results"}],"x":370,"y":440,"wires":[["7711c397ae4f46b8"]]},{"id":"f0aa795f7467f496","type":"inject","z":"8ab98f5aa8b2c325","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":204,"y":440,"wires":[["6adcadcb1d6f6c25"]]},{"id":"7711c397ae4f46b8","type":"debug","z":"8ab98f5aa8b2c325","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":566,"y":440,"wires":[]},{"id":"8aeffb6fc961ba4c","type":"function","z":"8ab98f5aa8b2c325","name":" Set payload for play media ","func":"var msg = {\n    \"payload\": {\n      \"message\":   msg.message\n}\n\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":520,"y":760,"wires":[["409cdd84649d5063"]]},{"id":"409cdd84649d5063","type":"http request","z":"8ab98f5aa8b2c325","name":"POST request","method":"POST","ret":"obj","paytoqs":"ignore","url":"http://192.168.0.14:8085/broadcast","tls":"","persist":false,"proxy":"","authType":"","senderr":false,"headers":[],"x":840,"y":760,"wires":[[]]},{"id":"200460a5fceff893","type":"change","z":"8ab98f5aa8b2c325","name":"Set Message and color","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"message","pt":"msg","to":"Water Damage Detected In The Kitchen","tot":"str"},{"t":"set","p":"color_value","pt":"msg","to":"[0,255,255]","tot":"json"},{"t":"set","p":"dbrightness","pt":"msg","to":"100","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":260,"y":780,"wires":[["8aeffb6fc961ba4c"]]},{"id":"29c622b87b857b2a","type":"inject","z":"8ab98f5aa8b2c325","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":720,"wires":[["200460a5fceff893"]]},{"id":"4cb23e9433cf6f87","type":"function","z":"8ab98f5aa8b2c325","name":" Set payload for play media ","func":"var msg = {\n    \"payload\": {\n      \"message\":   \"broadcast to chillingroom speaker, this is a test \"\n}\n\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":460,"y":2820,"wires":[["5dd8124a89b4bd00"]]},{"id":"5dd8124a89b4bd00","type":"http request","z":"8ab98f5aa8b2c325","name":"POST request","method":"POST","ret":"obj","paytoqs":"ignore","url":"http://192.168.0.14:8085/broadcast","tls":"","persist":false,"proxy":"","authType":"","senderr":false,"headers":[],"x":780,"y":2820,"wires":[[]]},{"id":"6dbac789f6d12eb6","type":"change","z":"8ab98f5aa8b2c325","name":"Set Message and color","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"message","pt":"msg","to":"Water Damage Detected In The Kitchen","tot":"str"},{"t":"set","p":"color_value","pt":"msg","to":"[0,255,255]","tot":"json"},{"t":"set","p":"dbrightness","pt":"msg","to":"100","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":200,"y":2840,"wires":[["4cb23e9433cf6f87"]]},{"id":"212f0010b21e3078","type":"inject","z":"8ab98f5aa8b2c325","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":160,"y":2740,"wires":[["6dbac789f6d12eb6"]]},{"id":"74e83bb54e13e800","type":"server-state-changed","z":"90585768a7a619f8","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.remote_doorbell_button_action","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"None","halt_if_type":"str","halt_if_compare":"is_not","outputs":2,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":true,"ignorePrevStateUnknown":true,"ignorePrevStateUnavailable":true,"ignoreCurrentStateUnknown":true,"ignoreCurrentStateUnavailable":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":200,"y":540,"wires":[["d2ec41d6aac3af0d","de0d45e08d67309e"],[]]},{"id":"ffe3bf33bb370856","type":"inject","z":"90585768a7a619f8","name":"click","props":[{"p":"payload.event.command","v":"click","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":3090,"y":780,"wires":[[]]},{"id":"5468d4ebbfa0037c","type":"api-current-state","z":"90585768a7a619f8","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"camera.facecam_person","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":580,"y":480,"wires":[["4c880ba1a1e1524c","88a6d28e86a3933f"]]},{"id":"4c880ba1a1e1524c","type":"debug","z":"90585768a7a619f8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1070,"y":360,"wires":[]},{"id":"88a6d28e86a3933f","type":"function","z":"90585768a7a619f8","name":"Time Check + Cam Passthrough","func":"\nvar timestamp = msg.data.last_updated;\nvar timestampUnix = new Date(timestamp).getTime();\nvar cameraurl = msg.data.attributes.entity_picture;\n\nvar now = Date.now();\nvar timedif = (now - timestampUnix);\n\n\nif (timedif < 50000 ){ // set back to 100000 after test\n     var nowfinal = 1;\n } else {\n     var nowfinal = 0;};\n\n\n\n  var test = {\n   \t\"payload\":  {\n\t\t\"now\":  nowfinal\n\t\t\n   \t},\n   \t\"entity\": msg.entity,\n   \t\"data\": msg.data,\n   \t\"cameraurl\": \"http://192.168.0.15:8123\" + cameraurl\n  };\n  return test;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":890,"y":480,"wires":[["7ae1ef352a10a3f3","9ddf2dd94d18f1c7"]]},{"id":"7ae1ef352a10a3f3","type":"debug","z":"90585768a7a619f8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1270,"y":280,"wires":[]},{"id":"9ddf2dd94d18f1c7","type":"switch","z":"90585768a7a619f8","name":"Now pic top, old pic bottom","property":"payload.now","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":1160,"y":500,"wires":[["02cd6a8a41ba903f"],["d53583062314d64f"]]},{"id":"7b192427da0ef0bd","type":"api-current-state","z":"90585768a7a619f8","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"camera.facecam","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":1630,"y":560,"wires":[["c3229b8d83beacb2","b3d64d1e907a6f10"]]},{"id":"02cd6a8a41ba903f","type":"function","z":"90585768a7a619f8","name":"Double take URL set","func":"// SETTINGS\nvar required_conf = 75;\n// SETTINGS\n\n  var test = {\n   \t\"payload\":  {\n\t\t\"url\": \"http://192.168.0.14:3000/api/recognize?url=\" + msg.cameraurl + \"&camera=camera.facecam\"\n   \t},\n   \t\"url\": \"http://192.168.0.14:3000/api/recognize?url=\" + msg.cameraurl + \"&camera=camera.facecam\"\n  };\n  return test;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1400,"y":520,"wires":[["503b614ca1d1c1e4","26f440787c731b08"]]},{"id":"503b614ca1d1c1e4","type":"http request","z":"90585768a7a619f8","name":"[POST] Recognize Double-Take","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","senderr":false,"x":1650,"y":520,"wires":[["68892ec178b704a0"]]},{"id":"26f440787c731b08","type":"debug","z":"90585768a7a619f8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1750,"y":360,"wires":[]},{"id":"200a580462a49ee8","type":"debug","z":"90585768a7a619f8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1950,"y":340,"wires":[]},{"id":"68892ec178b704a0","type":"json","z":"90585768a7a619f8","name":"toJson","property":"payload","action":"","pretty":true,"x":1850,"y":520,"wires":[["200a580462a49ee8","8aa52921be81dcd1"]]},{"id":"c3229b8d83beacb2","type":"debug","z":"90585768a7a619f8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1550,"y":680,"wires":[]},{"id":"6765ee0d50b6477f","type":"debug","z":"90585768a7a619f8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2090,"y":880,"wires":[]},{"id":"258189335764afac","type":"http request","z":"90585768a7a619f8","name":"[POST] Recognize Double-Take","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","senderr":false,"x":2130,"y":560,"wires":[["8fdb94790e6d465c"]]},{"id":"8fdb94790e6d465c","type":"json","z":"90585768a7a619f8","name":"toJson","property":"payload","action":"","pretty":true,"x":2330,"y":560,"wires":[["08c4fd83861dd951","8aa52921be81dcd1"]]},{"id":"b3d64d1e907a6f10","type":"function","z":"90585768a7a619f8","name":"Double take URL set","func":"// SETTINGS\nvar cameraurl = \"http://192.168.0.15:8123\" + msg.data.attributes.entity_picture;\n// SETTINGS\n\n  var test = {\n   \t\"payload\":  {\n\t\t\"url\": \"http://192.168.0.14:3000/api/recognize?url=\" + cameraurl + \"&camera=camera.facecam\"\n   \t},\n   \t\"url\": \"http://192.168.0.14:3000/api/recognize?url=\" + cameraurl + \"&camera=camera.facecam\"\n  };\n  return test;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1880,"y":560,"wires":[["258189335764afac","e3e49b9d016e2510","7a252747939c703d"]]},{"id":"fe7d30b9a6cf08d3","type":"function","z":"90585768a7a619f8","name":"Time Check + Cam Passthrough","func":"var cameraurl = msg.data.attributes.entity_picture;\n\n\n\n\n\n  var test = {\n   \t\"entity\": msg.entity,\n   \t\"data\": msg.data,\n   \t\"cameraurl\": \"http://192.168.0.15:8123\" + cameraurl\n  };\n  return test;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1850,"y":900,"wires":[["6765ee0d50b6477f"]]},{"id":"d53583062314d64f","type":"change","z":"90585768a7a619f8","name":"","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"delete","p":"cameraurl","pt":"msg"},{"t":"delete","p":"data","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1400,"y":560,"wires":[["7b192427da0ef0bd","c3b86461750e7479"]]},{"id":"c3b86461750e7479","type":"debug","z":"90585768a7a619f8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1317.552734375,"y":680.0081176757812,"wires":[]},{"id":"e3e49b9d016e2510","type":"debug","z":"90585768a7a619f8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2070,"y":660,"wires":[]},{"id":"08c4fd83861dd951","type":"debug","z":"90585768a7a619f8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2230,"y":780,"wires":[]},{"id":"8aa52921be81dcd1","type":"trigger","z":"90585768a7a619f8","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"1","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2410,"y":520,"wires":[["e4922cf0cc301205"]]},{"id":"ef9acd7f7033be91","type":"switch","z":"90585768a7a619f8","name":"Any recognition?","property":"payload.matches","propertyType":"msg","rules":[{"t":"nempty"},{"t":"empty"}],"checkall":"true","repair":false,"outputs":2,"x":2830,"y":520,"wires":[["b8b9ae0b6ea48a6c"],["b2fa752cb1061f91"]]},{"id":"d2ec41d6aac3af0d","type":"api-call-service","z":"90585768a7a619f8","name":"toggle boolean","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_on","areaId":[],"deviceId":[],"entityId":["input_boolean.door_rang"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":480,"y":720,"wires":[["5a63b80c4e38e8e2"]]},{"id":"ef99c450fb2d33a0","type":"api-call-service","z":"90585768a7a619f8","name":"toggle boolean","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.door_rang"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":840,"y":720,"wires":[[]]},{"id":"5a63b80c4e38e8e2","type":"ha-wait-until","z":"90585768a7a619f8","name":"","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"lock.lock_front_door","entityIdFilterType":"exact","property":"state","comparator":"is","value":"locked","valueType":"str","timeout":"60","timeoutType":"num","timeoutUnits":"seconds","checkCurrentState":false,"blockInputOverrides":true,"outputProperties":[],"x":660,"y":700,"wires":[["ef99c450fb2d33a0"],["ef99c450fb2d33a0"]]},{"id":"6c2461f1f43780f7","type":"debug","z":"90585768a7a619f8","name":"reco post process","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3250,"y":400,"wires":[]},{"id":"b8b9ae0b6ea48a6c","type":"function","z":"90585768a7a619f8","name":"Face Extractor compare 7.0","func":"// SETTINGS\nvar required_conf = 80;\n// SETTINGS\n\n\nvar recoface = new Object();\nvar recofacesortable = [];\nvar name = \"\";\nvar camera = \"\";\nvar conf = \"\";\nvar reconame = \"\";\nvar recognized = 69;\nvar confidence = \"\";\nvar reco = \"\";\nvar recognized_confidently = 0;\n//declarations\n\n    for (i = 0; i < msg.payload.matches.length; i++){\n         for (y = 0; y < Object.keys(msg.payload.matches[i]).length; y++){\n                var name = msg.payload.matches[i].name;\n \t\t\t\tvar conf = msg.payload.matches[i].confidence;\n \t\t\t\tvar camera = msg.payload.camera;\n \t\t\t// \tif (conf > 0){\n \t\t\t\t    recofacesortable.push([name, conf]);\n \t\t\t// \t}\n \t\t\t\t\n        }\n    }\n    \n    \n     \trecofacesortable.sort(function(a, b) {\n \t\treturn a[1] - b[1];\n \t}).reverse();\n \t\n    for (i = 0; i < recofacesortable.length; i++){\n        var reconame = recofacesortable[0][0];\n        var confidence = recofacesortable[0][1]\n        \n        \n    }\n\n\n\nif (confidence > required_conf) {\n\tvar recognized_confidently = 1;\n}\n\nif (confidence != \"\") {\n\tvar recognized = 1;\n} else if (confidence == \"\") {\n    var recognized = 0;\n} else { \n var recognized = \"bugging\";\n    \n}\n\n\nvar newMsg = {\n\t\"payload\": {\n\t\t\"name\": reconame,\n\t\t\"confidence\": confidence,\n\t\t\"recognized_confidently\": recognized_confidently,\n\t\t\"recognized\": recognized,\n \t\t\"camera\": camera,\n \t\t\"recoface\": recoface\n\t}\n};\n\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2980,"y":460,"wires":[["6c2461f1f43780f7","36a9e69a1f17495d","38d03566a7dd39f1"]]},{"id":"c7e58e1c25d2264a","type":"inject","z":"90585768a7a619f8","name":"","props":[{"p":"payload"},{"p":"url","v":"http://192.168.0.14:3000/api/recognize?url=http://192.168.0.15:8123/api/camera_proxy/camera.facecam?token=97699652c0e63bfb128474ffcab6bd3f242378cdaecf961254f9c81db7285299&camera=camera.facecam","vt":"str"},{"p":"_msgid","v":"c296082d21604113","vt":"str"},{"p":"header","v":"{\"x-powered-by\":\"Express\",\"access-control-allow-origin\":\"*\",\"content-type\":\"application/json; charset=utf-8\",\"content-length\":\"400\",\"etag\":\"W/\\\"190-gyeGbs7LKPjnWp7g/2Mvq8RxVDs\\\"\",\"date\":\"Thu, 07 Apr 2022 20:24:54 GMT\",\"connection\":\"close\",\"x-node-red-request-node\":\"7940a9f0\"}","vt":"json"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"id\":\"15477d6e-7fff-4f82-84c2-badf6e1ed31a\",\"duration\":1.52,\"timestamp\":\"2022-04-07T20:24:54.253Z\",\"attempts\":1,\"camera\":\"camera.facecam\",\"zones\":[],\"matches\":[{\"name\":\"maxi\",\"confidence\":99.92,\"match\":true,\"box\":{\"top\":377,\"left\":388,\"width\":526,\"height\":652},\"type\":\"manual\",\"duration\":0.55,\"detector\":\"compreface\",\"filename\":\"b237ed80-7efb-4902-80f3-9b6b67a94675.jpg\",\"base64\":null},{\"name\":\"test\",\"confidence\":90.92,\"match\":true,\"box\":{\"top\":377,\"left\":388,\"width\":526,\"height\":652},\"type\":\"manual\",\"duration\":0.55,\"detector\":\"compreface\",\"filename\":\"b237ed80-7efb-4902-80f3-9b6b67a94675.jpg\",\"base64\":null}],\"misses\":[]}","payloadType":"json","x":2510,"y":400,"wires":[["ef9acd7f7033be91"]]},{"id":"0facc085cf02d8de","type":"function","z":"90585768a7a619f8","name":"Name Payload","func":"var name = msg.payload.name;\n\nvar newMsg = {\n    \"payload\": {\n        \"data\": {\n            \"value\": name\n        }}};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4020,"y":140,"wires":[["913adc0e99a5f42b"]]},{"id":"913adc0e99a5f42b","type":"api-call-service","z":"90585768a7a619f8","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"input_text","service":"set_value","areaId":[],"deviceId":[],"entityId":["input_text.recognized_face"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4230,"y":140,"wires":[[]]},{"id":"d32471499d5f1d14","type":"api-call-service","z":"90585768a7a619f8","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"notify","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4200,"y":180,"wires":[[]]},{"id":"dd39d946f8395675","type":"function","z":"90585768a7a619f8","name":"Javascript","func":"var name = msg.payload.name;\nvar camera = \"/api/camera_proxy/\" + msg.payload.camera\n\n\n\nvar newMsg = {\n\t\"payload\": {\n\t\t\"data\": {\n\t\t\t\"message\": \"Doorbell Alert\",\n\t\t\t\"title\": \"Welcoming \" + name,\n\t\t\t\"data\": {\n\t\t\t\t\"image\": camera,\n\t\t\t\t\"actions\": [\n\n\t\t\t\t]\n\t\t\t}\n\t\t}\n\t}\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4020,"y":180,"wires":[["d32471499d5f1d14","32523a71b60ee78b","37fcf38a57be3072"]]},{"id":"32523a71b60ee78b","type":"change","z":"90585768a7a619f8","name":"Set Data for mass alert","rules":[{"t":"set","p":"message","pt":"msg","to":"payload.data.title","tot":"msg"},{"t":"set","p":"color_value","pt":"msg","to":"[0,255,255]","tot":"json"},{"t":"set","p":"dbrigthness","pt":"msg","to":"100","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":4240,"y":220,"wires":[["150a6022ab095384"]]},{"id":"37fcf38a57be3072","type":"debug","z":"90585768a7a619f8","name":"result before notif","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":4650,"y":180,"wires":[]},{"id":"150a6022ab095384","type":"subflow:233ac7dcd801a802","z":"90585768a7a619f8","name":"","x":4450,"y":220,"wires":[]},{"id":"5024bcdda15789c5","type":"api-call-service","z":"90585768a7a619f8","name":"toggle boolean","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_on","areaId":[],"deviceId":[],"entityId":["input_boolean.face_recognized"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4320,"y":260,"wires":[["5658d6f6198ff866"]]},{"id":"5658d6f6198ff866","type":"ha-wait-until","z":"90585768a7a619f8","name":"","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"lock.lock_front_door","entityIdFilterType":"exact","property":"state","comparator":"is","value":"locked","valueType":"str","timeout":"30","timeoutType":"num","timeoutUnits":"seconds","checkCurrentState":true,"blockInputOverrides":true,"outputProperties":[],"x":4480,"y":260,"wires":[["96968459f3bf5c4f"],["96968459f3bf5c4f"]]},{"id":"96968459f3bf5c4f","type":"api-call-service","z":"90585768a7a619f8","name":"toggle boolean","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.face_recognized","input_boolean.waiting_someone"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4660,"y":260,"wires":[["88a988e7b7f4ba9f"]]},{"id":"88a988e7b7f4ba9f","type":"api-call-service","z":"90585768a7a619f8","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"input_text","service":"set_value","areaId":[],"deviceId":[],"entityId":["input_text.recognized_face"],"data":" {             \"value\": \"UNKNOWN\"         }","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4870,"y":260,"wires":[[]]},{"id":"6bf9206f0b2560da","type":"debug","z":"90585768a7a619f8","name":"unlock","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":4190,"y":320,"wires":[]},{"id":"e55293568958083e","type":"api-call-service","z":"90585768a7a619f8","name":"unLock Door","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"lock","service":"unlock","areaId":[],"deviceId":[],"entityId":["lock.lock_front_door"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4010,"y":260,"wires":[["6bf9206f0b2560da","d2a5f7253ef0c10d"]]},{"id":"d2a5f7253ef0c10d","type":"ha-wait-until","z":"90585768a7a619f8","name":"","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"lock.lock_front_door","entityIdFilterType":"exact","property":"state","comparator":"is","value":"unlocked","valueType":"str","timeout":"2","timeoutType":"num","timeoutUnits":"minutes","checkCurrentState":true,"blockInputOverrides":true,"outputProperties":[],"x":4160,"y":260,"wires":[["5024bcdda15789c5"],[]]},{"id":"36a9e69a1f17495d","type":"switch","z":"90585768a7a619f8","name":"recognized_confidently = 1","property":"payload.recognized_confidently","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":2740,"y":200,"wires":[["5f1d4051491a8660"]]},{"id":"38d03566a7dd39f1","type":"switch","z":"90585768a7a619f8","name":"recognized_confidently = 0","property":"payload.recognized_confidently","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":3360,"y":460,"wires":[["a40923a01527c162"]]},{"id":"610f658a4ddbf68f","type":"function","z":"90585768a7a619f8","name":"Name Payload","func":"var name = msg.payload.name;\n\nvar newMsg = {\n    \"payload\": {\n        \"data\": {\n            \"value\": name\n        }}};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4060,"y":420,"wires":[["232b1651138d30b5"]]},{"id":"232b1651138d30b5","type":"api-call-service","z":"90585768a7a619f8","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"input_text","service":"set_value","areaId":[],"deviceId":[],"entityId":["input_text.recognized_face"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4270,"y":420,"wires":[[]]},{"id":"d3cc5a4318a0557c","type":"api-call-service","z":"90585768a7a619f8","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"mobile_app_phone_fold_3","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4310,"y":460,"wires":[[]]},{"id":"79431cc4783087cc","type":"function","z":"90585768a7a619f8","name":"Javascript","func":"var name = msg.payload.name;\nvar camera = \"/api/camera_proxy/\" + msg.payload.camera\n\n\n\nvar newMsg = {\n\t\"payload\": {\n\t\t\"data\": {\n\t\t\t\"message\": \"Doorbell Alert\",\n\t\t\t\"title\": name + \" is at the door\",\n\t\t\t\"data\": {\n\t\t\t\t\"image\": camera,\n\t\t\t\t\"actions\": [{\n\t\t\t\t\t\t\"action\": \"REPLY\",\n\t\t\t\t\t\t\"title\": \"Who is this?\"\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"action\": \"unlock_door\",\n\t\t\t\t\t\t\"title\": \"Unlock The Door\"\n\t\t\t\t\t}\n\n\t\t\t\t]\n\t\t\t}\n\t\t}\n\t}\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4060,"y":460,"wires":[["d3cc5a4318a0557c","830faea3f6b259f6","cebf5df5cb373342"]]},{"id":"830faea3f6b259f6","type":"change","z":"90585768a7a619f8","name":"Set Data for mass alert","rules":[{"t":"set","p":"message","pt":"msg","to":"payload.data.title","tot":"msg"},{"t":"set","p":"color_value","pt":"msg","to":"[0,0,255]","tot":"json"},{"t":"set","p":"dbrigthness","pt":"msg","to":"100","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":4280,"y":500,"wires":[["0113d96a7ff8e5a3"]]},{"id":"cebf5df5cb373342","type":"debug","z":"90585768a7a619f8","name":"result before notif","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":4690,"y":460,"wires":[]},{"id":"a40923a01527c162","type":"delay","z":"90585768a7a619f8","name":"Semi Reco","pauseType":"delay","timeout":"1","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":3830,"y":460,"wires":[["610f658a4ddbf68f","79431cc4783087cc"]]},{"id":"0113d96a7ff8e5a3","type":"subflow:233ac7dcd801a802","z":"90585768a7a619f8","name":"","x":4490,"y":500,"wires":[]},{"id":"4f82b69b536c66d0","type":"api-current-state","z":"90585768a7a619f8","name":"kink off","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.kink_party","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":3380,"y":200,"wires":[["2d86a08c6b26df85","c20eb2b3b2ee5c62"],["a40923a01527c162"]]},{"id":"2d86a08c6b26df85","type":"api-current-state","z":"90585768a7a619f8","name":"Party on","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.party_mode","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":3560,"y":140,"wires":[["ec17d2252465c097"],["a40923a01527c162"]]},{"id":"c20eb2b3b2ee5c62","type":"api-current-state","z":"90585768a7a619f8","name":"Waiting Friend?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.waiting_someone","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"partyon","propertyType":"msg","value":"","valueType":"entityState"},{"property":"partydata","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":3560,"y":200,"wires":[["ec17d2252465c097"],["a40923a01527c162"]]},{"id":"f39d0741c1e256e0","type":"api-current-state","z":"90585768a7a619f8","name":"Front House Motion","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.motion_front","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"partyon","propertyType":"msg","value":"","valueType":"entityState"},{"property":"partydata","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":3190,"y":200,"wires":[["4f82b69b536c66d0"],["a40923a01527c162"]]},{"id":"ec17d2252465c097","type":"trigger","z":"90585768a7a619f8","name":"Full Reco","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"1","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":3760,"y":200,"wires":[["0facc085cf02d8de","dd39d946f8395675","e55293568958083e"]]},{"id":"58966739a9aebde1","type":"api-call-service","z":"90585768a7a619f8","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"mobile_app_phone_fold_3","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3550,"y":820,"wires":[[]]},{"id":"cfe3eb50c94051d9","type":"function","z":"90585768a7a619f8","name":"Javascript","func":"var camera = \"/api/camera_proxy/camera.front_door\"\n\n\n\nvar newMsg = {\n\t\"payload\": {\n\t\t\"data\": {\n\t\t\t\"message\": \"Doorbell Alert\",\n\t\t\t\"title\": \"Someone is at the door\",\n\t\t\t\"data\": {\n\t\t\t\t\"image\": camera,\n\t\t\t\t\"actions\": [\n\t\t\t\t\t{\n\t\t\t\t\t\t\"action\": \"unlock_door\",\n\t\t\t\t\t\t\"title\": \"Unlock The Door\"\n\t\t\t\t\t}\n\n\t\t\t\t]\n\t\t\t}\n\t\t}\n\t}\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3300,"y":820,"wires":[["58966739a9aebde1","2384943a9be9ba20","5de2220a1888a23a","2d83c2efb9055c1f"]]},{"id":"2384943a9be9ba20","type":"change","z":"90585768a7a619f8","name":"Set Data for mass alert","rules":[{"t":"set","p":"message","pt":"msg","to":"payload.data.title","tot":"msg"},{"t":"set","p":"color_value","pt":"msg","to":"[0,0,255]","tot":"json"},{"t":"set","p":"dbrigthness","pt":"msg","to":"100","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":3520,"y":860,"wires":[["6e676f7506441f0e"]]},{"id":"5de2220a1888a23a","type":"debug","z":"90585768a7a619f8","name":"result before notif","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3930,"y":820,"wires":[]},{"id":"6e676f7506441f0e","type":"subflow:233ac7dcd801a802","z":"90585768a7a619f8","name":"","x":3730,"y":860,"wires":[]},{"id":"ec1e25816f47c86c","type":"api-current-state","z":"90585768a7a619f8","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"camera.front_door","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":3080,"y":820,"wires":[["cfe3eb50c94051d9","df1dfa3a6658beac"]]},{"id":"df1dfa3a6658beac","type":"debug","z":"90585768a7a619f8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3290,"y":940,"wires":[]},{"id":"2d83c2efb9055c1f","type":"debug","z":"90585768a7a619f8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3410,"y":880,"wires":[]},{"id":"b2fa752cb1061f91","type":"trigger","z":"90585768a7a619f8","name":"No reco","op1":"1","op2":"","op1type":"str","op2type":"nul","duration":"1","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2820,"y":820,"wires":[["ec1e25816f47c86c"]]},{"id":"c7146d518d08cb66","type":"inject","z":"90585768a7a619f8","name":"click","props":[{"p":"payload.event.command","v":"click","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":2670,"y":840,"wires":[["b2fa752cb1061f91"]]},{"id":"de0d45e08d67309e","type":"trigger","z":"90585768a7a619f8","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"1","extend":false,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":670,"y":540,"wires":[["d53583062314d64f"]]},{"id":"5f1d4051491a8660","type":"api-current-state","z":"90585768a7a619f8","name":"Acid time off","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.acid_time","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":2970,"y":200,"wires":[["f39d0741c1e256e0"],["a40923a01527c162"]]},{"id":"e4922cf0cc301205","type":"api-current-state","z":"90585768a7a619f8","name":"Waiting Uber off","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.waiting_uber","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":2600,"y":520,"wires":[["ef9acd7f7033be91"],["6b628ad5808dab81"]]},{"id":"baf4c87c046a4182","type":"api-call-service","z":"90585768a7a619f8","name":"to package","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"script","service":"ptz_to_package","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3030,"y":560,"wires":[["6ec6bc5e344c63f4"]]},{"id":"6b628ad5808dab81","type":"trigger","z":"90585768a7a619f8","name":"Uber","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"1","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2830,"y":560,"wires":[["baf4c87c046a4182","b2fa752cb1061f91"]]},{"id":"6ec6bc5e344c63f4","type":"ha-wait-until","z":"90585768a7a619f8","name":"lock opens?","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"lock.lock_front_door","entityIdFilterType":"exact","property":"state","comparator":"is","value":"unlocked","valueType":"str","timeout":"120","timeoutType":"num","timeoutUnits":"seconds","checkCurrentState":false,"blockInputOverrides":true,"outputProperties":[],"x":3190,"y":560,"wires":[["887c2c0e9969deb7"],["887c2c0e9969deb7"]]},{"id":"887c2c0e9969deb7","type":"api-call-service","z":"90585768a7a619f8","name":"to regular position","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"script","service":"ptz_to_doorway","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload666","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":3370,"y":560,"wires":[[]]},{"id":"d9656c1802b67624","type":"api-current-state","z":"90585768a7a619f8","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"camera.facecam","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":1690,"y":140,"wires":[["f54605c1989db8fd"]]},{"id":"f54605c1989db8fd","type":"function","z":"90585768a7a619f8","name":"Double take URL set","func":"// SETTINGS\nvar cameraurl = \"http://192.168.0.15:8123\" + msg.data.attributes.entity_picture;\n// SETTINGS\n\n  var test = {\n   \t\"payload\":  {\n\t\t\"url\": \"http://192.168.0.14:3000/api/recognize?url=\" + cameraurl + \"&camera=camera.facecam\"\n   \t},\n   \t\"url\": \"http://192.168.0.14:3000/api/recognize?url=\" + cameraurl + \"&camera=camera.facecam\"\n  };\n  return test;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1940,"y":140,"wires":[["40bd41f74a42d282"]]},{"id":"40bd41f74a42d282","type":"debug","z":"90585768a7a619f8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2150,"y":140,"wires":[]},{"id":"f5e1098cf6bf7a83","type":"inject","z":"90585768a7a619f8","name":"","props":[{"p":"payload"},{"p":"url","v":"http://192.168.0.14:3000/api/recognize?url=http://192.168.0.15:8123/api/camera_proxy/camera.facecam?token=97699652c0e63bfb128474ffcab6bd3f242378cdaecf961254f9c81db7285299&camera=camera.facecam","vt":"str"},{"p":"_msgid","v":"c296082d21604113","vt":"str"},{"p":"header","v":"{\"x-powered-by\":\"Express\",\"access-control-allow-origin\":\"*\",\"content-type\":\"application/json; charset=utf-8\",\"content-length\":\"400\",\"etag\":\"W/\\\"190-gyeGbs7LKPjnWp7g/2Mvq8RxVDs\\\"\",\"date\":\"Thu, 07 Apr 2022 20:24:54 GMT\",\"connection\":\"close\",\"x-node-red-request-node\":\"7940a9f0\"}","vt":"json"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"id\":\"15477d6e-7fff-4f82-84c2-badf6e1ed31a\",\"duration\":1.52,\"timestamp\":\"2022-04-07T20:24:54.253Z\",\"attempts\":1,\"camera\":\"camera.facecam\",\"zones\":[],\"matches\":[{\"name\":\"maxi\",\"confidence\":99.92,\"match\":true,\"box\":{\"top\":377,\"left\":388,\"width\":526,\"height\":652},\"type\":\"manual\",\"duration\":0.55,\"detector\":\"compreface\",\"filename\":\"b237ed80-7efb-4902-80f3-9b6b67a94675.jpg\",\"base64\":null},{\"name\":\"test\",\"confidence\":90.92,\"match\":true,\"box\":{\"top\":377,\"left\":388,\"width\":526,\"height\":652},\"type\":\"manual\",\"duration\":0.55,\"detector\":\"compreface\",\"filename\":\"b237ed80-7efb-4902-80f3-9b6b67a94675.jpg\",\"base64\":null}],\"misses\":[]}","payloadType":"json","x":1450,"y":120,"wires":[["d9656c1802b67624","d1cd688cd46a6d30"]]},{"id":"d1cd688cd46a6d30","type":"api-call-service","z":"90585768a7a619f8","name":"Save Facecam Ring.jpg","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"camera","service":"snapshot","areaId":[],"deviceId":[],"entityId":["camera.facecam"],"data":"{\"filename\":\"/config/www/ring.jpg\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1970,"y":220,"wires":[[]]},{"id":"7a252747939c703d","type":"api-call-service","z":"90585768a7a619f8","name":"Save Facecam Ring.jpg For Debug","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"camera","service":"snapshot","areaId":[],"deviceId":[],"entityId":["camera.facecam"],"data":"{\"filename\":\"/config/www/ring.jpg\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2140,"y":600,"wires":[[]]},{"id":"679f1d97bea54b16","type":"link out","z":"90585768a7a619f8","name":"","mode":"link","links":["6c95d201f6c9daf3"],"x":2535,"y":480,"wires":[]},{"id":"e42173d3ee832046","type":"server-events","z":"14484d2a357fa501","name":"Ringer","server":"7ab5c227.a3ce8c","version":2,"eventType":"zha_event","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"waitForRunning":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"},{"property":"event_type","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"}],"x":170,"y":520,"wires":[[]]},{"id":"af8b05e8de50da59","type":"http request","z":"14484d2a357fa501","name":"[POST] Recognize Double-Take","method":"GET","ret":"txt","paytoqs":"ignore","url":"http://192.168.0.14:3000/api/recognize?url=http://192.168.0.15:8123/local/ring.jpg&camera=camera.facecam","tls":"","persist":false,"proxy":"","authType":"","x":1310,"y":680,"wires":[["076cb4627269321c","f546f47e34358c73"]]},{"id":"96b3d130e3563de0","type":"api-call-service","z":"14484d2a357fa501","name":"Save Facecam Ring.jpg","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"camera","service":"snapshot","areaId":[],"deviceId":[],"entityId":["camera.facecam"],"data":"{\"filename\":\"/config/www/ring.jpg\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1030,"y":680,"wires":[["af8b05e8de50da59"]]},{"id":"0bc207fe43223f88","type":"debug","z":"14484d2a357fa501","name":"Face","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1610,"y":720,"wires":[]},{"id":"34cdf332c6ebfd19","type":"inject","z":"14484d2a357fa501","name":"click","props":[{"p":"payload.event.command","v":"click","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":630,"y":720,"wires":[["57590a930154b3b5"]]},{"id":"9891b32c5fd5257a","type":"inject","z":"14484d2a357fa501","name":"click","props":[{"p":"payload.event.command","v":"click","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":1550,"y":460,"wires":[["af8b05e8de50da59"]]},{"id":"076cb4627269321c","type":"json","z":"14484d2a357fa501","name":"toJson","property":"payload","action":"","pretty":true,"x":1510,"y":680,"wires":[["f5b71d7a68b6bf15","0bc207fe43223f88"]]},{"id":"5db6ae5b9dd8cdf8","type":"inject","z":"14484d2a357fa501","name":"scan","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"date","x":1250,"y":900,"wires":[["dd31bc940ba436cd"]]},{"id":"8e6e4a3476037a0a","type":"api-current-state","z":"14484d2a357fa501","name":"Double take Wyzecam over 0","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"num","halt_if_compare":"gt","entity_id":"sensor.double_take_wyzecam","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"entity","propertyType":"msg","value":"","valueType":"entity"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":1040,"y":560,"wires":[[]]},{"id":"8fbdc854c3139373","type":"debug","z":"14484d2a357fa501","name":"Front","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1610,"y":580,"wires":[]},{"id":"5b10e27560a87f12","type":"api-call-service","z":"14484d2a357fa501","name":"toggle boolean","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_on","areaId":[],"deviceId":[],"entityId":["input_boolean.door_rang"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1120,"y":780,"wires":[["dd31bc940ba436cd"]]},{"id":"85dd28056bc51434","type":"switch","z":"14484d2a357fa501","name":"double","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"single","vt":"str"},{"t":"cont","v":"double","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":770,"y":880,"wires":[[],["fc8fbf5aa1970461"]]},{"id":"fc8fbf5aa1970461","type":"api-current-state","z":"14484d2a357fa501","name":"rang?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.door_rang","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1190,"y":840,"wires":[["e6e3ef3912aff7f6"],[]]},{"id":"e6e3ef3912aff7f6","type":"api-call-service","z":"14484d2a357fa501","name":"toggle boolean","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_on","areaId":[],"deviceId":[],"entityId":["input_boolean.door_double_rang"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1340,"y":840,"wires":[["f1f790880aa9080d"]]},{"id":"f1f790880aa9080d","type":"trigger","z":"14484d2a357fa501","name":"","op1":"","op2":"1","op1type":"nul","op2type":"num","duration":"1","extend":false,"units":"min","reset":"","bytopic":"all","outputs":1,"x":1510,"y":840,"wires":[["9c240a82d84da6d9"]]},{"id":"9c240a82d84da6d9","type":"api-call-service","z":"14484d2a357fa501","name":"toggle boolean","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.door_double_rang"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1680,"y":840,"wires":[[]]},{"id":"8e3afe4418dd544b","type":"trigger","z":"14484d2a357fa501","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"45","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":750,"y":780,"wires":[["5b10e27560a87f12"]]},{"id":"4e24196273b44e21","type":"debug","z":"14484d2a357fa501","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1030,"y":1260,"wires":[]},{"id":"b438aff1211d4c4d","type":"server-state-changed","z":"14484d2a357fa501","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.double_take_reolink","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":710,"y":1280,"wires":[["4e24196273b44e21"]]},{"id":"c5041027b8e134e0","type":"function","z":"14484d2a357fa501","name":"cam set","func":"// SETTINGS\nvar required_conf = 75;\n// SETTINGS\n\n\nvar matches = msg.entity.attributes.matches;\n\nvar recoface = new Object();\nvar recofacesortable = [];\nvar name = \"\";\nvar camera = \"camera.front_door\";\nvar conf = \"\";\nvar reconame = \"\";\nvar confidence = \"\";\nvar matched_faces_count = 0;\nvar reco = \"\";\n//declarations\nif ( matches.length > 0){\n\n\n    for (i = 0; i < matches.length; i++){\n\n                var name = matches[i].name;\n \t\t\t\tvar conf = matches[i].confidence;\n \t\t\t\trecofacesortable.push([name, conf, camera]);\n \t\t\t\tvar matched_faces_count = (matched_faces_count + 1);\n        \n    }\n} else {\n    \n}\n\nif (typeof msg.payload.unknown!==\"undefined\"){\n    recofacesortable.push([\"Unknown\", \"0\", camera]);\n}\n\n\n\n  var test = {\n   \t\"payload\":  {\n\t\t\"matches\": recofacesortable,\n\t\t\"matched_faces_count\":  matched_faces_count\n   \t}\n  };\n  return test;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1640,"y":620,"wires":[["8fbdc854c3139373","18d023cf8cc0e4e3"]]},{"id":"d4cb39c44d10600f","type":"function","z":"14484d2a357fa501","name":"cam set","func":"// SETTINGS\nvar required_conf = 75;\n// SETTINGS\n\n\nvar recoface = new Object();\nvar recofacesortable = [];\nvar name = \"\";\nvar camera = \"camera.facecam\";\nvar conf = \"\";\nvar reconame = \"\";\nvar confidence = \"\";\nvar reco = \"\";\n//declarations\n\n    for (i = 0; i < msg.payload.matches.length; i++){\n\n                var name = msg.payload.matches[i].name;\n \t\t\t\tvar conf = msg.payload.matches[i].confidence;\n \t\t\t// \tif (conf > 0){\n \t\t\t\t    recofacesortable.push([name, conf, camera]);\n \t\t\t// \t}\n \t\t\t\t\n        \n    }\n\nif (typeof msg.payload.unknown!==\"undefined\"){\n    recofacesortable.push([\"Unknown\", \"0\", camera]);\n}\n    \n    \n//      \trecofacesortable.sort(function(a, b) {\n//  \t\treturn a[1] - b[1];\n//  \t}).reverse();\n \t\n//     for (i = 0; i < recofacesortable.length; i++){\n//         var reconame = recofacesortable[0][0];\n//         var confidence = recofacesortable[0][1]\n//         var camera = recofacesortable[0][2]\n        \n        \n//     }\n\n\n\n// if (confidence > required_conf) {\n// \tvar recognized = 1;\n// } else {\n// \tvar recognized = 0;\n// }\n\n// if (camera == \"face_counter_reolink\"){\n//     var camera = \"camera.reolink_static\";\n// } else if (camera == \"face_counter_facecam\"){\n//     var camera = \"camera.facecam_static\"\n// }\n\n// var newMsg = {\n// \t\"payload\": {\n// \t\t\"name\": reconame,\n// \t\t\"confidence\": confidence,\n// \t\t\"recognized\": recognized,\n//  \t\t\"camera\": camera \n// \t}\n// };\n\n//return newMsg;\n\n\n  var test = {\n   \t\"payload\":  {\n\t\t\"matches\": recofacesortable,\n// //  \t\t\"confidence\": confidence,\n// //  \t\t\"recognized\": recognized,\n// //  \t\t\"camera\": camera ,\n// //  \t\t\"recofacesortable\": recofacesortable\n   \t}\n  };\n  return test;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1320,"y":940,"wires":[[]]},{"id":"c10fbfb4d42df98e","type":"inject","z":"14484d2a357fa501","name":"click","props":[{"p":"payload.event.command","v":"click","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":810,"y":520,"wires":[["0861877d35bfe16e"]]},{"id":"18d023cf8cc0e4e3","type":"join","z":"14484d2a357fa501","name":"","mode":"custom","build":"array","property":"payload.matches","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"6","count":"2","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"num","reduceFixup":"","x":1770,"y":660,"wires":[["81b44903ee46c869"]]},{"id":"81b44903ee46c869","type":"function","z":"14484d2a357fa501","name":"Face Extractor compare 7.0","func":"// SETTINGS\nvar required_conf = 80;\n// SETTINGS\n\n\nvar recoface = new Object();\nvar recofacesortable = [];\nvar name = \"\";\nvar camera = \"\";\nvar conf = \"\";\nvar reconame = \"\";\nvar recognized = 69;\nvar confidence = \"\";\nvar reco = \"\";\nvar recognized_confidently = 0;\n//declarations\n\n    for (i = 0; i < msg.payload.matches.length; i++){\n         for (y = 0; y < Object.keys(msg.payload.matches[i]).length; y++){\n                var name = msg.payload.matches[i][y][0];\n \t\t\t\tvar conf = msg.payload.matches[i][y][1];\n \t\t\t\tvar camera = msg.payload.matches[i][y][2];\n \t\t\t// \tif (conf > 0){\n \t\t\t\t    recofacesortable.push([name, conf, camera]);\n \t\t\t// \t}\n \t\t\t\t\n        }\n    }\n    \n    \n     \trecofacesortable.sort(function(a, b) {\n \t\treturn a[1] - b[1];\n \t}).reverse();\n \t\n    for (i = 0; i < recofacesortable.length; i++){\n        var reconame = recofacesortable[0][0];\n        var confidence = recofacesortable[0][1]\n        var camera = recofacesortable[0][2]\n        \n        \n    }\n\n\n\nif (confidence > required_conf) {\n\tvar recognized_confidently = 1;\n}\n\nif (confidence != \"\") {\n\tvar recognized = 1;\n} else if (confidence == \"\") {\n    var recognized = 0;\n} else { \n var recognized = \"bugging\";\n    \n}\n\n if (camera == \"camera.front_door\"){\n     var camera = \"camera.reolink_static\";\n } else if (camera == \"camera.facecam\"){\n     var camera = \"camera.facecam_static\"\n }\n\nvar newMsg = {\n\t\"payload\": {\n\t\t\"name\": reconame,\n\t\t\"confidence\": confidence,\n\t//\t\"matched_faces\": total_matched_faces,\n\t//\t\"total_faces\": total_faces,\n\t\t\"recognized_confidently\": recognized_confidently,\n\t\t\"recognized\": recognized,\n \t\t\"camera\": camera \n\t}\n};\n\nreturn newMsg;\n\n\n//  var test = {\n//  \t\"payload\": {\n// \t\t\"name\": reconame,\n// \t\t\"confidence\": confidence,\n// \t\t\"matched_faces\": total_matched_faces,\n// \t\t\"total_faces\": total_faces,\n// \t\t\"recognized\": recognized,\n// \t\t\"camera\": camera ,\n// \t\t\"recofacesortable\": recofacesortable\n//  \t}\n//  };\n//  return test;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2040,"y":660,"wires":[["40f8e21c39f3f8bc","afedb702f35b0c65","0da283caf2f22ca9"]]},{"id":"f5b71d7a68b6bf15","type":"function","z":"14484d2a357fa501","name":"cam set","func":"// SETTINGS\nvar required_conf = 75;\n// SETTINGS\n\n\nvar matches = msg.payload.matches;\n\n\nvar recoface = new Object();\nvar recofacesortable = [];\nvar name = \"\";\nvar camera = \"camera.front_door\";\nvar conf = \"\";\nvar reconame = \"\";\nvar confidence = \"\";\nvar matched_faces_count = 0;\nvar reco = \"\";\n//declarations\nif ( matches.length > 0){\n\n\n    for (i = 0; i < matches.length; i++){\n\n                var name = matches[i].name;\n \t\t\t\tvar conf = matches[i].confidence;\n \t\t\t\trecofacesortable.push([name, conf, camera]);\n \t\t\t\tvar matched_faces_count = (matched_faces_count + 1);\n        \n    }\n} else {\n    \n}\n\nif (typeof msg.payload.unknown!==\"undefined\"){\n    recofacesortable.push([\"Unknown\", \"0\", camera]);\n}\n\n\n\n  var test = {\n   \t\"payload\":  {\n\t\t\"matches\": recofacesortable,\n\t\t\"matched_faces_count\":  matched_faces_count\n   \t}\n  };\n  return test;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1640,"y":680,"wires":[["0bc207fe43223f88","18d023cf8cc0e4e3"]]},{"id":"40f8e21c39f3f8bc","type":"debug","z":"14484d2a357fa501","name":"Compare","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2040,"y":600,"wires":[]},{"id":"6c570d7a5ff63f37","type":"inject","z":"14484d2a357fa501","name":"click","props":[{"p":"payload.event.command","v":"click","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":810,"y":720,"wires":[["af8b05e8de50da59","0861877d35bfe16e"]]},{"id":"42988384b18c311e","type":"function","z":"14484d2a357fa501","name":"Time Check + Cam Passthrough","func":"\nvar timestamp = msg.entity.attributes.timestamp;\n\nvar timestampUnix = new Date(timestamp).getTime();\n\n\nvar now = Date.now();\nvar timedif = (now - timestampUnix);\n\n\nif (timedif < 100000 ){\n     var nowfinal = 1;\n } else {\n     var nowfinal = 0;};\n\n\n\n  var test = {\n   \t\"payload\":  {\n\t\t\"nowfinal\":  nowfinal\n\t\t\n   \t},\n   \t\"entity\": msg.entity,\n   \t\"data\": msg.data\n  };\n  return test;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1410,"y":620,"wires":[["c5041027b8e134e0","8fbdc854c3139373"]]},{"id":"0861877d35bfe16e","type":"api-current-state","z":"14484d2a357fa501","name":"Double take Front Door","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"num","halt_if_compare":"gt","entity_id":"sensor.double_take_front_door","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"entity","propertyType":"msg","value":"","valueType":"entity"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":1030,"y":620,"wires":[["42988384b18c311e","8fbdc854c3139373"]]},{"id":"660692c291ce0d61","type":"switch","z":"14484d2a357fa501","name":"Reco Confident?","property":"payload.recognized_confidently","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":2270,"y":420,"wires":[["68e202d57728a02c"],["26ed3a6f44375dca"]]},{"id":"b0ae24686447690e","type":"trigger","z":"14484d2a357fa501","name":"Face Not reco Enough","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"1","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2660,"y":420,"wires":[["ef1dda3e1adf46b9","4a05baf3976bade9"]]},{"id":"ef1dda3e1adf46b9","type":"function","z":"14484d2a357fa501","name":"Javascript","func":"var d = new Date();\nvar h = d.getHours();\nvar m = d.getMinutes();\nvar s = d.getSeconds();\nvar camera = msg.payload.camera;\nvar confidence = 0;\n\nif (typeof msg.payload.confidence !==\"undefined\"){\nvar confidence = msg.payload.confidence;\n}\n\nvar who = \"Unknown\";\nif (typeof msg.payload.name !==\"undefined\"){\nvar who = msg.payload.name;\n}\n\n\n\n\nvar newMsg = {\n    \"payload\": {\n        \"name\": who,\n        \"data\": {\n            \"filename\":\"/config/www/portraits/\" + who + \"/\" + who + \"-\" + camera + \"-\" + h + m + s + \"-\" + confidence + \".jpg\",\n            \"entity_id\": camera\n        }\n    }\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2880,"y":420,"wires":[["f87196b3f1cac189"]]},{"id":"f87196b3f1cac189","type":"api-call-service","z":"14484d2a357fa501","name":"snapshot","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"camera","service":"snapshot","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload666","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":3060,"y":420,"wires":[["84ce3ec7603cd21c"]]},{"id":"4bc46934e4fad499","type":"api-call-service","z":"14484d2a357fa501","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"notify","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3420,"y":420,"wires":[["ffd73041c96aeb47"]]},{"id":"84ce3ec7603cd21c","type":"function","z":"14484d2a357fa501","name":"Javascript","func":"var d = new Date();\nvar name = msg.payload.name;\nvar m = d.getMilliseconds();\nvar snapshot = msg.payload.data.filename;\nvar url = \"http://192.168.0.12:8765/picture/8/current/?\" + m;\n\nvar snapshot = snapshot.replace(\"\\/config\\/www\",\"https:\\/\\/hass.purgatoire.ca\\/local\");\n\n\nvar newMsg = {\n\t\"payload\": {\n\t\t\"data\": {\n\t\t\t\"message\": \"Doorbell Alert\",\n\t\t\t\"title\": \"Someone is at the door\",\n\t\t\t\"data\": {\n\t\t\t\t\"image\": snapshot,\n\t\t\t\t\"actions\": [{\n\t\t\t\t\t\t\"action\": \"REPLY\",\n\t\t\t\t\t\t\"title\": \"Who is this?\"\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"action\": \"unlock_door\",\n\t\t\t\t\t\t\"title\": \"Unlock The Door\"\n\t\t\t\t\t}\n\n\t\t\t\t]\n\t\t\t}\n\t\t}\n\t}\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3220,"y":420,"wires":[["4bc46934e4fad499","0780bf362a29ae82"]]},{"id":"0780bf362a29ae82","type":"change","z":"14484d2a357fa501","name":"Set Data for mass alert","rules":[{"t":"set","p":"message","pt":"msg","to":"payload.data.title","tot":"msg"},{"t":"set","p":"color_value","pt":"msg","to":"[0,0,255]","tot":"json"},{"t":"set","p":"dbrigthness","pt":"msg","to":"100","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":3440,"y":460,"wires":[["d71380d25baade5a"]]},{"id":"800c68555a289aa4","type":"link out","z":"14484d2a357fa501","name":"Light and Speakers","mode":"link","links":["45904ca6429d867d"],"x":3795,"y":460,"wires":[]},{"id":"4a05baf3976bade9","type":"link out","z":"14484d2a357fa501","name":"Announcement input","mode":"link","links":["6c95d201f6c9daf3"],"x":2835,"y":380,"wires":[]},{"id":"f546f47e34358c73","type":"debug","z":"14484d2a357fa501","name":"Face","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1310,"y":720,"wires":[]},{"id":"0957f7e68479d041","type":"function","z":"14484d2a357fa501","name":"Name Payload","func":"var name = msg.payload.name;\n\nvar newMsg = {\n    \"payload\": {\n        \"data\": {\n            \"value\": name\n        }}};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3500,"y":80,"wires":[["7958beafd0e53872"]]},{"id":"7958beafd0e53872","type":"api-call-service","z":"14484d2a357fa501","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"input_text","service":"set_value","areaId":[],"deviceId":[],"entityId":["input_text.recognized_face"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3730,"y":80,"wires":[[]]},{"id":"c90ed1f0e41371e2","type":"api-call-service","z":"14484d2a357fa501","name":"toggle boolean","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_on","areaId":[],"deviceId":[],"entityId":["input_boolean.face_recognized"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3700,"y":220,"wires":[["2735223105cee635"]]},{"id":"9b2ed8dad4eaa555","type":"ha-wait-until","z":"14484d2a357fa501","name":"","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"binary_sensor.door_front_outside","entityIdFilterType":"exact","property":"state","comparator":"is","value":"on","valueType":"str","timeout":"30","timeoutType":"num","timeoutUnits":"seconds","checkCurrentState":true,"blockInputOverrides":true,"outputProperties":[],"x":4040,"y":220,"wires":[["40e5eb0d237b3098"],["40e5eb0d237b3098"]]},{"id":"40e5eb0d237b3098","type":"api-call-service","z":"14484d2a357fa501","name":"toggle boolean","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.waiting_someone"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3820,"y":300,"wires":[["8d68879fab9b827e"]]},{"id":"8d68879fab9b827e","type":"api-call-service","z":"14484d2a357fa501","name":"toggle boolean","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.face_recognized"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4000,"y":300,"wires":[["e774c1e55caf8651"]]},{"id":"e774c1e55caf8651","type":"function","z":"14484d2a357fa501","name":"Reset Name","func":"var newMsg = {\n    \"payload\": {\n        \"data\": {\n            \"value\": \"UNKNOWN\"\n        }}};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4230,"y":300,"wires":[["c314da045d710791"]]},{"id":"c314da045d710791","type":"api-call-service","z":"14484d2a357fa501","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"input_text","service":"set_value","areaId":[],"deviceId":[],"entityId":["input_text.recognized_face"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4450,"y":300,"wires":[[]]},{"id":"a0dac4bb43fa12d7","type":"debug","z":"14484d2a357fa501","name":"unlock","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3630,"y":280,"wires":[]},{"id":"899a01a3f875d158","type":"function","z":"14484d2a357fa501","name":"Javascript","func":"var d = new Date();\nvar h = d.getHours();\nvar m = d.getMinutes();\nvar s = d.getSeconds();\nvar camera = msg.payload.camera;\nvar confidence = 0;\n\nif (typeof msg.payload.confidence !==\"undefined\"){\nvar confidence = msg.payload.confidence;\n}\n\nvar who = \"Unknown\";\nif (typeof msg.payload.name !==\"undefined\"){\nvar who = msg.payload.name;\n}\n\n\n\n\nvar newMsg = {\n    \"payload\": {\n        \"name\": who,\n        \"data\": {\n            \"filename\":\"/config/www/portraits/\" + who + \"/\" + who + \"-\" + camera + \"-\" + h + m + s + \"-\" + confidence + \".jpg\",\n            \"entity_id\": camera\n        }\n    }\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3560,"y":140,"wires":[["60741d3ede1ab113"]]},{"id":"60741d3ede1ab113","type":"api-call-service","z":"14484d2a357fa501","name":"snapshot","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"camera","service":"snapshot","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload666","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":3740,"y":140,"wires":[["10d1a7633c410ac8","37637e4f196eaa61"]]},{"id":"10d1a7633c410ac8","type":"debug","z":"14484d2a357fa501","name":"result of snapchot","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3930,"y":100,"wires":[]},{"id":"8e2af2d4484e16bb","type":"api-call-service","z":"14484d2a357fa501","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"notify","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4100,"y":140,"wires":[[]]},{"id":"37637e4f196eaa61","type":"function","z":"14484d2a357fa501","name":"Javascript","func":"var d = new Date();\nvar name = msg.payload.name;\nvar m = d.getMilliseconds();\nvar snapshot = msg.payload.data.filename;\nvar url = \"http://192.168.0.12:8765/picture/8/current/?\" + m;\n\nvar snapshot = snapshot.replace(\"\\/config\\/www\",\"https:\\/\\/hass.purgatoire.ca\\/local\");\n\n\nvar newMsg = {\n\t\"payload\": {\n\t\t\"data\": {\n\t\t\t\"message\": \"Doorbell Alert\",\n\t\t\t\"title\": \"Welcoming \" + name,\n\t\t\t\"data\": {\n\t\t\t\t\"image\": snapshot,\n\t\t\t\t\"actions\": [{\n\t\t\t\t\t\t\"action\": \"REPLY\",\n\t\t\t\t\t\t\"title\": \"Who is this?\"\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"action\": \"unlock_door\",\n\t\t\t\t\t\t\"title\": \"Unlock The Door\"\n\t\t\t\t\t}\n\n\t\t\t\t]\n\t\t\t}\n\t\t}\n\t}\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3920,"y":140,"wires":[["8e2af2d4484e16bb","85344f47f3f54884","17893907670ec826"]]},{"id":"85344f47f3f54884","type":"change","z":"14484d2a357fa501","name":"Set Data for mass alert","rules":[{"t":"set","p":"message","pt":"msg","to":"payload.data.title","tot":"msg"},{"t":"set","p":"color_value","pt":"msg","to":"[0,255,255]","tot":"json"},{"t":"set","p":"dbrigthness","pt":"msg","to":"100","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":4100,"y":180,"wires":[["04566cb55ad19575"]]},{"id":"17893907670ec826","type":"debug","z":"14484d2a357fa501","name":"result before notif","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":4248.571533203125,"y":85.71429443359375,"wires":[]},{"id":"b61e3fe82467cd65","type":"link out","z":"14484d2a357fa501","name":"Light and Speakers","links":["45904ca6429d867d"],"x":4495,"y":180,"wires":[]},{"id":"313337e23f238993","type":"api-call-service","z":"14484d2a357fa501","name":"unLock Door","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"lock","service":"unlock","areaId":[],"deviceId":[],"entityId":["lock.lock_front_door"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3470,"y":280,"wires":[["a0dac4bb43fa12d7","80d0e06e2010c9a2"]]},{"id":"80d0e06e2010c9a2","type":"api-current-state","z":"14484d2a357fa501","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"unlocked","halt_if_type":"str","halt_if_compare":"is","entity_id":"lock.lock_front_door","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":3440,"y":220,"wires":[["c90ed1f0e41371e2"],["313337e23f238993"]]},{"id":"86bd928d040cab78","type":"delay","z":"14484d2a357fa501","name":"Waiting someone","pauseType":"delay","timeout":"1","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":3270,"y":140,"wires":[["0957f7e68479d041","899a01a3f875d158","313337e23f238993","1b2ca2456333eec4"]]},{"id":"a9f7a85966e01bbb","type":"link out","z":"14484d2a357fa501","name":"Announcement input","links":["6c95d201f6c9daf3"],"x":2315,"y":500,"wires":[]},{"id":"2735223105cee635","type":"trigger","z":"14484d2a357fa501","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"25","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":3870,"y":220,"wires":[["9b2ed8dad4eaa555"]]},{"id":"2b1a7a32e0739f94","type":"trigger","z":"14484d2a357fa501","name":"Not waiting","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"1","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2550,"y":320,"wires":[["c08a9e734d4838af","836799ab5789bfdd"]]},{"id":"c08a9e734d4838af","type":"function","z":"14484d2a357fa501","name":"Javascript","func":"var d = new Date();\nvar h = d.getHours();\nvar m = d.getMinutes();\nvar s = d.getSeconds();\nvar camera = msg.payload.camera;\nvar confidence = 0;\n\nif (typeof msg.payload.confidence !==\"undefined\"){\nvar confidence = msg.payload.confidence;\n}\n\nvar who = \"Unknown\";\nif (typeof msg.payload.name !==\"undefined\"){\nvar who = msg.payload.name;\n}\n\n\n\n\nvar newMsg = {\n    \"payload\": {\n        \"name\": who,\n        \"data\": {\n            \"filename\":\"/config/www/portraits/\" + who + \"/\" + who + \"-\" + camera + \"-\" + h + m + s + \"-\" + confidence + \".jpg\",\n            \"entity_id\": camera\n        }\n    }\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2720,"y":340,"wires":[["8ff570914988d411"]]},{"id":"8ff570914988d411","type":"api-call-service","z":"14484d2a357fa501","name":"snapshot","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"camera","service":"snapshot","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload666","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2900,"y":340,"wires":[["07f0e7c1e3ba7a5d"]]},{"id":"a4f5d2304535e7f3","type":"api-call-service","z":"14484d2a357fa501","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"notify","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3260,"y":340,"wires":[["ffd73041c96aeb47"]]},{"id":"07f0e7c1e3ba7a5d","type":"function","z":"14484d2a357fa501","name":"Javascript","func":"var d = new Date();\nvar name = msg.payload.name;\nvar m = d.getMilliseconds();\nvar snapshot = msg.payload.data.filename;\nvar url = \"http://192.168.0.12:8765/picture/8/current/?\" + m;\n\nvar snapshot = snapshot.replace(\"\\/config\\/www\",\"https:\\/\\/hass.purgatoire.ca\\/local\");\n\n\nvar newMsg = {\n\t\"payload\": {\n\t\t\"data\": {\n\t\t\t\"message\": \"Doorbell Alert\",\n\t\t\t\"title\": name + \" is at the door\",\n\t\t\t\"data\": {\n\t\t\t\t\"image\": snapshot,\n\t\t\t\t\"actions\": [{\n\t\t\t\t\t\t\"action\": \"REPLY\",\n\t\t\t\t\t\t\"title\": \"Who is this?\"\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"action\": \"unlock_door\",\n\t\t\t\t\t\t\"title\": \"Unlock The Door\"\n\t\t\t\t\t}\n\n\t\t\t\t]\n\t\t\t}\n\t\t}\n\t}\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3080,"y":340,"wires":[["a4f5d2304535e7f3","0958bee360c44c1d"]]},{"id":"0958bee360c44c1d","type":"change","z":"14484d2a357fa501","name":"Set Data for mass alert","rules":[{"t":"set","p":"message","pt":"msg","to":"payload.data.title","tot":"msg"},{"t":"set","p":"color_value","pt":"msg","to":"[0,0,255]","tot":"json"},{"t":"set","p":"dbrigthness","pt":"msg","to":"100","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":2880,"y":280,"wires":[["35a1804fd59f9be8"]]},{"id":"cda6edfe40da167c","type":"link out","z":"14484d2a357fa501","name":"Light and Speakers","links":["45904ca6429d867d","ad88dbd2.4726b8","3405e943.fd3ee6","9cf42cf7ef60f645"],"x":3235,"y":280,"wires":[]},{"id":"836799ab5789bfdd","type":"link out","z":"14484d2a357fa501","name":"Announcement input","mode":"link","links":["6c95d201f6c9daf3"],"x":2675,"y":300,"wires":[]},{"id":"adca23ed01fc6039","type":"change","z":"14484d2a357fa501","name":"reset","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2330,"y":1060,"wires":[["b9c00de82e84dac3","12c4c8382e0744d9","1c53442f1f8346db","071e62f4a8fb4411"]]},{"id":"b9c00de82e84dac3","type":"function","z":"14484d2a357fa501","name":"Javascript","func":"var recoface = [];\nvar facestring = \"\"\nvar d = new Date();\nvar m = d.getMilliseconds();\nvar url = \"https://hass.purgatoire.ca/local/ring.jpg?\" + m;\nvar facestring = msg.payload;\n\nvar newMsg = {\n \"payload\": {\n  \"data\": {\n  \"message\": \"Someone is at the door but system crashed\",\n  \"data\": {\n    \"image\": url,\n    \"actions\": [\n      {\n        \"action\": \"unlock_door\",\n        \"title\": \"Unlock The Door\"\n      }\n                \n    ]\n  }\n}\n }\n};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2580,"y":1020,"wires":[["f8c520c15bdc3496"]]},{"id":"f8c520c15bdc3496","type":"api-call-service","z":"14484d2a357fa501","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"notify","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2760,"y":1020,"wires":[["ffd73041c96aeb47"]]},{"id":"8591b7ba9e35795f","type":"trigger","z":"14484d2a357fa501","name":"Crash","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"1","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2210,"y":1040,"wires":[["adca23ed01fc6039"]]},{"id":"12c4c8382e0744d9","type":"change","z":"14484d2a357fa501","name":"Set Data for mass alert","rules":[{"t":"set","p":"color_value","pt":"msg","to":"[0,0,255]","tot":"json"},{"t":"set","p":"dbrigthness","pt":"msg","to":"100","tot":"num"},{"t":"set","p":"message","pt":"msg","to":"Someone is at the door","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2620,"y":1100,"wires":[["d97a6ca5f29095fa"]]},{"id":"3c31668009a3d6e2","type":"link out","z":"14484d2a357fa501","name":"Light and Speakers","links":["45904ca6429d867d","ad88dbd2.4726b8","3405e943.fd3ee6","9cf42cf7ef60f645"],"x":3035,"y":1100,"wires":[]},{"id":"3225b96d73d99955","type":"catch","z":"14484d2a357fa501","name":"","scope":["af8b05e8de50da59"],"uncaught":false,"x":2070,"y":1000,"wires":[["8591b7ba9e35795f"]]},{"id":"1c53442f1f8346db","type":"debug","z":"14484d2a357fa501","name":"result before notif","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2570,"y":980,"wires":[]},{"id":"071e62f4a8fb4411","type":"link out","z":"14484d2a357fa501","name":"Announcement input","links":["6c95d201f6c9daf3"],"x":2555,"y":1060,"wires":[]},{"id":"68e202d57728a02c","type":"api-current-state","z":"14484d2a357fa501","name":"party on?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.party_mode","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"partyon","propertyType":"msg","value":"","valueType":"entityState"},{"property":"partydata","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":2540,"y":80,"wires":[["56d8698dc3949500"],["8cc2908d43c2b0e6"]]},{"id":"8cc2908d43c2b0e6","type":"api-current-state","z":"14484d2a357fa501","name":"Waiting Friend?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.waiting_someone","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"partyon","propertyType":"msg","value":"","valueType":"entityState"},{"property":"partydata","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":2720,"y":140,"wires":[["56d8698dc3949500"],["2b1a7a32e0739f94"]]},{"id":"56d8698dc3949500","type":"api-current-state","z":"14484d2a357fa501","name":"Front House Motion","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.motion_front","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"partyon","propertyType":"msg","value":"","valueType":"entityState"},{"property":"partydata","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":2890,"y":80,"wires":[["86bd928d040cab78"],["2b1a7a32e0739f94"]]},{"id":"26ed3a6f44375dca","type":"switch","z":"14484d2a357fa501","name":"Reco?","property":"payload.recognized","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":2430,"y":420,"wires":[["b0ae24686447690e"],["e3baaad7235f860d"]]},{"id":"afedb702f35b0c65","type":"api-current-state","z":"14484d2a357fa501","name":"uber","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.waiting_uber","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"uber","propertyType":"msg","value":"","valueType":"entityState"},{"property":"uberentity","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":2270,"y":660,"wires":[["f4192181153226e6"],[]]},{"id":"aca7f51d5f5467f6","type":"trigger","z":"14484d2a357fa501","name":"Uber","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"1","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1750,"y":780,"wires":[["3aaca7bceb8c1e16","fe9a07db7ec23343"]]},{"id":"3aaca7bceb8c1e16","type":"function","z":"14484d2a357fa501","name":"Javascript","func":"var d = new Date();\nvar h = d.getHours();\nvar m = d.getMinutes();\nvar s = d.getSeconds();\nvar camera = \"camera.front_door\";\nvar confidence = 0;\n\nif (typeof msg.payload.confidence !==\"undefined\"){\nvar confidence = msg.payload.confidence;\n}\n\nvar who = \"Unknown\";\nif (typeof msg.payload.name !==\"undefined\"){\nvar who = msg.payload.name;\n}\n\n\n\n\nvar newMsg = {\n    \"payload\": {\n        \"name\": who,\n        \"data\": {\n            \"filename\":\"/config/www/portraits/\" + who + \"/\" + who + \"-\" + camera + \"-\" + h + m + s + \"-\" + confidence + \".jpg\",\n            \"entity_id\": camera\n        }\n    }\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1960,"y":800,"wires":[["003c13e20cc28ae5","3e51ec47ed89c67e"]]},{"id":"003c13e20cc28ae5","type":"api-call-service","z":"14484d2a357fa501","name":"snapshot","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"camera","service":"snapshot","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload666","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2100,"y":800,"wires":[["b1130b17e8e654ed","30b831c8da8ccd2f"]]},{"id":"a3636fb3c619cfea","type":"api-call-service","z":"14484d2a357fa501","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"notify","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2540,"y":760,"wires":[[]]},{"id":"b1130b17e8e654ed","type":"function","z":"14484d2a357fa501","name":"Javascript","func":"var d = new Date();\nvar name = \"Someone\";\nvar m = d.getMilliseconds();\nvar snapshot = msg.payload.data.filename;\nvar url = \"http://192.168.0.12:8765/picture/8/current/?\" + m;\n\nvar snapshot = snapshot.replace(\"\\/config\\/www\",\"https:\\/\\/hass.purgatoire.ca\\/local\");\n\n\nvar newMsg = {\n\t\"payload\": {\n\t\t\"data\": {\n\t\t\t\"message\": \"Doorbell Alert\",\n\t\t\t\"title\": name + \" is at the door\",\n\t\t\t\"data\": {\n\t\t\t\t\"image\": snapshot,\n\t\t\t\t\"actions\": [{\n\t\t\t\t\t\t\"action\": \"REPLY\",\n\t\t\t\t\t\t\"title\": \"Who is this?\"\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"action\": \"unlock_door\",\n\t\t\t\t\t\t\"title\": \"Unlock The Door\"\n\t\t\t\t\t}\n\n\t\t\t\t]\n\t\t\t}\n\t\t}\n\t}\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2240,"y":800,"wires":[["a3636fb3c619cfea","5ced15bcb2b21f09"]]},{"id":"5ced15bcb2b21f09","type":"change","z":"14484d2a357fa501","name":"Set Data for mass alert","rules":[{"t":"set","p":"message","pt":"msg","to":"payload.data.title","tot":"msg"},{"t":"set","p":"color_value","pt":"msg","to":"[0,0,255]","tot":"json"},{"t":"set","p":"dbrigthness","pt":"msg","to":"100","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":2520,"y":840,"wires":[["dd61d0b2cad7a585","5df29bf9a155a455"]]},{"id":"9bcf0ff17f4166b3","type":"link out","z":"14484d2a357fa501","name":"Light and Speakers","links":["45904ca6429d867d"],"x":2935,"y":860,"wires":[]},{"id":"fe9a07db7ec23343","type":"api-call-service","z":"14484d2a357fa501","name":"to package","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"script","service":"ptz_to_package","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1930,"y":760,"wires":[["87741f0405d05c21","a3954cb431d13482","93ce05f120ded01c"]]},{"id":"87741f0405d05c21","type":"link out","z":"14484d2a357fa501","name":"Announcement input","links":["6c95d201f6c9daf3"],"x":2035,"y":760,"wires":[]},{"id":"30b831c8da8ccd2f","type":"debug","z":"14484d2a357fa501","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2190,"y":820,"wires":[]},{"id":"3e51ec47ed89c67e","type":"debug","z":"14484d2a357fa501","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2070,"y":840,"wires":[]},{"id":"ba467450b6d6dcd2","type":"api-call-service","z":"14484d2a357fa501","name":"to regular position","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"script","service":"ptz_to_doorway","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload666","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2290,"y":720,"wires":[[]]},{"id":"a3954cb431d13482","type":"ha-wait-until","z":"14484d2a357fa501","name":"lock opens?","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"lock.lock_front_door","entityIdFilterType":"exact","property":"state","comparator":"is","value":"unlocked","valueType":"str","timeout":"120","timeoutType":"num","timeoutUnits":"seconds","checkCurrentState":false,"blockInputOverrides":true,"outputProperties":[],"x":2090,"y":720,"wires":[["ba467450b6d6dcd2"],["ba467450b6d6dcd2"]]},{"id":"5297d6f39c193257","type":"change","z":"14484d2a357fa501","name":"reset","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2790,"y":500,"wires":[["734b7304e89ca79e","99f47b25145a1f09","bdb95ccd4331168c"]]},{"id":"734b7304e89ca79e","type":"function","z":"14484d2a357fa501","name":"Javascript","func":"var recoface = [];\nvar facestring = \"\"\nvar d = new Date();\nvar m = d.getMilliseconds();\nvar url = \"https://hass.purgatoire.ca/local/ring.jpg?\" + m;\nvar facestring = msg.payload;\n\nvar newMsg = {\n \"payload\": {\n  \"data\": {\n  \"message\": \"Someone is at the door\",\n  \"data\": {\n    \"image\": url,\n    \"actions\": [\n      {\n        \"action\": \"unlock_door\",\n        \"title\": \"Unlock The Door\"\n      }\n                \n    ]\n  }\n}\n }\n};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2960,"y":480,"wires":[["f6b532ffea29d27b"]]},{"id":"f6b532ffea29d27b","type":"api-call-service","z":"14484d2a357fa501","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"notify","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3140,"y":480,"wires":[["ffd73041c96aeb47","40200dddf08a041f"]]},{"id":"e3baaad7235f860d","type":"trigger","z":"14484d2a357fa501","name":"No Face","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"1","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2640,"y":500,"wires":[["5297d6f39c193257"]]},{"id":"99f47b25145a1f09","type":"change","z":"14484d2a357fa501","name":"Set Data for mass alert","rules":[{"t":"set","p":"color_value","pt":"msg","to":"[0,0,255]","tot":"json"},{"t":"set","p":"dbrigthness","pt":"msg","to":"100","tot":"num"},{"t":"set","p":"message","pt":"msg","to":"Someone is at the door","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2990,"y":520,"wires":[["c7edae404be99e1a"]]},{"id":"e02e42d8570d1e35","type":"link out","z":"14484d2a357fa501","name":"Light and Speakers","links":["45904ca6429d867d"],"x":3375,"y":520,"wires":[]},{"id":"bdb95ccd4331168c","type":"link out","z":"14484d2a357fa501","name":"Announcement input","links":["6c95d201f6c9daf3"],"x":2915,"y":560,"wires":[]},{"id":"41c58a88bcf4a030","type":"server-events","z":"14484d2a357fa501","name":"","server":"7ab5c227.a3ce8c","version":2,"eventType":"mobile_app_notification_action","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"waitForRunning":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"},{"property":"event_type","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"}],"x":430,"y":200,"wires":[["e5df440fd885d7bc","49f2b70e9a7396bd"]]},{"id":"e5df440fd885d7bc","type":"debug","z":"14484d2a357fa501","name":"actionable","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":930,"y":80,"wires":[]},{"id":"49f2b70e9a7396bd","type":"switch","z":"14484d2a357fa501","name":"","property":"payload.event.action_1_title","propertyType":"msg","rules":[{"t":"eq","v":"Who is this?","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":670,"y":260,"wires":[["7beed4a06521b3d3","3a5e39d9485156dd"]]},{"id":"7beed4a06521b3d3","type":"function","z":"14484d2a357fa501","name":"Javascript","func":"var d = new Date();\nvar h = d.getHours();\nvar m = d.getMinutes();\nvar s = d.getSeconds();\n\nvar confidence = 0;\nif (typeof msg.payload.confidence !==\"undefined\"){\nvar confidence = msg.payload.confidence;\n}\n\n\nvar who = msg.payload.event.reply_text.toLowerCase().replace(\" \",\"\");\nvar replacestring = \"https://hass.purgatoire.ca/local/portraits/\" + who.toLowerCase();\nvar replacestring1 = msg.payload.event.image.replace(replacestring);\nvar replacestring2 = replacestring1.split(\"-\");\nvar camera = replacestring2[1];\n\n\n\n\nvar newMsg = {\n    \"image\": msg.payload.event.image,\n    \"payload\": {\n        \"name\": who,\n        \"data\": {\n            \"filename\":\"/config/double-take/\" + who +  \"/\" + camera + \"_\" + h + m + s + \"_\" + confidence + \".jpg\",\n            \"entity_id\": camera,\n            // \"1\": replacestring,\n            // \"2\": replacestring1,\n            // \"3\": replacestring2\n        }\n    }\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":780,"y":320,"wires":[["3a5e39d9485156dd","868b65e07deac98b"]]},{"id":"3a5e39d9485156dd","type":"debug","z":"14484d2a357fa501","name":"actionable","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":970,"y":200,"wires":[]},{"id":"868b65e07deac98b","type":"switch","z":"14484d2a357fa501","name":"Recod Faces 1/0","property":"payload.data.entity_id","propertyType":"msg","rules":[{"t":"eq","v":"camera.facecam_static","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":990,"y":320,"wires":[["f269e432af96e7cf"]]},{"id":"f269e432af96e7cf","type":"api-call-service","z":"14484d2a357fa501","name":"snapshot","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"camera","service":"snapshot","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload666","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1160,"y":320,"wires":[["334a69225c8ff960","d5e0364259c9d2f7"]]},{"id":"334a69225c8ff960","type":"debug","z":"14484d2a357fa501","name":"result of snapchot","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1530,"y":340,"wires":[]},{"id":"d5e0364259c9d2f7","type":"function","z":"14484d2a357fa501","name":"Javascript","func":"var d = new Date();\nvar m = d.getMilliseconds();\nvar url = msg.image;\n\nvar url = url.replace(\"https:\\/\\/hass.purgatoire.ca\\/local\", \"\\/config\\/www\");\n\nvar newMsg = {\n \"name\": msg.payload.name,\n \"url\": \"http://192.168.0.14:3000/api/train/retrain/\" + msg.payload.name.toLowerCase(),\n \"data\":{\n    \"data\":{\n\t\"file_path\": url,\n\t\"name\": msg.payload.name.toLowerCase(),\n\t\"url\": \"http://192.168.0.14:3000/api/train/retrain/\" + msg.payload.name.toLowerCase()\n}}\n};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1200,"y":220,"wires":[["6bd4b336b2a94011","3a041018b34a7a99"]]},{"id":"6bd4b336b2a94011","type":"debug","z":"14484d2a357fa501","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1470,"y":140,"wires":[]},{"id":"3a041018b34a7a99","type":"http request","z":"14484d2a357fa501","name":"POST request","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1420,"y":220,"wires":[["262670207fc2a028","7177d9971a37d755"]]},{"id":"262670207fc2a028","type":"debug","z":"14484d2a357fa501","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1715.71435546875,"y":132.85714721679688,"wires":[]},{"id":"7177d9971a37d755","type":"function","z":"14484d2a357fa501","name":"Javascript","func":"var d = new Date();\nvar m = d.getMilliseconds();\nvar url = msg.data.data.file_path;\n\n\nvar snapshot = url.replace(\"\\/config\\/www\",\"https:\\/\\/hass.purgatoire.ca\\/local\");\n\nvar newMsg = {\n \"payload\": {\n  \"data\": {\n  \"message\": \"Faces learning for\" + \" \" + msg.name,\n  \"data\": {\n    \"image\": snapshot\n  }\n}\n }\n};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1680,"y":220,"wires":[["6da834e1d6cb8676","a1f03d69aff0468d"]]},{"id":"6da834e1d6cb8676","type":"api-call-service","z":"14484d2a357fa501","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"notify","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1900,"y":220,"wires":[["a1f03d69aff0468d"]]},{"id":"a1f03d69aff0468d","type":"debug","z":"14484d2a357fa501","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1870,"y":100,"wires":[]},{"id":"4c173b13c52a7625","type":"debug","z":"14484d2a357fa501","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":470,"y":380,"wires":[]},{"id":"130dabbc622bdd7c","type":"api-call-service","z":"14484d2a357fa501","name":"snapshot","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"camera","service":"snapshot","areaId":[],"deviceId":[],"entityId":["camera.front_door"],"data":"{\"filename\":\"/config/www/reolink.jpg\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1180,"y":1340,"wires":[[]]},{"id":"52c7a029e3d99227","type":"trigger","z":"14484d2a357fa501","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"10","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1030,"y":1340,"wires":[["130dabbc622bdd7c"]]},{"id":"3e79915f8de8b345","type":"change","z":"14484d2a357fa501","name":"","rules":[{"t":"set","p":"reset","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":840,"y":1400,"wires":[["52c7a029e3d99227"]]},{"id":"e529e2ebd8ba0cc3","type":"trigger","z":"14484d2a357fa501","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"1","extend":false,"units":"min","reset":"","bytopic":"all","outputs":1,"x":670,"y":1400,"wires":[["3e79915f8de8b345"]]},{"id":"c198ab088fd12cf2","type":"mqtt in","z":"14484d2a357fa501","name":"","topic":"frigate/faceshot_zone/person","qos":"0","datatype":"auto","broker":"21000c19b97da572","nl":false,"rap":true,"rh":0,"inputs":0,"x":400,"y":1340,"wires":[["0741c816d5e61590"]]},{"id":"0741c816d5e61590","type":"switch","z":"14484d2a357fa501","name":"click","property":"payload","propertyType":"msg","rules":[{"t":"gt","v":"0","vt":"num"},{"t":"eq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":670,"y":1340,"wires":[["52c7a029e3d99227"],["e529e2ebd8ba0cc3"]]},{"id":"57590a930154b3b5","type":"trigger","z":"14484d2a357fa501","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"45","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":750,"y":600,"wires":[["0861877d35bfe16e","96b3d130e3563de0"]]},{"id":"a7c52589eb409444","type":"api-call-service","z":"14484d2a357fa501","name":"toggle boolean","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.door_rang"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1480,"y":780,"wires":[[]]},{"id":"dd31bc940ba436cd","type":"ha-wait-until","z":"14484d2a357fa501","name":"","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"binary_sensor.door_front_outside","entityIdFilterType":"exact","property":"state","comparator":"is","value":"on","valueType":"str","timeout":"60","timeoutType":"num","timeoutUnits":"seconds","checkCurrentState":false,"blockInputOverrides":true,"outputProperties":[],"x":1300,"y":780,"wires":[["a7c52589eb409444"],["a7c52589eb409444"]]},{"id":"d4d993dd0b6b1e6d","type":"ha-wait-until","z":"14484d2a357fa501","name":"wait until Doubletake detect someone","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"sensor.double_take_facecam","entityIdFilterType":"exact","property":"state","comparator":"gt","value":"0","valueType":"num","timeout":"2","timeoutType":"num","timeoutUnits":"seconds","checkCurrentState":true,"blockInputOverrides":true,"outputProperties":[{"property":"doubletake","propertyType":"msg","value":"","valueType":"entity"}],"x":490,"y":560,"wires":[["57590a930154b3b5"],["57590a930154b3b5"]]},{"id":"93ce05f120ded01c","type":"debug","z":"14484d2a357fa501","name":"to package","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2180,"y":760,"wires":[]},{"id":"f4192181153226e6","type":"api-current-state","z":"14484d2a357fa501","name":"Kink=1","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.kink_party","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"uber","propertyType":"msg","value":"","valueType":"entityState"},{"property":"uberentity","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":2310,"y":600,"wires":[["660692c291ce0d61"],["458fbd5918128bfa"]]},{"id":"458fbd5918128bfa","type":"trigger","z":"14484d2a357fa501","name":"Kink","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"1","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2570,"y":660,"wires":[["0bb5f84e75c93b34"]]},{"id":"0bb5f84e75c93b34","type":"function","z":"14484d2a357fa501","name":"Javascript","func":"var d = new Date();\nvar h = d.getHours();\nvar m = d.getMinutes();\nvar s = d.getSeconds();\nvar camera = \"camera.front_door\";\nvar confidence = 0;\n\nif (typeof msg.payload.confidence !==\"undefined\"){\nvar confidence = msg.payload.confidence;\n}\n\nvar who = \"Unknown\";\nif (typeof msg.payload.name !==\"undefined\"){\nvar who = msg.payload.name;\n}\n\n\n\n\nvar newMsg = {\n    \"payload\": {\n        \"name\": who,\n        \"data\": {\n            \"filename\":\"/config/www/portraits/\" + who + \"/\" + who + \"-\" + camera + \"-\" + h + m + s + \"-\" + confidence + \".jpg\",\n            \"entity_id\": camera\n        }\n    }\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2780,"y":680,"wires":[["8761ead0cec960d3","630cbead206160c0"]]},{"id":"8761ead0cec960d3","type":"api-call-service","z":"14484d2a357fa501","name":"snapshot","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"camera","service":"snapshot","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload666","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2920,"y":680,"wires":[["40e28c855edef985","1cd2dab97e94ddb6"]]},{"id":"0865a3bc30f7f16b","type":"api-call-service","z":"14484d2a357fa501","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"notify","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3220,"y":680,"wires":[["ffd73041c96aeb47"]]},{"id":"40e28c855edef985","type":"function","z":"14484d2a357fa501","name":"Javascript","func":"var d = new Date();\nvar name = \"A perv\";\nvar m = d.getMilliseconds();\nvar snapshot = msg.payload.data.filename;\nvar url = \"http://192.168.0.12:8765/picture/8/current/?\" + m;\n\nvar snapshot = snapshot.replace(\"\\/config\\/www\",\"https:\\/\\/hass.purgatoire.ca\\/local\");\n\n\nvar newMsg = {\n\t\"payload\": {\n\t\t\"data\": {\n\t\t\t\"message\": \"Doorbell Alert\",\n\t\t\t\"title\": name + \" is at the door\",\n\t\t\t\"data\": {\n\t\t\t\t\"image\": snapshot,\n\t\t\t\t\"actions\": [{\n\t\t\t\t\t\t\"action\": \"REPLY\",\n\t\t\t\t\t\t\"title\": \"Who is this?\"\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"action\": \"unlock_door\",\n\t\t\t\t\t\t\"title\": \"Unlock The Door\"\n\t\t\t\t\t}\n\n\t\t\t\t]\n\t\t\t}\n\t\t}\n\t}\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3060,"y":680,"wires":[["0865a3bc30f7f16b","87fbabb7f224a018"]]},{"id":"87fbabb7f224a018","type":"change","z":"14484d2a357fa501","name":"Set Data for mass alert","rules":[{"t":"set","p":"message","pt":"msg","to":"payload.data.title","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":3200,"y":640,"wires":[["49ff1245733f7615"]]},{"id":"333bc07437e9824c","type":"link out","z":"14484d2a357fa501","name":"Light and Speakers","links":["45904ca6429d867d","ad88dbd2.4726b8","3405e943.fd3ee6","9cf42cf7ef60f645"],"x":3555,"y":640,"wires":[]},{"id":"1cd2dab97e94ddb6","type":"debug","z":"14484d2a357fa501","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3050,"y":700,"wires":[]},{"id":"630cbead206160c0","type":"debug","z":"14484d2a357fa501","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2890,"y":720,"wires":[]},{"id":"18e6e4790a40d9dc","type":"server-state-changed","z":"14484d2a357fa501","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.remote_doorbell_button_action","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"None","halt_if_type":"str","halt_if_compare":"is_not","outputs":2,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":true,"ignorePrevStateUnknown":true,"ignorePrevStateUnavailable":true,"ignoreCurrentStateUnknown":true,"ignoreCurrentStateUnavailable":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":200,"y":660,"wires":[["79e4e71f5e0852e8","d4d993dd0b6b1e6d","8e3afe4418dd544b","85dd28056bc51434"],[]]},{"id":"79e4e71f5e0852e8","type":"debug","z":"14484d2a357fa501","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":550,"y":660,"wires":[]},{"id":"1b2ca2456333eec4","type":"api-call-service","z":"14484d2a357fa501","name":"toggle boolean","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.waiting_someone"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3280,"y":80,"wires":[[]]},{"id":"62ebb57ee56b1998","type":"api-call-service","z":"14484d2a357fa501","name":"toggle boolean","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_on","areaId":[],"deviceId":[],"entityId":["input_boolean.face_recognized"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4700,"y":760,"wires":[["3f3e07f49c27ac01"]]},{"id":"c76a570fe0a7f2c9","type":"ha-wait-until","z":"14484d2a357fa501","name":"","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"binary_sensor.door_front_outside","entityIdFilterType":"exact","property":"state","comparator":"is","value":"on","valueType":"str","timeout":"30","timeoutType":"num","timeoutUnits":"seconds","checkCurrentState":true,"blockInputOverrides":true,"outputProperties":[],"x":3780,"y":840,"wires":[["52c948979f3a3aca"],["52c948979f3a3aca"]]},{"id":"52c948979f3a3aca","type":"api-call-service","z":"14484d2a357fa501","name":"toggle boolean","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.waiting_someone"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3940,"y":840,"wires":[["a51e1c8356c64b74"]]},{"id":"a51e1c8356c64b74","type":"api-call-service","z":"14484d2a357fa501","name":"toggle boolean","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.face_recognized"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4140,"y":840,"wires":[["5f99f60edf3b2662"]]},{"id":"5f99f60edf3b2662","type":"function","z":"14484d2a357fa501","name":"Reset Name","func":"var newMsg = {\n    \"payload\": {\n        \"data\": {\n            \"value\": \"UNKNOWN\"\n        }}};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4350,"y":840,"wires":[["43b8809b9dc8292a"]]},{"id":"43b8809b9dc8292a","type":"api-call-service","z":"14484d2a357fa501","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"input_text","service":"set_value","areaId":[],"deviceId":[],"entityId":["input_text.recognized_face"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4730,"y":840,"wires":[[]]},{"id":"3f3e07f49c27ac01","type":"trigger","z":"14484d2a357fa501","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"25","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":4890,"y":760,"wires":[["c76a570fe0a7f2c9"]]},{"id":"ffd73041c96aeb47","type":"trigger","z":"14484d2a357fa501","name":"Manual unlock","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"1","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":3800,"y":660,"wires":[["e7dbb42f6b57e7ed"]]},{"id":"e7dbb42f6b57e7ed","type":"ha-wait-until","z":"14484d2a357fa501","name":"","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"lock.lock_front_door","entityIdFilterType":"exact","property":"state","comparator":"is","value":"unlocked","valueType":"str","timeout":"60","timeoutType":"num","timeoutUnits":"seconds","checkCurrentState":true,"blockInputOverrides":true,"outputProperties":[],"x":3960,"y":760,"wires":[["99c11665f1ce940e"],[]]},{"id":"b348709007cc3c6d","type":"api-call-service","z":"14484d2a357fa501","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"input_text","service":"set_value","areaId":[],"deviceId":[],"entityId":["input_text.recognized_face"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4330,"y":760,"wires":[["92083edde6a1bc99"]]},{"id":"99c11665f1ce940e","type":"function","z":"14484d2a357fa501","name":"Empty name","func":"var newMsg = {\n    \"payload\": {\n        \"data\": {\n            \"value\": \" \"\n        }}};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4130,"y":760,"wires":[["b348709007cc3c6d"]]},{"id":"23dab3195e4bf115","type":"inject","z":"14484d2a357fa501","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":3900,"y":600,"wires":[["99c11665f1ce940e"]]},{"id":"92083edde6a1bc99","type":"change","z":"14484d2a357fa501","name":"reset","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":4510,"y":760,"wires":[["62ebb57ee56b1998"]]},{"id":"d71380d25baade5a","type":"subflow:233ac7dcd801a802","z":"14484d2a357fa501","name":"","x":3670,"y":460,"wires":[]},{"id":"49ff1245733f7615","type":"subflow:233ac7dcd801a802","z":"14484d2a357fa501","name":"","x":3450,"y":640,"wires":[]},{"id":"d97a6ca5f29095fa","type":"subflow:233ac7dcd801a802","z":"14484d2a357fa501","name":"","x":2890,"y":1100,"wires":[]},{"id":"04566cb55ad19575","type":"subflow:233ac7dcd801a802","z":"14484d2a357fa501","name":"","x":4350,"y":180,"wires":[]},{"id":"dd61d0b2cad7a585","type":"subflow:233ac7dcd801a802","z":"14484d2a357fa501","name":"","x":2870,"y":840,"wires":[]},{"id":"35a1804fd59f9be8","type":"subflow:233ac7dcd801a802","z":"14484d2a357fa501","name":"","x":3110,"y":260,"wires":[]},{"id":"0da283caf2f22ca9","type":"change","z":"14484d2a357fa501","name":"TV Announcement","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2210,"y":540,"wires":[["a9f7a85966e01bbb"]]},{"id":"5d8d33df42b78247","type":"subflow:a4f0ac9a6eed6b71","z":"14484d2a357fa501","name":"TV Alerts","x":2440,"y":540,"wires":[]},{"id":"40200dddf08a041f","type":"debug","z":"14484d2a357fa501","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3290,"y":560,"wires":[]},{"id":"c7edae404be99e1a","type":"subflow:233ac7dcd801a802","z":"14484d2a357fa501","name":"","x":3210,"y":520,"wires":[]},{"id":"14a6954cfb02badb","type":"inject","z":"14484d2a357fa501","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2300,"y":860,"wires":[["5ced15bcb2b21f09"]]},{"id":"3a522a70e3e51c47","type":"api-current-state","z":"14484d2a357fa501","name":"light.bedroom_lights","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.bedroom_lights","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"state","propertyType":"msg","value":"","valueType":"entityState"},{"property":"entity_inital","propertyType":"msg","value":"","valueType":"entity"},{"property":"payload.entity_id","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":2540,"y":1460,"wires":[["266c477a16663fb0"]],"outputLabels":["data.attributes"]},{"id":"b841b93f25f30a29","type":"api-call-service","z":"14484d2a357fa501","name":"Change Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["{{entity_inital.entity_id}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload.data.entity_id","propertyType":"msg","value":"payload.entity_id","valueType":"msg"}],"queue":"none","x":3000,"y":1460,"wires":[["7527924fc1f061a4","e9ec6b1c73677558"]]},{"id":"266c477a16663fb0","type":"change","z":"14484d2a357fa501","name":"rules","rules":[{"t":"move","p":"dbrigthness","pt":"msg","to":"payload.data.brightness_pct","tot":"msg"},{"t":"move","p":"color_value","pt":"msg","to":"payload.data.rgb_color","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2770,"y":1460,"wires":[["b841b93f25f30a29","e9ec6b1c73677558"]]},{"id":"7527924fc1f061a4","type":"trigger","z":"14484d2a357fa501","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"2","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":3200,"y":1460,"wires":[["22b5ad9b36ed6cc6"]]},{"id":"b64ae81ae20cf2a5","type":"api-call-service","z":"14484d2a357fa501","name":"Change Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3540,"y":1460,"wires":[["b0d705754518181d"]]},{"id":"b0d705754518181d","type":"api-current-state","z":"14484d2a357fa501","name":"light.bedroom_lights","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.bedroom_lights","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":3740,"y":1460,"wires":[["8ace3253f8070032"]]},{"id":"8ace3253f8070032","type":"switch","z":"14484d2a357fa501","name":"!=same color","property":"data.attributes.rgb_color","propertyType":"msg","rules":[{"t":"eq","v":"color_value","vt":"msg"}],"checkall":"true","repair":false,"outputs":1,"x":3650,"y":1420,"wires":[["b64ae81ae20cf2a5"]]},{"id":"22b5ad9b36ed6cc6","type":"function","z":"14484d2a357fa501","name":"","func":"var brightness = msg.entity_inital.attributes.brightness;\nvar initial_color = msg.entity_inital.attributes.rgb_color;\nvar state = msg.entity_inital.state;\nvar entity = msg.entity_inital.entity_id;\nvar color_value = msg.payload.data.rgb_color;\nvar newMsg = \n\n{ \n    \"payload\": {\n                data: {\n                         \"brightness\": brightness,\n                         \"rgb_color\": initial_color,\n                \"entity_id\": entity\n                    \n                },\n               \n                \"service\": \"turn_\" + state,\n                \"color_value\": color_value\n                \n               }\n};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3360,"y":1460,"wires":[["b64ae81ae20cf2a5"]]},{"id":"e6776b38f590c7c8","type":"change","z":"14484d2a357fa501","name":"Set Data for mass alert","rules":[{"t":"set","p":"message","pt":"msg","to":"payload.data.title","tot":"msg"},{"t":"set","p":"color_value","pt":"msg","to":"[0,0,255]","tot":"json"},{"t":"set","p":"dbrigthness","pt":"msg","to":"100","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":2250,"y":1440,"wires":[["3a522a70e3e51c47"]]},{"id":"78e3206309a9efd9","type":"inject","z":"14484d2a357fa501","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2040,"y":1420,"wires":[["e6776b38f590c7c8"]]},{"id":"e9ec6b1c73677558","type":"debug","z":"14484d2a357fa501","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3000,"y":1380,"wires":[]},{"id":"ee4abadbba55767d","type":"inject","z":"14484d2a357fa501","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2010,"y":880,"wires":[[]]},{"id":"5df29bf9a155a455","type":"debug","z":"14484d2a357fa501","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2770,"y":780,"wires":[]},{"id":"f81f9066c3642e33","type":"switch","z":"dc434684164184f3","name":"click","property":"payload.event.command","propertyType":"msg","rules":[{"t":"regex","v":"(click)","vt":"str","case":true}],"checkall":"true","repair":false,"outputs":1,"x":250,"y":840,"wires":[["e454c3be539b6285","d56d0261de5b568d"]]},{"id":"d0439c4b4704092f","type":"server-events","z":"dc434684164184f3","name":"Ringer","server":"7ab5c227.a3ce8c","version":2,"eventType":"zha_event","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"waitForRunning":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"},{"property":"event_type","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"}],"x":110,"y":840,"wires":[["f81f9066c3642e33"]]},{"id":"fcbc2284bd9e9322","type":"trigger","z":"dc434684164184f3","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"45","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":590,"y":840,"wires":[["73d5a5506a43fcd1","615613db29724c87","e919893a9841580a"]]},{"id":"73d5a5506a43fcd1","type":"trigger","z":"dc434684164184f3","name":"Snapshots","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"1","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":790,"y":860,"wires":[["7c8ab89cab1b4956","d49d22ab07c3d2ee"]]},{"id":"10758c426a0858aa","type":"inject","z":"dc434684164184f3","name":"scan","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"date","x":2130,"y":600,"wires":[["9360acda1b161468","d49d22ab07c3d2ee"]]},{"id":"4185710a31385ab9","type":"switch","z":"dc434684164184f3","name":"Recod Faces 1/0","property":"payload.recognized","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":1990,"y":820,"wires":[["b4835ffffced14cd"],["2830e93ceb0cef1f"]]},{"id":"ca373eccc666f38c","type":"api-current-state","z":"dc434684164184f3","name":"party on?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.party_mode","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"partyon","propertyType":"msg","value":"","valueType":"entityState"},{"property":"partydata","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":2420,"y":800,"wires":[["89af71618b9c0faa"],["040c177eb917a566"]]},{"id":"d111259afef6d892","type":"change","z":"dc434684164184f3","name":"reset","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":3370,"y":800,"wires":[["c8843b8ac78ff90b"]]},{"id":"a9bdbe5fe49d2b6e","type":"function","z":"dc434684164184f3","name":"Name Payload","func":"var name = msg.payload.name;\n\nvar newMsg = {\n    \"payload\": {\n        \"data\": {\n            \"value\": name\n        }}};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3440,"y":960,"wires":[["7a162e600a9e97be"]]},{"id":"040c177eb917a566","type":"api-current-state","z":"dc434684164184f3","name":"Waiting Friend?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.waiting_someone","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"partyon","propertyType":"msg","value":"","valueType":"entityState"},{"property":"partydata","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":2460,"y":840,"wires":[["89af71618b9c0faa"],["06d4b8e6ac09e9b5"]]},{"id":"c8843b8ac78ff90b","type":"function","z":"dc434684164184f3","name":"Set Path","func":"var d = new Date();\nvar m = d.getMilliseconds();\nvar url = \"http://192.168.0.12:8765/picture/8/current/?\"+m;\nvar newMsg = \n\n{ \n    \"payload\": {\n                data: {\n    \"media_content_id\": url,\n    \"media_content_type\": \"image/jpg\"\n                      }\n                }         \n};\nreturn newMsg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3500,"y":800,"wires":[["bc521ef8b67af4c3"]]},{"id":"7a162e600a9e97be","type":"api-call-service","z":"dc434684164184f3","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"input_text","service":"set_value","areaId":[],"deviceId":[],"entityId":["input_text.recognized_face"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3670,"y":960,"wires":[[]]},{"id":"b499a1d86fc0a256","type":"api-call-service","z":"dc434684164184f3","name":"toggle boolean","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_on","areaId":[],"deviceId":[],"entityId":["input_boolean.face_recognized"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3900,"y":840,"wires":[["c8765eb38fe5e2eb"]]},{"id":"bc521ef8b67af4c3","type":"subflow:eb3b6592c8406c0d","z":"dc434684164184f3","name":"","env":[],"x":3730,"y":780,"wires":[]},{"id":"c8765eb38fe5e2eb","type":"ha-wait-until","z":"dc434684164184f3","name":"","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"binary_sensor.door_front_outside","entityIdFilterType":"exact","property":"state","comparator":"is","value":"on","valueType":"str","timeout":"30","timeoutType":"num","timeoutUnits":"seconds","checkCurrentState":true,"blockInputOverrides":true,"outputProperties":[],"x":4080,"y":820,"wires":[["6a1b71bb3d5da029"],["6a1b71bb3d5da029"]]},{"id":"6a1b71bb3d5da029","type":"api-call-service","z":"dc434684164184f3","name":"toggle boolean","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.waiting_someone"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4320,"y":800,"wires":[["54512cfe53d49af7"]]},{"id":"54512cfe53d49af7","type":"api-call-service","z":"dc434684164184f3","name":"toggle boolean","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.face_recognized"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4480,"y":860,"wires":[["02440b086a01d79d"]]},{"id":"02440b086a01d79d","type":"function","z":"dc434684164184f3","name":"Name Payload","func":"var newMsg = {\n    \"payload\": {\n        \"data\": {\n            \"value\": \"UNKNOWN\"\n        }}};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4620,"y":800,"wires":[["fd73e469e2a05453"]]},{"id":"fd73e469e2a05453","type":"api-call-service","z":"dc434684164184f3","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"input_text","service":"set_value","areaId":[],"deviceId":[],"entityId":["input_text.recognized_face"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4830,"y":800,"wires":[[]]},{"id":"cc7516bbde4f135b","type":"debug","z":"dc434684164184f3","name":"Compare","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1900,"y":660,"wires":[]},{"id":"e2e0e39a2bb3932e","type":"debug","z":"dc434684164184f3","name":"unlock","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3810,"y":900,"wires":[]},{"id":"aa27da83f6d208af","type":"function","z":"dc434684164184f3","name":"Set Path","func":"var d = new Date();\nvar m = d.getMilliseconds();\nvar url = \"http://192.168.0.12:8765/picture/8/current/?\"+m;\nvar newMsg = \n\n{ \n    \"payload\": {\n                data: {\n    \"media_content_id\": url,\n    \"media_content_type\": \"image/jpg\"\n                      }\n                }         \n};\nreturn newMsg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2720,"y":880,"wires":[["67210b69f6801374"]]},{"id":"67210b69f6801374","type":"subflow:eb3b6592c8406c0d","z":"dc434684164184f3","name":"","env":[],"x":2890,"y":880,"wires":[]},{"id":"06d4b8e6ac09e9b5","type":"trigger","z":"dc434684164184f3","name":"Not waiting","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"1","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2550,"y":900,"wires":[["aa27da83f6d208af","32fd5b7cc87fce18"]]},{"id":"aa4d207fc89018f6","type":"change","z":"dc434684164184f3","name":"reset","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1950,"y":1520,"wires":[["f9c54cc9d58ea2ce","1f05f8606cdaa521","59c279e0d389e66e","12161e79cce07bcd"]]},{"id":"f9c54cc9d58ea2ce","type":"function","z":"dc434684164184f3","name":"Set Path","func":"var d = new Date();\nvar m = d.getMilliseconds();\nvar url = \"http://192.168.0.12:8765/picture/8/current/?\"+m;\nvar newMsg = \n\n{ \n    \"payload\": {\n                data: {\n    \"media_content_id\": url,\n    \"media_content_type\": \"image/jpg\"\n                      }\n                }         \n};\nreturn newMsg;\n\n","outputs":1,"noerr":0,"x":2200,"y":1520,"wires":[["b5b3990469a88f46"]]},{"id":"1f05f8606cdaa521","type":"function","z":"dc434684164184f3","name":"Javascript","func":"var recoface = [];\nvar facestring = \"\"\nvar d = new Date();\nvar m = d.getMilliseconds();\nvar url = \"https://hass.purgatoire.ca/local/ring.jpg?\" + m;\nvar facestring = msg.payload;\n\nvar newMsg = {\n \"payload\": {\n  \"data\": {\n  \"message\": \"Someone is at the door\",\n  \"data\": {\n    \"image\": url,\n    \"actions\": [\n      {\n        \"action\": \"unlock_door\",\n        \"title\": \"Unlock The Door\"\n      }\n                \n    ]\n  }\n}\n }\n};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2200,"y":1480,"wires":[["b985406500241595"]]},{"id":"b5b3990469a88f46","type":"subflow:eb3b6592c8406c0d","z":"dc434684164184f3","name":"","env":[],"x":2370,"y":1520,"wires":[]},{"id":"b985406500241595","type":"api-call-service","z":"dc434684164184f3","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"notify","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2380,"y":1480,"wires":[[]]},{"id":"a24b5102df8c3ebf","type":"trigger","z":"dc434684164184f3","name":"Crash","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"1","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2010,"y":1380,"wires":[["aa4d207fc89018f6"]]},{"id":"59c279e0d389e66e","type":"change","z":"dc434684164184f3","name":"Set Data for mass alert","rules":[{"t":"set","p":"color_value","pt":"msg","to":"[0,0,255]","tot":"json"},{"t":"set","p":"dbrigthness","pt":"msg","to":"100","tot":"num"},{"t":"set","p":"message","pt":"msg","to":"Someone is at the door","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2240,"y":1560,"wires":[["2185ba65d3b32ccb"]]},{"id":"2185ba65d3b32ccb","type":"link out","z":"dc434684164184f3","name":"Light and Speakers","links":["45904ca6429d867d","ad88dbd2.4726b8","3405e943.fd3ee6","9cf42cf7ef60f645"],"x":2375,"y":1560,"wires":[]},{"id":"faa50083e3ae1f1f","type":"catch","z":"dc434684164184f3","name":"","scope":["9f56048afecabe35"],"uncaught":false,"x":1810,"y":880,"wires":[["a24b5102df8c3ebf"]]},{"id":"b3c65ffba062ab08","type":"function","z":"dc434684164184f3","name":"Javascript","func":"var d = new Date();\nvar m = d.getMilliseconds();\nvar url = msg.image;\n\nvar url = url.replace(\"https:\\/\\/hass.purgatoire.ca\\/local\", \"\\/config\\/www\");\n\nvar newMsg = {\n \"name\": msg.payload.name,\n \"url\": \"http://192.168.0.14:3000/api/train/retrain/\" + msg.payload.name.toLowerCase(),\n \"data\":{\n    \"data\":{\n\t\"file_path\": url,\n\t\"name\": msg.payload.name.toLowerCase(),\n\t\"url\": \"http://192.168.0.14:3000/api/train/retrain/\" + msg.payload.name.toLowerCase()\n}}\n};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2480,"y":420,"wires":[["2487eb56be4a95b3","1837bd252cf0b8b2"]]},{"id":"efcc0d26c6fb51c0","type":"server-events","z":"dc434684164184f3","name":"","server":"7ab5c227.a3ce8c","version":2,"eventType":"mobile_app_notification_action","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"waitForRunning":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"},{"property":"event_type","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"}],"x":1710,"y":400,"wires":[["fac725887b00c8f5","bf36421868181d87"]]},{"id":"2487eb56be4a95b3","type":"debug","z":"dc434684164184f3","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2750,"y":340,"wires":[]},{"id":"3e6de3c6f5cb0f17","type":"function","z":"dc434684164184f3","name":"Javascript","func":"var d = new Date();\nvar m = d.getMilliseconds();\nvar url = msg.data.data.file_path;\n\n\nvar snapshot = url.replace(\"\\/config\\/www\",\"https:\\/\\/hass.purgatoire.ca\\/local\");\n\nvar newMsg = {\n \"payload\": {\n  \"data\": {\n  \"message\": \"Faces learning for\" + \" \" + msg.name,\n  \"data\": {\n    \"image\": snapshot\n  }\n}\n }\n};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2960,"y":420,"wires":[["e5cd95667df3b1f2","757cc328cc541338"]]},{"id":"e5cd95667df3b1f2","type":"api-call-service","z":"dc434684164184f3","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"notify","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3180,"y":420,"wires":[["757cc328cc541338"]]},{"id":"87caa448533c8d9b","type":"api-call-service","z":"dc434684164184f3","name":"snapshot","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"camera","service":"snapshot","areaId":[],"deviceId":[],"entityId":["camera.front_door"],"data":"{\"filename\":\"/config/www/reolink.jpg\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":740,"y":500,"wires":[[]]},{"id":"ecb63bd121dd5c2d","type":"ha-wait-until","z":"dc434684164184f3","name":"wait until facecam detect someone","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"sensor.facecam_persons","entityIdFilterType":"exact","property":"state","comparator":"gt","value":"0","valueType":"num","timeout":"30","timeoutType":"num","timeoutUnits":"seconds","checkCurrentState":true,"blockInputOverrides":true,"outputProperties":[],"x":380,"y":740,"wires":[[],[]]},{"id":"d76b686b96f8befd","type":"trigger","z":"dc434684164184f3","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"2","extend":false,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":510,"y":540,"wires":[["ecb63bd121dd5c2d","87caa448533c8d9b"]]},{"id":"59219d6d3e694135","type":"server-state-changed","z":"dc434684164184f3","name":"frigate reolink over 0","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.front_persons","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"0","halt_if_type":"num","halt_if_compare":"gt","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":90,"y":540,"wires":[[],[]]},{"id":"9ddf5ca3edccdd85","type":"change","z":"dc434684164184f3","name":"","rules":[{"t":"set","p":"reset","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":440,"y":580,"wires":[["d76b686b96f8befd"]]},{"id":"e65cd0635908707b","type":"trigger","z":"dc434684164184f3","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"1","extend":false,"units":"min","reset":"","bytopic":"all","outputs":1,"x":270,"y":580,"wires":[["9ddf5ca3edccdd85"]]},{"id":"e454c3be539b6285","type":"debug","z":"dc434684164184f3","name":"click","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":90,"y":720,"wires":[]},{"id":"c1c0010cdeca663b","type":"inject","z":"dc434684164184f3","name":"scan","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"date","x":3470,"y":1060,"wires":[["869e08ac92dc847d"]]},{"id":"615613db29724c87","type":"api-call-service","z":"dc434684164184f3","name":"toggle boolean","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_on","areaId":[],"deviceId":[],"entityId":["input_boolean.door_rang"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":880,"y":1020,"wires":[["9e34afd93f69bbba"]]},{"id":"e919893a9841580a","type":"switch","z":"dc434684164184f3","name":"double","property":"payload.event.args.click_type","propertyType":"msg","rules":[{"t":"cont","v":"double","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":710,"y":1080,"wires":[["051eaa0a3bc81fd8"]]},{"id":"9e34afd93f69bbba","type":"trigger","z":"dc434684164184f3","name":"","op1":"","op2":"1","op1type":"nul","op2type":"num","duration":"1","extend":false,"units":"min","reset":"","bytopic":"all","outputs":1,"x":1190,"y":1020,"wires":[["f9a2017b6a2a8e68"]]},{"id":"051eaa0a3bc81fd8","type":"api-current-state","z":"dc434684164184f3","name":"rang?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.door_rang","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":850,"y":1080,"wires":[["135a89df5af43c6b"],[]]},{"id":"f9a2017b6a2a8e68","type":"api-call-service","z":"dc434684164184f3","name":"toggle boolean","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.door_rang"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1400,"y":1020,"wires":[[]]},{"id":"135a89df5af43c6b","type":"api-call-service","z":"dc434684164184f3","name":"toggle boolean","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_on","areaId":[],"deviceId":[],"entityId":["input_boolean.door_double_rang"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1020,"y":1080,"wires":[["30759e3e74abfcbc"]]},{"id":"30759e3e74abfcbc","type":"trigger","z":"dc434684164184f3","name":"","op1":"","op2":"1","op1type":"nul","op2type":"num","duration":"1","extend":false,"units":"min","reset":"","bytopic":"all","outputs":1,"x":1190,"y":1080,"wires":[["b43c21109dfa88c6"]]},{"id":"b43c21109dfa88c6","type":"api-call-service","z":"dc434684164184f3","name":"toggle boolean","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.door_double_rang"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1400,"y":1080,"wires":[[]]},{"id":"8c06e0a3aebde655","type":"function","z":"dc434684164184f3","name":"Javascript","func":"var d = new Date();\nvar h = d.getHours();\nvar m = d.getMinutes();\nvar s = d.getSeconds();\nvar camera = msg.payload.camera;\nvar confidence = 0;\n\nif (typeof msg.payload.confidence !==\"undefined\"){\nvar confidence = msg.payload.confidence;\n}\n\nvar who = \"Unknown\";\nif (typeof msg.payload.name !==\"undefined\"){\nvar who = msg.payload.name;\n}\n\n\n\n\nvar newMsg = {\n    \"payload\": {\n        \"name\": who,\n        \"data\": {\n            \"filename\":\"/config/www/portraits/\" + who + \"/\" + who + \"-\" + camera + \"-\" + h + m + s + \"-\" + confidence + \".jpg\",\n            \"entity_id\": camera\n        }\n    }\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3340,"y":680,"wires":[["1c4f42af07633df5"]]},{"id":"1c4f42af07633df5","type":"api-call-service","z":"dc434684164184f3","name":"snapshot","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"camera","service":"snapshot","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload666","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":3520,"y":680,"wires":[["609158bb18808aa9","7b8fce8d5b789dee"]]},{"id":"609158bb18808aa9","type":"debug","z":"dc434684164184f3","name":"result of snapchot","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3770,"y":560,"wires":[]},{"id":"79fc99ef6e3fe4e8","type":"api-call-service","z":"dc434684164184f3","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"notify","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3880,"y":680,"wires":[[]]},{"id":"7b8fce8d5b789dee","type":"function","z":"dc434684164184f3","name":"Javascript","func":"var d = new Date();\nvar name = msg.payload.name;\nvar m = d.getMilliseconds();\nvar snapshot = msg.payload.data.filename;\nvar url = \"http://192.168.0.12:8765/picture/8/current/?\" + m;\n\nvar snapshot = snapshot.replace(\"\\/config\\/www\",\"https:\\/\\/hass.purgatoire.ca\\/local\");\n\n\nvar newMsg = {\n\t\"payload\": {\n\t\t\"data\": {\n\t\t\t\"message\": \"Doorbell Alert\",\n\t\t\t\"title\": \"Welcoming \" + name,\n\t\t\t\"data\": {\n\t\t\t\t\"image\": snapshot,\n\t\t\t\t\"actions\": [{\n\t\t\t\t\t\t\"action\": \"REPLY\",\n\t\t\t\t\t\t\"title\": \"Who is this?\"\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"action\": \"unlock_door\",\n\t\t\t\t\t\t\"title\": \"Unlock The Door\"\n\t\t\t\t\t}\n\n\t\t\t\t]\n\t\t\t}\n\t\t}\n\t}\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3700,"y":680,"wires":[["79fc99ef6e3fe4e8","417d9ddbc2aedfbd","4417fff8bb8b1560"]]},{"id":"417d9ddbc2aedfbd","type":"change","z":"dc434684164184f3","name":"Set Data for mass alert","rules":[{"t":"set","p":"message","pt":"msg","to":"payload.data.title","tot":"msg"},{"t":"set","p":"color_value","pt":"msg","to":"[0,0,255]","tot":"json"},{"t":"set","p":"dbrigthness","pt":"msg","to":"100","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":3880,"y":720,"wires":[["9790cd5589899bc8"]]},{"id":"daa9cae4d006c055","type":"debug","z":"dc434684164184f3","name":"actionable","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2250,"y":400,"wires":[]},{"id":"4417fff8bb8b1560","type":"debug","z":"dc434684164184f3","name":"result before notif","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":4028.571533203125,"y":625.7142944335938,"wires":[]},{"id":"2cf12fb174beb029","type":"debug","z":"dc434684164184f3","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2995.71435546875,"y":332.8571472167969,"wires":[]},{"id":"9790cd5589899bc8","type":"link out","z":"dc434684164184f3","name":"Light and Speakers","links":["45904ca6429d867d","ad88dbd2.4726b8","3405e943.fd3ee6","9cf42cf7ef60f645"],"x":4015,"y":720,"wires":[]},{"id":"757cc328cc541338","type":"debug","z":"dc434684164184f3","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3510,"y":380,"wires":[]},{"id":"37a8bfd412e08e5e","type":"inject","z":"dc434684164184f3","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"date","x":560,"y":460,"wires":[["87caa448533c8d9b"]]},{"id":"12161e79cce07bcd","type":"debug","z":"dc434684164184f3","name":"result before notif","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2190,"y":1420,"wires":[]},{"id":"b4835ffffced14cd","type":"switch","z":"dc434684164184f3","name":"","property":"payload.name","propertyType":"msg","rules":[{"t":"nempty"}],"checkall":"false","repair":false,"outputs":1,"x":2150,"y":800,"wires":[["da2860a614a49ff1"]]},{"id":"d49d22ab07c3d2ee","type":"http request","z":"dc434684164184f3","name":"POST request","method":"GET","ret":"txt","paytoqs":"ignore","url":"http://192.168.0.14:3000/api/recognize?url=http://192.168.0.15:8123/local/reolink.jpg&camera=camera.front_door","tls":"","persist":false,"proxy":"","authType":"","x":1100,"y":780,"wires":[["f185509b6fd7311d"]]},{"id":"f185509b6fd7311d","type":"json","z":"dc434684164184f3","name":"toJson","property":"payload","action":"","pretty":true,"x":1250,"y":780,"wires":[["f21d613ea08e3590","7446c1cb0213acde"]]},{"id":"9360acda1b161468","type":"http request","z":"dc434684164184f3","name":"POST request","method":"GET","ret":"txt","paytoqs":"ignore","url":"http://192.168.0.14:3000/api/recognize?url=http://192.168.0.15:8123/local/ring.jpg&camera=camera.facecam","tls":"","persist":false,"proxy":"","authType":"","senderr":false,"headers":[],"x":1120,"y":880,"wires":[["0f1586ce7c4017e7"]]},{"id":"7c8ab89cab1b4956","type":"api-call-service","z":"dc434684164184f3","name":"snapshot","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"camera","service":"snapshot","areaId":[],"deviceId":[],"entityId":["camera.facecam"],"data":"{\"filename\":\"/config/www/ring.jpg\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":940,"y":880,"wires":[["9360acda1b161468"]]},{"id":"3a1df7f09ea211e4","type":"join","z":"dc434684164184f3","name":"","mode":"custom","build":"array","property":"payload.matches","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"5","count":"2","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"num","reduceFixup":"","x":1550,"y":820,"wires":[["9f56048afecabe35","ce41bc07cb1f5ec0"]]},{"id":"0f1586ce7c4017e7","type":"json","z":"dc434684164184f3","name":"toJson","property":"payload","action":"","pretty":true,"x":1270,"y":880,"wires":[["104f147483ea4de5","aa08583877f8a98d"]]},{"id":"9f56048afecabe35","type":"function","z":"dc434684164184f3","name":"Face Extractor compare 5.1","func":"// SETTINGS\nvar required_conf = 80;\n// SETTINGS\n\n\nvar recoface = new Object();\nvar recofacesortable = [];\nvar name = \"\";\nvar camera = \"\";\nvar conf = \"\";\nvar reconame = \"\";\nvar confidence = \"\";\nvar reco = \"\";\n//declarations\n\n    for (i = 0; i < msg.payload.matches.length; i++){\n         for (y = 0; y < Object.keys(msg.payload.matches[i]).length; y++){\n                var name = msg.payload.matches[i][y][0];\n \t\t\t\tvar conf = msg.payload.matches[i][y][1];\n \t\t\t\tvar camera = msg.payload.matches[i][y][2];\n \t\t\t// \tif (conf > 0){\n \t\t\t\t    recofacesortable.push([name, conf, camera]);\n \t\t\t// \t}\n \t\t\t\t\n        }\n    }\n    \n    \n     \trecofacesortable.sort(function(a, b) {\n \t\treturn a[1] - b[1];\n \t}).reverse();\n \t\n    for (i = 0; i < recofacesortable.length; i++){\n        var reconame = recofacesortable[0][0];\n        var confidence = recofacesortable[0][1]\n        var camera = recofacesortable[0][2]\n        \n        \n    }\n\n\n\nif (confidence > required_conf) {\n\tvar recognized = 1;\n} else {\n\tvar recognized = 0;\n}\n\n if (camera == \"camera.front_door\"){\n     var camera = \"camera.reolink_static\";\n } else if (camera == \"camera.facecam\"){\n     var camera = \"camera.facecam_static\"\n }\n\nvar newMsg = {\n\t\"payload\": {\n\t\t\"name\": reconame,\n\t\t\"confidence\": confidence,\n\t//\t\"matched_faces\": total_matched_faces,\n\t//\t\"total_faces\": total_faces,\n\t\t\"recognized\": recognized,\n \t\t\"camera\": camera \n\t}\n};\n\nreturn newMsg;\n\n\n//  var test = {\n//  \t\"payload\": {\n// \t\t\"name\": reconame,\n// \t\t\"confidence\": confidence,\n// \t\t\"matched_faces\": total_matched_faces,\n// \t\t\"total_faces\": total_faces,\n// \t\t\"recognized\": recognized,\n// \t\t\"camera\": camera ,\n// \t\t\"recofacesortable\": recofacesortable\n//  \t}\n//  };\n//  return test;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1760,"y":820,"wires":[["4185710a31385ab9","cc7516bbde4f135b"]]},{"id":"7446c1cb0213acde","type":"debug","z":"dc434684164184f3","name":"post1","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1390,"y":700,"wires":[]},{"id":"aa08583877f8a98d","type":"debug","z":"dc434684164184f3","name":"post2","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1510,"y":920,"wires":[]},{"id":"ce41bc07cb1f5ec0","type":"debug","z":"dc434684164184f3","name":"tojson","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1570,"y":740,"wires":[]},{"id":"3fa7103aee25b943","type":"inject","z":"dc434684164184f3","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1820,"y":1040,"wires":[["73d5a5506a43fcd1"]]},{"id":"f21d613ea08e3590","type":"function","z":"dc434684164184f3","name":"cam set","func":"// SETTINGS\nvar required_conf = 75;\n// SETTINGS\n\n\nvar recoface = new Object();\nvar recofacesortable = [];\nvar name = \"\";\nvar camera = \"camera.front_door\";\nvar conf = \"\";\nvar reconame = \"\";\nvar confidence = \"\";\nvar reco = \"\";\n//declarations\n\n    for (i = 0; i < msg.payload.matches.length; i++){\n\n                var name = msg.payload.matches[i].name;\n \t\t\t\tvar conf = msg.payload.matches[i].confidence;\n \t\t\t// \tif (conf > 0){\n \t\t\t\t    recofacesortable.push([name, conf, camera]);\n \t\t\t// \t}\n \t\t\t\t\n        \n    }\n\nif (typeof msg.payload.unknown!==\"undefined\"){\n    recofacesortable.push([\"Unknown\", \"0\", camera]);\n}\n    \n    \n//      \trecofacesortable.sort(function(a, b) {\n//  \t\treturn a[1] - b[1];\n//  \t}).reverse();\n \t\n//     for (i = 0; i < recofacesortable.length; i++){\n//         var reconame = recofacesortable[0][0];\n//         var confidence = recofacesortable[0][1]\n//         var camera = recofacesortable[0][2]\n        \n        \n//     }\n\n\n\n// if (confidence > required_conf) {\n// \tvar recognized = 1;\n// } else {\n// \tvar recognized = 0;\n// }\n\n// if (camera == \"face_counter_reolink\"){\n//     var camera = \"camera.reolink_static\";\n// } else if (camera == \"face_counter_facecam\"){\n//     var camera = \"camera.facecam_static\"\n// }\n\n// var newMsg = {\n// \t\"payload\": {\n// \t\t\"name\": reconame,\n// \t\t\"confidence\": confidence,\n// \t\t\"recognized\": recognized,\n//  \t\t\"camera\": camera \n// \t}\n// };\n\n//return newMsg;\n\n\n  var test = {\n   \t\"payload\":  {\n\t\t\"matches\": recofacesortable,\n// //  \t\t\"confidence\": confidence,\n// //  \t\t\"recognized\": recognized,\n// //  \t\t\"camera\": camera ,\n// //  \t\t\"recofacesortable\": recofacesortable\n   \t}\n  };\n  return test;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1400,"y":800,"wires":[["3a1df7f09ea211e4","7446c1cb0213acde"]]},{"id":"104f147483ea4de5","type":"function","z":"dc434684164184f3","name":"cam set","func":"// SETTINGS\nvar required_conf = 75;\n// SETTINGS\n\n\nvar recoface = new Object();\nvar recofacesortable = [];\nvar name = \"\";\nvar camera = \"camera.facecam\";\nvar conf = \"\";\nvar reconame = \"\";\nvar confidence = \"\";\nvar reco = \"\";\n//declarations\n\n    for (i = 0; i < msg.payload.matches.length; i++){\n\n                var name = msg.payload.matches[i].name;\n \t\t\t\tvar conf = msg.payload.matches[i].confidence;\n \t\t\t// \tif (conf > 0){\n \t\t\t\t    recofacesortable.push([name, conf, camera]);\n \t\t\t// \t}\n \t\t\t\t\n        \n    }\n\nif (typeof msg.payload.unknown!==\"undefined\"){\n    recofacesortable.push([\"Unknown\", \"0\", camera]);\n}\n    \n    \n//      \trecofacesortable.sort(function(a, b) {\n//  \t\treturn a[1] - b[1];\n//  \t}).reverse();\n \t\n//     for (i = 0; i < recofacesortable.length; i++){\n//         var reconame = recofacesortable[0][0];\n//         var confidence = recofacesortable[0][1]\n//         var camera = recofacesortable[0][2]\n        \n        \n//     }\n\n\n\n// if (confidence > required_conf) {\n// \tvar recognized = 1;\n// } else {\n// \tvar recognized = 0;\n// }\n\n// if (camera == \"face_counter_reolink\"){\n//     var camera = \"camera.reolink_static\";\n// } else if (camera == \"face_counter_facecam\"){\n//     var camera = \"camera.facecam_static\"\n// }\n\n// var newMsg = {\n// \t\"payload\": {\n// \t\t\"name\": reconame,\n// \t\t\"confidence\": confidence,\n// \t\t\"recognized\": recognized,\n//  \t\t\"camera\": camera \n// \t}\n// };\n\n//return newMsg;\n\n\n  var test = {\n   \t\"payload\":  {\n\t\t\"matches\": recofacesortable,\n// //  \t\t\"confidence\": confidence,\n// //  \t\t\"recognized\": recognized,\n// //  \t\t\"camera\": camera ,\n// //  \t\t\"recofacesortable\": recofacesortable\n   \t}\n  };\n  return test;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1400,"y":840,"wires":[["3a1df7f09ea211e4","aa08583877f8a98d"]]},{"id":"fac725887b00c8f5","type":"debug","z":"dc434684164184f3","name":"actionable","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2210,"y":280,"wires":[]},{"id":"1837bd252cf0b8b2","type":"http request","z":"dc434684164184f3","name":"POST request","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":2700,"y":420,"wires":[["2cf12fb174beb029","3e6de3c6f5cb0f17"]]},{"id":"2620e3257d6fa84d","type":"function","z":"dc434684164184f3","name":"Javascript","func":"var d = new Date();\nvar h = d.getHours();\nvar m = d.getMinutes();\nvar s = d.getSeconds();\nvar camera = msg.payload.camera;\nvar confidence = 0;\n\nif (typeof msg.payload.confidence !==\"undefined\"){\nvar confidence = msg.payload.confidence;\n}\n\n\nvar who = msg.payload.name;\n\n\n\n\n\nvar newMsg = {\n    \"payload\": {\n        \"name\": who,\n        \"data\": {\n            \"filename\":\"/config/double-take/\" + who.toLowerCase() +  \"/\" + who + \"_\" + camera + \"_\" + h + m + s + \"_\" + confidence + \".jpg\",\n            \"entity_id\": camera\n        }\n    }\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3340,"y":640,"wires":[["d21500d7b53cd67a"]]},{"id":"d21500d7b53cd67a","type":"api-call-service","z":"dc434684164184f3","name":"snapshot","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"camera","service":"snapshot","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload666","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":3520,"y":640,"wires":[[]]},{"id":"ac6262324beb2749","type":"function","z":"dc434684164184f3","name":"Javascript","func":"var d = new Date();\nvar h = d.getHours();\nvar m = d.getMinutes();\nvar s = d.getSeconds();\n\nvar confidence = 0;\nif (typeof msg.payload.confidence !==\"undefined\"){\nvar confidence = msg.payload.confidence;\n}\n\n\nvar who = msg.payload.event.reply_text.toLowerCase().replace(\" \",\"\");\nvar replacestring = \"https://hass.purgatoire.ca/local/portraits/\" + who.toLowerCase();\nvar replacestring1 = msg.payload.event.image.replace(replacestring);\nvar replacestring2 = replacestring1.split(\"-\");\nvar camera = replacestring2[1];\n\n\n\n\nvar newMsg = {\n    \"image\": msg.payload.event.image,\n    \"payload\": {\n        \"name\": who,\n        \"data\": {\n            \"filename\":\"/config/double-take/\" + who +  \"/\" + camera + \"_\" + h + m + s + \"_\" + confidence + \".jpg\",\n            \"entity_id\": camera,\n            // \"1\": replacestring,\n            // \"2\": replacestring1,\n            // \"3\": replacestring2\n        }\n    }\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2060,"y":520,"wires":[["daa9cae4d006c055","febfacf98e14230f"]]},{"id":"914d208ac8e90c6b","type":"api-call-service","z":"dc434684164184f3","name":"snapshot","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"camera","service":"snapshot","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload666","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2440,"y":520,"wires":[["a55fc2865d50ea0f","b3c65ffba062ab08"]]},{"id":"a55fc2865d50ea0f","type":"debug","z":"dc434684164184f3","name":"result of snapchot","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2610,"y":540,"wires":[]},{"id":"32fd5b7cc87fce18","type":"function","z":"dc434684164184f3","name":"Javascript","func":"var d = new Date();\nvar h = d.getHours();\nvar m = d.getMinutes();\nvar s = d.getSeconds();\nvar camera = msg.payload.camera;\nvar confidence = 0;\n\nif (typeof msg.payload.confidence !==\"undefined\"){\nvar confidence = msg.payload.confidence;\n}\n\nvar who = \"Unknown\";\nif (typeof msg.payload.name !==\"undefined\"){\nvar who = msg.payload.name;\n}\n\n\n\n\nvar newMsg = {\n    \"payload\": {\n        \"name\": who,\n        \"data\": {\n            \"filename\":\"/config/www/portraits/\" + who + \"/\" + who + \"-\" + camera + \"-\" + h + m + s + \"-\" + confidence + \".jpg\",\n            \"entity_id\": camera\n        }\n    }\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2720,"y":920,"wires":[["777be68bc82d9798"]]},{"id":"777be68bc82d9798","type":"api-call-service","z":"dc434684164184f3","name":"snapshot","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"camera","service":"snapshot","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload666","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2900,"y":920,"wires":[["a92451862222ae6a"]]},{"id":"11ade2d568b39f66","type":"api-call-service","z":"dc434684164184f3","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"notify","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3260,"y":920,"wires":[[]]},{"id":"a92451862222ae6a","type":"function","z":"dc434684164184f3","name":"Javascript","func":"var d = new Date();\nvar name = msg.payload.name;\nvar m = d.getMilliseconds();\nvar snapshot = msg.payload.data.filename;\nvar url = \"http://192.168.0.12:8765/picture/8/current/?\" + m;\n\nvar snapshot = snapshot.replace(\"\\/config\\/www\",\"https:\\/\\/hass.purgatoire.ca\\/local\");\n\n\nvar newMsg = {\n\t\"payload\": {\n\t\t\"data\": {\n\t\t\t\"message\": \"Doorbell Alert\",\n\t\t\t\"title\": name + \" is at the door\",\n\t\t\t\"data\": {\n\t\t\t\t\"image\": snapshot,\n\t\t\t\t\"actions\": [{\n\t\t\t\t\t\t\"action\": \"REPLY\",\n\t\t\t\t\t\t\"title\": \"Who is this?\"\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"action\": \"unlock_door\",\n\t\t\t\t\t\t\"title\": \"Unlock The Door\"\n\t\t\t\t\t}\n\n\t\t\t\t]\n\t\t\t}\n\t\t}\n\t}\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3080,"y":920,"wires":[["11ade2d568b39f66","18292d736069ab1a"]]},{"id":"18292d736069ab1a","type":"change","z":"dc434684164184f3","name":"Set Data for mass alert","rules":[{"t":"set","p":"message","pt":"msg","to":"payload.data.title","tot":"msg"},{"t":"set","p":"color_value","pt":"msg","to":"[0,0,255]","tot":"json"},{"t":"set","p":"dbrigthness","pt":"msg","to":"100","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":3240,"y":860,"wires":[["07dc8ff772761239"]]},{"id":"621cf8c7437be5fe","type":"link out","z":"dc434684164184f3","name":"Light and Speakers","links":["45904ca6429d867d","ad88dbd2.4726b8","3405e943.fd3ee6","9cf42cf7ef60f645"],"x":3275,"y":1180,"wires":[]},{"id":"49d8d5ab57bc2780","type":"function","z":"dc434684164184f3","name":"Set Path","func":"var d = new Date();\nvar m = d.getMilliseconds();\nvar url = \"http://192.168.0.12:8765/picture/8/current/?\"+m;\nvar newMsg = \n\n{ \n    \"payload\": {\n                data: {\n    \"media_content_id\": url,\n    \"media_content_type\": \"image/jpg\"\n                      }\n                }         \n};\nreturn newMsg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2540,"y":1260,"wires":[["25416eae7693a8e4"]]},{"id":"25416eae7693a8e4","type":"subflow:eb3b6592c8406c0d","z":"dc434684164184f3","name":"","env":[],"x":2710,"y":1260,"wires":[]},{"id":"8b7cf867e5dd6af0","type":"trigger","z":"dc434684164184f3","name":"Face Not reco","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"1","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2240,"y":1100,"wires":[["49d8d5ab57bc2780","32980352dae1ed87","a9477e0fd3c6f536"]]},{"id":"32980352dae1ed87","type":"debug","z":"dc434684164184f3","name":"face not reco","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2590,"y":1200,"wires":[]},{"id":"a9477e0fd3c6f536","type":"function","z":"dc434684164184f3","name":"Javascript","func":"var d = new Date();\nvar h = d.getHours();\nvar m = d.getMinutes();\nvar s = d.getSeconds();\nvar camera = msg.payload.camera;\nvar confidence = 0;\n\nif (typeof msg.payload.confidence !==\"undefined\"){\nvar confidence = msg.payload.confidence;\n}\n\nvar who = \"Unknown\";\nif (typeof msg.payload.name !==\"undefined\"){\nvar who = msg.payload.name;\n}\n\n\n\n\nvar newMsg = {\n    \"payload\": {\n        \"name\": who,\n        \"data\": {\n            \"filename\":\"/config/www/portraits/\" + who + \"/\" + who + \"-\" + camera + \"-\" + h + m + s + \"-\" + confidence + \".jpg\",\n            \"entity_id\": camera\n        }\n    }\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2540,"y":1300,"wires":[["69902b6ab60ec2ea"]]},{"id":"69902b6ab60ec2ea","type":"api-call-service","z":"dc434684164184f3","name":"snapshot","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"camera","service":"snapshot","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload666","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2720,"y":1300,"wires":[["8a45cac1cf815583"]]},{"id":"fd6cc49b9bc3415b","type":"api-call-service","z":"dc434684164184f3","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"notify","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3080,"y":1300,"wires":[[]]},{"id":"8a45cac1cf815583","type":"function","z":"dc434684164184f3","name":"Javascript","func":"var d = new Date();\nvar name = msg.payload.name;\nvar m = d.getMilliseconds();\nvar snapshot = msg.payload.data.filename;\nvar url = \"http://192.168.0.12:8765/picture/8/current/?\" + m;\n\nvar snapshot = snapshot.replace(\"\\/config\\/www\",\"https:\\/\\/hass.purgatoire.ca\\/local\");\n\n\nvar newMsg = {\n\t\"payload\": {\n\t\t\"data\": {\n\t\t\t\"message\": \"Doorbell Alert\",\n\t\t\t\"title\": \"Someone is at the door\",\n\t\t\t\"data\": {\n\t\t\t\t\"image\": snapshot,\n\t\t\t\t\"actions\": [{\n\t\t\t\t\t\t\"action\": \"REPLY\",\n\t\t\t\t\t\t\"title\": \"Who is this?\"\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"action\": \"unlock_door\",\n\t\t\t\t\t\t\"title\": \"Unlock The Door\"\n\t\t\t\t\t}\n\n\t\t\t\t]\n\t\t\t}\n\t\t}\n\t}\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2880,"y":1300,"wires":[["fd6cc49b9bc3415b","6fed897f15a1b7df"]]},{"id":"6fed897f15a1b7df","type":"change","z":"dc434684164184f3","name":"Set Data for mass alert","rules":[{"t":"set","p":"message","pt":"msg","to":"payload.data.title","tot":"msg"},{"t":"set","p":"color_value","pt":"msg","to":"[0,0,255]","tot":"json"},{"t":"set","p":"dbrigthness","pt":"msg","to":"100","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":3080,"y":1340,"wires":[["a6b24fae2a2006c2"]]},{"id":"a6b24fae2a2006c2","type":"link out","z":"dc434684164184f3","name":"Light and Speakers","links":["45904ca6429d867d","ad88dbd2.4726b8","3405e943.fd3ee6","9cf42cf7ef60f645"],"x":3215,"y":1340,"wires":[]},{"id":"da2860a614a49ff1","type":"api-current-state","z":"dc434684164184f3","name":"uber","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.waiting_uber","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"partyon","propertyType":"msg","value":"","valueType":"entityState"},{"property":"partydata","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":2270,"y":800,"wires":[["ca373eccc666f38c"],["a4e503149ac458a8"]]},{"id":"2830e93ceb0cef1f","type":"switch","z":"dc434684164184f3","name":"","property":"payload.name","propertyType":"msg","rules":[{"t":"nempty"},{"t":"eq","v":"","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":2090,"y":1000,"wires":[["8b7cf867e5dd6af0"],["b2a60458583628a1"]]},{"id":"febfacf98e14230f","type":"switch","z":"dc434684164184f3","name":"Recod Faces 1/0","property":"payload.data.entity_id","propertyType":"msg","rules":[{"t":"eq","v":"camera.facecam_static","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":2270,"y":520,"wires":[["914d208ac8e90c6b"]]},{"id":"869e08ac92dc847d","type":"api-call-service","z":"dc434684164184f3","name":"unLock Door","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"lock","service":"unlock","areaId":[],"deviceId":[],"entityId":["lock.front_door"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3650,"y":900,"wires":[["e2e0e39a2bb3932e","db63be43a45de51e"]]},{"id":"db63be43a45de51e","type":"api-current-state","z":"dc434684164184f3","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"unlocked","halt_if_type":"str","halt_if_compare":"is","entity_id":"lock.front_door","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":3640,"y":840,"wires":[["b499a1d86fc0a256"],["869e08ac92dc847d"]]},{"id":"ff28ced5802c6663","type":"inject","z":"dc434684164184f3","name":"scan","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"date","x":2910,"y":1220,"wires":[["a19802bc53c3e698"]]},{"id":"a19802bc53c3e698","type":"change","z":"dc434684164184f3","name":"Set Data for mass alert","rules":[{"t":"set","p":"message","pt":"msg","to":"PSA, THIS IS A TEST, DO NOT REACT TO THIS, IT IS A TEST.","tot":"str"},{"t":"set","p":"color_value","pt":"msg","to":"[0,0,255]","tot":"json"},{"t":"set","p":"dbrigthness","pt":"msg","to":"100","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":3100,"y":1220,"wires":[["621cf8c7437be5fe"]]},{"id":"29e077a48ee59080","type":"delay","z":"dc434684164184f3","name":"Waiting someone","pauseType":"delay","timeout":"1","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":2990,"y":800,"wires":[["d111259afef6d892","a9bdbe5fe49d2b6e","8c06e0a3aebde655","869e08ac92dc847d"]]},{"id":"89af71618b9c0faa","type":"api-current-state","z":"dc434684164184f3","name":"Front House Motion","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.motion_front","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"partyon","propertyType":"msg","value":"","valueType":"entityState"},{"property":"partydata","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":2770,"y":800,"wires":[["29e077a48ee59080"],["06d4b8e6ac09e9b5"]]},{"id":"5c3a07277166a802","type":"change","z":"dc434684164184f3","name":"reset","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2030,"y":1240,"wires":[["a4be2cbfac620b45","d6527d9b31a67e2b","620dc7e41c123988","39ca8227b74fd49d"]]},{"id":"a4be2cbfac620b45","type":"function","z":"dc434684164184f3","name":"Set Path","func":"var d = new Date();\nvar m = d.getMilliseconds();\nvar url = \"http://192.168.0.12:8765/picture/8/current/?\"+m;\nvar newMsg = \n\n{ \n    \"payload\": {\n                data: {\n    \"media_content_id\": url,\n    \"media_content_type\": \"image/jpg\"\n                      }\n                }         \n};\nreturn newMsg;\n\n","outputs":1,"noerr":0,"x":2200,"y":1260,"wires":[["37c7747a6e0b9586"]]},{"id":"d6527d9b31a67e2b","type":"function","z":"dc434684164184f3","name":"Javascript","func":"var recoface = [];\nvar facestring = \"\"\nvar d = new Date();\nvar m = d.getMilliseconds();\nvar url = \"https://hass.purgatoire.ca/local/ring.jpg?\" + m;\nvar facestring = msg.payload;\n\nvar newMsg = {\n \"payload\": {\n  \"data\": {\n  \"message\": \"Someone is at the door\",\n  \"data\": {\n    \"image\": url,\n    \"actions\": [\n      {\n        \"action\": \"unlock_door\",\n        \"title\": \"Unlock The Door\"\n      }\n                \n    ]\n  }\n}\n }\n};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2200,"y":1220,"wires":[["e7e97761c64767e9"]]},{"id":"37c7747a6e0b9586","type":"subflow:eb3b6592c8406c0d","z":"dc434684164184f3","name":"","env":[],"x":2370,"y":1260,"wires":[]},{"id":"e7e97761c64767e9","type":"api-call-service","z":"dc434684164184f3","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"notify","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2380,"y":1220,"wires":[[]]},{"id":"b2a60458583628a1","type":"trigger","z":"dc434684164184f3","name":"No Face","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"1","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2020,"y":1120,"wires":[["5c3a07277166a802"]]},{"id":"620dc7e41c123988","type":"change","z":"dc434684164184f3","name":"Set Data for mass alert","rules":[{"t":"set","p":"color_value","pt":"msg","to":"[0,0,255]","tot":"json"},{"t":"set","p":"dbrigthness","pt":"msg","to":"100","tot":"num"},{"t":"set","p":"message","pt":"msg","to":"Someone is at the door","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2240,"y":1300,"wires":[["691a7adae76a461c"]]},{"id":"691a7adae76a461c","type":"link out","z":"dc434684164184f3","name":"Light and Speakers","links":["45904ca6429d867d","ad88dbd2.4726b8","3405e943.fd3ee6","9cf42cf7ef60f645"],"x":2375,"y":1300,"wires":[]},{"id":"39ca8227b74fd49d","type":"debug","z":"dc434684164184f3","name":"result before notif","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2190,"y":1160,"wires":[]},{"id":"d56d0261de5b568d","type":"delay","z":"dc434684164184f3","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":400,"y":840,"wires":[["fcbc2284bd9e9322"]]},{"id":"bf36421868181d87","type":"switch","z":"dc434684164184f3","name":"","property":"payload.event.action_1_title","propertyType":"msg","rules":[{"t":"eq","v":"Who is this?","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1950,"y":460,"wires":[["ac6262324beb2749","daa9cae4d006c055"]]},{"id":"07dc8ff772761239","type":"link out","z":"dc434684164184f3","name":"Light and Speakers","links":["45904ca6429d867d","ad88dbd2.4726b8","3405e943.fd3ee6","9cf42cf7ef60f645"],"x":3375,"y":860,"wires":[]},{"id":"2514a98f5322706e","type":"subflow:eb3b6592c8406c0d","z":"dc434684164184f3","name":"","env":[],"x":2990,"y":1020,"wires":[]},{"id":"a4e503149ac458a8","type":"trigger","z":"dc434684164184f3","name":"Uber","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"1","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2310,"y":1040,"wires":[["5a39e063f81f4934","ca181274192ce702"]]},{"id":"5a39e063f81f4934","type":"function","z":"dc434684164184f3","name":"Javascript","func":"var d = new Date();\nvar h = d.getHours();\nvar m = d.getMinutes();\nvar s = d.getSeconds();\nvar camera = msg.payload.camera;\nvar confidence = 0;\n\nif (typeof msg.payload.confidence !==\"undefined\"){\nvar confidence = msg.payload.confidence;\n}\n\nvar who = \"Unknown\";\nif (typeof msg.payload.name !==\"undefined\"){\nvar who = msg.payload.name;\n}\n\n\n\n\nvar newMsg = {\n    \"payload\": {\n        \"name\": who,\n        \"data\": {\n            \"filename\":\"/config/www/portraits/\" + who + \"/\" + who + \"-\" + camera + \"-\" + h + m + s + \"-\" + confidence + \".jpg\",\n            \"entity_id\": camera\n        }\n    }\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2500,"y":1060,"wires":[["0622a15703bbaff4"]]},{"id":"0622a15703bbaff4","type":"api-call-service","z":"dc434684164184f3","name":"snapshot","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"camera","service":"snapshot","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload666","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2960,"y":1060,"wires":[["11a0719ba4e2269b"]]},{"id":"ec801c1b335a58de","type":"api-call-service","z":"dc434684164184f3","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"notify","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3280,"y":1060,"wires":[[]]},{"id":"11a0719ba4e2269b","type":"function","z":"dc434684164184f3","name":"Javascript","func":"var d = new Date();\nvar name = msg.payload.name;\nvar m = d.getMilliseconds();\nvar snapshot = msg.payload.data.filename;\nvar url = \"http://192.168.0.12:8765/picture/8/current/?\" + m;\n\nvar snapshot = snapshot.replace(\"\\/config\\/www\",\"https:\\/\\/hass.purgatoire.ca\\/local\");\n\n\nvar newMsg = {\n\t\"payload\": {\n\t\t\"data\": {\n\t\t\t\"message\": \"Doorbell Alert\",\n\t\t\t\"title\": name + \" is at the door\",\n\t\t\t\"data\": {\n\t\t\t\t\"image\": snapshot,\n\t\t\t\t\"actions\": [{\n\t\t\t\t\t\t\"action\": \"REPLY\",\n\t\t\t\t\t\t\"title\": \"Who is this?\"\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"action\": \"unlock_door\",\n\t\t\t\t\t\t\"title\": \"Unlock The Door\"\n\t\t\t\t\t}\n\n\t\t\t\t]\n\t\t\t}\n\t\t}\n\t}\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3100,"y":1060,"wires":[["ec801c1b335a58de","601dd7a48a2a870b"]]},{"id":"601dd7a48a2a870b","type":"change","z":"dc434684164184f3","name":"Set Data for mass alert","rules":[{"t":"set","p":"message","pt":"msg","to":"payload.data.title","tot":"msg"},{"t":"set","p":"color_value","pt":"msg","to":"[0,0,255]","tot":"json"},{"t":"set","p":"dbrigthness","pt":"msg","to":"100","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":3220,"y":1020,"wires":[["7a91de5bae6af973"]]},{"id":"7a91de5bae6af973","type":"link out","z":"dc434684164184f3","name":"Light and Speakers","links":["45904ca6429d867d","ad88dbd2.4726b8","3405e943.fd3ee6","9cf42cf7ef60f645"],"x":3355,"y":1020,"wires":[]},{"id":"1e4ae4a2670f5fb5","type":"function","z":"dc434684164184f3","name":"Set Path","func":"var d = new Date();\nvar m = d.getMilliseconds();\nvar url = \"http://192.168.0.12:8765/picture/4/current/?\"+m;\nvar newMsg = \n\n{ \n    \"payload\": {\n                data: {\n    \"media_content_id\": url,\n    \"media_content_type\": \"image/jpg\"\n                      }\n                }         \n};\nreturn newMsg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2760,"y":1020,"wires":[["2514a98f5322706e"]]},{"id":"ca181274192ce702","type":"api-call-service","z":"dc434684164184f3","name":"to package","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"script","service":"ptz_to_package","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload666","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2470,"y":1020,"wires":[["df6ec4f40fef1842"]]},{"id":"df6ec4f40fef1842","type":"delay","z":"dc434684164184f3","name":"","pauseType":"delay","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":2620,"y":1020,"wires":[["1e4ae4a2670f5fb5"]]},{"id":"f7538e3f710d210e","type":"switch","z":"904d418a12e6a4b0","name":"click","property":"payload.event.command","propertyType":"msg","rules":[{"t":"regex","v":"click","vt":"str","case":true}],"checkall":"true","repair":false,"outputs":1,"x":190,"y":800,"wires":[["626d390b494bc86d","1cf2d343db1c089e","b07092e47615b45f"]]},{"id":"1fe47840b92e7438","type":"server-events","z":"904d418a12e6a4b0","name":"Ringer","server":"7ab5c227.a3ce8c","version":2,"eventType":"zha_event","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"waitForRunning":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"},{"property":"event_type","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"}],"x":50,"y":800,"wires":[["f7538e3f710d210e"]]},{"id":"23685ea64ad822fc","type":"trigger","z":"904d418a12e6a4b0","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"45","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":850,"y":780,"wires":[["150cd5e00c84aade","acdb4cbe807a4670","f3c7ce0f95a036c8"]]},{"id":"150cd5e00c84aade","type":"trigger","z":"904d418a12e6a4b0","name":"Snapshots","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"1","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1030,"y":780,"wires":[["90f8b95437a6b15f","1e8f53f8970447d0"]]},{"id":"11239223a67ab481","type":"inject","z":"904d418a12e6a4b0","name":"scan","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"date","x":1310,"y":740,"wires":[["1e8f53f8970447d0","90f8b95437a6b15f"]]},{"id":"0f1732762ac40879","type":"switch","z":"904d418a12e6a4b0","name":"Recod Faces 1/0","property":"payload.recognized","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":2230,"y":740,"wires":[["e458126bd5641b2e"],["7013d7b5775bf756"]]},{"id":"725592b772d2f831","type":"api-current-state","z":"904d418a12e6a4b0","name":"party on?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.party_mode","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"partyon","propertyType":"msg","value":"","valueType":"entityState"},{"property":"partydata","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":2660,"y":720,"wires":[["1ab167e6d548ddec"],["bfa891ca7c805714"]]},{"id":"de700ffb416bffb9","type":"change","z":"904d418a12e6a4b0","name":"reset","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":3630,"y":280,"wires":[["f0ab80a27fc67e71"]]},{"id":"d3a54796c0c96850","type":"function","z":"904d418a12e6a4b0","name":"Name Payload","func":"var name = msg.payload.name;\n\nvar newMsg = {\n    \"payload\": {\n        \"data\": {\n            \"value\": name\n        }}};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3700,"y":440,"wires":[["df56ee8f0c6bb231"]]},{"id":"bfa891ca7c805714","type":"api-current-state","z":"904d418a12e6a4b0","name":"Waiting Friend?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.waiting_someone","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"partyon","propertyType":"msg","value":"","valueType":"entityState"},{"property":"partydata","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":2700,"y":760,"wires":[["1ab167e6d548ddec"],["67d7a5e70c4f1173"]]},{"id":"df56ee8f0c6bb231","type":"api-call-service","z":"904d418a12e6a4b0","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"input_text","service":"set_value","areaId":[],"deviceId":[],"entityId":["input_text.recognized_face"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3930,"y":440,"wires":[[]]},{"id":"700116e39062929e","type":"api-call-service","z":"904d418a12e6a4b0","name":"toggle boolean","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_on","areaId":[],"deviceId":[],"entityId":["input_boolean.face_recognized"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4160,"y":320,"wires":[["aad8dfcf35a5f778"]]},{"id":"7caca54b79a292ef","type":"ha-wait-until","z":"904d418a12e6a4b0","name":"","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"binary_sensor.door_front_outside","entityIdFilterType":"exact","property":"state","comparator":"is","value":"on","valueType":"str","timeout":"30","timeoutType":"num","timeoutUnits":"seconds","checkCurrentState":true,"blockInputOverrides":true,"outputProperties":[],"x":4540,"y":300,"wires":[["e0c4c89638370ea1"],["e0c4c89638370ea1"]]},{"id":"e0c4c89638370ea1","type":"api-call-service","z":"904d418a12e6a4b0","name":"toggle boolean","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.waiting_someone"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4420,"y":380,"wires":[["4826327855dea551"]]},{"id":"4826327855dea551","type":"api-call-service","z":"904d418a12e6a4b0","name":"toggle boolean","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.face_recognized"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4520,"y":420,"wires":[["9df4fb50cafcd327"]]},{"id":"9df4fb50cafcd327","type":"function","z":"904d418a12e6a4b0","name":"Name Payload","func":"var newMsg = {\n    \"payload\": {\n        \"data\": {\n            \"value\": \"UNKNOWN\"\n        }}};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4660,"y":360,"wires":[["20814234fdc77097"]]},{"id":"20814234fdc77097","type":"api-call-service","z":"904d418a12e6a4b0","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"input_text","service":"set_value","areaId":[],"deviceId":[],"entityId":["input_text.recognized_face"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4870,"y":360,"wires":[[]]},{"id":"ba44446730be7bf1","type":"debug","z":"904d418a12e6a4b0","name":"Compare","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2140,"y":580,"wires":[]},{"id":"088cb81fd7b1e783","type":"debug","z":"904d418a12e6a4b0","name":"unlock","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":4070,"y":380,"wires":[]},{"id":"67d7a5e70c4f1173","type":"trigger","z":"904d418a12e6a4b0","name":"Not waiting","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"1","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2790,"y":820,"wires":[["7546d4fa774773c7","e139f44c71b58e6e"]]},{"id":"3629533536809995","type":"change","z":"904d418a12e6a4b0","name":"reset","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2190,"y":1440,"wires":[["7e47c931d199b580","b265d8c4006cbefb","2a283d05b6b10ba0","0361e9a0a13608d3"]]},{"id":"7e47c931d199b580","type":"function","z":"904d418a12e6a4b0","name":"Javascript","func":"var recoface = [];\nvar facestring = \"\"\nvar d = new Date();\nvar m = d.getMilliseconds();\nvar url = \"https://hass.purgatoire.ca/local/ring.jpg?\" + m;\nvar facestring = msg.payload;\n\nvar newMsg = {\n \"payload\": {\n  \"data\": {\n  \"message\": \"Someone is at the door but system crashed\",\n  \"data\": {\n    \"image\": url,\n    \"actions\": [\n      {\n        \"action\": \"unlock_door\",\n        \"title\": \"Unlock The Door\"\n      }\n                \n    ]\n  }\n}\n }\n};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2440,"y":1400,"wires":[["d4a93a044d2c8587"]]},{"id":"d4a93a044d2c8587","type":"api-call-service","z":"904d418a12e6a4b0","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"notify","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2620,"y":1400,"wires":[[]]},{"id":"8737b486a882091c","type":"trigger","z":"904d418a12e6a4b0","name":"Crash","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"1","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2070,"y":1420,"wires":[["3629533536809995"]]},{"id":"b265d8c4006cbefb","type":"change","z":"904d418a12e6a4b0","name":"Set Data for mass alert","rules":[{"t":"set","p":"color_value","pt":"msg","to":"[0,0,255]","tot":"json"},{"t":"set","p":"dbrigthness","pt":"msg","to":"100","tot":"num"},{"t":"set","p":"message","pt":"msg","to":"Someone is at the door","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2480,"y":1480,"wires":[["9ad961f55f0e53d5"]]},{"id":"9ad961f55f0e53d5","type":"link out","z":"904d418a12e6a4b0","name":"Light and Speakers","links":["45904ca6429d867d","ad88dbd2.4726b8","3405e943.fd3ee6","9cf42cf7ef60f645"],"x":2615,"y":1480,"wires":[]},{"id":"4ccc71fe76626676","type":"catch","z":"904d418a12e6a4b0","name":"","scope":["06ef254284bf7af3","1e8f53f8970447d0"],"uncaught":false,"x":1930,"y":1380,"wires":[["8737b486a882091c"]]},{"id":"f77a07bb408cd716","type":"function","z":"904d418a12e6a4b0","name":"Javascript","func":"var d = new Date();\nvar m = d.getMilliseconds();\nvar url = msg.image;\n\nvar url = url.replace(\"https:\\/\\/hass.purgatoire.ca\\/local\", \"\\/config\\/www\");\n\nvar newMsg = {\n \"name\": msg.payload.name,\n \"url\": \"http://192.168.0.14:3000/api/train/retrain/\" + msg.payload.name.toLowerCase(),\n \"data\":{\n    \"data\":{\n\t\"file_path\": url,\n\t\"name\": msg.payload.name.toLowerCase(),\n\t\"url\": \"http://192.168.0.14:3000/api/train/retrain/\" + msg.payload.name.toLowerCase()\n}}\n};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1720,"y":220,"wires":[["243b96d7cdc5d440","50d9fa7e7c3800e4"]]},{"id":"694f1010c55e9e17","type":"server-events","z":"904d418a12e6a4b0","name":"","server":"7ab5c227.a3ce8c","version":2,"eventType":"mobile_app_notification_action","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"waitForRunning":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"},{"property":"event_type","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"}],"x":950,"y":200,"wires":[["901b9e8cae5d66bb","6a2c4537d58a5c2f"]]},{"id":"243b96d7cdc5d440","type":"debug","z":"904d418a12e6a4b0","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1990,"y":140,"wires":[]},{"id":"14c699202031c457","type":"function","z":"904d418a12e6a4b0","name":"Javascript","func":"var d = new Date();\nvar m = d.getMilliseconds();\nvar url = msg.data.data.file_path;\n\n\nvar snapshot = url.replace(\"\\/config\\/www\",\"https:\\/\\/hass.purgatoire.ca\\/local\");\n\nvar newMsg = {\n \"payload\": {\n  \"data\": {\n  \"message\": \"Faces learning for\" + \" \" + msg.name,\n  \"data\": {\n    \"image\": snapshot\n  }\n}\n }\n};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2200,"y":220,"wires":[["9eb3d3bcb3053048","08a258ae4d9f51b9"]]},{"id":"9eb3d3bcb3053048","type":"api-call-service","z":"904d418a12e6a4b0","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"notify","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2420,"y":220,"wires":[["08a258ae4d9f51b9"]]},{"id":"671d15b4bb2861ae","type":"api-call-service","z":"904d418a12e6a4b0","name":"snapshot","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"camera","service":"snapshot","areaId":[],"deviceId":[],"entityId":["camera.front_door"],"data":"{\"filename\":\"/config/www/reolink.jpg\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":920,"y":380,"wires":[[]]},{"id":"19e94e7c65b85b28","type":"ha-wait-until","z":"904d418a12e6a4b0","name":"wait until facecam detect someone","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"sensor.double_take_facecam","entityIdFilterType":"exact","property":"state","comparator":"gt","value":"0","valueType":"num","timeout":"30","timeoutType":"num","timeoutUnits":"seconds","checkCurrentState":true,"blockInputOverrides":true,"outputProperties":[],"x":520,"y":660,"wires":[[],[]]},{"id":"ce3728c13dfb8720","type":"trigger","z":"904d418a12e6a4b0","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"10","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":750,"y":440,"wires":[["19e94e7c65b85b28","671d15b4bb2861ae"]]},{"id":"0df5acd3c1fad200","type":"server-state-changed","z":"904d418a12e6a4b0","name":"frigate reolink over 0","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.front_persons","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"0","halt_if_type":"num","halt_if_compare":"gt","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":210,"y":120,"wires":[[],[]]},{"id":"585381fe547bc719","type":"change","z":"904d418a12e6a4b0","name":"","rules":[{"t":"set","p":"reset","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":560,"y":500,"wires":[["ce3728c13dfb8720"]]},{"id":"e5af5b96f50720e9","type":"trigger","z":"904d418a12e6a4b0","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"1","extend":false,"units":"min","reset":"","bytopic":"all","outputs":1,"x":390,"y":500,"wires":[["585381fe547bc719"]]},{"id":"626d390b494bc86d","type":"debug","z":"904d418a12e6a4b0","name":"click","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":130,"y":640,"wires":[]},{"id":"e843854a6c48ebdb","type":"inject","z":"904d418a12e6a4b0","name":"scan","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"date","x":3730,"y":540,"wires":[["dcab6140df1dc36d"]]},{"id":"acdb4cbe807a4670","type":"api-call-service","z":"904d418a12e6a4b0","name":"toggle boolean","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_on","areaId":[],"deviceId":[],"entityId":["input_boolean.door_rang"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1120,"y":940,"wires":[["45bc0fa8d57f6768"]]},{"id":"f3c7ce0f95a036c8","type":"switch","z":"904d418a12e6a4b0","name":"double","property":"payload.event.args.click_type","propertyType":"msg","rules":[{"t":"cont","v":"double","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":950,"y":1000,"wires":[["f0e2a9aab2d39af9"]]},{"id":"45bc0fa8d57f6768","type":"trigger","z":"904d418a12e6a4b0","name":"","op1":"","op2":"1","op1type":"nul","op2type":"num","duration":"1","extend":false,"units":"min","reset":"","bytopic":"all","outputs":1,"x":1430,"y":940,"wires":[["94f6e81203f67cbb"]]},{"id":"f0e2a9aab2d39af9","type":"api-current-state","z":"904d418a12e6a4b0","name":"rang?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.door_rang","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1090,"y":1000,"wires":[["7952b48f4d8032d1"],[]]},{"id":"94f6e81203f67cbb","type":"api-call-service","z":"904d418a12e6a4b0","name":"toggle boolean","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.door_rang"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1640,"y":940,"wires":[[]]},{"id":"7952b48f4d8032d1","type":"api-call-service","z":"904d418a12e6a4b0","name":"toggle boolean","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_on","areaId":[],"deviceId":[],"entityId":["input_boolean.door_double_rang"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1260,"y":1000,"wires":[["f9569e59c0a776c6"]]},{"id":"f9569e59c0a776c6","type":"trigger","z":"904d418a12e6a4b0","name":"","op1":"","op2":"1","op1type":"nul","op2type":"num","duration":"1","extend":false,"units":"min","reset":"","bytopic":"all","outputs":1,"x":1430,"y":1000,"wires":[["81492eb48aaa8da6"]]},{"id":"81492eb48aaa8da6","type":"api-call-service","z":"904d418a12e6a4b0","name":"toggle boolean","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.door_double_rang"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1640,"y":1000,"wires":[[]]},{"id":"f99077e2dc36f112","type":"function","z":"904d418a12e6a4b0","name":"Javascript","func":"var d = new Date();\nvar h = d.getHours();\nvar m = d.getMinutes();\nvar s = d.getSeconds();\nvar camera = msg.payload.camera;\nvar confidence = 0;\n\nif (typeof msg.payload.confidence !==\"undefined\"){\nvar confidence = msg.payload.confidence;\n}\n\nvar who = \"Unknown\";\nif (typeof msg.payload.name !==\"undefined\"){\nvar who = msg.payload.name;\n}\n\n\n\n\nvar newMsg = {\n    \"payload\": {\n        \"name\": who,\n        \"data\": {\n            \"filename\":\"/config/www/portraits/\" + who + \"/\" + who + \"-\" + camera + \"-\" + h + m + s + \"-\" + confidence + \".jpg\",\n            \"entity_id\": camera\n        }\n    }\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3580,"y":600,"wires":[["7db5fd2d3aa6db7e"]]},{"id":"7db5fd2d3aa6db7e","type":"api-call-service","z":"904d418a12e6a4b0","name":"snapshot","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"camera","service":"snapshot","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload666","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":3760,"y":600,"wires":[["cdd5d0321269882c","76218d6fce436e81"]]},{"id":"cdd5d0321269882c","type":"debug","z":"904d418a12e6a4b0","name":"result of snapchot","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":4010,"y":480,"wires":[]},{"id":"eb675614f65329ab","type":"api-call-service","z":"904d418a12e6a4b0","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"notify","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4120,"y":600,"wires":[[]]},{"id":"76218d6fce436e81","type":"function","z":"904d418a12e6a4b0","name":"Javascript","func":"var d = new Date();\nvar name = msg.payload.name;\nvar m = d.getMilliseconds();\nvar snapshot = msg.payload.data.filename;\nvar url = \"http://192.168.0.12:8765/picture/8/current/?\" + m;\n\nvar snapshot = snapshot.replace(\"\\/config\\/www\",\"https:\\/\\/hass.purgatoire.ca\\/local\");\n\n\nvar newMsg = {\n\t\"payload\": {\n\t\t\"data\": {\n\t\t\t\"message\": \"Doorbell Alert\",\n\t\t\t\"title\": \"Welcoming \" + name,\n\t\t\t\"data\": {\n\t\t\t\t\"image\": snapshot,\n\t\t\t\t\"actions\": [{\n\t\t\t\t\t\t\"action\": \"REPLY\",\n\t\t\t\t\t\t\"title\": \"Who is this?\"\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"action\": \"unlock_door\",\n\t\t\t\t\t\t\"title\": \"Unlock The Door\"\n\t\t\t\t\t}\n\n\t\t\t\t]\n\t\t\t}\n\t\t}\n\t}\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3940,"y":600,"wires":[["eb675614f65329ab","f476ea5d167c3030","92a5921275fef525"]]},{"id":"f476ea5d167c3030","type":"change","z":"904d418a12e6a4b0","name":"Set Data for mass alert","rules":[{"t":"set","p":"message","pt":"msg","to":"payload.data.title","tot":"msg"},{"t":"set","p":"color_value","pt":"msg","to":"[0,0,255]","tot":"json"},{"t":"set","p":"dbrigthness","pt":"msg","to":"100","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":4120,"y":640,"wires":[["dec00629dd8d0b6f"]]},{"id":"dd50fb000b813d29","type":"debug","z":"904d418a12e6a4b0","name":"actionable","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1490,"y":200,"wires":[]},{"id":"92a5921275fef525","type":"debug","z":"904d418a12e6a4b0","name":"result before notif","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":4268.571533203125,"y":545.7142944335938,"wires":[]},{"id":"b2d3879e774d743e","type":"debug","z":"904d418a12e6a4b0","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2235.71435546875,"y":132.85714721679688,"wires":[]},{"id":"dec00629dd8d0b6f","type":"link out","z":"904d418a12e6a4b0","name":"Light and Speakers","links":["45904ca6429d867d","ad88dbd2.4726b8","3405e943.fd3ee6","9cf42cf7ef60f645"],"x":4255,"y":640,"wires":[]},{"id":"08a258ae4d9f51b9","type":"debug","z":"904d418a12e6a4b0","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2390,"y":100,"wires":[]},{"id":"82b2857a071236b8","type":"inject","z":"904d418a12e6a4b0","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payloadType":"date","x":740,"y":380,"wires":[["671d15b4bb2861ae"]]},{"id":"2a283d05b6b10ba0","type":"debug","z":"904d418a12e6a4b0","name":"result before notif","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2430,"y":1340,"wires":[]},{"id":"e458126bd5641b2e","type":"switch","z":"904d418a12e6a4b0","name":"","property":"payload.name","propertyType":"msg","rules":[{"t":"nempty"}],"checkall":"false","repair":false,"outputs":1,"x":2390,"y":720,"wires":[["93d0afd406ac15b9"]]},{"id":"1e8f53f8970447d0","type":"http request","z":"904d418a12e6a4b0","name":"POST request to catch","method":"GET","ret":"txt","paytoqs":"ignore","url":"http://192.168.0.14:3000/api/recognize?url=http://192.168.0.15:8123/local/reolink.jpg&camera=camera.front_door","tls":"","persist":false,"proxy":"","authType":"","x":1280,"y":700,"wires":[["d3f48ad47a6eca11"]]},{"id":"d3f48ad47a6eca11","type":"json","z":"904d418a12e6a4b0","name":"toJson","property":"payload","action":"","pretty":true,"x":1490,"y":700,"wires":[["7219126187207dfa","e66b54c926156cea"]]},{"id":"c0780ce38288680f","type":"http request","z":"904d418a12e6a4b0","name":"POST request","method":"GET","ret":"txt","paytoqs":"ignore","url":"http://192.168.0.14:3000/api/recognize?url=http://192.168.0.15:8123/local/ring.jpg&camera=camera.facecam","tls":"","persist":false,"proxy":"","authType":"","senderr":false,"headers":[],"x":1360,"y":800,"wires":[["2ddab611dce859bf"]]},{"id":"90f8b95437a6b15f","type":"api-call-service","z":"904d418a12e6a4b0","name":"snapshot","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"camera","service":"snapshot","areaId":[],"deviceId":[],"entityId":["camera.facecam"],"data":"{\"filename\":\"/config/www/ring.jpg\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1180,"y":800,"wires":[["c0780ce38288680f"]]},{"id":"3a4d0b43583f798d","type":"join","z":"904d418a12e6a4b0","name":"","mode":"custom","build":"array","property":"payload.matches","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"5","count":"2","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"num","reduceFixup":"","x":1790,"y":740,"wires":[["06ef254284bf7af3","1bb02d2cdc9d745c"]]},{"id":"2ddab611dce859bf","type":"json","z":"904d418a12e6a4b0","name":"toJson","property":"payload","action":"","pretty":true,"x":1510,"y":800,"wires":[["d3a5b3d7566830b1","67688ca323561b6b"]]},{"id":"06ef254284bf7af3","type":"function","z":"904d418a12e6a4b0","name":"Face Extractor compare 5.1","func":"// SETTINGS\nvar required_conf = 80;\n// SETTINGS\n\n\nvar recoface = new Object();\nvar recofacesortable = [];\nvar name = \"\";\nvar camera = \"\";\nvar conf = \"\";\nvar reconame = \"\";\nvar confidence = \"\";\nvar reco = \"\";\nvar recognized_confidently = 0;\n//declarations\n\n    for (i = 0; i < msg.payload.matches.length; i++){\n         for (y = 0; y < Object.keys(msg.payload.matches[i]).length; y++){\n                var name = msg.payload.matches[i][y][0];\n \t\t\t\tvar conf = msg.payload.matches[i][y][1];\n \t\t\t\tvar camera = msg.payload.matches[i][y][2];\n \t\t\t// \tif (conf > 0){\n \t\t\t\t    recofacesortable.push([name, conf, camera]);\n \t\t\t// \t}\n \t\t\t\t\n        }\n    }\n    \n    \n     \trecofacesortable.sort(function(a, b) {\n \t\treturn a[1] - b[1];\n \t}).reverse();\n \t\n    for (i = 0; i < recofacesortable.length; i++){\n        var reconame = recofacesortable[0][0];\n        var confidence = recofacesortable[0][1]\n        var camera = recofacesortable[0][2]\n        \n        \n    }\n\n\n\nif (confidence > required_conf) \n\tvar recognized = 1;\n}\n\n if (camera == \"camera.front_door\"){\n     var camera = \"camera.reolink_static\";\n } else if (camera == \"camera.facecam\"){\n     var camera = \"camera.facecam_static\"\n }\n\nvar newMsg = {\n\t\"payload\": {\n\t\t\"name\": reconame,\n\t\t\"confidence\": confidence,\n\t//\t\"matched_faces\": total_matched_faces,\n\t//\t\"total_faces\": total_faces,\n\t\t\"recognized\": recognized,\n \t\t\"camera\": camera \n\t}\n};\n\nreturn newMsg;\n\n\n//  var test = {\n//  \t\"payload\": {\n// \t\t\"name\": reconame,\n// \t\t\"confidence\": confidence,\n// \t\t\"matched_faces\": total_matched_faces,\n// \t\t\"total_faces\": total_faces,\n// \t\t\"recognized\": recognized,\n// \t\t\"camera\": camera ,\n// \t\t\"recofacesortable\": recofacesortable\n//  \t}\n//  };\n//  return test;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2000,"y":740,"wires":[["0f1732762ac40879","ba44446730be7bf1","0ac672adeec6d647"]]},{"id":"e66b54c926156cea","type":"debug","z":"904d418a12e6a4b0","name":"post1","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1630,"y":620,"wires":[]},{"id":"67688ca323561b6b","type":"debug","z":"904d418a12e6a4b0","name":"post2","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1750,"y":840,"wires":[]},{"id":"1bb02d2cdc9d745c","type":"debug","z":"904d418a12e6a4b0","name":"tojson","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1810,"y":660,"wires":[]},{"id":"5f8de432d168d923","type":"inject","z":"904d418a12e6a4b0","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2060,"y":960,"wires":[["150cd5e00c84aade"]]},{"id":"7219126187207dfa","type":"function","z":"904d418a12e6a4b0","name":"cam set","func":"// SETTINGS\nvar required_conf = 75;\n// SETTINGS\n\n\nvar recoface = new Object();\nvar recofacesortable = [];\nvar name = \"\";\nvar camera = \"camera.front_door\";\nvar conf = \"\";\nvar reconame = \"\";\nvar confidence = \"\";\nvar reco = \"\";\n//declarations\n\n    for (i = 0; i < msg.payload.matches.length; i++){\n\n                var name = msg.payload.matches[i].name;\n \t\t\t\tvar conf = msg.payload.matches[i].confidence;\n \t\t\t// \tif (conf > 0){\n \t\t\t\t    recofacesortable.push([name, conf, camera]);\n \t\t\t// \t}\n \t\t\t\t\n        \n    }\n\nif (typeof msg.payload.unknown!==\"undefined\"){\n    recofacesortable.push([\"Unknown\", \"0\", camera]);\n}\n    \n    \n//      \trecofacesortable.sort(function(a, b) {\n//  \t\treturn a[1] - b[1];\n//  \t}).reverse();\n \t\n//     for (i = 0; i < recofacesortable.length; i++){\n//         var reconame = recofacesortable[0][0];\n//         var confidence = recofacesortable[0][1]\n//         var camera = recofacesortable[0][2]\n        \n        \n//     }\n\n\n\n// if (confidence > required_conf) {\n// \tvar recognized = 1;\n// } else {\n// \tvar recognized = 0;\n// }\n\n// if (camera == \"face_counter_reolink\"){\n//     var camera = \"camera.reolink_static\";\n// } else if (camera == \"face_counter_facecam\"){\n//     var camera = \"camera.facecam_static\"\n// }\n\n// var newMsg = {\n// \t\"payload\": {\n// \t\t\"name\": reconame,\n// \t\t\"confidence\": confidence,\n// \t\t\"recognized\": recognized,\n//  \t\t\"camera\": camera \n// \t}\n// };\n\n//return newMsg;\n\n\n  var test = {\n   \t\"payload\":  {\n\t\t\"matches\": recofacesortable,\n// //  \t\t\"confidence\": confidence,\n// //  \t\t\"recognized\": recognized,\n// //  \t\t\"camera\": camera ,\n// //  \t\t\"recofacesortable\": recofacesortable\n   \t}\n  };\n  return test;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1640,"y":720,"wires":[["3a4d0b43583f798d","e66b54c926156cea"]]},{"id":"d3a5b3d7566830b1","type":"function","z":"904d418a12e6a4b0","name":"cam set","func":"// SETTINGS\nvar required_conf = 75;\n// SETTINGS\n\n\nvar recoface = new Object();\nvar recofacesortable = [];\nvar name = \"\";\nvar camera = \"camera.facecam\";\nvar conf = \"\";\nvar reconame = \"\";\nvar confidence = \"\";\nvar reco = \"\";\n//declarations\n\n    for (i = 0; i < msg.payload.matches.length; i++){\n\n                var name = msg.payload.matches[i].name;\n \t\t\t\tvar conf = msg.payload.matches[i].confidence;\n \t\t\t// \tif (conf > 0){\n \t\t\t\t    recofacesortable.push([name, conf, camera]);\n \t\t\t// \t}\n \t\t\t\t\n        \n    }\n\nif (typeof msg.payload.unknown!==\"undefined\"){\n    recofacesortable.push([\"Unknown\", \"0\", camera]);\n}\n    \n    \n//      \trecofacesortable.sort(function(a, b) {\n//  \t\treturn a[1] - b[1];\n//  \t}).reverse();\n \t\n//     for (i = 0; i < recofacesortable.length; i++){\n//         var reconame = recofacesortable[0][0];\n//         var confidence = recofacesortable[0][1]\n//         var camera = recofacesortable[0][2]\n        \n        \n//     }\n\n\n\n// if (confidence > required_conf) {\n// \tvar recognized = 1;\n// } else {\n// \tvar recognized = 0;\n// }\n\n// if (camera == \"face_counter_reolink\"){\n//     var camera = \"camera.reolink_static\";\n// } else if (camera == \"face_counter_facecam\"){\n//     var camera = \"camera.facecam_static\"\n// }\n\n// var newMsg = {\n// \t\"payload\": {\n// \t\t\"name\": reconame,\n// \t\t\"confidence\": confidence,\n// \t\t\"recognized\": recognized,\n//  \t\t\"camera\": camera \n// \t}\n// };\n\n//return newMsg;\n\n\n  var test = {\n   \t\"payload\":  {\n\t\t\"matches\": recofacesortable,\n// //  \t\t\"confidence\": confidence,\n// //  \t\t\"recognized\": recognized,\n// //  \t\t\"camera\": camera ,\n// //  \t\t\"recofacesortable\": recofacesortable\n   \t}\n  };\n  return test;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1640,"y":760,"wires":[["3a4d0b43583f798d","67688ca323561b6b"]]},{"id":"901b9e8cae5d66bb","type":"debug","z":"904d418a12e6a4b0","name":"actionable","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1450,"y":80,"wires":[]},{"id":"50d9fa7e7c3800e4","type":"http request","z":"904d418a12e6a4b0","name":"POST request","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","x":1940,"y":220,"wires":[["b2d3879e774d743e","14c699202031c457"]]},{"id":"ec6cea7645c91b6a","type":"function","z":"904d418a12e6a4b0","name":"Javascript","func":"var d = new Date();\nvar h = d.getHours();\nvar m = d.getMinutes();\nvar s = d.getSeconds();\n\nvar confidence = 0;\nif (typeof msg.payload.confidence !==\"undefined\"){\nvar confidence = msg.payload.confidence;\n}\n\n\nvar who = msg.payload.event.reply_text.toLowerCase().replace(\" \",\"\");\nvar replacestring = \"https://hass.purgatoire.ca/local/portraits/\" + who.toLowerCase();\nvar replacestring1 = msg.payload.event.image.replace(replacestring);\nvar replacestring2 = replacestring1.split(\"-\");\nvar camera = replacestring2[1];\n\n\n\n\nvar newMsg = {\n    \"image\": msg.payload.event.image,\n    \"payload\": {\n        \"name\": who,\n        \"data\": {\n            \"filename\":\"/config/double-take/\" + who +  \"/\" + camera + \"_\" + h + m + s + \"_\" + confidence + \".jpg\",\n            \"entity_id\": camera,\n            // \"1\": replacestring,\n            // \"2\": replacestring1,\n            // \"3\": replacestring2\n        }\n    }\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1300,"y":320,"wires":[["dd50fb000b813d29","30b540a24623fdf9"]]},{"id":"2c7e04d7b8d79fe4","type":"api-call-service","z":"904d418a12e6a4b0","name":"snapshot","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"camera","service":"snapshot","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload666","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1680,"y":320,"wires":[["31ebe03fa4f5502a","f77a07bb408cd716"]]},{"id":"31ebe03fa4f5502a","type":"debug","z":"904d418a12e6a4b0","name":"result of snapchot","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2050,"y":340,"wires":[]},{"id":"7546d4fa774773c7","type":"function","z":"904d418a12e6a4b0","name":"Javascript","func":"var d = new Date();\nvar h = d.getHours();\nvar m = d.getMinutes();\nvar s = d.getSeconds();\nvar camera = msg.payload.camera;\nvar confidence = 0;\n\nif (typeof msg.payload.confidence !==\"undefined\"){\nvar confidence = msg.payload.confidence;\n}\n\nvar who = \"Unknown\";\nif (typeof msg.payload.name !==\"undefined\"){\nvar who = msg.payload.name;\n}\n\n\n\n\nvar newMsg = {\n    \"payload\": {\n        \"name\": who,\n        \"data\": {\n            \"filename\":\"/config/www/portraits/\" + who + \"/\" + who + \"-\" + camera + \"-\" + h + m + s + \"-\" + confidence + \".jpg\",\n            \"entity_id\": camera\n        }\n    }\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2960,"y":840,"wires":[["fbe327880877a39a"]]},{"id":"fbe327880877a39a","type":"api-call-service","z":"904d418a12e6a4b0","name":"snapshot","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"camera","service":"snapshot","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload666","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":3140,"y":840,"wires":[["c95634890ca84687"]]},{"id":"293471c2ce12198b","type":"api-call-service","z":"904d418a12e6a4b0","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"notify","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3500,"y":840,"wires":[[]]},{"id":"c95634890ca84687","type":"function","z":"904d418a12e6a4b0","name":"Javascript","func":"var d = new Date();\nvar name = msg.payload.name;\nvar m = d.getMilliseconds();\nvar snapshot = msg.payload.data.filename;\nvar url = \"http://192.168.0.12:8765/picture/8/current/?\" + m;\n\nvar snapshot = snapshot.replace(\"\\/config\\/www\",\"https:\\/\\/hass.purgatoire.ca\\/local\");\n\n\nvar newMsg = {\n\t\"payload\": {\n\t\t\"data\": {\n\t\t\t\"message\": \"Doorbell Alert\",\n\t\t\t\"title\": name + \" is at the door\",\n\t\t\t\"data\": {\n\t\t\t\t\"image\": snapshot,\n\t\t\t\t\"actions\": [{\n\t\t\t\t\t\t\"action\": \"REPLY\",\n\t\t\t\t\t\t\"title\": \"Who is this?\"\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"action\": \"unlock_door\",\n\t\t\t\t\t\t\"title\": \"Unlock The Door\"\n\t\t\t\t\t}\n\n\t\t\t\t]\n\t\t\t}\n\t\t}\n\t}\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3320,"y":840,"wires":[["293471c2ce12198b","857a70342f2d7124"]]},{"id":"857a70342f2d7124","type":"change","z":"904d418a12e6a4b0","name":"Set Data for mass alert","rules":[{"t":"set","p":"message","pt":"msg","to":"payload.data.title","tot":"msg"},{"t":"set","p":"color_value","pt":"msg","to":"[0,0,255]","tot":"json"},{"t":"set","p":"dbrigthness","pt":"msg","to":"100","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":3120,"y":780,"wires":[["ce20e38b68c63777"]]},{"id":"7a0fcae802a46c08","type":"trigger","z":"904d418a12e6a4b0","name":"Face Not reco","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"1","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2620,"y":1120,"wires":[["aa5a286de68e5ce7","88fe95a4556c899d","2be68eeca4b12515"]]},{"id":"aa5a286de68e5ce7","type":"debug","z":"904d418a12e6a4b0","name":"face not reco","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2610,"y":1280,"wires":[]},{"id":"88fe95a4556c899d","type":"function","z":"904d418a12e6a4b0","name":"Javascript","func":"var d = new Date();\nvar h = d.getHours();\nvar m = d.getMinutes();\nvar s = d.getSeconds();\nvar camera = msg.payload.camera;\nvar confidence = 0;\n\nif (typeof msg.payload.confidence !==\"undefined\"){\nvar confidence = msg.payload.confidence;\n}\n\nvar who = \"Unknown\";\nif (typeof msg.payload.name !==\"undefined\"){\nvar who = msg.payload.name;\n}\n\n\n\n\nvar newMsg = {\n    \"payload\": {\n        \"name\": who,\n        \"data\": {\n            \"filename\":\"/config/www/portraits/\" + who + \"/\" + who + \"-\" + camera + \"-\" + h + m + s + \"-\" + confidence + \".jpg\",\n            \"entity_id\": camera\n        }\n    }\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2800,"y":1120,"wires":[["5eda1fd916d75fc5"]]},{"id":"5eda1fd916d75fc5","type":"api-call-service","z":"904d418a12e6a4b0","name":"snapshot","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"camera","service":"snapshot","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload666","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2980,"y":1120,"wires":[["e6f12c198a7ff8ce"]]},{"id":"407481c5ec78fe37","type":"api-call-service","z":"904d418a12e6a4b0","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"notify","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3340,"y":1120,"wires":[[]]},{"id":"e6f12c198a7ff8ce","type":"function","z":"904d418a12e6a4b0","name":"Javascript","func":"var d = new Date();\nvar name = msg.payload.name;\nvar m = d.getMilliseconds();\nvar snapshot = msg.payload.data.filename;\nvar url = \"http://192.168.0.12:8765/picture/8/current/?\" + m;\n\nvar snapshot = snapshot.replace(\"\\/config\\/www\",\"https:\\/\\/hass.purgatoire.ca\\/local\");\n\n\nvar newMsg = {\n\t\"payload\": {\n\t\t\"data\": {\n\t\t\t\"message\": \"Doorbell Alert\",\n\t\t\t\"title\": \"Someone is at the door\",\n\t\t\t\"data\": {\n\t\t\t\t\"image\": snapshot,\n\t\t\t\t\"actions\": [{\n\t\t\t\t\t\t\"action\": \"REPLY\",\n\t\t\t\t\t\t\"title\": \"Who is this?\"\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"action\": \"unlock_door\",\n\t\t\t\t\t\t\"title\": \"Unlock The Door\"\n\t\t\t\t\t}\n\n\t\t\t\t]\n\t\t\t}\n\t\t}\n\t}\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3140,"y":1120,"wires":[["407481c5ec78fe37","04136d4e58b72b49"]]},{"id":"04136d4e58b72b49","type":"change","z":"904d418a12e6a4b0","name":"Set Data for mass alert","rules":[{"t":"set","p":"message","pt":"msg","to":"payload.data.title","tot":"msg"},{"t":"set","p":"color_value","pt":"msg","to":"[0,0,255]","tot":"json"},{"t":"set","p":"dbrigthness","pt":"msg","to":"100","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":3340,"y":1160,"wires":[["f66eb3a9e4a19b70"]]},{"id":"f66eb3a9e4a19b70","type":"link out","z":"904d418a12e6a4b0","name":"Light and Speakers","links":["45904ca6429d867d","ad88dbd2.4726b8","3405e943.fd3ee6","9cf42cf7ef60f645"],"x":3475,"y":1160,"wires":[]},{"id":"93d0afd406ac15b9","type":"api-current-state","z":"904d418a12e6a4b0","name":"uber","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.waiting_uber","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"partyon","propertyType":"msg","value":"","valueType":"entityState"},{"property":"partydata","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":2510,"y":720,"wires":[["725592b772d2f831"],["e4c7a28d349931be"]]},{"id":"7013d7b5775bf756","type":"switch","z":"904d418a12e6a4b0","name":"","property":"payload.name","propertyType":"msg","rules":[{"t":"nempty"},{"t":"eq","v":"","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":2190,"y":920,"wires":[["dd33921d39d3ec9c"],["264198226c051236"]]},{"id":"30b540a24623fdf9","type":"switch","z":"904d418a12e6a4b0","name":"Recod Faces 1/0","property":"payload.data.entity_id","propertyType":"msg","rules":[{"t":"eq","v":"camera.facecam_static","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1510,"y":320,"wires":[["2c7e04d7b8d79fe4"]]},{"id":"dcab6140df1dc36d","type":"api-call-service","z":"904d418a12e6a4b0","name":"unLock Door","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"lock","service":"unlock","areaId":[],"deviceId":[],"entityId":["lock.front_door"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3910,"y":380,"wires":[["088cb81fd7b1e783","18efd9deec536b5b"]]},{"id":"18efd9deec536b5b","type":"api-current-state","z":"904d418a12e6a4b0","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"unlocked","halt_if_type":"str","halt_if_compare":"is","entity_id":"lock.front_door","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":3900,"y":320,"wires":[["700116e39062929e"],["dcab6140df1dc36d"]]},{"id":"bf68ef8d39f309d7","type":"delay","z":"904d418a12e6a4b0","name":"Waiting someone","pauseType":"delay","timeout":"1","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":3290,"y":600,"wires":[["de700ffb416bffb9","d3a54796c0c96850","f99077e2dc36f112","dcab6140df1dc36d"]]},{"id":"1ab167e6d548ddec","type":"api-current-state","z":"904d418a12e6a4b0","name":"Front House Motion","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.motion_front","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"partyon","propertyType":"msg","value":"","valueType":"entityState"},{"property":"partydata","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":3010,"y":720,"wires":[["bf68ef8d39f309d7"],["67d7a5e70c4f1173"]]},{"id":"c971d4a0445aef2c","type":"change","z":"904d418a12e6a4b0","name":"reset","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1890,"y":1160,"wires":[["a883a03c81fd4859","a537f90568a2331e","d7ccb3af1a82f471"]]},{"id":"a883a03c81fd4859","type":"function","z":"904d418a12e6a4b0","name":"Javascript","func":"var recoface = [];\nvar facestring = \"\"\nvar d = new Date();\nvar m = d.getMilliseconds();\nvar url = \"https://hass.purgatoire.ca/local/ring.jpg?\" + m;\nvar facestring = msg.payload;\n\nvar newMsg = {\n \"payload\": {\n  \"data\": {\n  \"message\": \"Someone is at the door\",\n  \"data\": {\n    \"image\": url,\n    \"actions\": [\n      {\n        \"action\": \"unlock_door\",\n        \"title\": \"Unlock The Door\"\n      }\n                \n    ]\n  }\n}\n }\n};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2060,"y":1140,"wires":[["482b132529f27f0f"]]},{"id":"482b132529f27f0f","type":"api-call-service","z":"904d418a12e6a4b0","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"notify","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2240,"y":1140,"wires":[[]]},{"id":"f1df89f7f6273d40","type":"trigger","z":"904d418a12e6a4b0","name":"No Face","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"1","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1740,"y":1160,"wires":[["c971d4a0445aef2c"]]},{"id":"a537f90568a2331e","type":"change","z":"904d418a12e6a4b0","name":"Set Data for mass alert","rules":[{"t":"set","p":"color_value","pt":"msg","to":"[0,0,255]","tot":"json"},{"t":"set","p":"dbrigthness","pt":"msg","to":"100","tot":"num"},{"t":"set","p":"message","pt":"msg","to":"Someone is at the door","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2100,"y":1220,"wires":[["26bb1943455ffac1"]]},{"id":"26bb1943455ffac1","type":"link out","z":"904d418a12e6a4b0","name":"Light and Speakers","links":["45904ca6429d867d","ad88dbd2.4726b8","3405e943.fd3ee6","9cf42cf7ef60f645"],"x":2235,"y":1220,"wires":[]},{"id":"6a2c4537d58a5c2f","type":"switch","z":"904d418a12e6a4b0","name":"","property":"payload.event.action_1_title","propertyType":"msg","rules":[{"t":"eq","v":"Who is this?","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1190,"y":260,"wires":[["ec6cea7645c91b6a","dd50fb000b813d29"]]},{"id":"ce20e38b68c63777","type":"link out","z":"904d418a12e6a4b0","name":"Light and Speakers","links":["45904ca6429d867d","ad88dbd2.4726b8","3405e943.fd3ee6","9cf42cf7ef60f645"],"x":3295,"y":780,"wires":[]},{"id":"e4c7a28d349931be","type":"trigger","z":"904d418a12e6a4b0","name":"Uber","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"1","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2550,"y":960,"wires":[["923994cc630458f6","d7ee96320385c85a"]]},{"id":"923994cc630458f6","type":"function","z":"904d418a12e6a4b0","name":"Javascript","func":"var d = new Date();\nvar h = d.getHours();\nvar m = d.getMinutes();\nvar s = d.getSeconds();\nvar camera = \"camera.front_door\";\nvar confidence = 0;\n\nif (typeof msg.payload.confidence !==\"undefined\"){\nvar confidence = msg.payload.confidence;\n}\n\nvar who = \"Unknown\";\nif (typeof msg.payload.name !==\"undefined\"){\nvar who = msg.payload.name;\n}\n\n\n\n\nvar newMsg = {\n    \"payload\": {\n        \"name\": who,\n        \"data\": {\n            \"filename\":\"/config/www/portraits/\" + who + \"/\" + who + \"-\" + camera + \"-\" + h + m + s + \"-\" + confidence + \".jpg\",\n            \"entity_id\": camera\n        }\n    }\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2740,"y":980,"wires":[["60da29b51fca273a","42cc2f7f3b9febbd"]]},{"id":"60da29b51fca273a","type":"api-call-service","z":"904d418a12e6a4b0","name":"snapshot","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"camera","service":"snapshot","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload666","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2960,"y":980,"wires":[["8140863346e33c80","2e41453782c86465"]]},{"id":"7656e9b692e9fc03","type":"api-call-service","z":"904d418a12e6a4b0","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"notify","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3380,"y":980,"wires":[[]]},{"id":"8140863346e33c80","type":"function","z":"904d418a12e6a4b0","name":"Javascript","func":"var d = new Date();\nvar name = \"Someone\";\nvar m = d.getMilliseconds();\nvar snapshot = msg.payload.data.filename;\nvar url = \"http://192.168.0.12:8765/picture/8/current/?\" + m;\n\nvar snapshot = snapshot.replace(\"\\/config\\/www\",\"https:\\/\\/hass.purgatoire.ca\\/local\");\n\n\nvar newMsg = {\n\t\"payload\": {\n\t\t\"data\": {\n\t\t\t\"message\": \"Doorbell Alert\",\n\t\t\t\"title\": name + \" is at the door\",\n\t\t\t\"data\": {\n\t\t\t\t\"image\": snapshot,\n\t\t\t\t\"actions\": [{\n\t\t\t\t\t\t\"action\": \"REPLY\",\n\t\t\t\t\t\t\"title\": \"Who is this?\"\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"action\": \"unlock_door\",\n\t\t\t\t\t\t\"title\": \"Unlock The Door\"\n\t\t\t\t\t}\n\n\t\t\t\t]\n\t\t\t}\n\t\t}\n\t}\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3140,"y":980,"wires":[["7656e9b692e9fc03","9993335ff3898bdb"]]},{"id":"9993335ff3898bdb","type":"change","z":"904d418a12e6a4b0","name":"Set Data for mass alert","rules":[{"t":"set","p":"message","pt":"msg","to":"payload.data.title","tot":"msg"},{"t":"set","p":"color_value","pt":"msg","to":"[0,0,255]","tot":"json"},{"t":"set","p":"dbrigthness","pt":"msg","to":"100","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":3320,"y":940,"wires":[["902a23bee759d216"]]},{"id":"902a23bee759d216","type":"link out","z":"904d418a12e6a4b0","name":"Light and Speakers","links":["45904ca6429d867d","ad88dbd2.4726b8","3405e943.fd3ee6","9cf42cf7ef60f645"],"x":3455,"y":940,"wires":[]},{"id":"d7ee96320385c85a","type":"api-call-service","z":"904d418a12e6a4b0","name":"to package","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"script","service":"ptz_to_package","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload666","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2710,"y":940,"wires":[["c83706e06ce524aa","f7d1fdeab2abc3b3"]]},{"id":"d7ccb3af1a82f471","type":"link out","z":"904d418a12e6a4b0","name":"Announcement input","links":["6c95d201f6c9daf3"],"x":2035,"y":1180,"wires":[]},{"id":"2be68eeca4b12515","type":"link out","z":"904d418a12e6a4b0","name":"Announcement input","links":["6c95d201f6c9daf3"],"x":2775,"y":1080,"wires":[]},{"id":"c83706e06ce524aa","type":"link out","z":"904d418a12e6a4b0","name":"Announcement input","links":["6c95d201f6c9daf3"],"x":3015,"y":940,"wires":[]},{"id":"e139f44c71b58e6e","type":"link out","z":"904d418a12e6a4b0","name":"Announcement input","links":["6c95d201f6c9daf3"],"x":2915,"y":800,"wires":[]},{"id":"0361e9a0a13608d3","type":"link out","z":"904d418a12e6a4b0","name":"Announcement input","links":["6c95d201f6c9daf3"],"x":2415,"y":1440,"wires":[]},{"id":"f0ab80a27fc67e71","type":"link out","z":"904d418a12e6a4b0","name":"Announcement input","links":["6c95d201f6c9daf3"],"x":3735,"y":260,"wires":[]},{"id":"efbcac8ae861406a","type":"inject","z":"904d418a12e6a4b0","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":510,"y":740,"wires":[["23685ea64ad822fc"]]},{"id":"264198226c051236","type":"api-current-state","z":"904d418a12e6a4b0","name":"uber","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.waiting_uber","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"partyon","propertyType":"msg","value":"","valueType":"entityState"},{"property":"partydata","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":2270,"y":1020,"wires":[["e4c7a28d349931be"],["f1df89f7f6273d40"]]},{"id":"dd33921d39d3ec9c","type":"api-current-state","z":"904d418a12e6a4b0","name":"uber","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.waiting_uber","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"partyon","propertyType":"msg","value":"","valueType":"entityState"},{"property":"partydata","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":2350,"y":920,"wires":[["e4c7a28d349931be"],["7a0fcae802a46c08"]]},{"id":"2e41453782c86465","type":"debug","z":"904d418a12e6a4b0","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3150,"y":1020,"wires":[]},{"id":"42cc2f7f3b9febbd","type":"debug","z":"904d418a12e6a4b0","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2850,"y":1020,"wires":[]},{"id":"fdfb55f783cdc525","type":"api-call-service","z":"904d418a12e6a4b0","name":"to regular position","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"script","service":"ptz_to_doorway","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload666","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":3090,"y":900,"wires":[[]]},{"id":"f7d1fdeab2abc3b3","type":"ha-wait-until","z":"904d418a12e6a4b0","name":"lock opens","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"lock.front_door","entityIdFilterType":"exact","property":"state","comparator":"is","value":"unlocked","valueType":"str","timeout":"120","timeoutType":"num","timeoutUnits":"seconds","checkCurrentState":false,"blockInputOverrides":true,"outputProperties":[],"x":2870,"y":900,"wires":[["fdfb55f783cdc525"],["fdfb55f783cdc525"]]},{"id":"0ac672adeec6d647","type":"api-call-service","z":"904d418a12e6a4b0","name":"to door","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"script","service":"ptz_to_doorway","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload666","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2180,"y":700,"wires":[[]]},{"id":"c084c153d3ab6ee7","type":"mqtt in","z":"904d418a12e6a4b0","name":"","topic":"frigate/faceshot_zone/person","qos":"0","datatype":"auto","broker":"21000c19b97da572","nl":false,"rap":true,"rh":0,"inputs":0,"x":120,"y":440,"wires":[["9ddcaabefcce8a21","ca098420ae1420ee"]]},{"id":"9ddcaabefcce8a21","type":"debug","z":"904d418a12e6a4b0","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":270,"y":340,"wires":[]},{"id":"ca098420ae1420ee","type":"switch","z":"904d418a12e6a4b0","name":"click","property":"payload","propertyType":"msg","rules":[{"t":"gt","v":"0","vt":"num"},{"t":"eq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":390,"y":440,"wires":[["ce3728c13dfb8720"],["e5af5b96f50720e9"]]},{"id":"06a45ec0ea3134e4","type":"server-state-changed","z":"904d418a12e6a4b0","name":"double-take facecam over 0","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.double_take_facecam","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"0","halt_if_type":"num","halt_if_compare":"gt","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":260,"y":200,"wires":[[],[]]},{"id":"1cf2d343db1c089e","type":"ha-wait-until","z":"904d418a12e6a4b0","name":"wait until Doubletake detect someone","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"sensor.double_take_facecam","entityIdFilterType":"exact","property":"state","comparator":"gt","value":"0","valueType":"num","timeout":"2","timeoutType":"num","timeoutUnits":"seconds","checkCurrentState":true,"blockInputOverrides":true,"outputProperties":[{"property":"doubletake","propertyType":"msg","value":"","valueType":"entity"}],"x":490,"y":800,"wires":[["23685ea64ad822fc","fd9e004bebcc4da9"],["23685ea64ad822fc","fd9e004bebcc4da9"]]},{"id":"b07092e47615b45f","type":"trigger","z":"904d418a12e6a4b0","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"45","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":430,"y":960,"wires":[["acdb4cbe807a4670","f3c7ce0f95a036c8"]]},{"id":"f0580e72171443ad","type":"inject","z":"904d418a12e6a4b0","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":3910,"y":680,"wires":[[]]},{"id":"aad8dfcf35a5f778","type":"trigger","z":"904d418a12e6a4b0","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"25","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":4350,"y":320,"wires":[["7caca54b79a292ef"]]},{"id":"f965de714ebd94de","type":"inject","z":"904d418a12e6a4b0","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":4180,"y":500,"wires":[["700116e39062929e"]]},{"id":"fd9e004bebcc4da9","type":"debug","z":"904d418a12e6a4b0","name":"Doubletake output","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1000,"y":660,"wires":[]},{"id":"7a28dcc41462f8d0","type":"trigger","z":"62914984f579d881","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"10","extend":false,"overrideDelay":false,"units":"min","reset":"motion","bytopic":"all","topic":"topic","outputs":1,"x":770,"y":160,"wires":[["31bebf3958fcf0e0"]]},{"id":"fc016d7d841dc253","type":"comment","z":"62914984f579d881","name":"This prevent the Light from going off as long as the humidity is over 40%(Shower)","info":"","x":380,"y":360,"wires":[]},{"id":"5f50084e74c02bc3","type":"change","z":"62914984f579d881","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"A","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1220,"y":400,"wires":[["dd93311cd91a73d1"]]},{"id":"a2ce03d101a308e9","type":"api-current-state","z":"62914984f579d881","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.bathrooms","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":550,"y":400,"wires":[[],["64c3ec1015818ca1","17d3bbda6788aad5"]]},{"id":"91a8dc11fdd22505","type":"trigger","z":"62914984f579d881","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"10","extend":false,"units":"s","reset":"on","bytopic":"all","outputs":1,"x":890,"y":400,"wires":[["b9f683ce8421d3e1"]]},{"id":"dd93311cd91a73d1","type":"api-call-service","z":"62914984f579d881","name":"Bathroom Light Off","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.bathrooms"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1410,"y":400,"wires":[[]]},{"id":"ad83e9172b3261e5","type":"random","z":"62914984f579d881","name":"","low":"1","high":"37","inte":"true","property":"number","x":1120,"y":300,"wires":[["16f65f5fa0edd049"]]},{"id":"64c3ec1015818ca1","type":"change","z":"62914984f579d881","name":"on","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":750,"y":400,"wires":[["91a8dc11fdd22505"]]},{"id":"1056df852f1797e7","type":"api-call-service","z":"62914984f579d881","name":"cast Off","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"media_stop","areaId":[],"deviceId":[],"entityId":["media_player.bathroom_speaker"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1940,"y":120,"wires":[[]]},{"id":"b9f683ce8421d3e1","type":"api-current-state","z":"62914984f579d881","name":"Motion state","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.motion_bathroom","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":1050,"y":400,"wires":[[],["5f50084e74c02bc3"]]},{"id":"b342c608e970b24c","type":"api-call-service","z":"62914984f579d881","name":"Bathroom Light Off","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.bathrooms"],"data":"{\"transition\": \"60\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload1","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1310,"y":180,"wires":[[]]},{"id":"31bebf3958fcf0e0","type":"api-current-state","z":"62914984f579d881","name":"Humidity","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.shower_in_use","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":760,"y":220,"wires":[["7a28dcc41462f8d0"],["b342c608e970b24c","f5861041d494f37e"]]},{"id":"e95d11698cb134f6","type":"api-call-service","z":"62914984f579d881","name":"Bathroom Light on","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.bathrooms"],"data":"{\"color_temp\":\"255\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1190,"y":340,"wires":[["0b6a796c40e84fa2"]]},{"id":"d46e459824e86588","type":"change","z":"62914984f579d881","name":"motion","rules":[{"t":"set","p":"payload","pt":"msg","to":"motion","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":470,"y":300,"wires":[["c6df82b35cd45d70","738649c7c49ba0be","7a28dcc41462f8d0"]]},{"id":"42e2e246c6d7057e","type":"change","z":"62914984f579d881","name":"no_motion","rules":[{"t":"set","p":"payload","pt":"msg","to":"no_motion","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":450,"y":180,"wires":[["7a28dcc41462f8d0"]]},{"id":"c6df82b35cd45d70","type":"api-current-state","z":"62914984f579d881","name":"Speaker state","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"playing","halt_if_type":"str","halt_if_compare":"is","entity_id":"media_player.bathroom_speaker","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"state","propertyType":"msg","value":"","valueType":"entityState"},{"property":"entity","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":940,"y":300,"wires":[[],["ad83e9172b3261e5"]]},{"id":"738649c7c49ba0be","type":"api-current-state","z":"62914984f579d881","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is_not","entity_id":"light.bathrooms","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":790,"y":340,"wires":[["2db415b636da4c52"],[]]},{"id":"005ba27c7bfbbe3a","type":"api-current-state","z":"62914984f579d881","name":"Door state","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.door_bathroom","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":1570,"y":300,"wires":[["0d0b01759e483177"],["622de50bd63e6252"]]},{"id":"2db415b636da4c52","type":"function","z":"62914984f579d881","name":"Time","func":"var d = new Date();\nvar h = d.getHours();\n\nif (h > 22){\n    var brightness = \"80\";\n}\nelse if (h >= 0 && h <= 2 ){\n    var brightness = \"75\";\n}\nelse if (h>2 && h<7){\n    var brightness = \"50\";\n}\nelse{\n    var brightness = \"100\";\n}\n\nvar newMsg = \n\n{ \n    \"payload\": {\n                data: {\n                         \"brightness_pct\": brightness                      }\n               } \n};\nreturn newMsg;\n\n","outputs":1,"noerr":0,"x":1030,"y":340,"wires":[["e95d11698cb134f6"]]},{"id":"cda6b5abac0d7b3c","type":"ha-wait-until","z":"62914984f579d881","name":"","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"binary_sensor.door_bathroom","entityIdFilterType":"exact","property":"state","comparator":"is","value":"off","valueType":"str","timeout":"30","timeoutType":"num","timeoutUnits":"seconds","checkCurrentState":true,"blockInputOverrides":true,"outputProperties":[],"x":2280,"y":260,"wires":[["457aa2e66b9e0cb6"],[]]},{"id":"457aa2e66b9e0cb6","type":"api-call-service","z":"62914984f579d881","name":"Bathroom Speaker","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_set","areaId":[],"deviceId":[],"entityId":["media_player.bathroom_speaker"],"data":"{\"volume_level\":\"0.4\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2450,"y":260,"wires":[[]]},{"id":"17d3bbda6788aad5","type":"function","z":"62914984f579d881","name":"Time","func":"var d = new Date();\nvar h = d.getHours();\n\nif (h > 22){\n    var brightness = \"80\";\n}\nelse if (h >= 0 && h <= 2 ){\n    var brightness = \"75\";\n}\nelse if (h>2 && h<7){\n    var brightness = \"50\";\n}\nelse{\n    var brightness = \"100\";\n}\n\nvar newMsg = \n\n{ \n    \"payload\": {\n                data: {\n                         \"brightness_pct\": brightness                      }\n               } \n};\nreturn newMsg;\n\n","outputs":1,"noerr":0,"x":750,"y":440,"wires":[["c7ef108fa33f0253"]]},{"id":"c7ef108fa33f0253","type":"api-call-service","z":"62914984f579d881","name":"Bathroom Light on","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.bathrooms"],"data":"{\"color_temp\":\"255\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":910,"y":440,"wires":[[]]},{"id":"8c62be6a200a3ae2","type":"cast-to-client","z":"62914984f579d881","name":"","url":"","contentType":"audio","message":"","language":"en","ip":"192.168.40.26","port":"","volume":"10","x":2110,"y":260,"wires":[["cda6b5abac0d7b3c"]]},{"id":"ce1932e8d523fa22","type":"cast-to-client","z":"62914984f579d881","name":"","url":"","contentType":"audio","message":"","language":"en","ip":"192.168.40.26","port":"","volume":"40","x":2110,"y":300,"wires":[[]]},{"id":"16f65f5fa0edd049","type":"random","z":"62914984f579d881","name":"","low":"1","high":"37","inte":"true","property":"number1","x":1280,"y":300,"wires":[["3a47aa1af562161c"]]},{"id":"3a47aa1af562161c","type":"random","z":"62914984f579d881","name":"","low":"1","high":"37","inte":"true","property":"number2","x":1420,"y":300,"wires":[["005ba27c7bfbbe3a"]]},{"id":"0d0b01759e483177","type":"function","z":"62914984f579d881","name":"Music Selector","func":"var number = msg.number;\nvar number1 = msg.number1;\nvar number2 = msg.number2;\nvar newMsg = {\n    \"payload\": {\n            \"urlList\": [\"http://192.168.0.15:8123/local/muzak/muzak\" + number + \".mp3\",\n            \"http://192.168.0.15:8123/local/muzak/muzak\" + number1 + \".mp3\", \n            \"http://192.168.0.15:8123/local/muzak/muzak\" + number2 + \".mp3\"]\n    }\n};\nreturn newMsg;","outputs":1,"noerr":0,"x":1860,"y":260,"wires":[["8c62be6a200a3ae2"]]},{"id":"a4cdefc2674d8b0d","type":"server-state-changed","z":"62914984f579d881","name":"Bathroom Motion","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.motion_bathroom","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":180,"y":260,"wires":[[],[]]},{"id":"30c4c03d146af7ba","type":"server-state-changed","z":"62914984f579d881","name":"Kitchen Entrance","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.motion_kitchen_entrance","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":260,"y":400,"wires":[[],[]]},{"id":"7ed52a7170b8a213","type":"api-call-service","z":"62914984f579d881","name":"Bathroom Light on","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.bathrooms"],"data":"{\"color_temp\":\"255\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1670,"y":340,"wires":[["ceb9c26d369631c5"]]},{"id":"0b6a796c40e84fa2","type":"trigger","z":"62914984f579d881","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"4","extend":false,"overrideDelay":false,"units":"s","reset":"motion","bytopic":"all","topic":"topic","outputs":1,"x":1360,"y":340,"wires":[["e65f89e364490324"]]},{"id":"e65f89e364490324","type":"function","z":"62914984f579d881","name":"Time","func":"var d = new Date();\nvar h = d.getHours();\n\nif (h > 22){\n    var brightness = \"80\";\n}\nelse if (h >= 0 && h <= 2 ){\n    var brightness = \"75\";\n}\nelse if (h>2 && h<7){\n    var brightness = \"50\";\n}\nelse{\n    var brightness = \"100\";\n}\n\nvar newMsg = \n\n{ \n    \"payload\": {\n                data: {\n                         \"brightness_pct\": brightness                      }\n               } \n};\nreturn newMsg;\n\n","outputs":1,"noerr":0,"x":1490,"y":340,"wires":[["7ed52a7170b8a213"]]},{"id":"24135e7fd269aea2","type":"server-state-changed","z":"62914984f579d881","name":"LV Entrance","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.motion_livingroom_entry","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":250,"y":440,"wires":[[],[]]},{"id":"ac9f7a787f36a843","type":"server-state-changed","z":"62914984f579d881","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.motion_bathroom_occupancy","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"(on|off)","halt_if_type":"re","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":420,"y":1320,"wires":[[],[]]},{"id":"c1130de3bab69922","type":"trigger","z":"62914984f579d881","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"3","extend":false,"units":"min","reset":"on","bytopic":"all","outputs":1,"x":910,"y":1320,"wires":[["6de65ecb56f2c8fb"]]},{"id":"d8675594a9b0b0c4","type":"switch","z":"62914984f579d881","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":750,"y":1320,"wires":[["24ef072cbe343aaf","c1130de3bab69922"],["c1130de3bab69922"]]},{"id":"24ef072cbe343aaf","type":"api-call-service","z":"62914984f579d881","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.bathrooms"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1330,"y":1240,"wires":[[]]},{"id":"6de65ecb56f2c8fb","type":"api-call-service","z":"62914984f579d881","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.bathrooms"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1390,"y":1320,"wires":[[]]},{"id":"8357a15d22ab6e4f","type":"inject","z":"62914984f579d881","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":180,"y":340,"wires":[["d46e459824e86588"]]},{"id":"0106224d5177a94d","type":"cast-to-client","z":"62914984f579d881","name":"","url":"","contentType":"audio","message":"","language":"en","ip":"192.168.40.26","port":"","volume":"10","x":1910,"y":680,"wires":[[]]},{"id":"edb50470abfa6de1","type":"function","z":"62914984f579d881","name":"Music Selector","func":"var number = msg.number;\nvar number1 = msg.number1;\nvar number2 = msg.number2;\nvar newMsg = {\n    \"payload\": {\n            \"urlList\": [\"http://192.168.0.15:8123/local/muzak/muzak\" + number + \".mp3\",\n            \"http://192.168.0.15:8123/local/muzak/muzak\" + number1 + \".mp3\", \n            \"http://192.168.0.15:8123/local/muzak/muzak\" + number2 + \".mp3\"]\n    }\n};\nreturn newMsg;","outputs":1,"noerr":0,"x":1720,"y":680,"wires":[["0106224d5177a94d"]]},{"id":"d8094eafcc6de7a5","type":"random","z":"62914984f579d881","name":"","low":"1","high":"24","inte":"true","property":"number","x":1360,"y":600,"wires":[["6b913194f6f015c8"]]},{"id":"6b913194f6f015c8","type":"random","z":"62914984f579d881","name":"","low":"1","high":"25","inte":"true","property":"number1","x":1520,"y":600,"wires":[["25afc1e0b6179878"]]},{"id":"25afc1e0b6179878","type":"random","z":"62914984f579d881","name":"","low":"1","high":"25","inte":"true","property":"number2","x":1660,"y":600,"wires":[["edb50470abfa6de1"]]},{"id":"f4a41e9483461728","type":"inject","z":"62914984f579d881","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"1","payloadType":"str","x":1470,"y":740,"wires":[["d8094eafcc6de7a5"]]},{"id":"6637c3bb52f120c9","type":"api-call-service","z":"62914984f579d881","name":"Bathroom Speaker","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_up","areaId":[],"deviceId":[],"entityId":["media_player.bathroom_speaker"],"data":"{\"volume_level\":\"0.7\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1050,"y":680,"wires":[[]]},{"id":"f5861041d494f37e","type":"api-current-state","z":"62914984f579d881","name":"Speaker state","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"media_player.bathroom_speaker","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"state","propertyType":"msg","value":"","valueType":"entityState"},{"property":"entity","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1460,"y":120,"wires":[["735f509d94b7b468","b7f55b5b852817d7"]]},{"id":"dbdfaa6896bcae66","type":"inject","z":"62914984f579d881","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":920,"y":60,"wires":[["f5861041d494f37e"]]},{"id":"735f509d94b7b468","type":"debug","z":"62914984f579d881","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1490,"y":60,"wires":[]},{"id":"b7f55b5b852817d7","type":"switch","z":"62914984f579d881","name":"","property":"entity.attributes.app_name","propertyType":"msg","rules":[{"t":"neq","v":"YouTube Music","vt":"str"},{"t":"nnull"}],"checkall":"false","repair":true,"outputs":2,"x":1650,"y":120,"wires":[["1056df852f1797e7"],["6d3644c9de866147"]]},{"id":"367c6690fe1384fa","type":"function","z":"62914984f579d881","name":"Music/Selector Selector","func":"var d = new Date();\nvar h = d.getHours();\nvar number = msg.number;\nvar number1 = msg.number1;\nvar number2 = msg.number2;\n\n\nif (h > 22){\n    var brightness = \"30\";\n}\nelse if (h >= 0 && h <= 2 ){\n    var brightness = \"20\";\n}\nelse if (h>2 && h<7){\n    var brightness = \"10\";\n}\nelse{\n    var brightness = \"40\";\n}\n\n\n\n\n\n\n\n\nvar newMsg = {\n    \"payload\": {\n            \"urlList\": [\"http://192.168.0.15:8123/local/muzak/muzak\" + number + \".mp3\",\n            \"http://192.168.0.15:8123/local/muzak/muzak\" + number1 + \".mp3\", \n            \"http://192.168.0.15:8123/local/muzak/muzak\" + number2 + \".mp3\"],\n            \"volume\": brightness\n            }\n            \n   }\n\nreturn newMsg;\n\n\n","outputs":1,"noerr":0,"x":2170,"y":600,"wires":[["07556d8fb3b72051","6aa56fbbf0d53594"]]},{"id":"07556d8fb3b72051","type":"cast-to-client","z":"62914984f579d881","name":"","url":"","contentType":"audio","message":"","language":"en","ip":"192.168.40.26","port":"","volume":"10","x":2410,"y":600,"wires":[[]]},{"id":"3fde5cf9716d799a","type":"random","z":"62914984f579d881","name":"","low":"1","high":"24","inte":"true","property":"number","x":1880,"y":500,"wires":[["3796a1ccda9b9cc1"]]},{"id":"3796a1ccda9b9cc1","type":"random","z":"62914984f579d881","name":"","low":"1","high":"25","inte":"true","property":"number1","x":2040,"y":500,"wires":[["7f024601e6f9e27e"]]},{"id":"7f024601e6f9e27e","type":"random","z":"62914984f579d881","name":"","low":"1","high":"25","inte":"true","property":"number2","x":2180,"y":500,"wires":[["367c6690fe1384fa"]]},{"id":"cee5335ff58e67eb","type":"inject","z":"62914984f579d881","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1680,"y":500,"wires":[["3fde5cf9716d799a"]]},{"id":"6aa56fbbf0d53594","type":"debug","z":"62914984f579d881","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2360,"y":520,"wires":[]},{"id":"67df1142d788cf83","type":"function","z":"62914984f579d881","name":"Music Selector","func":"var number = msg.number;\nvar number1 = msg.number1;\nvar number2 = msg.number2;\nvar newMsg = {\n    \"payload\": {\n            \"urlList\": [\"http://192.168.0.15:8123/local/muzak/muzak\" + number + \".mp3\",\n            \"http://192.168.0.15:8123/local/muzak/muzak\" + number1 + \".mp3\", \n            \"http://192.168.0.15:8123/local/muzak/muzak\" + number2 + \".mp3\"]\n    }\n};\nreturn newMsg;","outputs":1,"noerr":0,"x":1860,"y":400,"wires":[[]]},{"id":"622de50bd63e6252","type":"function","z":"62914984f579d881","name":"Music/Selector Selector","func":"var d = new Date();\nvar h = d.getHours();\nvar number = msg.number;\nvar number1 = msg.number1;\nvar number2 = msg.number2;\n\n\nif (h > 22){\n    var brightness = \"30\";\n}\nelse if (h >= 0 && h <= 2 ){\n    var brightness = \"20\";\n}\nelse if (h>2 && h<7){\n    var brightness = \"10\";\n}\nelse{\n    var brightness = \"40\";\n}\n\n\n\n\n\n\n\n\nvar newMsg = {\n    \"payload\": {\n            \"urlList\": [\"http://192.168.0.15:8123/local/muzak/muzak\" + number + \".mp3\",\n            \"http://192.168.0.15:8123/local/muzak/muzak\" + number1 + \".mp3\", \n            \"http://192.168.0.15:8123/local/muzak/muzak\" + number2 + \".mp3\"],\n            \"volume\": brightness\n            }\n            \n   }\n\nreturn newMsg;\n\n\n","outputs":1,"noerr":0,"x":1890,"y":300,"wires":[["ce1932e8d523fa22"]]},{"id":"28b3047be7d84633","type":"function","z":"62914984f579d881","name":"Volume Selector","func":"var d = new Date();\nvar h = d.getHours();\n\n\nif (h > 22){\n    var brightness = \"0.3\";\n}\nelse if (h >= 0 && h <= 2 ){\n    var brightness = \"0.2\";\n}\nelse if (h>2 && h<7){\n    var brightness = \"0.1\";\n}\nelse{\n    var brightness = \"0.4\";\n}\n\n\n\n\n\n\n\n\nvar newMsg = {\n    \"payload\": {\n            \"data\": {\n            \"volume_level\": brightness\n            }\n            }\n            \n   }\n\nreturn newMsg;\n\n\n","outputs":1,"noerr":0,"x":920,"y":1180,"wires":[["584d53eae6c02f02","5e847e2c822d9d97"]]},{"id":"ca593d28ce376205","type":"inject","z":"62914984f579d881","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":720,"y":1180,"wires":[["28b3047be7d84633"]]},{"id":"584d53eae6c02f02","type":"api-call-service","z":"62914984f579d881","name":"Bathroom Speaker","server":"7ab5c227.a3ce8c","version":5,"debugenabled":true,"domain":"media_player","service":"volume_set","areaId":[],"deviceId":[],"entityId":["media_player.bathroom_speaker"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1130,"y":1160,"wires":[[]]},{"id":"5e847e2c822d9d97","type":"debug","z":"62914984f579d881","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1120,"y":1200,"wires":[]},{"id":"f0b1f2ee9bc2b208","type":"api-call-service","z":"62914984f579d881","name":"cast Off","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"media_stop","areaId":[],"deviceId":[],"entityId":["media_player.bathroom_speaker"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1960,"y":160,"wires":[[]]},{"id":"6d3644c9de866147","type":"trigger","z":"62914984f579d881","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"5","extend":false,"units":"min","reset":"motion","bytopic":"all","outputs":1,"x":1770,"y":160,"wires":[["f0b1f2ee9bc2b208"]]},{"id":"d840afe02cc6e920","type":"server-state-changed","z":"62914984f579d881","name":"Bathroom door","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.door_bathroom","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":180,"y":300,"wires":[[],[]]},{"id":"ceb9c26d369631c5","type":"ha-wait-until","z":"62914984f579d881","name":"wait door open","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"binary_sensor.door_bathroom","entityIdFilterType":"exact","property":"state","comparator":"is","value":"on","valueType":"str","timeout":"30","timeoutType":"num","timeoutUnits":"minutes","checkCurrentState":false,"blockInputOverrides":true,"outputProperties":[],"x":1920,"y":340,"wires":[["87df9e89784ae13d"],[]]},{"id":"1c93657999d006e5","type":"api-call-service","z":"62914984f579d881","name":"Bathroom Light Off","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.bathrooms"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload1","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2930,"y":340,"wires":[["e6d4433069732c20"]]},{"id":"87df9e89784ae13d","type":"trigger","z":"62914984f579d881","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"67","extend":false,"overrideDelay":false,"units":"s","reset":"motion","bytopic":"all","topic":"topic","outputs":1,"x":2130,"y":440,"wires":[["df7f530cd34b0563"]]},{"id":"df7f530cd34b0563","type":"ha-wait-until","z":"62914984f579d881","name":"wait door open","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"binary_sensor.door_bathroom","entityIdFilterType":"exact","property":"state","comparator":"is","value":"on","valueType":"str","timeout":"30","timeoutType":"num","timeoutUnits":"seconds","checkCurrentState":true,"blockInputOverrides":true,"outputProperties":[],"x":2180,"y":380,"wires":[["655e470274dffae3"],["87df9e89784ae13d"]]},{"id":"cee25095cb24a6ac","type":"api-call-service","z":"62914984f579d881","name":"cast Off","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"media_stop","areaId":[],"deviceId":[],"entityId":["media_player.bathroom_speaker"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":3940,"y":340,"wires":[[]]},{"id":"784d065a47ce5ba3","type":"api-current-state","z":"62914984f579d881","name":"Speaker state","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"media_player.bathroom_speaker","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"state","propertyType":"msg","value":"","valueType":"entityState"},{"property":"entity","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":3520,"y":340,"wires":[["24e203f33a3e46c4"]]},{"id":"24e203f33a3e46c4","type":"switch","z":"62914984f579d881","name":"","property":"entity.attributes.app_name","propertyType":"msg","rules":[{"t":"neq","v":"YouTube Music","vt":"str"},{"t":"nnull"}],"checkall":"false","repair":true,"outputs":2,"x":3690,"y":340,"wires":[["cee25095cb24a6ac"],["8c688c81ddfeca9a"]]},{"id":"5cd97bed1ec8569f","type":"api-call-service","z":"62914984f579d881","name":"cast Off","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"media_stop","areaId":[],"deviceId":[],"entityId":["media_player.bathroom_speaker"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":3960,"y":380,"wires":[[]]},{"id":"8c688c81ddfeca9a","type":"trigger","z":"62914984f579d881","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"5","extend":false,"units":"min","reset":"motion","bytopic":"all","outputs":1,"x":3810,"y":380,"wires":[["5cd97bed1ec8569f"]]},{"id":"e6d4433069732c20","type":"api-current-state","z":"62914984f579d881","name":"Speaker state","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"media_player.home_group","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":3220,"y":340,"wires":[["784d065a47ce5ba3"],[]]},{"id":"18757545b19255e0","type":"inject","z":"62914984f579d881","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1110,"y":120,"wires":[["b342c608e970b24c"]]},{"id":"655e470274dffae3","type":"api-current-state","z":"62914984f579d881","name":"Motion?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.motion_bathroom","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":2300,"y":320,"wires":[["1c93657999d006e5"],["df7f530cd34b0563"]]},{"id":"72bfd397cd702c8e","type":"trigger","z":"2cc7bfce9974187b","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"3","extend":false,"units":"min","reset":"motion","bytopic":"all","outputs":1,"x":810,"y":160,"wires":[["84e18e21e9dd9ff4"]]},{"id":"a08f57b1171dda68","type":"comment","z":"2cc7bfce9974187b","name":"This prevent the Light from going off as long as the humidity is over 40%(Shower)","info":"","x":480,"y":280,"wires":[]},{"id":"ac3673555eeffef9","type":"change","z":"2cc7bfce9974187b","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"A","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1320,"y":400,"wires":[["9879e858bca8da07"]]},{"id":"77e5d0056da4a761","type":"api-current-state","z":"2cc7bfce9974187b","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.bathrooms","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":650,"y":400,"wires":[[],["fadf63c0ba97e35a","c486434c68967ba8"]]},{"id":"8d27e7aef34d8dab","type":"trigger","z":"2cc7bfce9974187b","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"10","extend":false,"units":"s","reset":"on","bytopic":"all","outputs":1,"x":990,"y":400,"wires":[["0b9fb1d9b33f9466"]]},{"id":"9879e858bca8da07","type":"api-call-service","z":"2cc7bfce9974187b","name":"Bathroom Light Off","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.bathrooms"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1510,"y":400,"wires":[[]]},{"id":"798f2bb5acabecfe","type":"random","z":"2cc7bfce9974187b","name":"","low":"1","high":"36","inte":"true","property":"number","x":1220,"y":220,"wires":[["24cab57cb10e5c89"]]},{"id":"fadf63c0ba97e35a","type":"change","z":"2cc7bfce9974187b","name":"on","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":850,"y":400,"wires":[["8d27e7aef34d8dab"]]},{"id":"22c7389336042dde","type":"api-call-service","z":"2cc7bfce9974187b","name":"cast Off","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"media_stop","areaId":[],"deviceId":[],"entityId":["media_player.bathroom_speaker"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2020,"y":100,"wires":[[]]},{"id":"0b9fb1d9b33f9466","type":"api-current-state","z":"2cc7bfce9974187b","name":"Motion state","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.motion_bathroom","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":1150,"y":400,"wires":[[],["ac3673555eeffef9"]]},{"id":"0725e0584ea76f47","type":"api-call-service","z":"2cc7bfce9974187b","name":"Bathroom Light Off","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.bathrooms"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload1","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1630,"y":140,"wires":[[]]},{"id":"84e18e21e9dd9ff4","type":"api-current-state","z":"2cc7bfce9974187b","name":"Humidity","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.humidity_bathroom","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":960,"y":120,"wires":[["706ed5be7a91d3e0"]]},{"id":"f4d7e893a7e154e0","type":"api-call-service","z":"2cc7bfce9974187b","name":"Bathroom Light on","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.bathrooms"],"data":"{\"color_temp\":\"255\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1290,"y":260,"wires":[["feba2e5b4509af16"]]},{"id":"706ed5be7a91d3e0","type":"switch","z":"2cc7bfce9974187b","name":"","property":"payload","propertyType":"msg","rules":[{"t":"lt","v":"65","vt":"str"},{"t":"gt","v":"65","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1110,"y":140,"wires":[["929d2e17b7d7b5ae","0725e0584ea76f47"],["72bfd397cd702c8e"]]},{"id":"c3a67edf4a8fa7e6","type":"trigger","z":"2cc7bfce9974187b","name":"","op1":"1","op2":"","op1type":"str","op2type":"str","duration":"-30","extend":true,"units":"s","reset":"no_motion","bytopic":"all","outputs":1,"x":810,"y":220,"wires":[["647c57e703d4c7af","f13cfb67bbf400d5"]]},{"id":"e748d3e4a6d8acc7","type":"change","z":"2cc7bfce9974187b","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"motion","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":220,"wires":[["72bfd397cd702c8e","c3a67edf4a8fa7e6"]]},{"id":"de4d3a6119fb72fd","type":"change","z":"2cc7bfce9974187b","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"no_motion","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":140,"wires":[["72bfd397cd702c8e","c3a67edf4a8fa7e6"]]},{"id":"0949695b2744d2bf","type":"switch","z":"2cc7bfce9974187b","name":"","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"off","vt":"str"},{"t":"cont","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":490,"y":880,"wires":[["bb3d35298bb0f780"],["302111b2c104b0c5"]]},{"id":"1e3486819572b13d","type":"api-call-service","z":"2cc7bfce9974187b","name":"Bathroom Speaker","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_set","areaId":[],"deviceId":[],"entityId":["media_player.bathroom_speaker"],"data":"{\"volume_level\":\"0.0\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1070,"y":900,"wires":[[]]},{"id":"f2e31ce0ff5a5b1c","type":"api-call-service","z":"2cc7bfce9974187b","name":"Bathroom Speaker","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_set","areaId":[],"deviceId":[],"entityId":["media_player.bathroom_speaker"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1210,"y":820,"wires":[[]]},{"id":"647c57e703d4c7af","type":"api-current-state","z":"2cc7bfce9974187b","name":"Speaker state","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"playing","halt_if_type":"str","halt_if_compare":"is","entity_id":"media_player.bathroom_speaker","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"state","propertyType":"msg","value":"","valueType":"entityState"},{"property":"entity","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1040,"y":220,"wires":[[],["798f2bb5acabecfe"]]},{"id":"7e85042e228f6e2d","type":"server-state-changed","z":"2cc7bfce9974187b","name":"Door change?","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.door_bathroom","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":330,"y":880,"wires":[["0949695b2744d2bf"]]},{"id":"f13cfb67bbf400d5","type":"api-current-state","z":"2cc7bfce9974187b","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.bathrooms","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":930,"y":260,"wires":[[],["0ea02b5030d1e7c1"]]},{"id":"4c6da4d01d3f88ca","type":"server-state-changed","z":"2cc7bfce9974187b","name":"Humidity over 65","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.humidity_bathroom","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"65","halt_if_type":"num","halt_if_compare":"gt","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":260,"y":540,"wires":[["909f646954961822"],["0390741daffca5b2"]]},{"id":"909f646954961822","type":"api-call-service","z":"2cc7bfce9974187b","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.bathroom_fan"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":670,"y":500,"wires":[["a62f85af1cd5362b"]]},{"id":"0390741daffca5b2","type":"api-call-service","z":"2cc7bfce9974187b","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.bathroom_fan"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":670,"y":560,"wires":[[]]},{"id":"7dddb776442f3bf6","type":"api-current-state","z":"2cc7bfce9974187b","name":"Door state","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.door_bathroom","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"door","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1670,"y":220,"wires":[["a6f2af2b1910de58"]]},{"id":"a6f2af2b1910de58","type":"switch","z":"2cc7bfce9974187b","name":"","property":"door","propertyType":"msg","rules":[{"t":"cont","v":"on","vt":"str"},{"t":"cont","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1810,"y":220,"wires":[["8a6dfab444a65854"],["27438a98bf41c717"]]},{"id":"0ea02b5030d1e7c1","type":"function","z":"2cc7bfce9974187b","name":"Time","func":"var d = new Date();\nvar h = d.getHours();\n\nif (h > 22){\n    var brightness = \"80\";\n}\nelse if (h >= 0 && h <= 2 ){\n    var brightness = \"75\";\n}\nelse if (h>2 && h<7){\n    var brightness = \"50\";\n}\nelse{\n    var brightness = \"100\";\n}\n\nvar newMsg = \n\n{ \n    \"payload\": {\n                data: {\n                         \"brightness_pct\": brightness                      }\n               } \n};\nreturn newMsg;\n\n","outputs":1,"noerr":0,"x":1130,"y":260,"wires":[["f4d7e893a7e154e0"]]},{"id":"3ce1bd2af33f10ed","type":"ha-wait-until","z":"2cc7bfce9974187b","name":"","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"binary_sensor.door_bathroom","entityIdFilterType":"exact","property":"state","comparator":"is","value":"off","valueType":"str","timeout":"30","timeoutType":"num","timeoutUnits":"seconds","checkCurrentState":true,"blockInputOverrides":true,"outputProperties":[],"x":2400,"y":220,"wires":[["9d53207076965daa"],[]]},{"id":"9d53207076965daa","type":"api-call-service","z":"2cc7bfce9974187b","name":"Bathroom Speaker","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_set","areaId":[],"deviceId":[],"entityId":["media_player.bathroom_speaker"],"data":"{\"volume_level\":\"0.4\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2550,"y":220,"wires":[[]]},{"id":"c486434c68967ba8","type":"function","z":"2cc7bfce9974187b","name":"Time","func":"var d = new Date();\nvar h = d.getHours();\n\nif (h > 22){\n    var brightness = \"80\";\n}\nelse if (h >= 0 && h <= 2 ){\n    var brightness = \"75\";\n}\nelse if (h>2 && h<7){\n    var brightness = \"50\";\n}\nelse{\n    var brightness = \"100\";\n}\n\nvar newMsg = \n\n{ \n    \"payload\": {\n                data: {\n                         \"brightness_pct\": brightness                      }\n               } \n};\nreturn newMsg;\n\n","outputs":1,"noerr":0,"x":850,"y":440,"wires":[["040c052c317ea502"]]},{"id":"040c052c317ea502","type":"api-call-service","z":"2cc7bfce9974187b","name":"Bathroom Light on","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.bathrooms"],"data":"{\"color_temp\":\"255\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1010,"y":440,"wires":[[]]},{"id":"e03992e5db39fc03","type":"cast-to-client","z":"2cc7bfce9974187b","name":"","url":"","contentType":"audio","message":"","language":"en","ip":"192.168.40.26","port":"","volume":"10","x":2210,"y":220,"wires":[["3ce1bd2af33f10ed"]]},{"id":"f415c5780d5c46a2","type":"cast-to-client","z":"2cc7bfce9974187b","name":"","url":"","contentType":"audio","message":"","language":"en","ip":"192.168.40.26","port":"","volume":"40","x":2210,"y":260,"wires":[[]]},{"id":"bb3d35298bb0f780","type":"api-current-state","z":"2cc7bfce9974187b","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.bathroom_fan","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":740,"y":820,"wires":[["f47f068525e5c9ee"],["8dde3ccdeea9f81e"]]},{"id":"90d3f381bf7b6b5a","type":"api-call-service","z":"2cc7bfce9974187b","name":"Bathroom Speaker","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_set","areaId":[],"deviceId":[],"entityId":["media_player.bathroom_speaker"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1210,"y":720,"wires":[[]]},{"id":"24cab57cb10e5c89","type":"random","z":"2cc7bfce9974187b","name":"","low":"1","high":"36","inte":"true","property":"number1","x":1380,"y":220,"wires":[["da6220a10da3b0db"]]},{"id":"da6220a10da3b0db","type":"random","z":"2cc7bfce9974187b","name":"","low":"1","high":"36","inte":"true","property":"number2","x":1520,"y":220,"wires":[["7dddb776442f3bf6"]]},{"id":"8a6dfab444a65854","type":"function","z":"2cc7bfce9974187b","name":"Music Selector","func":"var number = msg.number;\nvar number1 = msg.number1;\nvar number2 = msg.number2;\nvar newMsg = {\n    \"payload\": {\n            \"urlList\": [\"http://192.168.0.15:8123/local/muzak/muzak\" + number + \".mp3\",\n            \"http://192.168.0.15:8123/local/muzak/muzak\" + number1 + \".mp3\", \n            \"http://192.168.0.15:8123/local/muzak/muzak\" + number2 + \".mp3\"]\n    }\n};\nreturn newMsg;","outputs":1,"noerr":0,"x":1960,"y":220,"wires":[["e03992e5db39fc03"]]},{"id":"a62f85af1cd5362b","type":"api-current-state","z":"2cc7bfce9974187b","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.door_bathroom","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":950,"y":500,"wires":[[],[]]},{"id":"d43ad0c97eb40662","type":"server-state-changed","z":"2cc7bfce9974187b","name":"Humidity over 65","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.humidity_bathroom","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"65","halt_if_type":"num","halt_if_compare":"gt","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":280,"y":660,"wires":[["c68bfe6d7b1dce87"],[]]},{"id":"c68bfe6d7b1dce87","type":"trigger","z":"2cc7bfce9974187b","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"20","extend":false,"units":"min","reset":"on","bytopic":"all","outputs":1,"x":510,"y":640,"wires":[["89bc79868ccab1c9"]]},{"id":"89bc79868ccab1c9","type":"api-current-state","z":"2cc7bfce9974187b","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.door_bathroom","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":790,"y":640,"wires":[[],["4496a13e8fecdf98"]]},{"id":"017caa3fded6319a","type":"server-state-changed","z":"2cc7bfce9974187b","name":"Bathroom Motion","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.motion_bathroom","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":280,"y":200,"wires":[["de4d3a6119fb72fd"],["e748d3e4a6d8acc7"]]},{"id":"34542c1839078cfc","type":"server-state-changed","z":"2cc7bfce9974187b","name":"Kitchen Entrance","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.motion_kitchen_entrance","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":360,"y":400,"wires":[["77e5d0056da4a761"],[]]},{"id":"302111b2c104b0c5","type":"api-current-state","z":"2cc7bfce9974187b","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is_not","entity_id":"media_player.living_room_tv","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":750,"y":900,"wires":[["1e3486819572b13d"],["33e279e38362db46"]]},{"id":"991e3c063bacac2c","type":"api-call-service","z":"2cc7bfce9974187b","name":"Bathroom Speaker","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_set","areaId":[],"deviceId":[],"entityId":["media_player.bathroom_speaker"],"data":"{\"volume_level\":\"0.1\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1310,"y":960,"wires":[[]]},{"id":"b8ba99a2c157e81a","type":"api-call-service","z":"2cc7bfce9974187b","name":"Bathroom Light on","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.bathrooms"],"data":"{\"color_temp\":\"255\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1770,"y":260,"wires":[[]]},{"id":"feba2e5b4509af16","type":"trigger","z":"2cc7bfce9974187b","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"4","extend":false,"units":"s","reset":"motion","bytopic":"all","outputs":1,"x":1460,"y":260,"wires":[["a42972d9aaa1fc4c"]]},{"id":"a42972d9aaa1fc4c","type":"function","z":"2cc7bfce9974187b","name":"Time","func":"var d = new Date();\nvar h = d.getHours();\n\nif (h > 22){\n    var brightness = \"80\";\n}\nelse if (h >= 0 && h <= 2 ){\n    var brightness = \"75\";\n}\nelse if (h>2 && h<7){\n    var brightness = \"50\";\n}\nelse{\n    var brightness = \"100\";\n}\n\nvar newMsg = \n\n{ \n    \"payload\": {\n                data: {\n                         \"brightness_pct\": brightness                      }\n               } \n};\nreturn newMsg;\n\n","outputs":1,"noerr":0,"x":1590,"y":260,"wires":[["b8ba99a2c157e81a"]]},{"id":"7bcc74c430267c7b","type":"server-state-changed","z":"2cc7bfce9974187b","name":"LV Entrance","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.motion_livingroom_entry","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":350,"y":440,"wires":[["77e5d0056da4a761"],[]]},{"id":"33e279e38362db46","type":"api-current-state","z":"2cc7bfce9974187b","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"playing","halt_if_type":"str","halt_if_compare":"is","entity_id":"media_player.party_group","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1000,"y":960,"wires":[["af14d9a12d4a59bc"],["991e3c063bacac2c"]]},{"id":"106c085522e3711c","type":"inject","z":"2cc7bfce9974187b","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":500,"y":980,"wires":[["302111b2c104b0c5"]]},{"id":"69d559c61533a359","type":"api-call-service","z":"2cc7bfce9974187b","name":"Bathroom Speaker","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_set","areaId":[],"deviceId":[],"entityId":["media_player.bathroom_speaker"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1510,"y":920,"wires":[[]]},{"id":"f3699917c5030c49","type":"server-state-changed","z":"2cc7bfce9974187b","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.motion_bathroom_occupancy","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"(on|off)","halt_if_type":"re","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":520,"y":1240,"wires":[["73eb582d270883a0"],[]]},{"id":"dbf2ec4f77027946","type":"trigger","z":"2cc7bfce9974187b","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"3","extend":false,"units":"min","reset":"on","bytopic":"all","outputs":1,"x":1010,"y":1240,"wires":[["652772e71a16d7b5"]]},{"id":"73eb582d270883a0","type":"switch","z":"2cc7bfce9974187b","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":850,"y":1240,"wires":[["4d380fd2d7b3ab61","dbf2ec4f77027946"],["dbf2ec4f77027946"]]},{"id":"4d380fd2d7b3ab61","type":"api-call-service","z":"2cc7bfce9974187b","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.bathrooms"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1190,"y":1180,"wires":[[]]},{"id":"652772e71a16d7b5","type":"api-call-service","z":"2cc7bfce9974187b","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.bathrooms"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1230,"y":1240,"wires":[[]]},{"id":"8681b7e5b00b09a7","type":"inject","z":"2cc7bfce9974187b","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":260,"y":260,"wires":[["e748d3e4a6d8acc7"]]},{"id":"38f077a757506538","type":"inject","z":"2cc7bfce9974187b","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":240,"y":100,"wires":[["de4d3a6119fb72fd"]]},{"id":"a70b30bcf42f719b","type":"cast-to-client","z":"2cc7bfce9974187b","name":"","url":"","contentType":"audio","message":"","language":"en","ip":"192.168.40.26","port":"","volume":"10","x":2010,"y":600,"wires":[[]]},{"id":"2f3cadb8a25ae06e","type":"function","z":"2cc7bfce9974187b","name":"Music Selector","func":"var number = msg.number;\nvar number1 = msg.number1;\nvar number2 = msg.number2;\nvar newMsg = {\n    \"payload\": {\n            \"urlList\": [\"http://192.168.0.15:8123/local/muzak/muzak\" + number + \".mp3\",\n            \"http://192.168.0.15:8123/local/muzak/muzak\" + number1 + \".mp3\", \n            \"http://192.168.0.15:8123/local/muzak/muzak\" + number2 + \".mp3\"]\n    }\n};\nreturn newMsg;","outputs":1,"noerr":0,"x":1820,"y":600,"wires":[["a70b30bcf42f719b"]]},{"id":"b4fd6126ba52bc5a","type":"random","z":"2cc7bfce9974187b","name":"","low":"1","high":"24","inte":"true","property":"number","x":1460,"y":520,"wires":[["125a838d269315da"]]},{"id":"125a838d269315da","type":"random","z":"2cc7bfce9974187b","name":"","low":"1","high":"25","inte":"true","property":"number1","x":1620,"y":520,"wires":[["f8c91f51c2505f6e"]]},{"id":"f8c91f51c2505f6e","type":"random","z":"2cc7bfce9974187b","name":"","low":"1","high":"25","inte":"true","property":"number2","x":1760,"y":520,"wires":[["2f3cadb8a25ae06e"]]},{"id":"d3bd72c59869e55f","type":"inject","z":"2cc7bfce9974187b","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"1","payloadType":"str","x":1570,"y":660,"wires":[["b4fd6126ba52bc5a"]]},{"id":"4496a13e8fecdf98","type":"api-call-service","z":"2cc7bfce9974187b","name":"Bathroom Speaker","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_up","areaId":[],"deviceId":[],"entityId":["media_player.bathroom_speaker"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1090,"y":640,"wires":[["86fa788a366e9443"]]},{"id":"9faf5885ac1f4b09","type":"inject","z":"2cc7bfce9974187b","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":820,"y":740,"wires":[[]]},{"id":"86fa788a366e9443","type":"api-call-service","z":"2cc7bfce9974187b","name":"Bathroom Speaker","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_up","areaId":[],"deviceId":[],"entityId":["media_player.bathroom_speaker"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1290,"y":640,"wires":[[]]},{"id":"4dc927806423e211","type":"api-call-service","z":"2cc7bfce9974187b","name":"Bathroom Speaker","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_up","areaId":[],"deviceId":[],"entityId":["media_player.bathroom_speaker"],"data":"{\"volume_level\":\"0.7\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1150,"y":600,"wires":[[]]},{"id":"929d2e17b7d7b5ae","type":"api-current-state","z":"2cc7bfce9974187b","name":"Speaker state","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"media_player.bathroom_speaker","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"state","propertyType":"msg","value":"","valueType":"entityState"},{"property":"entity","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1500,"y":100,"wires":[["3d9ba4db5de4d062","3c4d2f55695bd15b"]]},{"id":"6f9b638ff2bf736b","type":"inject","z":"2cc7bfce9974187b","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1000,"y":40,"wires":[["929d2e17b7d7b5ae"]]},{"id":"3d9ba4db5de4d062","type":"debug","z":"2cc7bfce9974187b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1660,"y":60,"wires":[]},{"id":"3c4d2f55695bd15b","type":"switch","z":"2cc7bfce9974187b","name":"","property":"entity.attributes.app_name","propertyType":"msg","rules":[{"t":"neq","v":"YouTube Music","vt":"str"},{"t":"nnull"}],"checkall":"false","repair":true,"outputs":2,"x":1670,"y":100,"wires":[["22c7389336042dde"],["779a26c8815a8b98"]]},{"id":"44538583e2aefeeb","type":"function","z":"2cc7bfce9974187b","name":"Music/Selector Selector","func":"var d = new Date();\nvar h = d.getHours();\nvar number = msg.number;\nvar number1 = msg.number1;\nvar number2 = msg.number2;\n\n\nif (h > 22){\n    var brightness = \"30\";\n}\nelse if (h >= 0 && h <= 2 ){\n    var brightness = \"20\";\n}\nelse if (h>2 && h<7){\n    var brightness = \"10\";\n}\nelse{\n    var brightness = \"40\";\n}\n\n\n\n\n\n\n\n\nvar newMsg = {\n    \"payload\": {\n            \"urlList\": [\"http://192.168.0.15:8123/local/muzak/muzak\" + number + \".mp3\",\n            \"http://192.168.0.15:8123/local/muzak/muzak\" + number1 + \".mp3\", \n            \"http://192.168.0.15:8123/local/muzak/muzak\" + number2 + \".mp3\"],\n            \"volume\": brightness\n            }\n            \n   }\n\nreturn newMsg;\n\n\n","outputs":1,"noerr":0,"x":2270,"y":520,"wires":[["4f03e8191637daa8","964eb61456296b66"]]},{"id":"4f03e8191637daa8","type":"cast-to-client","z":"2cc7bfce9974187b","name":"","url":"","contentType":"audio","message":"","language":"en","ip":"192.168.40.26","port":"","volume":"10","x":2510,"y":520,"wires":[[]]},{"id":"3fe9ada2261aacf2","type":"random","z":"2cc7bfce9974187b","name":"","low":"1","high":"24","inte":"true","property":"number","x":1980,"y":420,"wires":[["88263d677b7cd8e3"]]},{"id":"88263d677b7cd8e3","type":"random","z":"2cc7bfce9974187b","name":"","low":"1","high":"25","inte":"true","property":"number1","x":2140,"y":420,"wires":[["1571cdbcb7410dd5"]]},{"id":"1571cdbcb7410dd5","type":"random","z":"2cc7bfce9974187b","name":"","low":"1","high":"25","inte":"true","property":"number2","x":2280,"y":420,"wires":[["44538583e2aefeeb"]]},{"id":"9d98bd31319ef852","type":"inject","z":"2cc7bfce9974187b","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1780,"y":420,"wires":[["3fe9ada2261aacf2"]]},{"id":"964eb61456296b66","type":"debug","z":"2cc7bfce9974187b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2460,"y":440,"wires":[]},{"id":"16101b9482ba94f1","type":"function","z":"2cc7bfce9974187b","name":"Music Selector","func":"var number = msg.number;\nvar number1 = msg.number1;\nvar number2 = msg.number2;\nvar newMsg = {\n    \"payload\": {\n            \"urlList\": [\"http://192.168.0.15:8123/local/muzak/muzak\" + number + \".mp3\",\n            \"http://192.168.0.15:8123/local/muzak/muzak\" + number1 + \".mp3\", \n            \"http://192.168.0.15:8123/local/muzak/muzak\" + number2 + \".mp3\"]\n    }\n};\nreturn newMsg;","outputs":1,"noerr":0,"x":1960,"y":320,"wires":[[]]},{"id":"27438a98bf41c717","type":"function","z":"2cc7bfce9974187b","name":"Music/Selector Selector","func":"var d = new Date();\nvar h = d.getHours();\nvar number = msg.number;\nvar number1 = msg.number1;\nvar number2 = msg.number2;\n\n\nif (h > 22){\n    var brightness = \"30\";\n}\nelse if (h >= 0 && h <= 2 ){\n    var brightness = \"20\";\n}\nelse if (h>2 && h<7){\n    var brightness = \"10\";\n}\nelse{\n    var brightness = \"40\";\n}\n\n\n\n\n\n\n\n\nvar newMsg = {\n    \"payload\": {\n            \"urlList\": [\"http://192.168.0.15:8123/local/muzak/muzak\" + number + \".mp3\",\n            \"http://192.168.0.15:8123/local/muzak/muzak\" + number1 + \".mp3\", \n            \"http://192.168.0.15:8123/local/muzak/muzak\" + number2 + \".mp3\"],\n            \"volume\": brightness\n            }\n            \n   }\n\nreturn newMsg;\n\n\n","outputs":1,"noerr":0,"x":1990,"y":260,"wires":[["f415c5780d5c46a2"]]},{"id":"18337752adde25a7","type":"function","z":"2cc7bfce9974187b","name":"Volume Selector","func":"var d = new Date();\nvar h = d.getHours();\n\n\nif (h > 22){\n    var brightness = \"0.3\";\n}\nelse if (h >= 0 && h <= 2 ){\n    var brightness = \"0.2\";\n}\nelse if (h>2 && h<7){\n    var brightness = \"0.1\";\n}\nelse{\n    var brightness = \"0.4\";\n}\n\n\n\n\n\n\n\n\nvar newMsg = {\n    \"payload\": {\n            \"data\": {\n            \"volume_level\": brightness\n            }\n            }\n            \n   }\n\nreturn newMsg;\n\n\n","outputs":1,"noerr":0,"x":1020,"y":1100,"wires":[["bb9aaf7ba88daf40","5b0399a8082b4ded"]]},{"id":"92e85c8e307db927","type":"inject","z":"2cc7bfce9974187b","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":820,"y":1100,"wires":[["18337752adde25a7"]]},{"id":"bb9aaf7ba88daf40","type":"api-call-service","z":"2cc7bfce9974187b","name":"Bathroom Speaker","server":"7ab5c227.a3ce8c","version":5,"debugenabled":true,"domain":"media_player","service":"volume_set","areaId":[],"deviceId":[],"entityId":["media_player.bathroom_speaker"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1230,"y":1080,"wires":[[]]},{"id":"5b0399a8082b4ded","type":"debug","z":"2cc7bfce9974187b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1180,"y":1140,"wires":[]},{"id":"8dde3ccdeea9f81e","type":"function","z":"2cc7bfce9974187b","name":"Volume Selector","func":"var d = new Date();\nvar h = d.getHours();\n\n\nif (h > 22){\n    var brightness = \"0.35\";\n}\nelse if (h >= 0 && h <= 2 ){\n    var brightness = \"0.25\";\n}\nelse if (h>2 && h<8){\n    var brightness = \"0.15\";\n}\nelse{\n    var brightness = \"0.4\";\n}\n\n\n\n\n\n\n\n\nvar newMsg = {\n    \"payload\": {\n            \"data\": {\n            \"volume_level\": brightness\n            }\n            }\n            \n   }\n\nreturn newMsg;\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1000,"y":820,"wires":[["f2e31ce0ff5a5b1c"]]},{"id":"f47f068525e5c9ee","type":"function","z":"2cc7bfce9974187b","name":"Volume Selector","func":"var d = new Date();\nvar h = d.getHours();\n\n\nif (h > 22){\n    var brightness = \"0.4\";\n}\nelse if (h >= 0 && h <= 2 ){\n    var brightness = \"0.35\";\n}\nelse if (h>2 && h<7){\n    var brightness = \"0.3\";\n}\nelse{\n    var brightness = \"0.4\";\n}\n\n\n\n\n\n\n\n\nvar newMsg = {\n    \"payload\": {\n            \"data\": {\n            \"volume_level\": brightness\n            }\n            }\n            \n   }\n\nreturn newMsg;\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1000,"y":760,"wires":[["90d3f381bf7b6b5a"]]},{"id":"0b6d18d1e8b70efd","type":"api-call-service","z":"2cc7bfce9974187b","name":"cast Off","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"media_stop","areaId":[],"deviceId":[],"entityId":["media_player.bathroom_speaker"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2040,"y":140,"wires":[[]]},{"id":"779a26c8815a8b98","type":"trigger","z":"2cc7bfce9974187b","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"5","extend":false,"units":"min","reset":"motion","bytopic":"all","outputs":1,"x":1850,"y":140,"wires":[["0b6d18d1e8b70efd"]]},{"id":"57b7182be5211537","type":"server-state-changed","z":"2cc7bfce9974187b","name":"Bathroom door","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.door_bathroom","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":260,"y":160,"wires":[["de4d3a6119fb72fd"],["e748d3e4a6d8acc7"]]},{"id":"af14d9a12d4a59bc","type":"function","z":"2cc7bfce9974187b","name":"Volume Selector","func":"var d = new Date();\nvar h = d.getHours();\n\n\nif (h > 22){\n    var brightness = \"0.35\";\n}\nelse if (h >= 0 && h <= 2 ){\n    var brightness = \"0.25\";\n}\nelse if (h>2 && h<8){\n    var brightness = \"0.15\";\n}\nelse{\n    var brightness = \"0.4\";\n}\n\n\n\n\n\n\n\n\nvar newMsg = {\n    \"payload\": {\n            \"data\": {\n            \"volume_level\": brightness\n            }\n            }\n            \n   }\n\nreturn newMsg;\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1280,"y":920,"wires":[["69d559c61533a359"]]},{"id":"7eda3eb589b2ea8e","type":"delay","z":"933f5581a37dd52c","name":"Delay","pauseType":"delay","timeout":"1","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":1270,"y":600,"wires":[["faf7be1af95146ae"]]},{"id":"faf7be1af95146ae","type":"change","z":"933f5581a37dd52c","name":"Reset","rules":[{"t":"set","p":"reset","pt":"msg","to":"foo","tot":"str"},{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1450,"y":600,"wires":[["8a301cae264d3533"]]},{"id":"7ccd40e93a276211","type":"api-current-state","z":"933f5581a37dd52c","name":"b7","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.b7bracelet1","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"location","propertyType":"msg","value":"","valueType":"entityState"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":1030,"y":540,"wires":[["8a301cae264d3533","401ca565b25fb13d"]]},{"id":"e251c8e0979fa2ac","type":"switch","z":"933f5581a37dd52c","name":"count presses","property":"count","propertyType":"flow","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"num"},{"t":"eq","v":"3","vt":"num"},{"t":"eq","v":"4","vt":"num"},{"t":"eq","v":"5","vt":"num"}],"checkall":"true","repair":false,"outputs":5,"x":1630,"y":640,"wires":[["a9dbc1eaf7a99840"],["4d3fcc087692f8f7"],["061eeb741dd75d76"],["28818cdcb9aea2a2"],["053cfa396de504ff"]],"info":"Just expand the flow.count to how ever many\npresses you want/need."},{"id":"8a301cae264d3533","type":"counter","z":"933f5581a37dd52c","name":"","init":"0","step":"1","lower":"","upper":"","mode":"increment","outputs":"1","x":1450,"y":540,"wires":[["dab811d3aa55cbbb"]]},{"id":"f0093527c390e7d5","type":"inject","z":"933f5581a37dd52c","name":"Reset","repeat":"","crontab":"","once":true,"onceDelay":"0.5","topic":"","payload":"","payloadType":"date","x":1270,"y":560,"wires":[["faf7be1af95146ae"]]},{"id":"d46e3e1f0c3f672b","type":"change","z":"933f5581a37dd52c","name":"command","rules":[{"t":"set","p":"command","pt":"msg","to":"up","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":890,"y":460,"wires":[["7ccd40e93a276211"]]},{"id":"5c6651bd9d231831","type":"change","z":"933f5581a37dd52c","name":"command","rules":[{"t":"set","p":"command","pt":"msg","to":"down","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":890,"y":500,"wires":[["7ccd40e93a276211"]]},{"id":"97a3057cac8a6407","type":"change","z":"933f5581a37dd52c","name":"command","rules":[{"t":"set","p":"command","pt":"msg","to":"off","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":790,"y":540,"wires":[["7ccd40e93a276211"]]},{"id":"df7bc71760bdb52a","type":"change","z":"933f5581a37dd52c","name":"command","rules":[{"t":"set","p":"command","pt":"msg","to":"on","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":790,"y":580,"wires":[["7ccd40e93a276211"]]},{"id":"a9dbc1eaf7a99840","type":"change","z":"933f5581a37dd52c","name":"Single Press","rules":[{"t":"set","p":"pressamount","pt":"msg","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1840,"y":580,"wires":[["61324482911d6fe5"]]},{"id":"4d3fcc087692f8f7","type":"change","z":"933f5581a37dd52c","name":"Double Press","rules":[{"t":"set","p":"pressamount","pt":"msg","to":"2","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1850,"y":620,"wires":[["61324482911d6fe5"]]},{"id":"061eeb741dd75d76","type":"change","z":"933f5581a37dd52c","name":"Triple Press","rules":[{"t":"set","p":"pressamount","pt":"msg","to":"3","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1840,"y":660,"wires":[["61324482911d6fe5"]]},{"id":"28818cdcb9aea2a2","type":"change","z":"933f5581a37dd52c","name":"Four Press","rules":[{"t":"set","p":"pressamount","pt":"msg","to":"4","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1840,"y":700,"wires":[["61324482911d6fe5"]]},{"id":"dab811d3aa55cbbb","type":"change","z":"933f5581a37dd52c","name":"Flow set","rules":[{"t":"set","p":"count","pt":"flow","to":"count","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1610,"y":540,"wires":[["951e41f7fe8a8d19"]]},{"id":"ca31fb2d54aeeabd","type":"switch","z":"933f5581a37dd52c","name":"Ste?","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"up","vt":"str"},{"t":"cont","v":"down","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":760,"y":500,"wires":[["d46e3e1f0c3f672b"],["5c6651bd9d231831"]]},{"id":"604c2e5b40e35943","type":"switch","z":"933f5581a37dd52c","name":"Command?","property":"payload","propertyType":"msg","rules":[{"t":"regex","v":"(up_press$|down_press$)","vt":"str","case":true},{"t":"eq","v":"off_press","vt":"str"},{"t":"eq","v":"on_press","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":610,"y":520,"wires":[["ca31fb2d54aeeabd"],["97a3057cac8a6407"],["df7bc71760bdb52a"]]},{"id":"61324482911d6fe5","type":"delay","z":"933f5581a37dd52c","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":2020,"y":660,"wires":[["74dfe04a388c11fe","b2e71a0dd8285867","21d342f5e6f65e21"]]},{"id":"951e41f7fe8a8d19","type":"debug","z":"933f5581a37dd52c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"count","targetType":"msg","statusVal":"","statusType":"auto","x":1840,"y":540,"wires":[]},{"id":"74dfe04a388c11fe","type":"switch","z":"933f5581a37dd52c","name":"Where?","property":"location","propertyType":"msg","rules":[{"t":"cont","v":"bedroom","vt":"str"},{"t":"cont","v":"not_home","vt":"str"},{"t":"cont","v":"hotbox","vt":"str"},{"t":"cont","v":"livingroom","vt":"str"},{"t":"cont","v":"kitchen","vt":"str"},{"t":"cont","v":"patio","vt":"str"},{"t":"cont","v":"bathroom","vt":"str"}],"checkall":"false","repair":false,"outputs":7,"x":2170,"y":660,"wires":[["b707b1f3fac181dd","a2582ee0170c26ce"],["b707b1f3fac181dd","a2582ee0170c26ce"],["1647a17ed447b30c"],["c2dba062682cb223","e995b61ee5af4baa"],["e4404a46e419386e"],["4401ad2a0d09eb11"],["ad72f1db01fb1844"]]},{"id":"7af7d3b7a473b57a","type":"debug","z":"933f5581a37dd52c","name":"first","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":610,"y":400,"wires":[]},{"id":"f2eeb853583688c7","type":"api-current-state","z":"933f5581a37dd52c","name":"MAxi speakers","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"(playing|paused)","halt_if_type":"re","halt_if_compare":"is","entity_id":"media_player.group_maxi_speakers","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"data.entity","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1920,"y":340,"wires":[["1ff72288c10be7af"],["f5a4259b583436d3"]]},{"id":"b707b1f3fac181dd","type":"switch","z":"933f5581a37dd52c","name":"Actions","property":"command","propertyType":"msg","rules":[{"t":"cont","v":"on","vt":"str"},{"t":"cont","v":"off","vt":"str"}],"checkall":"false","repair":true,"outputs":2,"x":2360,"y":180,"wires":[["73f8126b172d8d24"],["b96918d98aa8f0a6"]]},{"id":"5b84962a20066e47","type":"api-current-state","z":"933f5581a37dd52c","name":"HotboxStop","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"(playing|paused)","halt_if_type":"re","halt_if_compare":"is","entity_id":"media_player.hotbox_speaker","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"data.entity","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":2210,"y":480,"wires":[["d6f487fa60b6b303"],["b358f4d5d4f57d8d"]]},{"id":"8dedf648b9898060","type":"api-current-state","z":"933f5581a37dd52c","name":"LVSpeakerW","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"(playing|paused)","halt_if_type":"re","halt_if_compare":"is","entity_id":"media_player.living_room_window_speaker","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"data.entity","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":2230,"y":1040,"wires":[["24a77a57aa08f003"],["4b0a76d25e54223a"]]},{"id":"e4404a46e419386e","type":"api-current-state","z":"933f5581a37dd52c","name":"KitchenSpeaker","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"(playing|paused)","halt_if_type":"re","halt_if_compare":"is","entity_id":"media_player.kitchen_speaker","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"data.entity","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":2240,"y":1140,"wires":[["414d8b86396a73d2"],["7bfb04403e75cd9c"]]},{"id":"4401ad2a0d09eb11","type":"api-current-state","z":"933f5581a37dd52c","name":"ServerS","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"(playing|paused)","halt_if_type":"re","halt_if_compare":"is","entity_id":"media_player.server_speaker","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"data.entity","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":2220,"y":1240,"wires":[["df7ff12e363fec3e"],["705c9de52ee23f35"]]},{"id":"ad72f1db01fb1844","type":"api-current-state","z":"933f5581a37dd52c","name":"BAthroomS","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"(playing|paused)","halt_if_type":"re","halt_if_compare":"is","entity_id":"media_player.bathroom_speaker","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"data.entity","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":2210,"y":1340,"wires":[["1082ee557bc692f7"],["9faa0d691663ceed"]]},{"id":"1ff72288c10be7af","type":"change","z":"933f5581a37dd52c","name":"maxi speakers","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"media_player.group_maxi_speakers\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1920,"y":300,"wires":[["151f1963fecf0607"]]},{"id":"e16abcee378dd6d5","type":"api-current-state","z":"933f5581a37dd52c","name":"Dungeo?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"(playing|paused)","halt_if_type":"re","halt_if_compare":"is","entity_id":"media_player.dungeon_speaker","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"data.entity","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":2240,"y":340,"wires":[["62c914e60d903899"],["adcfce4ade885675"]]},{"id":"73f8126b172d8d24","type":"switch","z":"933f5581a37dd52c","name":"presses","property":"pressamount","propertyType":"msg","rules":[{"t":"eq","v":"3","vt":"num"},{"t":"eq","v":"4","vt":"num"}],"checkall":"false","repair":true,"outputs":2,"x":2500,"y":160,"wires":[["62e8476ce51168b9"],["a38b3a45d7a24b40"]]},{"id":"b96918d98aa8f0a6","type":"switch","z":"933f5581a37dd52c","name":"presses","property":"pressamount","propertyType":"msg","rules":[{"t":"eq","v":"3","vt":"num"},{"t":"eq","v":"4","vt":"num"}],"checkall":"false","repair":true,"outputs":2,"x":2520,"y":200,"wires":[["a7769c85728b7eae"],["09917881fce29b61"]]},{"id":"d6f487fa60b6b303","type":"change","z":"933f5581a37dd52c","name":"HotboxSTop","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"media_player.hotbox_speaker\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":2210,"y":440,"wires":[["052b675a64ed69b9"]]},{"id":"b358f4d5d4f57d8d","type":"api-current-state","z":"933f5581a37dd52c","name":"HotboxSdown","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"(playing|paused)","halt_if_type":"re","halt_if_compare":"is","entity_id":"media_player.hotbox_down_speaker","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"data.entity","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":2380,"y":480,"wires":[["b315582540cef332"],["8bc0c8a92c54372e"]]},{"id":"24a77a57aa08f003","type":"change","z":"933f5581a37dd52c","name":"set entity","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"media_player.living_room_window_speaker\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":2240,"y":1000,"wires":[["914fc6977ecda928"]]},{"id":"4b0a76d25e54223a","type":"api-current-state","z":"933f5581a37dd52c","name":"LVSpeakerTV","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"(playing|paused)","halt_if_type":"re","halt_if_compare":"is","entity_id":"media_player.living_room_speaker","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"data.entity","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":2420,"y":1040,"wires":[["313761cbd8e8cc83"],["b683d3c5dc18c9e8"]]},{"id":"414d8b86396a73d2","type":"change","z":"933f5581a37dd52c","name":"set entity","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"media_player.kitchen_speaker\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":2240,"y":1100,"wires":[["84e3d11a74d7b3f0"]]},{"id":"7bfb04403e75cd9c","type":"delay","z":"933f5581a37dd52c","name":"Lights","pauseType":"delay","timeout":"0","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":3100,"y":1140,"wires":[["724ea66aa6af5a85"]]},{"id":"df7ff12e363fec3e","type":"change","z":"933f5581a37dd52c","name":"set entity","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"media_player.server_speaker\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":2240,"y":1200,"wires":[["58596053ccf4745a"]]},{"id":"705c9de52ee23f35","type":"api-current-state","z":"933f5581a37dd52c","name":"PatioTV","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"(playing|paused)","halt_if_type":"re","halt_if_compare":"is","entity_id":"media_player.patio_chromecast","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"data.entity","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":2400,"y":1240,"wires":[["28387c6a2f2b3d0a"],["20ed761cdc12302b"]]},{"id":"1082ee557bc692f7","type":"change","z":"933f5581a37dd52c","name":"set entity","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"media_player.bathroom_speaker\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":2220,"y":1300,"wires":[["8b57db222e735ddc"]]},{"id":"9faa0d691663ceed","type":"delay","z":"933f5581a37dd52c","name":"Lights","pauseType":"delay","timeout":"0","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":3090,"y":1340,"wires":[["724ea66aa6af5a85"]]},{"id":"151f1963fecf0607","type":"delay","z":"933f5581a37dd52c","name":"Action","pauseType":"delay","timeout":"0","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":2990,"y":300,"wires":[["df04f2923a255b17","dccde5863cfee895"]]},{"id":"62c914e60d903899","type":"change","z":"933f5581a37dd52c","name":"Dungeon","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"media_player.dungeon_speaker\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":2240,"y":300,"wires":[["151f1963fecf0607"]]},{"id":"62e8476ce51168b9","type":"api-call-service","z":"933f5581a37dd52c","name":"Blind up","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"cover","service":"open_cover","areaId":[],"deviceId":[],"entityId":["cover.cover_bedroom_blinds"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2680,"y":100,"wires":[[]]},{"id":"ac394a05ef3653b0","type":"api-call-service","z":"933f5581a37dd52c","name":"screens on","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.plug_bedroom_screens"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2970,"y":120,"wires":[[]]},{"id":"a7769c85728b7eae","type":"api-call-service","z":"933f5581a37dd52c","name":"Blind down","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"cover","service":"close_cover","areaId":[],"deviceId":[],"entityId":["cover.cover_bedroom_blinds"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2690,"y":180,"wires":[[]]},{"id":"60e8aefe4c72a2f8","type":"api-call-service","z":"933f5581a37dd52c","name":"Screens off","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.plug_bedroom_screens"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2890,"y":200,"wires":[[]]},{"id":"052b675a64ed69b9","type":"delay","z":"933f5581a37dd52c","name":"Action","pauseType":"delay","timeout":"0","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":3010,"y":440,"wires":[["a1fe8fca019a4242"]]},{"id":"b315582540cef332","type":"change","z":"933f5581a37dd52c","name":"HotboxSDown","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"media_player.hotbox_down_speaker\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":2380,"y":440,"wires":[["052b675a64ed69b9"]]},{"id":"8bc0c8a92c54372e","type":"api-current-state","z":"933f5581a37dd52c","name":"HotboxTVT","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"(playing|paused)","halt_if_type":"re","halt_if_compare":"is","entity_id":"media_player.hotbox_top_chromecast","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"data.entity","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":2550,"y":480,"wires":[["85bfd74a4b4cd3fd"],["76bf04d0a1ad960a"]]},{"id":"914fc6977ecda928","type":"delay","z":"933f5581a37dd52c","name":"Action","pauseType":"delay","timeout":"0","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":2790,"y":1000,"wires":[["68bfea40cb637c9b"]]},{"id":"313761cbd8e8cc83","type":"change","z":"933f5581a37dd52c","name":"set entity","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"media_player.living_room_speaker\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":2420,"y":1000,"wires":[["914fc6977ecda928"]]},{"id":"b683d3c5dc18c9e8","type":"api-current-state","z":"933f5581a37dd52c","name":"LVTV","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"(playing|paused)","halt_if_type":"re","halt_if_compare":"is","entity_id":"media_player.livingroom_chromecast","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"data.entity","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":2630,"y":1040,"wires":[["bdc231c126a0de02"],["edd8b7f18891ec17"]]},{"id":"84e3d11a74d7b3f0","type":"delay","z":"933f5581a37dd52c","name":"Action","pauseType":"delay","timeout":"0","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":2790,"y":1100,"wires":[["21e7c649df1f7f5b"]]},{"id":"cdbd2791507b6364","type":"switch","z":"933f5581a37dd52c","name":"Where?","property":"location","propertyType":"msg","rules":[{"t":"cont","v":"bedroom","vt":"str"},{"t":"cont","v":"not_home","vt":"str"},{"t":"cont","v":"hotbox","vt":"str"},{"t":"cont","v":"livingroom","vt":"str"},{"t":"cont","v":"kitchen","vt":"str"},{"t":"cont","v":"patio","vt":"str"},{"t":"cont","v":"Bathroom","vt":"str"}],"checkall":"false","repair":false,"outputs":7,"x":4080,"y":200,"wires":[["12238a713745a7d3"],["12238a713745a7d3"],["13f3f50c3d5ddd56"],["bbbcb77500e0c5cc"],["ad9dc8f13fc57340"],["d1dc4030bca8869d"],[]]},{"id":"58596053ccf4745a","type":"delay","z":"933f5581a37dd52c","name":"Action","pauseType":"delay","timeout":"0","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":2790,"y":1200,"wires":[["e7fd9fbdfdbfe732"]]},{"id":"28387c6a2f2b3d0a","type":"change","z":"933f5581a37dd52c","name":"set entity","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"media_player.patio_chromecast\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":2420,"y":1200,"wires":[["58596053ccf4745a"]]},{"id":"20ed761cdc12302b","type":"delay","z":"933f5581a37dd52c","name":"Lights","pauseType":"delay","timeout":"0","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":3090,"y":1240,"wires":[["724ea66aa6af5a85"]]},{"id":"8b57db222e735ddc","type":"delay","z":"933f5581a37dd52c","name":"Action","pauseType":"delay","timeout":"0","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":2750,"y":1300,"wires":[["f4d96017c0b01350"]]},{"id":"9eefd3eaa566fef7","type":"switch","z":"933f5581a37dd52c","name":"Actions","property":"command","propertyType":"msg","rules":[{"t":"cont","v":"on","vt":"str"},{"t":"cont","v":"up","vt":"str"},{"t":"cont","v":"down","vt":"str"},{"t":"cont","v":"off","vt":"str"}],"checkall":"false","repair":true,"outputs":4,"x":3720,"y":340,"wires":[["7fbbd5b4666692af"],["74fe08d15056f7f9"],["8b64f3e84f712078"],["83daf28d1c4ca1b1"]]},{"id":"83578c147b05105f","type":"delay","z":"933f5581a37dd52c","name":"Lights","pauseType":"delay","timeout":"0","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":3250,"y":340,"wires":[["724ea66aa6af5a85"]]},{"id":"85bfd74a4b4cd3fd","type":"change","z":"933f5581a37dd52c","name":"HotboxTVT","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"media_player.hotbox_top_chromecast\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":2550,"y":440,"wires":[["052b675a64ed69b9"]]},{"id":"8066eac7c4aa7d00","type":"change","z":"933f5581a37dd52c","name":"HotboxTVD","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"media_player.hotbox_down_chromecast\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":2730,"y":440,"wires":[["052b675a64ed69b9"]]},{"id":"76bf04d0a1ad960a","type":"api-current-state","z":"933f5581a37dd52c","name":"HotboxTVD","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"(playing|paused)","halt_if_type":"re","halt_if_compare":"is","entity_id":"media_player.hotbox_down_chromecast","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"data.entity","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":2710,"y":480,"wires":[["8066eac7c4aa7d00"],["781a8af1762ae28d"]]},{"id":"bdc231c126a0de02","type":"change","z":"933f5581a37dd52c","name":"set entity","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"media_player.livingroom_chromecast\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":2640,"y":1000,"wires":[["914fc6977ecda928"]]},{"id":"edd8b7f18891ec17","type":"delay","z":"933f5581a37dd52c","name":"Lights","pauseType":"delay","timeout":"0","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":3100,"y":1040,"wires":[["724ea66aa6af5a85"]]},{"id":"30bcd364e3198e99","type":"delay","z":"933f5581a37dd52c","name":"Lights","pauseType":"delay","timeout":"0","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":3270,"y":480,"wires":[["724ea66aa6af5a85"]]},{"id":"12238a713745a7d3","type":"change","z":"933f5581a37dd52c","name":"Bedroom","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"light.bedroom_lights\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":4260,"y":40,"wires":[["be1a1db6c15f316b"]]},{"id":"13f3f50c3d5ddd56","type":"change","z":"933f5581a37dd52c","name":"HotBox","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":[\"light.hotbox_lights\"]}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":4260,"y":80,"wires":[["be1a1db6c15f316b","10e097f0fcce8cf3"]]},{"id":"bbbcb77500e0c5cc","type":"change","z":"933f5581a37dd52c","name":"LivingRo","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":[\"light.group_livingroom_lights\"]}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":4260,"y":120,"wires":[["be1a1db6c15f316b"]]},{"id":"ad9dc8f13fc57340","type":"change","z":"933f5581a37dd52c","name":"Kitchen","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":[\"light.group_kitchen_lights\"]}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":4260,"y":160,"wires":[["be1a1db6c15f316b"]]},{"id":"d1dc4030bca8869d","type":"change","z":"933f5581a37dd52c","name":"Patio","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"light.patio_lights\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":4250,"y":200,"wires":[["be1a1db6c15f316b"]]},{"id":"7fbbd5b4666692af","type":"switch","z":"933f5581a37dd52c","name":"Actions","property":"pressamount","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"num"}],"checkall":"false","repair":true,"outputs":2,"x":3860,"y":200,"wires":[["f12a1e726663a65e"],["cdbd2791507b6364"]]},{"id":"74fe08d15056f7f9","type":"switch","z":"933f5581a37dd52c","name":"Actions","property":"pressamount","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"num"},{"t":"eq","v":"3","vt":"num"}],"checkall":"false","repair":true,"outputs":3,"x":3880,"y":320,"wires":[["b03644fb7ed5a0a7"],["cdbd2791507b6364"],["25a1023d6f9bbbb5"]]},{"id":"8b64f3e84f712078","type":"switch","z":"933f5581a37dd52c","name":"Actions","property":"pressamount","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"num"},{"t":"eq","v":"3","vt":"num"}],"checkall":"false","repair":true,"outputs":3,"x":3880,"y":380,"wires":[["d5a19c27e1b9b0ac","16f62f47e8cdb911"],["cdbd2791507b6364"],["c0edfd57e02ce14a"]]},{"id":"83daf28d1c4ca1b1","type":"switch","z":"933f5581a37dd52c","name":"Actions","property":"pressamount","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"num"},{"t":"eq","v":"5","vt":"str"}],"checkall":"false","repair":true,"outputs":3,"x":3880,"y":440,"wires":[["f6253b46f0db9687"],["cdbd2791507b6364"],["f76e0cc8cd2d017d"]]},{"id":"be1a1db6c15f316b","type":"switch","z":"933f5581a37dd52c","name":"","property":"command","propertyType":"msg","rules":[{"t":"cont","v":"on","vt":"str"},{"t":"cont","v":"up","vt":"str"},{"t":"cont","v":"down","vt":"str"},{"t":"cont","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":4470,"y":100,"wires":[["6450468126476966"],["d2471aaf5e8e7bcf"],["39c38bee6add2d84"],["ffde540b34cb55f0"]]},{"id":"10e097f0fcce8cf3","type":"debug","z":"933f5581a37dd52c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":4450,"y":180,"wires":[]},{"id":"f12a1e726663a65e","type":"api-call-service","z":"933f5581a37dd52c","name":"Play","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"media_play","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":3890,"y":100,"wires":[[]]},{"id":"4a87be609378f3f5","type":"api-call-service","z":"933f5581a37dd52c","name":"V. Up S","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_up","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4540,"y":300,"wires":[[]]},{"id":"25a1023d6f9bbbb5","type":"api-call-service","z":"933f5581a37dd52c","name":"Skip","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"media_seek","areaId":[],"deviceId":[],"entityId":[],"data":"{\"seek_position\": \"100000\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4080,"y":340,"wires":[[]]},{"id":"c0edfd57e02ce14a","type":"api-call-service","z":"933f5581a37dd52c","name":"Return Start","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"media_seek","areaId":[],"deviceId":[],"entityId":[],"data":"{\"seek_position\": \"0\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4080,"y":420,"wires":[[]]},{"id":"f6253b46f0db9687","type":"api-call-service","z":"933f5581a37dd52c","name":"Pause","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"media_pause","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4060,"y":460,"wires":[[]]},{"id":"6450468126476966","type":"api-call-service","z":"933f5581a37dd52c","name":"Lights on","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4660,"y":60,"wires":[[]]},{"id":"d2471aaf5e8e7bcf","type":"api-call-service","z":"933f5581a37dd52c","name":"Brigthen lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"{\"brightness_step\":25}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4680,"y":100,"wires":[[]]},{"id":"39c38bee6add2d84","type":"api-call-service","z":"933f5581a37dd52c","name":"Dim lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"{\"brightness_step\":-35}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4660,"y":140,"wires":[[]]},{"id":"ffde540b34cb55f0","type":"api-call-service","z":"933f5581a37dd52c","name":"Lights off","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4660,"y":180,"wires":[[]]},{"id":"d4288f4d376996e0","type":"debug","z":"933f5581a37dd52c","name":"zero","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":390,"y":340,"wires":[]},{"id":"79b43bcb79bd80b6","type":"server-events","z":"933f5581a37dd52c","name":"","server":"7ab5c227.a3ce8c","version":2,"eventType":"zha_event","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"waitForRunning":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"},{"property":"event_type","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"}],"x":170,"y":500,"wires":[["d4288f4d376996e0","df2e609cac6f2bc9"]]},{"id":"863b256ec1a3f635","type":"switch","z":"933f5581a37dd52c","name":"Device?","property":"payload.event.device_ieee","propertyType":"msg","rules":[{"t":"eq","v":"00:17:88:01:08:0b:50:a4","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":400,"y":480,"wires":[["604c2e5b40e35943","7af7d3b7a473b57a"]]},{"id":"724ea66aa6af5a85","type":"delay","z":"933f5581a37dd52c","name":"nothing playing","pauseType":"delay","timeout":"0","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":3400,"y":1100,"wires":[["402193bafafa31fa"]]},{"id":"1d56e1f478c25091","type":"switch","z":"933f5581a37dd52c","name":"","property":"command","propertyType":"msg","rules":[{"t":"cont","v":"on","vt":"str"},{"t":"cont","v":"up","vt":"str"},{"t":"cont","v":"down","vt":"str"},{"t":"cont","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":4490,"y":740,"wires":[["415b586c0a11b3c1"],["683de9d925eaa22c"],["5a870105b0009857"],["30cad5816ffb7638"]]},{"id":"402193bafafa31fa","type":"switch","z":"933f5581a37dd52c","name":"presses","property":"pressamount","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"num"},{"t":"eq","v":"3","vt":"num"}],"checkall":"false","repair":true,"outputs":3,"x":3580,"y":1100,"wires":[["fc31706c9e3efd4c"],["9f531ac1a1ac0866"],["e1bf20ae3d6a0604"]]},{"id":"415b586c0a11b3c1","type":"api-call-service","z":"933f5581a37dd52c","name":"Lights on","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4700,"y":700,"wires":[[]]},{"id":"683de9d925eaa22c","type":"api-call-service","z":"933f5581a37dd52c","name":"Brigthen lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"{\"brightness_step\":25}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4740,"y":740,"wires":[[]]},{"id":"5a870105b0009857","type":"api-call-service","z":"933f5581a37dd52c","name":"Dim lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"{\"brightness_step\":-35}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4720,"y":780,"wires":[[]]},{"id":"30cad5816ffb7638","type":"api-call-service","z":"933f5581a37dd52c","name":"Lights off","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4720,"y":820,"wires":[[]]},{"id":"fc31706c9e3efd4c","type":"switch","z":"933f5581a37dd52c","name":"Where?","property":"location","propertyType":"msg","rules":[{"t":"cont","v":"bedroom","vt":"str"},{"t":"cont","v":"not_home","vt":"str"},{"t":"cont","v":"hotbox","vt":"str"},{"t":"cont","v":"livingroom","vt":"str"},{"t":"cont","v":"kitchen","vt":"str"},{"t":"cont","v":"patio","vt":"str"},{"t":"cont","v":"Bathroom","vt":"str"}],"checkall":"false","repair":false,"outputs":7,"x":3680,"y":800,"wires":[["82dd3a5580b0d082"],["82dd3a5580b0d082"],["a5b6699bfe0f922d"],["df3b0055085e994b"],["5c976a10d19c074b"],["93cc876515c41852"],[]]},{"id":"82dd3a5580b0d082","type":"change","z":"933f5581a37dd52c","name":"Bedroom","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"light.bedroom_lights\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":4160,"y":680,"wires":[["1d56e1f478c25091"]]},{"id":"73e6cc8e0ab5755e","type":"change","z":"933f5581a37dd52c","name":"HotBox","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":[\"light.hotbox_lights\"]}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":4160,"y":720,"wires":[["1d56e1f478c25091"]]},{"id":"df3b0055085e994b","type":"change","z":"933f5581a37dd52c","name":"LivingRo","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":[\"light.group_livingroom_lights\"]}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":4160,"y":840,"wires":[["1d56e1f478c25091"]]},{"id":"5c976a10d19c074b","type":"change","z":"933f5581a37dd52c","name":"Kitchen","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":[\"light.group_kitchen_lights\"]}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":4160,"y":880,"wires":[["1d56e1f478c25091"]]},{"id":"129d0e159fd5f13d","type":"switch","z":"933f5581a37dd52c","name":"","property":"command","propertyType":"msg","rules":[{"t":"cont","v":"on","vt":"str"},{"t":"cont","v":"up","vt":"str"},{"t":"cont","v":"down","vt":"str"},{"t":"cont","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":3940,"y":1400,"wires":[["fd98a3ac705891b0"],["b6dfe6d848d06f88"],["42e075e61f0fb471"],["7f41aa7dbb329c58"]]},{"id":"e22054d6381f3c14","type":"api-call-service","z":"933f5581a37dd52c","name":"White llights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"{\"rgb_color\":[255,255,254]}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4870,"y":1300,"wires":[[]]},{"id":"9f531ac1a1ac0866","type":"switch","z":"933f5581a37dd52c","name":"Where?","property":"location","propertyType":"msg","rules":[{"t":"cont","v":"bedroom","vt":"str"},{"t":"cont","v":"not_home","vt":"str"},{"t":"cont","v":"hotbox","vt":"str"},{"t":"cont","v":"livingroom","vt":"str"},{"t":"cont","v":"kitchen","vt":"str"},{"t":"cont","v":"patio","vt":"str"},{"t":"cont","v":"Bathroom","vt":"str"}],"checkall":"false","repair":false,"outputs":7,"x":3280,"y":1400,"wires":[["c35016dd0311dc27"],["c35016dd0311dc27"],["ec6d0bf5830c893d"],["6bfde0472099a9a5"],["546f54ecbb7541b9"],["19c1b2c9a8cea9a6"],[]]},{"id":"c35016dd0311dc27","type":"change","z":"933f5581a37dd52c","name":"Bedroom","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"light.bedroom_lights\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":3660,"y":1200,"wires":[["129d0e159fd5f13d"]]},{"id":"6bfde0472099a9a5","type":"change","z":"933f5581a37dd52c","name":"LivingRo","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"light.group_livingroom_lights\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":3720,"y":1620,"wires":[["129d0e159fd5f13d"]]},{"id":"546f54ecbb7541b9","type":"change","z":"933f5581a37dd52c","name":"Kitchen","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"light.group_kitchen_lights\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":3720,"y":1660,"wires":[["129d0e159fd5f13d"]]},{"id":"19c1b2c9a8cea9a6","type":"change","z":"933f5581a37dd52c","name":"Patio","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"light.patio_lights\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":3710,"y":1740,"wires":[["129d0e159fd5f13d"]]},{"id":"e0572274be13a226","type":"api-call-service","z":"933f5581a37dd52c","name":"Blue Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"{\"color_name\":\"blue\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4880,"y":1380,"wires":[[]]},{"id":"e92151f1639963d9","type":"api-call-service","z":"933f5581a37dd52c","name":"Red lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"{\"color_name\":\"red\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4890,"y":1420,"wires":[[]]},{"id":"3e7e886b757c00c5","type":"switch","z":"933f5581a37dd52c","name":"command","property":"command","propertyType":"msg","rules":[{"t":"cont","v":"up","vt":"str"},{"t":"cont","v":"down","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":4320,"y":1020,"wires":[["95e9b76895eb3bd0"],["073222aa71e6b594"]]},{"id":"95e9b76895eb3bd0","type":"api-call-service","z":"933f5581a37dd52c","name":"max brightness","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"{\"brightness_pct\":100}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4520,"y":980,"wires":[[]]},{"id":"073222aa71e6b594","type":"api-call-service","z":"933f5581a37dd52c","name":"min brightness","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"{\"brightness_pct\":15}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4520,"y":1020,"wires":[[]]},{"id":"1db201ee47af75e9","type":"debug","z":"933f5581a37dd52c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":4330,"y":1280,"wires":[]},{"id":"218d310468233972","type":"debug","z":"933f5581a37dd52c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2670,"y":60,"wires":[]},{"id":"e1bf20ae3d6a0604","type":"switch","z":"933f5581a37dd52c","name":"Where?","property":"location","propertyType":"msg","rules":[{"t":"cont","v":"bedroom","vt":"str"},{"t":"cont","v":"not_home","vt":"str"},{"t":"cont","v":"hotbox","vt":"str"},{"t":"cont","v":"livingroom","vt":"str"},{"t":"cont","v":"kitchen","vt":"str"},{"t":"cont","v":"patio","vt":"str"},{"t":"cont","v":"Bathroom","vt":"str"}],"checkall":"false","repair":false,"outputs":7,"x":3740,"y":1100,"wires":[["d9d68a6d04a397b5"],["d9d68a6d04a397b5"],["10717e5f8acdf484"],["11b4afcad2643e2e"],["1482fb6bd7ca4dd1"],["d1ce8de1add5048b"],[]]},{"id":"d9d68a6d04a397b5","type":"change","z":"933f5581a37dd52c","name":"Bedroom","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"light.bedroom_lights\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":3960,"y":940,"wires":[["3e7e886b757c00c5"]]},{"id":"9387ad217245a486","type":"debug","z":"933f5581a37dd52c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":4470,"y":1180,"wires":[]},{"id":"5fa1a67bc9eb83bc","type":"api-current-state","z":"933f5581a37dd52c","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"color","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":4310,"y":1340,"wires":[["27cf8b28a2d8f366","9387ad217245a486"]]},{"id":"fd98a3ac705891b0","type":"change","z":"933f5581a37dd52c","name":"set id to curent state","rules":[{"t":"set","p":"payload.entity_id","pt":"msg","to":"payload.data.entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":4110,"y":1340,"wires":[["5fa1a67bc9eb83bc","1db201ee47af75e9"]]},{"id":"5b1f1212c8df2317","type":"switch","z":"933f5581a37dd52c","name":"","property":"color","propertyType":"msg","rules":[{"t":"neq","v":"white","vt":"str"},{"t":"eq","v":"white","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":4680,"y":1340,"wires":[["e22054d6381f3c14"],["9557fc2fce9cd7c9"]]},{"id":"27cf8b28a2d8f366","type":"function","z":"933f5581a37dd52c","name":"color","func":"var color1 = msg.color.attributes.rgb_color[0];\nvar color2 = msg.color.attributes.rgb_color[1];\nvar color3 = msg.color.attributes.rgb_color[2];\n\nif (color1 == 255 && color2 > 253 && color3 > 253){\n    var newColor = \"white\";\n} else {\n    var newColor = \"other\";\n}\n\nvar newMsg = {\n    \"color\": newColor,\n    \"payload\": {\n        \"data\": {\n            \"entity_id\": msg.payload.entity_id\n        }\n    }\n};\nreturn newMsg;","outputs":1,"noerr":0,"x":4460,"y":1340,"wires":[["5b1f1212c8df2317"]]},{"id":"9557fc2fce9cd7c9","type":"api-call-service","z":"933f5581a37dd52c","name":"Purple lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"{\"color_name\":\"purple\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4880,"y":1340,"wires":[[]]},{"id":"5e8f30045c48db75","type":"function","z":"933f5581a37dd52c","name":"color","func":"var color1 = msg.color.attributes.rgb_color[0];\nvar color2 = msg.color.attributes.rgb_color[1];\nvar color3 = msg.color.attributes.rgb_color[2];\n\nif (color1 == 0 && color2 == 0 && color3 == 255){\n    var newColor = \"blue\";\n} else {\n    var newColor = \"other\";\n}\n\nvar newMsg = {\n    \"color\": newColor,\n    \"payload\": {\n        \"data\": {\n            \"entity_id\": msg.payload.entity_id\n        }\n    }\n};\nreturn newMsg;","outputs":1,"noerr":0,"x":4480,"y":1380,"wires":[["202884616f111b24"]]},{"id":"2c2abdddfbc0711a","type":"api-current-state","z":"933f5581a37dd52c","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"color","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":4330,"y":1380,"wires":[["5e8f30045c48db75"]]},{"id":"b6dfe6d848d06f88","type":"change","z":"933f5581a37dd52c","name":"set id to curent state","rules":[{"t":"set","p":"payload.entity_id","pt":"msg","to":"payload.data.entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":4130,"y":1380,"wires":[["2c2abdddfbc0711a"]]},{"id":"202884616f111b24","type":"switch","z":"933f5581a37dd52c","name":"","property":"color","propertyType":"msg","rules":[{"t":"neq","v":"blue","vt":"str"},{"t":"eq","v":"blue","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":4680,"y":1380,"wires":[["e0572274be13a226"],["e92151f1639963d9"]]},{"id":"292d7f6f3caa6434","type":"function","z":"933f5581a37dd52c","name":"color","func":"var color1 = msg.color.attributes.rgb_color[0];\nvar color2 = msg.color.attributes.rgb_color[1];\nvar color3 = msg.color.attributes.rgb_color[2];\n\nif (color1 == 0 && color2 == 255 && color3 == 0){\n    var newColor = \"green\";\n} else {\n    var newColor = \"other\";\n}\n\nvar newMsg = {\n    \"color\": newColor,\n    \"payload\": {\n        \"data\": {\n            \"entity_id\": msg.payload.entity_id\n        }\n    }\n};\nreturn newMsg;","outputs":1,"noerr":0,"x":4480,"y":1420,"wires":[["f8a10790959005a7"]]},{"id":"9c5d35dc9afb6e05","type":"api-current-state","z":"933f5581a37dd52c","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"color","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":4330,"y":1420,"wires":[["292d7f6f3caa6434"]]},{"id":"42e075e61f0fb471","type":"change","z":"933f5581a37dd52c","name":"set id to curent state","rules":[{"t":"set","p":"payload.entity_id","pt":"msg","to":"payload.data.entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":4130,"y":1420,"wires":[["9c5d35dc9afb6e05"]]},{"id":"f8a10790959005a7","type":"switch","z":"933f5581a37dd52c","name":"","property":"color","propertyType":"msg","rules":[{"t":"neq","v":"green","vt":"str"},{"t":"eq","v":"green","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":4680,"y":1420,"wires":[["ec3c972c6d927aac"],["e2848bde55d1f9f1"]]},{"id":"ec3c972c6d927aac","type":"api-call-service","z":"933f5581a37dd52c","name":"GReen Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"{\"color_name\":\"green\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4890,"y":1460,"wires":[[]]},{"id":"e2848bde55d1f9f1","type":"api-call-service","z":"933f5581a37dd52c","name":"Orange Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"{\"color_name\":\"orange\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4890,"y":1500,"wires":[[]]},{"id":"e8e46105b41b3a9a","type":"function","z":"933f5581a37dd52c","name":"color","func":"var color1 = msg.color.attributes.rgb_color[0];\nvar color2 = msg.color.attributes.rgb_color[1];\nvar color3 = msg.color.attributes.rgb_color[2];\n\nif (color1 == 255 && color2 == 254 && color3 == 0){\n    var newColor = \"yellow\";\n} else {\n    var newColor = \"other\";\n}\n\nvar newMsg = {\n    \"color\": newColor,\n    \"payload\": {\n        \"data\": {\n            \"entity_id\": msg.payload.entity_id\n        }\n    }\n};\nreturn newMsg;","outputs":1,"noerr":0,"x":4460,"y":1460,"wires":[["e02feedc6dd55006"]]},{"id":"7d58407886870164","type":"api-current-state","z":"933f5581a37dd52c","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"color","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":4310,"y":1460,"wires":[["e8e46105b41b3a9a"]]},{"id":"7f41aa7dbb329c58","type":"change","z":"933f5581a37dd52c","name":"set id to curent state","rules":[{"t":"set","p":"payload.entity_id","pt":"msg","to":"payload.data.entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":4110,"y":1460,"wires":[["7d58407886870164"]]},{"id":"e02feedc6dd55006","type":"switch","z":"933f5581a37dd52c","name":"","property":"color","propertyType":"msg","rules":[{"t":"neq","v":"yellow","vt":"str"},{"t":"eq","v":"yellow","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":4660,"y":1460,"wires":[["1a60ab6e73ef32be"],["1a27ecc6dd71e9dc"]]},{"id":"1a60ab6e73ef32be","type":"api-call-service","z":"933f5581a37dd52c","name":"Yellow Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"{\"color_name\":\"yellow\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4880,"y":1540,"wires":[[]]},{"id":"1a27ecc6dd71e9dc","type":"api-call-service","z":"933f5581a37dd52c","name":"Cyan Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"{\"color_name\":\"cyan\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4880,"y":1580,"wires":[[]]},{"id":"c2dba062682cb223","type":"switch","z":"933f5581a37dd52c","name":"Actions","property":"command","propertyType":"msg","rules":[{"t":"cont","v":"on","vt":"str"},{"t":"cont","v":"off","vt":"str"}],"checkall":"false","repair":true,"outputs":2,"x":2140,"y":1480,"wires":[["ffd0725108893f9d"],["617c026b75c3778f"]]},{"id":"ffd0725108893f9d","type":"switch","z":"933f5581a37dd52c","name":"presses","property":"pressamount","propertyType":"msg","rules":[{"t":"eq","v":"3","vt":"num"}],"checkall":"false","repair":true,"outputs":1,"x":2290,"y":1460,"wires":[["0398039eb15e1c07"]]},{"id":"617c026b75c3778f","type":"switch","z":"933f5581a37dd52c","name":"presses","property":"pressamount","propertyType":"msg","rules":[{"t":"eq","v":"3","vt":"num"}],"checkall":"false","repair":true,"outputs":1,"x":2290,"y":1500,"wires":[["087bf42020cb8863"]]},{"id":"0398039eb15e1c07","type":"api-call-service","z":"933f5581a37dd52c","name":"Blind up","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"cover","service":"open_cover","areaId":[],"deviceId":[],"entityId":["cover.cover_livingroom_blinds"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2440,"y":1420,"wires":[[]]},{"id":"087bf42020cb8863","type":"api-call-service","z":"933f5581a37dd52c","name":"Blind down","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"cover","service":"close_cover","areaId":[],"deviceId":[],"entityId":["cover.cover_livingroom_blinds"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2450,"y":1520,"wires":[[]]},{"id":"1647a17ed447b30c","type":"api-current-state","z":"933f5581a37dd52c","name":"Hotbox All","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.hotbox_all_motion","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":2200,"y":560,"wires":[["5b84962a20066e47"],["51a76b6602405a82","ffb68f3707abf0e3","581ebb5cf099c918"]]},{"id":"51a76b6602405a82","type":"api-current-state","z":"933f5581a37dd52c","name":"Hotbox down","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.sensor_hotbox_down_motion_occupancy","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":2370,"y":560,"wires":[["b0b9d04943f68623"],[]]},{"id":"ffb68f3707abf0e3","type":"api-current-state","z":"933f5581a37dd52c","name":"Hotbox top","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"re","halt_if_compare":"is","entity_id":"binary_sensor.sensor_hotbox_top_motion_occupancy","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":2370,"y":640,"wires":[["b7903b29297cb7c3"],[]]},{"id":"b7903b29297cb7c3","type":"api-current-state","z":"933f5581a37dd52c","name":"HotboxSTop","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"(playing|paused)","halt_if_type":"re","halt_if_compare":"is","entity_id":"media_player.hotbox_top_speaker","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"data.entity","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":2650,"y":640,"wires":[["5506f7a94bc38fbd"],["423a3a80c7d51c6a"]]},{"id":"5506f7a94bc38fbd","type":"change","z":"933f5581a37dd52c","name":"HotboxSTop","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"media_player.hotbox_top_speaker\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":2670,"y":600,"wires":[["052b675a64ed69b9"]]},{"id":"423a3a80c7d51c6a","type":"api-current-state","z":"933f5581a37dd52c","name":"HotboxTVT","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"(playing|paused)","halt_if_type":"re","halt_if_compare":"is","entity_id":"media_player.hotbox_top_chromecast","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"data.entity","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":2850,"y":640,"wires":[["78103ca545a622d3"],["cdb28576d5def68c"]]},{"id":"78103ca545a622d3","type":"change","z":"933f5581a37dd52c","name":"HotboxTVT","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"media_player.hotbox_top_chromecast\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":2850,"y":600,"wires":[["052b675a64ed69b9"]]},{"id":"b0b9d04943f68623","type":"api-current-state","z":"933f5581a37dd52c","name":"HotboxSdown","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"(playing|paused)","halt_if_type":"re","halt_if_compare":"is","entity_id":"media_player.hotbox_down_speaker","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"data.entity","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":2660,"y":560,"wires":[["dc4299a23c2a4e46"],["f36672bd390783a9"]]},{"id":"dc4299a23c2a4e46","type":"change","z":"933f5581a37dd52c","name":"HotboxSDown","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"media_player.hotbox_down_speaker\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":2680,"y":520,"wires":[["052b675a64ed69b9"]]},{"id":"a25bffbc4855260a","type":"change","z":"933f5581a37dd52c","name":"HotboxTVD","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"media_player.hotbox_tv_down\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":2890,"y":520,"wires":[["052b675a64ed69b9"]]},{"id":"f36672bd390783a9","type":"api-current-state","z":"933f5581a37dd52c","name":"HotboxTVD","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"(playing|paused)","halt_if_type":"re","halt_if_compare":"is","entity_id":"media_player.hotbox_tv_down","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"data.entity","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":2890,"y":560,"wires":[["a25bffbc4855260a"],["30bcd364e3198e99"]]},{"id":"a5b6699bfe0f922d","type":"api-current-state","z":"933f5581a37dd52c","name":"Hotbox All","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.hotbox_all_motion","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":3950,"y":680,"wires":[["73e6cc8e0ab5755e"],["c0c772c74f2b852d","34d136b561342338","7fb674527598e2a0"]]},{"id":"c0c772c74f2b852d","type":"api-current-state","z":"933f5581a37dd52c","name":"Hotbox down","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.sensor_hotbox_down_motion_occupancy","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":3950,"y":720,"wires":[["e488e7ddc9e91922"],[]]},{"id":"34d136b561342338","type":"api-current-state","z":"933f5581a37dd52c","name":"Hotbox top","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.sensor_hotbox_top_motion_occupancy","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":3950,"y":760,"wires":[["d794132106f5c5bd"],[]]},{"id":"e488e7ddc9e91922","type":"change","z":"933f5581a37dd52c","name":"HotBox Down","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":[\"light.hotbox_bottom\"]}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":4160,"y":760,"wires":[["1d56e1f478c25091"]]},{"id":"d794132106f5c5bd","type":"change","z":"933f5581a37dd52c","name":"HotBox Wall","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":[\"light.hotbox_wall\"]}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":4150,"y":800,"wires":[["1d56e1f478c25091"]]},{"id":"8551d9f779976121","type":"change","z":"933f5581a37dd52c","name":"HotBox","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"light.hotbox_lights\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":4120,"y":980,"wires":[["3e7e886b757c00c5"]]},{"id":"10717e5f8acdf484","type":"api-current-state","z":"933f5581a37dd52c","name":"Hotbox All","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.hotbox_all_motion","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":3970,"y":980,"wires":[["8551d9f779976121"],["cd1f42701c73dde3","ef6262914d8cee8c","5ed346859afeb599"]]},{"id":"cd1f42701c73dde3","type":"api-current-state","z":"933f5581a37dd52c","name":"Hotbox down","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.sensor_hotbox_down_motion_occupancy","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":3970,"y":1020,"wires":[["d299b602948e71f1"],[]]},{"id":"ef6262914d8cee8c","type":"api-current-state","z":"933f5581a37dd52c","name":"Hotbox top","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.sensor_hotbox_top_motion_occupancy","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":3970,"y":1060,"wires":[["aed37ccc5c27d0b7"],[]]},{"id":"d299b602948e71f1","type":"change","z":"933f5581a37dd52c","name":"HotBox bottom","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":[\"light.hotbox_bottom\"]}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":4140,"y":1020,"wires":[["3e7e886b757c00c5"]]},{"id":"aed37ccc5c27d0b7","type":"change","z":"933f5581a37dd52c","name":"HotBox Wall","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":[\"light.hotbox_wall\"]}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":4130,"y":1060,"wires":[["3e7e886b757c00c5"]]},{"id":"6598aad34bf0df46","type":"change","z":"933f5581a37dd52c","name":"HotBox","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"light.hotbox_lights\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":3740,"y":1360,"wires":[["129d0e159fd5f13d"]]},{"id":"ec6d0bf5830c893d","type":"api-current-state","z":"933f5581a37dd52c","name":"Hotbox All","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.hotbox_all_motion","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":3550,"y":1300,"wires":[["6598aad34bf0df46"],["68663f890f19c125","058be30ba6012a36","eecb21cc68d3ae23"]]},{"id":"68663f890f19c125","type":"api-current-state","z":"933f5581a37dd52c","name":"Hotbox down","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.sensor_hotbox_down_motion_occupancy","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":3540,"y":1360,"wires":[["466f36fddb898c5e"],[]]},{"id":"058be30ba6012a36","type":"api-current-state","z":"933f5581a37dd52c","name":"Hotbox top","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.sensor_hotbox_top_motion_occupancy","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":3550,"y":1420,"wires":[["40226fc4fbaf4bd0"],[]]},{"id":"466f36fddb898c5e","type":"change","z":"933f5581a37dd52c","name":"HotBox Down","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"light.hotbox_bottom\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":3760,"y":1400,"wires":[["129d0e159fd5f13d"]]},{"id":"40226fc4fbaf4bd0","type":"change","z":"933f5581a37dd52c","name":"HotBox Wall","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"light.hotbox_top\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":3750,"y":1440,"wires":[["129d0e159fd5f13d"]]},{"id":"7fb674527598e2a0","type":"api-current-state","z":"933f5581a37dd52c","name":"Hotbox All","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.hotbox_all_motion_off","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":3920,"y":800,"wires":[["73e6cc8e0ab5755e"],[]]},{"id":"eecb21cc68d3ae23","type":"api-current-state","z":"933f5581a37dd52c","name":"Hotbox All","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.hotbox_all_motion_off","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":3550,"y":1480,"wires":[["6598aad34bf0df46"],[]]},{"id":"5ed346859afeb599","type":"api-current-state","z":"933f5581a37dd52c","name":"Hotbox All","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.hotbox_all_motion_off","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":3960,"y":1100,"wires":[["8551d9f779976121"],[]]},{"id":"581ebb5cf099c918","type":"api-current-state","z":"933f5581a37dd52c","name":"Hotbox All off","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.hotbox_all_motion_off","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":2370,"y":520,"wires":[["5b84962a20066e47"],[]]},{"id":"cd3cd4babc86066d","type":"change","z":"933f5581a37dd52c","name":"Roku","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"media_player.hotbox_top_roku\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":2890,"y":440,"wires":[["052b675a64ed69b9"]]},{"id":"781a8af1762ae28d","type":"api-current-state","z":"933f5581a37dd52c","name":"Roku","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"(playing|paused)","halt_if_type":"re","halt_if_compare":"is","entity_id":"media_player.hotbox_top_roku","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"data.entity","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":2890,"y":480,"wires":[["cd3cd4babc86066d"],["30bcd364e3198e99"]]},{"id":"39bdfcf9df08f913","type":"change","z":"933f5581a37dd52c","name":"Roku","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"media_player.hotbox_top_roku\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":3030,"y":600,"wires":[["052b675a64ed69b9"]]},{"id":"cdb28576d5def68c","type":"api-current-state","z":"933f5581a37dd52c","name":"Roku","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"(playing|paused)","halt_if_type":"re","halt_if_compare":"is","entity_id":"media_player.hotbox_top_roku","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":3030,"y":640,"wires":[["39bdfcf9df08f913"],["30bcd364e3198e99"]]},{"id":"4b04cb83c1b6a69a","type":"switch","z":"933f5581a37dd52c","name":"Actions","property":"command","propertyType":"msg","rules":[{"t":"cont","v":"on","vt":"str"},{"t":"cont","v":"off","vt":"str"}],"checkall":"false","repair":true,"outputs":2,"x":2440,"y":760,"wires":[["e872af90a11a4737"],["8313de7ac69b1eba"]]},{"id":"e872af90a11a4737","type":"switch","z":"933f5581a37dd52c","name":"presses","property":"pressamount","propertyType":"msg","rules":[{"t":"eq","v":"3","vt":"num"}],"checkall":"false","repair":true,"outputs":1,"x":2480,"y":880,"wires":[["624d74888ce1ee60"]]},{"id":"8313de7ac69b1eba","type":"switch","z":"933f5581a37dd52c","name":"presses","property":"pressamount","propertyType":"msg","rules":[{"t":"eq","v":"3","vt":"num"}],"checkall":"false","repair":true,"outputs":1,"x":2480,"y":920,"wires":[["0cedc729528b0cef"]]},{"id":"624d74888ce1ee60","type":"api-call-service","z":"933f5581a37dd52c","name":"Blind up","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"cover","service":"open_cover","areaId":[],"deviceId":[],"entityId":["cover.cover_bedroom_blinds"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2660,"y":820,"wires":[[]]},{"id":"0cedc729528b0cef","type":"api-call-service","z":"933f5581a37dd52c","name":"Blind down","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"cover","service":"close_cover","areaId":[],"deviceId":[],"entityId":["cover.cover_bedroom_blinds"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2670,"y":900,"wires":[[]]},{"id":"053cfa396de504ff","type":"change","z":"933f5581a37dd52c","name":"Five Press","rules":[{"t":"set","p":"pressamount","pt":"msg","to":"5","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1850,"y":740,"wires":[["61324482911d6fe5"]]},{"id":"f5a4259b583436d3","type":"api-current-state","z":"933f5581a37dd52c","name":"Bedroom","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"(playing|paused)","halt_if_type":"re","halt_if_compare":"is","entity_id":"media_player.bedroom_speaker","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"data.entity","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":2100,"y":340,"wires":[["81a9490e44a9bfac"],["e16abcee378dd6d5"]]},{"id":"81a9490e44a9bfac","type":"change","z":"933f5581a37dd52c","name":"Bedroom","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"media_player.bedroom_speaker\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":2100,"y":300,"wires":[["52b3fb4303059f0b","151f1963fecf0607"]]},{"id":"f76e0cc8cd2d017d","type":"api-call-service","z":"933f5581a37dd52c","name":"Stop all","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"turn_off","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4080,"y":500,"wires":[[]]},{"id":"1133dc8664a47a46","type":"change","z":"933f5581a37dd52c","name":"LivingRo","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":[\"light.livingroom_lights\"]}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":2300,"y":4840,"wires":[["4fc88edc54a36fc8"]]},{"id":"72c1bb665309b3cb","type":"change","z":"933f5581a37dd52c","name":"HotBox","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":[\"light.hotbox_lights\"]}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":2300,"y":4800,"wires":[["4fc88edc54a36fc8"]]},{"id":"ee9de7d8bd5208fa","type":"change","z":"933f5581a37dd52c","name":"Kitchen","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":[\"light.kitchen_lights\"]}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":2300,"y":4880,"wires":[["4fc88edc54a36fc8"]]},{"id":"8fd7b3db2f45b8ea","type":"change","z":"933f5581a37dd52c","name":"closet","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"media_player.closet_speaker\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":2290,"y":4920,"wires":[["4fc88edc54a36fc8"]]},{"id":"96ca10b1ca3f29e6","type":"change","z":"933f5581a37dd52c","name":"Bathroom","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"light.bathroom2\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":2300,"y":4960,"wires":[["4fc88edc54a36fc8"]]},{"id":"69684ef70a7f7a9f","type":"api-current-state","z":"933f5581a37dd52c","name":"Fitbit","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.galaxywatch","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":1870,"y":4760,"wires":[[]]},{"id":"77eae8e725382dc6","type":"switch","z":"933f5581a37dd52c","name":"Where?","property":"data.state","propertyType":"msg","rules":[{"t":"cont","v":"Bedroom","vt":"str"},{"t":"cont","v":"Thierry","vt":"str"},{"t":"cont","v":"not_home","vt":"str"},{"t":"cont","v":"Hotbox","vt":"str"},{"t":"cont","v":"Chilling","vt":"str"},{"t":"cont","v":"Kitchen","vt":"str"},{"t":"cont","v":"Closet","vt":"str"},{"t":"cont","v":"Bathroom","vt":"str"}],"checkall":"false","repair":false,"outputs":8,"x":2120,"y":4760,"wires":[["eb29b1e737676b49"],["eb29b1e737676b49"],["eb29b1e737676b49"],["72c1bb665309b3cb"],["1133dc8664a47a46"],["ee9de7d8bd5208fa"],["8fd7b3db2f45b8ea"],["96ca10b1ca3f29e6"]]},{"id":"4fc88edc54a36fc8","type":"switch","z":"933f5581a37dd52c","name":"FAce","property":"face","propertyType":"msg","rules":[{"t":"cont","v":"1","vt":"str"},{"t":"cont","v":"2","vt":"str"},{"t":"cont","v":"3","vt":"str"},{"t":"cont","v":"4","vt":"str"},{"t":"cont","v":"5","vt":"str"},{"t":"cont","v":"6","vt":"str"}],"checkall":"false","repair":true,"outputs":6,"x":2590,"y":4740,"wires":[["1169b420975f1408"],["39b5b39fa69d3276"],["2f14b2fa8554a2b4"],["5ddf0121ccf8212d"],["ea63eadbe0be3af7"],["91b5510d79b97997"]]},{"id":"1169b420975f1408","type":"api-call-service","z":"933f5581a37dd52c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"{ \"color_name\": \"white\" }","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2970,"y":4720,"wires":[[]]},{"id":"39b5b39fa69d3276","type":"api-call-service","z":"933f5581a37dd52c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"{ \"color_name\": \"green\" }","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2970,"y":4760,"wires":[[]]},{"id":"2f14b2fa8554a2b4","type":"api-call-service","z":"933f5581a37dd52c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"{ \"color_name\": \"blue\" }","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2970,"y":4800,"wires":[[]]},{"id":"5ddf0121ccf8212d","type":"api-call-service","z":"933f5581a37dd52c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"{ \"color_name\": \"purple\" }","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2970,"y":4840,"wires":[[]]},{"id":"ea63eadbe0be3af7","type":"api-call-service","z":"933f5581a37dd52c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"{ \"color_name\": \"orange\" }","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2970,"y":4880,"wires":[[]]},{"id":"91b5510d79b97997","type":"api-call-service","z":"933f5581a37dd52c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"{ \"color_name\": \"red\" }","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2970,"y":4920,"wires":[[]]},{"id":"d4a03aecb1ab34ab","type":"change","z":"933f5581a37dd52c","name":"Face","rules":[{"t":"move","p":"payload.event.args.activated_face","pt":"msg","to":"face","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1730,"y":4760,"wires":[["69684ef70a7f7a9f"]]},{"id":"1a9ca0c6f0997847","type":"server-events","z":"933f5581a37dd52c","name":"","server":"7ab5c227.a3ce8c","version":2,"eventType":"zha_event","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"waitForRunning":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"},{"property":"event_type","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"}],"x":1290,"y":4760,"wires":[["312c4df4513b4415"]]},{"id":"b8f4ecdac48219a7","type":"switch","z":"933f5581a37dd52c","name":"","property":"action","propertyType":"msg","rules":[{"t":"cont","v":"knock","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1590,"y":4760,"wires":[["d4a03aecb1ab34ab"]]},{"id":"312c4df4513b4415","type":"change","z":"933f5581a37dd52c","name":"Face","rules":[{"t":"move","p":"payload.event.command","pt":"msg","to":"action","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1470,"y":4760,"wires":[["b8f4ecdac48219a7"]]},{"id":"eb29b1e737676b49","type":"change","z":"933f5581a37dd52c","name":"Bedroom","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":[\"light.bedroom_lights\"]}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":2300,"y":4740,"wires":[["4fc88edc54a36fc8"]]},{"id":"2aefc1df2c48cdb7","type":"delay","z":"933f5581a37dd52c","name":"Delay","pauseType":"delay","timeout":"1","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":1330,"y":3560,"wires":[["5cc0a0d3cda0b25f"]]},{"id":"8dfd22529cfa94a8","type":"trigger","z":"933f5581a37dd52c","name":"","op1":"","op2":"0","op1type":"nul","op2type":"str","duration":"800","extend":true,"units":"ms","reset":"","bytopic":"all","outputs":1,"x":1360,"y":3600,"wires":[["2aefc1df2c48cdb7","27c1d3402ba49810"]]},{"id":"5cc0a0d3cda0b25f","type":"change","z":"933f5581a37dd52c","name":"Reset","rules":[{"t":"set","p":"reset","pt":"msg","to":"foo","tot":"str"},{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1450,"y":3560,"wires":[["503fbd2688bac18d"]]},{"id":"6b2917f5844873db","type":"api-current-state","z":"933f5581a37dd52c","name":"Watch","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.galaxywatch","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"location","propertyType":"msg","value":"","valueType":"entityState"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":1190,"y":3500,"wires":[["8dfd22529cfa94a8","503fbd2688bac18d"]]},{"id":"27c1d3402ba49810","type":"switch","z":"933f5581a37dd52c","name":"count presses","property":"count","propertyType":"flow","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"num"},{"t":"eq","v":"3","vt":"num"},{"t":"eq","v":"4","vt":"num"},{"t":"eq","v":"5","vt":"num"}],"checkall":"true","repair":false,"outputs":5,"x":1600,"y":3600,"wires":[["22d82bef9e825fe8"],["646be7329d496eba"],["b3b2b674ebbae71d"],["36a0aba78e9b37a8"],["adb66298764c6e84"]],"info":"Just expand the flow.count to how ever many\npresses you want/need."},{"id":"503fbd2688bac18d","type":"counter","z":"933f5581a37dd52c","name":"","init":"0","step":"1","lower":"","upper":"","mode":"increment","outputs":"1","x":1460,"y":3500,"wires":[["f13bcaaa665e4314"]]},{"id":"69df04f525caf170","type":"inject","z":"933f5581a37dd52c","name":"Reset","repeat":"","crontab":"","once":true,"onceDelay":"0.5","topic":"","payload":"","payloadType":"date","x":1330,"y":3460,"wires":[["5cc0a0d3cda0b25f"]]},{"id":"da1f598936d9e6cf","type":"change","z":"933f5581a37dd52c","name":"command","rules":[{"t":"set","p":"command","pt":"msg","to":"up","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1050,"y":3420,"wires":[["6b2917f5844873db"]]},{"id":"622da2e32be614fa","type":"change","z":"933f5581a37dd52c","name":"command","rules":[{"t":"set","p":"command","pt":"msg","to":"down","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1050,"y":3460,"wires":[["6b2917f5844873db"]]},{"id":"b57e915aa7772afc","type":"change","z":"933f5581a37dd52c","name":"command","rules":[{"t":"set","p":"command","pt":"msg","to":"off","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":950,"y":3500,"wires":[["6b2917f5844873db"]]},{"id":"96ef0aa933cdebc6","type":"change","z":"933f5581a37dd52c","name":"command","rules":[{"t":"set","p":"command","pt":"msg","to":"on","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":950,"y":3540,"wires":[["6b2917f5844873db"]]},{"id":"22d82bef9e825fe8","type":"change","z":"933f5581a37dd52c","name":"Single Press","rules":[{"t":"set","p":"pressamount","pt":"msg","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1790,"y":3540,"wires":[["1ff779a565368865"]]},{"id":"646be7329d496eba","type":"change","z":"933f5581a37dd52c","name":"Double Press","rules":[{"t":"set","p":"pressamount","pt":"msg","to":"2","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1800,"y":3580,"wires":[["1ff779a565368865"]]},{"id":"b3b2b674ebbae71d","type":"change","z":"933f5581a37dd52c","name":"Triple Press","rules":[{"t":"set","p":"pressamount","pt":"msg","to":"3","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1790,"y":3620,"wires":[["1ff779a565368865"]]},{"id":"36a0aba78e9b37a8","type":"change","z":"933f5581a37dd52c","name":"Four Press","rules":[{"t":"set","p":"pressamount","pt":"msg","to":"4","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1790,"y":3660,"wires":[["1ff779a565368865"]]},{"id":"f13bcaaa665e4314","type":"change","z":"933f5581a37dd52c","name":"Flow set","rules":[{"t":"set","p":"count","pt":"flow","to":"count","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1600,"y":3500,"wires":[["17a545a209baf4f1"]]},{"id":"3968a9f7dd594e6e","type":"switch","z":"933f5581a37dd52c","name":"Ste?","property":"payload.event.args[0]","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"eq","v":"1","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":920,"y":3460,"wires":[["da1f598936d9e6cf"],["622da2e32be614fa"]]},{"id":"b98fe94a2627260e","type":"switch","z":"933f5581a37dd52c","name":"Command?","property":"payload.event.command","propertyType":"msg","rules":[{"t":"eq","v":"step","vt":"str"},{"t":"eq","v":"off_with_effect","vt":"str"},{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":770,"y":3480,"wires":[["3968a9f7dd594e6e"],["b57e915aa7772afc"],["96ef0aa933cdebc6"]]},{"id":"1ff779a565368865","type":"delay","z":"933f5581a37dd52c","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":1970,"y":3620,"wires":[[]]},{"id":"17a545a209baf4f1","type":"debug","z":"933f5581a37dd52c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"count","targetType":"msg","x":1790,"y":3500,"wires":[]},{"id":"0b53d52d13305844","type":"debug","z":"933f5581a37dd52c","name":"first","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":750,"y":3440,"wires":[]},{"id":"d71eeae0a1466a37","type":"debug","z":"933f5581a37dd52c","name":"zero","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":610,"y":3440,"wires":[]},{"id":"b826da6237edeb15","type":"server-events","z":"933f5581a37dd52c","name":"","server":"7ab5c227.a3ce8c","version":2,"eventType":"zha_event","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"waitForRunning":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"},{"property":"event_type","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"}],"x":450,"y":3480,"wires":[["d71eeae0a1466a37","7e36a36b6f5330b3"]]},{"id":"7e36a36b6f5330b3","type":"switch","z":"933f5581a37dd52c","name":"Device?","property":"payload.event.device_ieee","propertyType":"msg","rules":[{"t":"eq","v":"00:17:88:01:08:0b:50:a4","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":620,"y":3480,"wires":[["b98fe94a2627260e","0b53d52d13305844"]]},{"id":"adb66298764c6e84","type":"change","z":"933f5581a37dd52c","name":"Five Press","rules":[{"t":"set","p":"pressamount","pt":"msg","to":"5","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1800,"y":3700,"wires":[["1ff779a565368865"]]},{"id":"2487f0c9129a879c","type":"api-current-state","z":"933f5581a37dd52c","name":"Plex","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"(playing|paused)","halt_if_type":"re","halt_if_compare":"is","entity_id":"media_player.plex_media_player_desktop","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"data.entity","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":2470,"y":320,"wires":[["b9c29cf9eab7ae68"],["adcfce4ade885675"]]},{"id":"e7d4f105bb2e64f3","type":"api-current-state","z":"933f5581a37dd52c","name":"Roku","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"(playing|paused)","halt_if_type":"re","halt_if_compare":"is","entity_id":"media_player.bedroom_roku","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":2870,"y":340,"wires":[["9d3f95d97949fcad"],["83578c147b05105f"]]},{"id":"9d3f95d97949fcad","type":"change","z":"933f5581a37dd52c","name":"Roku","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"media_player.bedroom_roku\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":2850,"y":300,"wires":[["151f1963fecf0607"]]},{"id":"384e8b92d0de16c5","type":"delay","z":"933f5581a37dd52c","name":"Stuff Playing","pauseType":"delay","timeout":"0","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":3430,"y":340,"wires":[["ee797e7b355bf40e","6f0583e9c09bf522"]]},{"id":"ee797e7b355bf40e","type":"change","z":"933f5581a37dd52c","name":"volume","rules":[{"t":"move","p":"data.entity.attributes.volume_level","pt":"msg","to":"volume","tot":"msg"},{"t":"delete","p":"data","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":3580,"y":340,"wires":[["9eefd3eaa566fef7"]]},{"id":"b9c29cf9eab7ae68","type":"change","z":"933f5581a37dd52c","name":"PLex","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"media_player.plex_media_player_desktop\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":2470,"y":260,"wires":[["151f1963fecf0607"]]},{"id":"2a043fd66f4c776d","type":"link out","z":"933f5581a37dd52c","name":"","links":[],"x":320,"y":2920,"wires":[]},{"id":"b03644fb7ed5a0a7","type":"switch","z":"933f5581a37dd52c","name":"Volume 1/>1","property":"volume","propertyType":"msg","rules":[{"t":"gt","v":".89","vt":"num"},{"t":"lt","v":".9","vt":"num"}],"checkall":"false","repair":true,"outputs":2,"x":4070,"y":300,"wires":[["0a1137bfb4f341a4"],["4a87be609378f3f5"]]},{"id":"0a1137bfb4f341a4","type":"switch","z":"933f5581a37dd52c","name":"Tv","property":"payload.data.entity_id","propertyType":"msg","rules":[{"t":"cont","v":"media_player.plex_pc","vt":"str"},{"t":"cont","v":"media_player.bedroom_chromecast","vt":"str"},{"t":"cont","v":"media_player.hotbox_tv","vt":"str"},{"t":"cont","v":"media_player.living_room_tv","vt":"str"},{"t":"nnull"}],"checkall":"false","repair":true,"outputs":5,"x":4210,"y":260,"wires":[["b9143e5b1397992b"],["b9143e5b1397992b"],["f99bfdefea729d0b"],["0814d7e1e73eea88"],["4a87be609378f3f5"]]},{"id":"b9143e5b1397992b","type":"change","z":"933f5581a37dd52c","name":"Roku","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"media_player.bedroom_tv\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":4410,"y":220,"wires":[["4a87be609378f3f5"]]},{"id":"f99bfdefea729d0b","type":"change","z":"933f5581a37dd52c","name":"Roku","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"media_player.roku\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":4390,"y":260,"wires":[["4a87be609378f3f5"]]},{"id":"0814d7e1e73eea88","type":"change","z":"933f5581a37dd52c","name":"Roku","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"media_player.living_room_lg_2\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":4370,"y":300,"wires":[["4a87be609378f3f5"]]},{"id":"1967c3a6edfac1a5","type":"api-call-service","z":"933f5581a37dd52c","name":"V. down S","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_down","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":4760,"y":500,"wires":[["58f42177fbba5da6"]]},{"id":"d5a19c27e1b9b0ac","type":"switch","z":"933f5581a37dd52c","name":"Volume 0/<0","property":"volume","propertyType":"msg","rules":[{"t":"lt","v":"0.5","vt":"num"},{"t":"gte","v":"0.5","vt":"num"}],"checkall":"false","repair":true,"outputs":2,"x":4230,"y":380,"wires":[["43ded35c0dd311d0"],["1967c3a6edfac1a5"]]},{"id":"43ded35c0dd311d0","type":"switch","z":"933f5581a37dd52c","name":"Tv","property":"payload.data.entity_id","propertyType":"msg","rules":[{"t":"cont","v":"media_player.plex_pc","vt":"str"},{"t":"cont","v":"media_player.bedroom_chromecast","vt":"str"},{"t":"cont","v":"media_player.hotbox_tv","vt":"str"},{"t":"cont","v":"media_player.living_room_tv","vt":"str"},{"t":"nnull"}],"checkall":"false","repair":true,"outputs":5,"x":4370,"y":380,"wires":[["321d6b96f5f4c690"],["321d6b96f5f4c690"],["7a5ca9a2eb9f048d"],["28516e3d82e738ce"],["1967c3a6edfac1a5"]]},{"id":"321d6b96f5f4c690","type":"change","z":"933f5581a37dd52c","name":"Roku bedroom","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"media_player.bedroom_tv\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":4560,"y":340,"wires":[["1967c3a6edfac1a5"]]},{"id":"7a5ca9a2eb9f048d","type":"change","z":"933f5581a37dd52c","name":"Roku Hotbox","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"media_player.roku\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":4550,"y":380,"wires":[["1967c3a6edfac1a5"]]},{"id":"28516e3d82e738ce","type":"change","z":"933f5581a37dd52c","name":"Living room LG","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"media_player.living_room_lg\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":4560,"y":420,"wires":[["1967c3a6edfac1a5"]]},{"id":"b2e71a0dd8285867","type":"switch","z":"933f5581a37dd52c","name":"Actions","property":"command","propertyType":"msg","rules":[{"t":"cont","v":"on","vt":"str"}],"checkall":"false","repair":true,"outputs":1,"x":1680,"y":840,"wires":[["e56fbd6fb90d7a6b"]]},{"id":"e56fbd6fb90d7a6b","type":"switch","z":"933f5581a37dd52c","name":"presses","property":"pressamount","propertyType":"msg","rules":[{"t":"eq","v":"5","vt":"num"}],"checkall":"false","repair":true,"outputs":1,"x":1840,"y":840,"wires":[["6fbc6fb0d2fce8e3"]]},{"id":"6fbc6fb0d2fce8e3","type":"api-call-service","z":"933f5581a37dd52c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"timer","service":"start","areaId":[],"deviceId":[],"entityId":["timer.five_click_delay"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2020,"y":840,"wires":[[]]},{"id":"0bde626db96121fd","type":"api-current-state","z":"933f5581a37dd52c","name":"option2","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"active","halt_if_type":"str","halt_if_compare":"is","entity_id":"timer.five_click_delay","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1940,"y":920,"wires":[[],[]]},{"id":"51db7308f80909d0","type":"inject","z":"933f5581a37dd52c","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1780,"y":900,"wires":[["0bde626db96121fd","6fbc6fb0d2fce8e3"]]},{"id":"68bfea40cb637c9b","type":"api-current-state","z":"933f5581a37dd52c","name":"option2","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"idle","halt_if_type":"str","halt_if_compare":"is","entity_id":"timer.five_click_delay","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":2920,"y":1000,"wires":[["e1a754c7dbd81296"],["edd8b7f18891ec17"]]},{"id":"e1a754c7dbd81296","type":"delay","z":"933f5581a37dd52c","name":"Action","pauseType":"delay","timeout":"0","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":3090,"y":1000,"wires":[["384e8b92d0de16c5"]]},{"id":"df04f2923a255b17","type":"api-current-state","z":"933f5581a37dd52c","name":"option2","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"idle","halt_if_type":"str","halt_if_compare":"is","entity_id":"timer.five_click_delay","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":3120,"y":300,"wires":[["6b1d895c5f9f10ac"],["83578c147b05105f"]]},{"id":"a1fe8fca019a4242","type":"api-current-state","z":"933f5581a37dd52c","name":"option2","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"idle","halt_if_type":"str","halt_if_compare":"is","entity_id":"timer.five_click_delay","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":3140,"y":440,"wires":[["8c9ffa99c3a8f497"],["30bcd364e3198e99"]]},{"id":"21e7c649df1f7f5b","type":"api-current-state","z":"933f5581a37dd52c","name":"option2","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"idle","halt_if_type":"str","halt_if_compare":"is","entity_id":"timer.five_click_delay","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":2940,"y":1100,"wires":[["5343f2709a089f77"],["7bfb04403e75cd9c"]]},{"id":"e7fd9fbdfdbfe732","type":"api-current-state","z":"933f5581a37dd52c","name":"option2","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"idle","halt_if_type":"str","halt_if_compare":"is","entity_id":"timer.five_click_delay","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":2940,"y":1200,"wires":[["290472fdb98cf797"],["20ed761cdc12302b"]]},{"id":"f4d96017c0b01350","type":"api-current-state","z":"933f5581a37dd52c","name":"option2","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"idle","halt_if_type":"str","halt_if_compare":"is","entity_id":"timer.five_click_delay","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":2920,"y":1300,"wires":[["58dcd0bc6f58f65a"],["9faa0d691663ceed"]]},{"id":"290472fdb98cf797","type":"delay","z":"933f5581a37dd52c","name":"Action","pauseType":"delay","timeout":"0","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":3090,"y":1200,"wires":[["384e8b92d0de16c5"]]},{"id":"58dcd0bc6f58f65a","type":"delay","z":"933f5581a37dd52c","name":"Action","pauseType":"delay","timeout":"0","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":3070,"y":1300,"wires":[["384e8b92d0de16c5"]]},{"id":"5343f2709a089f77","type":"delay","z":"933f5581a37dd52c","name":"Action","pauseType":"delay","timeout":"0","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":3090,"y":1100,"wires":[["384e8b92d0de16c5"]]},{"id":"8c9ffa99c3a8f497","type":"delay","z":"933f5581a37dd52c","name":"Action","pauseType":"delay","timeout":"0","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":3270,"y":440,"wires":[["384e8b92d0de16c5"]]},{"id":"6b1d895c5f9f10ac","type":"delay","z":"933f5581a37dd52c","name":"Action","pauseType":"delay","timeout":"0","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":3250,"y":300,"wires":[["384e8b92d0de16c5"]]},{"id":"21d342f5e6f65e21","type":"debug","z":"933f5581a37dd52c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2050,"y":780,"wires":[]},{"id":"adcfce4ade885675","type":"api-current-state","z":"933f5581a37dd52c","name":"Chromecast","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"(playing|paused)","halt_if_type":"re","halt_if_compare":"is","entity_id":"media_player.bedroom_chromecast","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"data.entity","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":2690,"y":340,"wires":[["b1ccfc98fc48d36c"],["e7d4f105bb2e64f3"]]},{"id":"b1ccfc98fc48d36c","type":"change","z":"933f5581a37dd52c","name":"Chromecast","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"media_player.bedroom_chromecast\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":2710,"y":300,"wires":[["151f1963fecf0607"]]},{"id":"09917881fce29b61","type":"api-current-state","z":"933f5581a37dd52c","name":"Screens","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"re","halt_if_compare":"is","entity_id":"switch.plug_bedroom_screens","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":2680,"y":220,"wires":[["60e8aefe4c72a2f8"],["0db580fe5864f3e3"]]},{"id":"0db580fe5864f3e3","type":"api-call-service","z":"933f5581a37dd52c","name":"TV Off","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"turn_off","areaId":[],"deviceId":[],"entityId":["media_player.bedroom_tv"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2870,"y":240,"wires":[[]]},{"id":"f236283a32820d91","type":"api-call-service","z":"933f5581a37dd52c","name":"TV On","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"turn_on","areaId":[],"deviceId":[],"entityId":["media_player.bedroom_tv"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2930,"y":160,"wires":[[]]},{"id":"a38b3a45d7a24b40","type":"api-current-state","z":"933f5581a37dd52c","name":"Screens","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"re","halt_if_compare":"is","entity_id":"switch.plug_bedroom_screens","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":2700,"y":140,"wires":[["ac394a05ef3653b0"],["f236283a32820d91"]]},{"id":"df2e609cac6f2bc9","type":"debug","z":"933f5581a37dd52c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":360,"y":640,"wires":[]},{"id":"58f42177fbba5da6","type":"debug","z":"933f5581a37dd52c","name":"hoy hgere","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":4420,"y":600,"wires":[]},{"id":"16f62f47e8cdb911","type":"debug","z":"933f5581a37dd52c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":4280,"y":460,"wires":[]},{"id":"52b3fb4303059f0b","type":"debug","z":"933f5581a37dd52c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2220,"y":180,"wires":[]},{"id":"6f0583e9c09bf522","type":"debug","z":"933f5581a37dd52c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":3620,"y":240,"wires":[]},{"id":"dccde5863cfee895","type":"debug","z":"933f5581a37dd52c","name":"data","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3110,"y":180,"wires":[]},{"id":"d1ce8de1add5048b","type":"change","z":"933f5581a37dd52c","name":"Patio","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"light.patio_lights\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":3930,"y":1220,"wires":[["3e7e886b757c00c5"]]},{"id":"93cc876515c41852","type":"change","z":"933f5581a37dd52c","name":"Patio","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"light.patio_lights\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":4150,"y":920,"wires":[["1d56e1f478c25091"]]},{"id":"11b4afcad2643e2e","type":"change","z":"933f5581a37dd52c","name":"LivingRo","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"light.group_livingroom_lights\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":3980,"y":1140,"wires":[["3e7e886b757c00c5"]]},{"id":"1482fb6bd7ca4dd1","type":"change","z":"933f5581a37dd52c","name":"Kitchen","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"light.group_kitchen_lights\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":3980,"y":1180,"wires":[["3e7e886b757c00c5"]]},{"id":"2d8d6d2796fc6b02","type":"debug","z":"933f5581a37dd52c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":470,"y":300,"wires":[]},{"id":"78d65470dc05638f","type":"server-state-changed","z":"933f5581a37dd52c","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.remote_maxi_dimmer_action","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":190,"y":300,"wires":[["2d8d6d2796fc6b02"]]},{"id":"2cc83b9a6fe9febb","type":"mqtt in","z":"933f5581a37dd52c","name":"","topic":"zigbee2mqtt/remote_ikea_dial","qos":"2","datatype":"json","broker":"21000c19b97da572","nl":false,"rap":true,"rh":0,"inputs":0,"x":120,"y":960,"wires":[[]]},{"id":"32505711f87bda11","type":"debug","z":"933f5581a37dd52c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":410,"y":880,"wires":[]},{"id":"776a8ebef16f1aac","type":"api-call-service","z":"933f5581a37dd52c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.bedroom_lights"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1250,"y":980,"wires":[["9937b3ec1d262f11"]]},{"id":"eb5d617dc72fac44","type":"change","z":"933f5581a37dd52c","name":"command","rules":[{"t":"move","p":"payload.brightness","pt":"msg","to":"payload.data.brightness","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":700,"y":960,"wires":[["d06aef76217953ea","6ac35973d7c049ea"]]},{"id":"6ac35973d7c049ea","type":"debug","z":"933f5581a37dd52c","name":"1","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":859,"y":891,"wires":[]},{"id":"9937b3ec1d262f11","type":"debug","z":"933f5581a37dd52c","name":"2","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1610,"y":1000,"wires":[]},{"id":"401ca565b25fb13d","type":"trigger","z":"933f5581a37dd52c","name":"","op1":"","op2":"0","op1type":"nul","op2type":"str","duration":"800","extend":true,"units":"ms","reset":"","bytopic":"all","outputs":1,"x":1300,"y":640,"wires":[["7eda3eb589b2ea8e","e251c8e0979fa2ac"]]},{"id":"94719e344c54c7a4","type":"switch","z":"933f5581a37dd52c","name":"Device?","property":"payload.action","propertyType":"msg","rules":[{"t":"neq","v":"toggle","vt":"str"},{"t":"eq","v":"toggle","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":520,"y":960,"wires":[["eb5d617dc72fac44"],["f91d0b008ef484ab"]]},{"id":"084b6cf2b359fa1f","type":"api-call-service","z":"933f5581a37dd52c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.bedroom_lights"],"data":"{\"brightness_pct\":\"100\"}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1090,"y":1040,"wires":[[]]},{"id":"72f1bd2daa8cf337","type":"api-call-service","z":"933f5581a37dd52c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.bedroom_lights"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1390,"y":920,"wires":[[]]},{"id":"d06aef76217953ea","type":"switch","z":"933f5581a37dd52c","name":"Device?","property":"payload.data.brightness","propertyType":"msg","rules":[{"t":"lt","v":"5","vt":"num"},{"t":"gte","v":"5","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":900,"y":960,"wires":[["08ba7ba6adf1f56a"],["776a8ebef16f1aac"]]},{"id":"08ba7ba6adf1f56a","type":"change","z":"933f5581a37dd52c","name":"command","rules":[{"t":"delete","p":"payload.data","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1060,"y":920,"wires":[["bf520346f7897afc"]]},{"id":"22697bf95c76c11d","type":"trigger","z":"933f5581a37dd52c","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"150","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":360,"y":960,"wires":[["94719e344c54c7a4"]]},{"id":"f91d0b008ef484ab","type":"trigger","z":"933f5581a37dd52c","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"1","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":540,"y":1000,"wires":[["601c267cee92a767"]]},{"id":"bf520346f7897afc","type":"trigger","z":"933f5581a37dd52c","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"1","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1220,"y":920,"wires":[["72f1bd2daa8cf337"]]},{"id":"601c267cee92a767","type":"api-current-state","z":"933f5581a37dd52c","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.bedroom_lights","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":700,"y":1060,"wires":[["084b6cf2b359fa1f"],["15951f24d6c2f9aa"]]},{"id":"15951f24d6c2f9aa","type":"api-call-service","z":"933f5581a37dd52c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.bedroom_lights"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1090,"y":1140,"wires":[[]]},{"id":"410609d9902f1294","type":"debug","z":"933f5581a37dd52c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":730,"y":800,"wires":[]},{"id":"80581914c059e70b","type":"switch","z":"933f5581a37dd52c","name":"Device?","property":"payload.action","propertyType":"msg","rules":[{"t":"eq","v":"brightness_move_up","vt":"str"},{"t":"eq","v":"play_pause","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":389,"y":824,"wires":[["410609d9902f1294"],[]]},{"id":"a2582ee0170c26ce","type":"api-current-state","z":"933f5581a37dd52c","name":"Home Group","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"(playing|paused)","halt_if_type":"re","halt_if_compare":"is","entity_id":"media_player.group_home_speakers","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"data.entity","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1690,"y":340,"wires":[["7470b08118e4aea7"],["f2eeb853583688c7"]]},{"id":"7470b08118e4aea7","type":"change","z":"933f5581a37dd52c","name":"maxi speakers","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"media_player.group_maxi_speakers\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":1700,"y":300,"wires":[["151f1963fecf0607"]]},{"id":"e995b61ee5af4baa","type":"api-current-state","z":"933f5581a37dd52c","name":"LVSpeakers","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"(playing|paused)","halt_if_type":"re","halt_if_compare":"is","entity_id":"media_player.group_living_room_speakers","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"data.entity","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":2050,"y":1040,"wires":[["70341d6483dd7f3c"],["8dedf648b9898060"]]},{"id":"70341d6483dd7f3c","type":"change","z":"933f5581a37dd52c","name":"set entity","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"data\":{\"entity_id\":\"media_player.group_living_room_speakers\"}}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":2060,"y":1000,"wires":[["914fc6977ecda928"]]},{"id":"7a2bddfeffbf719d","type":"api-call-service","z":"933f5581a37dd52c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.bedroom_lights"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1630,"y":1240,"wires":[[]]},{"id":"0d4ce40e39cf5c72","type":"trigger","z":"933f5581a37dd52c","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"1","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1460,"y":1240,"wires":[["7a2bddfeffbf719d"]]},{"id":"f2f9311781176673","type":"change","z":"933f5581a37dd52c","name":"command","rules":[{"t":"delete","p":"payload.data","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1300,"y":1240,"wires":[["0d4ce40e39cf5c72"]]},{"id":"2f0210cdb84f9d63","type":"switch","z":"933f5581a37dd52c","name":"Device?","property":"payload.data.brightness","propertyType":"msg","rules":[{"t":"lt","v":"5","vt":"num"},{"t":"gte","v":"5","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":1160,"y":1280,"wires":[["f2f9311781176673"],["18d6990371b0aae8"]]},{"id":"18d6990371b0aae8","type":"api-call-service","z":"933f5581a37dd52c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.bedroom_lights"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1490,"y":1300,"wires":[["1ec24ed38a64b403"]]},{"id":"48d6ca2327e1e096","type":"switch","z":"933f5581a37dd52c","name":"Device?","property":"payload.action","propertyType":"msg","rules":[{"t":"neq","v":"toggle","vt":"str"},{"t":"eq","v":"toggle","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":540,"y":1440,"wires":[["51cca52bb24630df"],["97f15f208e99080a"]]},{"id":"abe7e185c2c01538","type":"debug","z":"933f5581a37dd52c","name":"1","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":930,"y":1300,"wires":[]},{"id":"1ec24ed38a64b403","type":"debug","z":"933f5581a37dd52c","name":"2","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1850,"y":1320,"wires":[]},{"id":"e5b567c17d3cb0a2","type":"trigger","z":"933f5581a37dd52c","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"1","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":390,"y":1440,"wires":[["48d6ca2327e1e096"]]},{"id":"97f15f208e99080a","type":"trigger","z":"933f5581a37dd52c","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"1","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":620,"y":1480,"wires":[["32d8543abfecb3fe"]]},{"id":"e3852397348a4c3b","type":"mqtt in","z":"933f5581a37dd52c","name":"","topic":"zigbee2mqtt/remote_ikea_dial","qos":"2","datatype":"json","broker":"21000c19b97da572","nl":false,"rap":true,"rh":0,"inputs":0,"x":120,"y":1440,"wires":[["943beb7c250b8384"]]},{"id":"32d8543abfecb3fe","type":"api-current-state","z":"933f5581a37dd52c","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.bedroom_lights","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":780,"y":1540,"wires":[["32fb2a3700a3ad59"],["35027b882431c5ca"]]},{"id":"1e99da6c8d1b5a84","type":"switch","z":"933f5581a37dd52c","name":"Device?","property":"payload.action","propertyType":"msg","rules":[{"t":"eq","v":"brightness_move_up","vt":"str"},{"t":"eq","v":"play_pause","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":389,"y":1304,"wires":[["df538d97941e5ebd"],[]]},{"id":"943beb7c250b8384","type":"debug","z":"933f5581a37dd52c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":410,"y":1340,"wires":[]},{"id":"32fb2a3700a3ad59","type":"api-call-service","z":"933f5581a37dd52c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.bedroom_lights"],"data":"{\"brightness_pct\":\"100\"}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1170,"y":1520,"wires":[[]]},{"id":"35027b882431c5ca","type":"api-call-service","z":"933f5581a37dd52c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.bedroom_lights"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1170,"y":1620,"wires":[[]]},{"id":"df538d97941e5ebd","type":"debug","z":"933f5581a37dd52c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":730,"y":1280,"wires":[]},{"id":"ecabddfeb52b6782","type":"switch","z":"933f5581a37dd52c","name":"Command","property":"payload.action","propertyType":"msg","rules":[{"t":"eq","v":"brightness_move_up","vt":"str"},{"t":"eq","v":"brightness_move_down","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":870,"y":1420,"wires":[["e73a733b54de4469"],["59c8bb49365781b6"]]},{"id":"e73a733b54de4469","type":"api-call-service","z":"933f5581a37dd52c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.bedroom_lamp2_light"],"data":"{\"brightness_step_pct\":\"10\"}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1050,"y":1400,"wires":[[]]},{"id":"59c8bb49365781b6","type":"api-call-service","z":"933f5581a37dd52c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.bedroom_lamp2_light"],"data":"{\"brightness_step_pct\":\"-10\"}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1050,"y":1460,"wires":[[]]},{"id":"51cca52bb24630df","type":"trigger","z":"933f5581a37dd52c","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"500","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":700,"y":1360,"wires":[["ecabddfeb52b6782"]]},{"id":"20deda8f8b480aab","type":"server-state-changed","z":"933f5581a37dd52c","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.remote_phillips_tap_action","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":190,"y":2000,"wires":[["66e3f47ae7d12679","d5efbe75e4696a7e"]]},{"id":"66e3f47ae7d12679","type":"debug","z":"933f5581a37dd52c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":470,"y":1940,"wires":[]},{"id":"d5efbe75e4696a7e","type":"switch","z":"933f5581a37dd52c","name":"Command","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"press_1","vt":"str"},{"t":"eq","v":"press_2","vt":"str"},{"t":"eq","v":"press_3","vt":"str"},{"t":"eq","v":"press_4","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":510,"y":2000,"wires":[["c27b67d192564802"],["d3ce1563bea9ac19"],["bfe946629f5a60e0"],["7c8ea243bfaae384"]]},{"id":"c27b67d192564802","type":"api-call-service","z":"933f5581a37dd52c","name":"Lights on","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"toggle","areaId":[],"deviceId":[],"entityId":["light.bedroom_lights"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":860,"y":1900,"wires":[[]]},{"id":"7c8ea243bfaae384","type":"api-call-service","z":"933f5581a37dd52c","name":"Brigthen lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.bedroom_lights"],"data":"{\"brightness_step\":25}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":700,"y":2240,"wires":[[]]},{"id":"d3ce1563bea9ac19","type":"api-call-service","z":"933f5581a37dd52c","name":"Dim lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.bedroom_lights"],"data":"{\"brightness_step\":-35}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":740,"y":2000,"wires":[[]]},{"id":"fea5ddbb4ca0032b","type":"api-call-service","z":"933f5581a37dd52c","name":"Lightson ","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.bedroom_lights"],"data":"{\"brightness\":\"255\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1960,"y":2120,"wires":[[]]},{"id":"0345066f71f33d3c","type":"delay","z":"933f5581a37dd52c","name":"Delay","pauseType":"delay","timeout":"1","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":950,"y":2140,"wires":[["fcfbb9c93021b76f"]]},{"id":"fcfbb9c93021b76f","type":"change","z":"933f5581a37dd52c","name":"Reset","rules":[{"t":"set","p":"reset","pt":"msg","to":"foo","tot":"str"},{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1130,"y":2140,"wires":[["51f21057e0bd4fe6"]]},{"id":"aebf1618b9fd68b9","type":"switch","z":"933f5581a37dd52c","name":"count presses","property":"count","propertyType":"flow","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"num"},{"t":"eq","v":"3","vt":"num"},{"t":"eq","v":"4","vt":"num"},{"t":"eq","v":"5","vt":"num"}],"checkall":"true","repair":false,"outputs":5,"x":1310,"y":2180,"wires":[["f4250fd878904db2"],["e1c92a245a8e616e"],["8b0c601185dff764"],["f91c8dc3cb72e916"],["b6ae8aea6851c5d6"]],"info":"Just expand the flow.count to how ever many\npresses you want/need."},{"id":"51f21057e0bd4fe6","type":"counter","z":"933f5581a37dd52c","name":"","init":"0","step":"1","lower":"","upper":"","mode":"increment","outputs":"1","x":1130,"y":2080,"wires":[["a1bb33762f63e248"]]},{"id":"e18c0877e733d58b","type":"inject","z":"933f5581a37dd52c","name":"Reset","repeat":"","crontab":"","once":true,"onceDelay":"0.5","topic":"","payload":"","payloadType":"date","x":950,"y":2100,"wires":[["fcfbb9c93021b76f"]]},{"id":"f4250fd878904db2","type":"change","z":"933f5581a37dd52c","name":"Single Press","rules":[{"t":"set","p":"pressamount","pt":"msg","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1520,"y":2120,"wires":[["910922d2499bde3a"]]},{"id":"e1c92a245a8e616e","type":"change","z":"933f5581a37dd52c","name":"Double Press","rules":[{"t":"set","p":"pressamount","pt":"msg","to":"2","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1530,"y":2160,"wires":[[]]},{"id":"8b0c601185dff764","type":"change","z":"933f5581a37dd52c","name":"Triple Press","rules":[{"t":"set","p":"pressamount","pt":"msg","to":"3","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1520,"y":2200,"wires":[["1552707e460c5a04"]]},{"id":"f91c8dc3cb72e916","type":"change","z":"933f5581a37dd52c","name":"Four Press","rules":[{"t":"set","p":"pressamount","pt":"msg","to":"4","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1520,"y":2240,"wires":[["1552707e460c5a04"]]},{"id":"a1bb33762f63e248","type":"change","z":"933f5581a37dd52c","name":"Flow set","rules":[{"t":"set","p":"count","pt":"flow","to":"count","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1290,"y":2080,"wires":[["e962304395f19186"]]},{"id":"910922d2499bde3a","type":"delay","z":"933f5581a37dd52c","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":1750,"y":2120,"wires":[["fea5ddbb4ca0032b"]]},{"id":"e962304395f19186","type":"debug","z":"933f5581a37dd52c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"count","targetType":"msg","statusVal":"","statusType":"auto","x":1520,"y":2080,"wires":[]},{"id":"b6ae8aea6851c5d6","type":"change","z":"933f5581a37dd52c","name":"Five Press","rules":[{"t":"set","p":"pressamount","pt":"msg","to":"5","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1530,"y":2280,"wires":[["1552707e460c5a04"]]},{"id":"6cd22433ae5c4410","type":"trigger","z":"933f5581a37dd52c","name":"","op1":"","op2":"0","op1type":"nul","op2type":"str","duration":"999","extend":true,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":980,"y":2180,"wires":[["0345066f71f33d3c","aebf1618b9fd68b9"]]},{"id":"bfe946629f5a60e0","type":"trigger","z":"933f5581a37dd52c","name":"","op1":"","op2":"0","op1type":"nul","op2type":"str","duration":"1","extend":true,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":730,"y":2080,"wires":[["51f21057e0bd4fe6","6cd22433ae5c4410"]]},{"id":"c00d23ed8e7c4765","type":"api-call-service","z":"933f5581a37dd52c","name":"Lightson ","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.bedroom_lights"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2120,"y":2200,"wires":[["59f876eeba0c3824","617264b0da7792b3"]]},{"id":"1552707e460c5a04","type":"api-call-service","z":"933f5581a37dd52c","name":"Screens off","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.plug_bedroom_screens"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1790,"y":2200,"wires":[["3c17dce00dad3336"]]},{"id":"56dbb4172e68e11f","type":"api-call-service","z":"933f5581a37dd52c","name":"tv off","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"turn_off","areaId":[],"deviceId":[],"entityId":["media_player.bedroom_roku"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2450,"y":2200,"wires":[[]]},{"id":"6e4831e471f7e321","type":"inject","z":"933f5581a37dd52c","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1760,"y":2340,"wires":[[]]},{"id":"bc77330857b23826","type":"api-call-service","z":"933f5581a37dd52c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"play_media","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3250,"y":2140,"wires":[["82f3037dbdf4c18f"]]},{"id":"2e60ba2d2281d6db","type":"change","z":"933f5581a37dd52c","name":"","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"media_player.dungeon_speaker","tot":"str"},{"t":"set","p":"payload.data.media_content_id","pt":"msg","to":"url","tot":"msg"},{"t":"set","p":"payload.data.media_content_type","pt":"msg","to":"music","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":3000,"y":2140,"wires":[["bc77330857b23826"]]},{"id":"e6df7833b65ceed2","type":"api-call-service","z":"933f5581a37dd52c","name":"volume to 100%","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_set","areaId":[],"deviceId":[],"entityId":["media_player.dungeon_speaker"],"data":"{\"volume_level\":\"0.5\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3760,"y":2140,"wires":[[]]},{"id":"82f3037dbdf4c18f","type":"change","z":"933f5581a37dd52c","name":"","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":3540,"y":2140,"wires":[["e6df7833b65ceed2"]]},{"id":"c716ac613f65753d","type":"api-call-service","z":"933f5581a37dd52c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"play_media","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3250,"y":2220,"wires":[["6d965b3a11b2a290"]]},{"id":"6b5651fa187822fd","type":"change","z":"933f5581a37dd52c","name":"","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"media_player.bedroom_ceiling_speaker","tot":"str"},{"t":"set","p":"payload.data.media_content_id","pt":"msg","to":"url","tot":"msg"},{"t":"set","p":"payload.data.media_content_type","pt":"msg","to":"music","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2980,"y":2200,"wires":[["c716ac613f65753d"]]},{"id":"3a25d94217d2201a","type":"api-call-service","z":"933f5581a37dd52c","name":"volume to 100%","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_set","areaId":[],"deviceId":[],"entityId":["media_player.bedroom_ceiling_speaker"],"data":"{\"volume_level\":\"0.4\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3760,"y":2180,"wires":[[]]},{"id":"6d965b3a11b2a290","type":"change","z":"933f5581a37dd52c","name":"","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":3540,"y":2180,"wires":[["3a25d94217d2201a"]]},{"id":"ba42cf8822718c61","type":"api-call-service","z":"933f5581a37dd52c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"play_media","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3230,"y":2080,"wires":[["fd2911d7142ac815"]]},{"id":"566175fcf2828da5","type":"change","z":"933f5581a37dd52c","name":"","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"media_player.bedroom_speaker","tot":"str"},{"t":"set","p":"payload.data.media_content_id","pt":"msg","to":"url","tot":"msg"},{"t":"set","p":"payload.data.media_content_type","pt":"msg","to":"music","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":3000,"y":2100,"wires":[["ba42cf8822718c61"]]},{"id":"dbb80d8bab24f4aa","type":"api-call-service","z":"933f5581a37dd52c","name":"volume to 100%","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_set","areaId":[],"deviceId":[],"entityId":["media_player.bedroom_speaker"],"data":"{\"volume_level\":\"0.4\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3760,"y":2100,"wires":[[]]},{"id":"fd2911d7142ac815","type":"change","z":"933f5581a37dd52c","name":"","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":3540,"y":2100,"wires":[["dbb80d8bab24f4aa"]]},{"id":"fd2aa1f7d864b5f3","type":"trigger","z":"933f5581a37dd52c","name":"","op1":"","op2":"","op1type":"str","op2type":"nul","duration":"1","extend":false,"overrideDelay":false,"units":"min","reset":"open","bytopic":"all","topic":"topic","outputs":1,"x":2370,"y":2140,"wires":[["566175fcf2828da5","2e60ba2d2281d6db","6b5651fa187822fd"]]},{"id":"3c17dce00dad3336","type":"api-call-service","z":"933f5581a37dd52c","name":"tv off","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"turn_off","areaId":[],"deviceId":[],"entityId":["media_player.bedroom_tv"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1950,"y":2200,"wires":[["c00d23ed8e7c4765"]]},{"id":"59f876eeba0c3824","type":"delay","z":"933f5581a37dd52c","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":2280,"y":2200,"wires":[["56dbb4172e68e11f"]]},{"id":"617264b0da7792b3","type":"change","z":"933f5581a37dd52c","name":"set url","rules":[{"t":"set","p":"url","pt":"msg","to":"http://192.168.0.15:8123/local/thunderstorm.mp4","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2250,"y":2160,"wires":[["fd2aa1f7d864b5f3"]]},{"id":"ab19afa9f83a30a1","type":"api-call-service","z":"17e87e6a7428d034","name":"Back door 6%","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.back_door_light"],"data":"{\"brightness_pct\":\"6\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":640,"y":900,"wires":[[]]},{"id":"cddd2cdfb0fa4cec","type":"server-state-changed","z":"17e87e6a7428d034","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"light.back_door_light","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":200,"y":900,"wires":[["28f432ea822fff7e"],[]]},{"id":"48690bd0d5aa27c0","type":"poll-state","z":"17e87e6a7428d034","name":"","server":"7ab5c227.a3ce8c","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"2","updateIntervalType":"num","updateIntervalUnits":"hours","outputinitially":false,"outputonchanged":true,"entity_id":"sun.sun","state_type":"str","halt_if":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"x":170,"y":1160,"wires":[["cb186987cf766bb4","92b9d4d022fb97b0"]]},{"id":"cb186987cf766bb4","type":"switch","z":"17e87e6a7428d034","name":"","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"below","vt":"str"},{"t":"cont","v":"above_horizon","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":530,"y":1160,"wires":[["9908bc8610984a80"],[]]},{"id":"94184365ae7b7621","type":"inject","z":"17e87e6a7428d034","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"below_horizon","payloadType":"str","x":150,"y":960,"wires":[[]]},{"id":"92b9d4d022fb97b0","type":"trigger","z":"17e87e6a7428d034","name":"","op1":"","op2":"0","op1type":"pay","op2type":"str","duration":"-3","extend":false,"overrideDelay":false,"units":"min","reset":"above_horizon","bytopic":"all","topic":"topic","outputs":1,"x":370,"y":1200,"wires":[["cb186987cf766bb4"]]},{"id":"0ffe5761dfa6f9df","type":"api-call-service","z":"17e87e6a7428d034","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.back_door_light"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1170,"y":1160,"wires":[[]]},{"id":"28f432ea822fff7e","type":"debug","z":"17e87e6a7428d034","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":440,"y":900,"wires":[]},{"id":"030b33d510929c18","type":"switch","z":"17e87e6a7428d034","name":"","property":"data.old_state.state","propertyType":"msg","rules":[{"t":"cont","v":"off","vt":"str"},{"t":"cont","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":450,"y":940,"wires":[["ab19afa9f83a30a1"],["d1f32ca6f0845ba3"]]},{"id":"d1f32ca6f0845ba3","type":"api-call-service","z":"17e87e6a7428d034","name":"Back door 50%","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.back_door_light"],"data":"{\"brightness_pct\":\"50\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":640,"y":980,"wires":[[]]},{"id":"e6e81999e0dbffc6","type":"api-call-service","z":"17e87e6a7428d034","name":"Back door 100 white","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.back_door_light"],"data":"{\"color_name\":\"white\",\"brightness_pct\":\"100\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1140,"y":1880,"wires":[[]]},{"id":"3693c538eafb6dec","type":"server-state-changed","z":"17e87e6a7428d034","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.geovision_persons","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"(0|1|2)","halt_if_type":"re","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":420,"y":1840,"wires":[["77ff410b30c82d70"],[]]},{"id":"db8a264370e69bd1","type":"api-call-service","z":"17e87e6a7428d034","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.back_door_light"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":850,"y":1880,"wires":[[]]},{"id":"2f0b53d8218e08cb","type":"api-call-service","z":"17e87e6a7428d034","name":"Back door 65white","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.back_door_light"],"data":"{\"color_name\":\"white\",\"brightness_pct\":\"65\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1150,"y":1840,"wires":[[]]},{"id":"c7688e6ad81af324","type":"api-current-state","z":"17e87e6a7428d034","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"unlocked","halt_if_type":"str","halt_if_compare":"is","entity_id":"lock.back_door","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":890,"y":1840,"wires":[["2f0b53d8218e08cb"],["e6e81999e0dbffc6"]]},{"id":"77ff410b30c82d70","type":"switch","z":"17e87e6a7428d034","name":"","property":"payload","propertyType":"msg","rules":[{"t":"gt","v":"0","vt":"num"},{"t":"cont","v":"0","vt":"str"},{"t":"cont","v":"1","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":670,"y":1840,"wires":[["c7688e6ad81af324"],["db8a264370e69bd1"],["c7688e6ad81af324"]]},{"id":"9908bc8610984a80","type":"api-current-state","z":"17e87e6a7428d034","name":"Kink?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.kink_party","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":690,"y":1160,"wires":[["3cbe475172a6ab19"],[]]},{"id":"3cbe475172a6ab19","type":"api-current-state","z":"17e87e6a7428d034","name":"psychs","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.acid_time","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"entity.entity_id","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":890,"y":1160,"wires":[["0ffe5761dfa6f9df"],[]]},{"id":"f804d3fdcbcb9035","type":"comment","z":"17e87e6a7428d034","name":"","info":"","x":100,"y":900,"wires":[]},{"id":"5788d345103917bd","type":"comment","z":"17e87e6a7428d034","name":"","info":"","x":100,"y":1160,"wires":[]},{"id":"a010f0d06ca3253c","type":"comment","z":"17e87e6a7428d034","name":"","info":"","x":280,"y":1840,"wires":[]},{"id":"9c12ef115ca5a474","type":"inject","z":"17e87e6a7428d034","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":420,"y":800,"wires":[[]]},{"id":"e9f6f4497b61dc69","type":"server-state-changed","z":"1926984267e0fec1","name":"BAck Door","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"lock.back_door","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"(unlocked|locked)","halt_if_type":"re","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":440,"y":600,"wires":[["eaf32a902c4971a3","8d1093308d6433e7"],["8d1093308d6433e7"]]},{"id":"cad0065abe810e75","type":"api-call-service","z":"1926984267e0fec1","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"lock","service":"lock","areaId":[],"deviceId":[],"entityId":["lock.back_door"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":990,"y":600,"wires":[[]]},{"id":"5e653191a5bf60b4","type":"change","z":"1926984267e0fec1","name":"Set Data for mass alert","rules":[{"t":"set","p":"color_value","pt":"msg","to":"[0,255,0]","tot":"json"},{"t":"set","p":"dbrigthness","pt":"msg","to":"100","tot":"num"},{"t":"set","p":"message","pt":"msg","to":"Someone Has Entered","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1240,"y":540,"wires":[["211db03c05f264bb"]]},{"id":"3c74b545f5aa3550","type":"link out","z":"1926984267e0fec1","name":"Light and Speakers","mode":"link","links":["45904ca6429d867d"],"x":1715,"y":560,"wires":[]},{"id":"eaf32a902c4971a3","type":"switch","z":"1926984267e0fec1","name":"","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"unlocked","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":620,"y":560,"wires":[["2990b9e9192f7a80"]]},{"id":"2990b9e9192f7a80","type":"api-current-state","z":"1926984267e0fec1","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.motion_kitchen","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":920,"y":560,"wires":[["5e653191a5bf60b4"],["b85861972ad4be99"]]},{"id":"b85861972ad4be99","type":"change","z":"1926984267e0fec1","name":"Set Data for mass alert","rules":[{"t":"set","p":"color_value","pt":"msg","to":"[0,255,255]","tot":"str"},{"t":"set","p":"dbrigthness","pt":"msg","to":"100","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1240,"y":580,"wires":[["211db03c05f264bb"]]},{"id":"8d1093308d6433e7","type":"trigger","z":"1926984267e0fec1","name":"","op1":"","op2":"1","op1type":"nul","op2type":"num","duration":"2","extend":false,"units":"min","reset":"locked","bytopic":"all","outputs":1,"x":610,"y":600,"wires":[["1e74fde98cc5da1b"]]},{"id":"1e74fde98cc5da1b","type":"api-current-state","z":"1926984267e0fec1","name":"Kitchen Door?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"(off|unavailable)","halt_if_type":"re","halt_if_compare":"is","entity_id":"binary_sensor.door_kitchen","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":800,"y":600,"wires":[["cad0065abe810e75"],["29e855660eb896a6"]]},{"id":"29e855660eb896a6","type":"trigger","z":"1926984267e0fec1","name":"","op1":"","op2":"1","op1type":"nul","op2type":"num","duration":"1","extend":false,"overrideDelay":false,"units":"min","reset":"locked","bytopic":"all","topic":"topic","outputs":1,"x":810,"y":660,"wires":[["1e74fde98cc5da1b"]]},{"id":"211db03c05f264bb","type":"subflow:233ac7dcd801a802","z":"1926984267e0fec1","name":"","x":1510,"y":560,"wires":[]},{"id":"1d3476464ff3d90d","type":"comment","z":"1926984267e0fec1","name":"","info":"","x":460,"y":440,"wires":[]},{"id":"1875ad9ae15b702c","type":"comment","z":"ecbd17e87fcc158a","name":"simple on and off with a trigger and a timer","info":"","x":1000,"y":80,"wires":[]},{"id":"21e7d888746d39b3","type":"api-call-service","z":"ecbd17e87fcc158a","name":"Server Light Off","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.server_light"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1900,"y":160,"wires":[[]]},{"id":"641dccbf6f8208ce","type":"trigger","z":"ecbd17e87fcc158a","name":"","op1":"","op2":"1","op1type":"pay","op2type":"str","duration":"-20","extend":false,"overrideDelay":false,"units":"min","reset":"open","bytopic":"all","topic":"topic","outputs":1,"x":1150,"y":160,"wires":[["fa52dfb73465870a"]]},{"id":"b8e2bf300f26f59d","type":"api-call-service","z":"ecbd17e87fcc158a","name":"Server Light On","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.server_light"],"data":"{\"color_name\":\"white\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1320,"y":200,"wires":[[]]},{"id":"de13135d3070f7b1","type":"comment","z":"ecbd17e87fcc158a","name":"Server","info":"","x":1150,"y":200,"wires":[]},{"id":"81b7a07f10ff3da1","type":"change","z":"ecbd17e87fcc158a","name":"off","rules":[{"t":"set","p":"payload","pt":"msg","to":"closed","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":770,"y":160,"wires":[["9d253bda249c54f9"]]},{"id":"be1025049e5386e3","type":"change","z":"ecbd17e87fcc158a","name":"on","rules":[{"t":"set","p":"payload","pt":"msg","to":"open","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":770,"y":200,"wires":[["9d253bda249c54f9","641dccbf6f8208ce","b8e2bf300f26f59d"]]},{"id":"fa52dfb73465870a","type":"api-current-state","z":"ecbd17e87fcc158a","name":"Party Mode?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is_not","entity_id":"input_boolean.party_mode","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1350,"y":160,"wires":[["07a25a2deaab313c"],[]]},{"id":"cc2eda96a2201198","type":"trigger","z":"ecbd17e87fcc158a","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"2","extend":false,"units":"min","reset":"off","bytopic":"all","outputs":1,"x":990,"y":560,"wires":[["d814a9183efeac9d"]]},{"id":"83f7bbff63482710","type":"change","z":"ecbd17e87fcc158a","name":"Front Ring","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"message","pt":"msg","to":"Server door open","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2350,"y":540,"wires":[["fecc01ca46a98ae3"]]},{"id":"d814a9183efeac9d","type":"trigger","z":"ecbd17e87fcc158a","name":"","op1":"","op2":"1","op1type":"num","op2type":"str","duration":"-5","extend":false,"units":"min","reset":"off","bytopic":"all","outputs":1,"x":1170,"y":560,"wires":[["d42b6fb4393a1abe"]]},{"id":"912b80f94a088a9c","type":"api-call-service","z":"ecbd17e87fcc158a","name":"Patio Light Off","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.patio"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1760,"y":480,"wires":[[]]},{"id":"0f5c1fb35fb8e425","type":"trigger","z":"ecbd17e87fcc158a","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"3","extend":false,"units":"min","reset":"open","bytopic":"all","outputs":1,"x":1310,"y":480,"wires":[["38026934af438d84"]]},{"id":"fb351fa522c14669","type":"server-state-changed","z":"ecbd17e87fcc158a","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"light.patio","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":1110,"y":480,"wires":[["0f5c1fb35fb8e425"],[]]},{"id":"15c8c28a2d0c6d6b","type":"server-state-changed","z":"ecbd17e87fcc158a","name":"Door Server","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.sensor_server_door_contact","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":590,"y":160,"wires":[["81b7a07f10ff3da1"],["be1025049e5386e3"]]},{"id":"20b9ce12dbbfcdc6","type":"server-state-changed","z":"ecbd17e87fcc158a","name":"Door Server","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.sensor_server_door_contact","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"(on|off)","halt_if_type":"re","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":750,"y":560,"wires":[["cc2eda96a2201198","512fdf4d314eb48f"],[]]},{"id":"d42b6fb4393a1abe","type":"api-current-state","z":"ecbd17e87fcc158a","name":"Aerating?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.aerating_appartment","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1340,"y":560,"wires":[["94da865e35ea4a2f"],[]]},{"id":"3f43113a52aa83e2","type":"function","z":"ecbd17e87fcc158a","name":" Set payload for assistant relay","func":"var msg = {\n    \"payload\": \n{\n    \"command\": msg.message,\n    \"broadcast\": true,\n    \"converse\": false\n}\n\n}\nreturn msg;","outputs":1,"noerr":0,"x":1270,"y":840,"wires":[["706291c133653e88"]]},{"id":"706291c133653e88","type":"http request","z":"ecbd17e87fcc158a","name":"POST request","method":"POST","ret":"txt","paytoqs":"ignore","url":"http://192.168.0.15:3000/api/assistant","tls":"","persist":false,"proxy":"","authType":"","senderr":false,"x":1500,"y":840,"wires":[[]]},{"id":"beeceaf7551b5aaf","type":"change","z":"ecbd17e87fcc158a","name":"Front Ring","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"message","pt":"msg","to":"Server door open","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1010,"y":820,"wires":[["3f43113a52aa83e2"]]},{"id":"c05d08be63ac4d0a","type":"inject","z":"ecbd17e87fcc158a","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":780,"y":820,"wires":[["beeceaf7551b5aaf"]]},{"id":"77b68da758e324f2","type":"api-current-state","z":"ecbd17e87fcc158a","name":"vacuum","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"docked","halt_if_type":"str","halt_if_compare":"is","entity_id":"vacuum.xiaomi_vacuum_cleaner","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1600,"y":520,"wires":[["ac225528acebd59a"],[]]},{"id":"ac225528acebd59a","type":"api-current-state","z":"ecbd17e87fcc158a","name":"Occupancy Patio","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.sensor_patio_motion_occupancy","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1790,"y":560,"wires":[["3a1728e4ec7c8034"],[]]},{"id":"91951a2f13b210be","type":"change","z":"ecbd17e87fcc158a","name":"Front Ring","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"message","pt":"msg","to":"Server door open","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":3150,"y":600,"wires":[["fecc01ca46a98ae3"]]},{"id":"3a1728e4ec7c8034","type":"api-current-state","z":"ecbd17e87fcc158a","name":"Temp","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"17","halt_if_type":"num","halt_if_compare":"lt","entity_id":"sensor.sensor_outside_temperature_temperature","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1970,"y":560,"wires":[["ac26ace8e3045c0d"],["9837d4c3db8cb32d"]]},{"id":"9837d4c3db8cb32d","type":"trigger","z":"ecbd17e87fcc158a","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"60","extend":false,"units":"min","reset":"off","bytopic":"all","outputs":1,"x":2150,"y":580,"wires":[["ceb1923b2e9244c7"]]},{"id":"8de9ec55d350126b","type":"server-state-changed","z":"ecbd17e87fcc158a","name":"Door Server","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.sensor_server_door_contact","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":1970,"y":600,"wires":[["9837d4c3db8cb32d"],[]]},{"id":"512fdf4d314eb48f","type":"switch","z":"ecbd17e87fcc158a","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":990,"y":520,"wires":[["d814a9183efeac9d"]]},{"id":"94da865e35ea4a2f","type":"api-current-state","z":"ecbd17e87fcc158a","name":"Motion","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.sensor_server_workstation_motion_occupancy","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1470,"y":560,"wires":[["77b68da758e324f2"],[]]},{"id":"363e437bccdc57b7","type":"link out","z":"ecbd17e87fcc158a","name":"Light and Speakers","links":["45904ca6429d867d","ad88dbd2.4726b8","3405e943.fd3ee6","9cf42cf7ef60f645"],"x":2615,"y":480,"wires":[]},{"id":"aed17becf9d2b3b6","type":"server-state-changed","z":"ecbd17e87fcc158a","name":"aerating","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.aerating_appartment","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":1980,"y":640,"wires":[["9837d4c3db8cb32d"],[]]},{"id":"ac26ace8e3045c0d","type":"api-current-state","z":"ecbd17e87fcc158a","name":"Aerating?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.aerating_appartment","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":2140,"y":540,"wires":[["83f7bbff63482710"],[]]},{"id":"b8817b9460610772","type":"api-current-state","z":"ecbd17e87fcc158a","name":"Aerating?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.aerating_appartment","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":3000,"y":600,"wires":[["91951a2f13b210be"],[]]},{"id":"efcdbfba4761cb6c","type":"server-state-changed","z":"ecbd17e87fcc158a","name":"Quiet time","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.sleeper_in_patio","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":720,"y":680,"wires":[["0146b1fcea8616ab"],[]]},{"id":"0146b1fcea8616ab","type":"api-call-service","z":"ecbd17e87fcc158a","name":"Patio Light Off","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.patio_lights"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":900,"y":680,"wires":[[]]},{"id":"9d253bda249c54f9","type":"trigger","z":"ecbd17e87fcc158a","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"20","extend":false,"units":"min","reset":"open","bytopic":"all","outputs":1,"x":950,"y":160,"wires":[["641dccbf6f8208ce"]]},{"id":"fa4167fc7ff0e0d1","type":"api-current-state","z":"ecbd17e87fcc158a","name":"Party?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is_not","entity_id":"input_boolean.party_mode","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":2790,"y":600,"wires":[["b8817b9460610772"],[]]},{"id":"bfe85bb32665b694","type":"api-current-state","z":"ecbd17e87fcc158a","name":"CpuTemp","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"70","halt_if_type":"num","halt_if_compare":"lt","entity_id":"sensor.proxmox_tdie_temperature","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":2580,"y":620,"wires":[["fa4167fc7ff0e0d1"],[]]},{"id":"df892cdd6477b892","type":"server-state-changed","z":"ecbd17e87fcc158a","name":"CPU TEMP","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.proxmox_tdie_temperature","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"74","halt_if_type":"num","halt_if_compare":"gt","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":470,"y":1040,"wires":[["3448f336b45086dc"],["c053e7008fb02cde"]]},{"id":"81f6cf5ef100fdde","type":"function","z":"ecbd17e87fcc158a","name":"Javascript","func":"var newMsg = {\n \"payload\": {\n  \"data\": {\n  \"message\": \"Server over 74C\"\n}\n }\n};\nreturn newMsg;\n","outputs":1,"noerr":0,"x":1340,"y":1040,"wires":[["964115b6094ff83d"]]},{"id":"964115b6094ff83d","type":"api-call-service","z":"ecbd17e87fcc158a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"notify","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1500,"y":1040,"wires":[[]]},{"id":"3448f336b45086dc","type":"trigger","z":"ecbd17e87fcc158a","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"15","extend":false,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":890,"y":1040,"wires":[["037a4ac433c674c4"]]},{"id":"c053e7008fb02cde","type":"change","z":"ecbd17e87fcc158a","name":"reset","rules":[{"t":"set","p":"reset","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":670,"y":1100,"wires":[["3448f336b45086dc"]]},{"id":"037a4ac433c674c4","type":"trigger","z":"ecbd17e87fcc158a","name":"","op1":"","op2":"1","op1type":"pay","op2type":"str","duration":"60","extend":false,"units":"min","reset":"","bytopic":"all","outputs":1,"x":1130,"y":1040,"wires":[["81f6cf5ef100fdde"]]},{"id":"ceb1923b2e9244c7","type":"api-current-state","z":"ecbd17e87fcc158a","name":"Temp","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"23","halt_if_type":"num","halt_if_compare":"gt","entity_id":"sensor.sensor_outside_temperature_temperature","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":2290,"y":580,"wires":[["9314613a3dfee599"],["bfe85bb32665b694"]]},{"id":"9314613a3dfee599","type":"api-current-state","z":"ecbd17e87fcc158a","name":"patio door","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.sensor_patio_door_contact","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":2440,"y":580,"wires":[["fa4167fc7ff0e0d1"],["bfe85bb32665b694"]]},{"id":"768e0785db3860e6","type":"api-call-service","z":"ecbd17e87fcc158a","name":"Server Light Off","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.server_workstation_light"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":840,"y":1460,"wires":[[]]},{"id":"24d1f0bd057db37b","type":"api-call-service","z":"ecbd17e87fcc158a","name":"Server Light On","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.server_workstation_light"],"data":"{\"color_name\":\"white\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":840,"y":1420,"wires":[[]]},{"id":"2eb1ae02da3137af","type":"comment","z":"ecbd17e87fcc158a","name":"Server Worksation","info":"","x":650,"y":1380,"wires":[]},{"id":"0d58453903b43d98","type":"server-state-changed","z":"ecbd17e87fcc158a","name":"Motion ","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.sensor_server_workstation_motion_occupancy","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":470,"y":1420,"wires":[[],[]]},{"id":"9b09b5ece3546f35","type":"function","z":"ecbd17e87fcc158a","name":"Time","func":"var d = new Date();\nvar h = d.getHours();\n\nif (h > 22){\n    var brightness = \"80\";\n}\nelse if (h >= 0 && h <= 2 ){\n    var brightness = \"75\";\n}\nelse if (h>2 && h<7){\n    var brightness = \"50\";\n}\nelse{\n    var brightness = \"100\";\n}\n\nvar newMsg = \n\n{ \n    \"payload\": {\n                data: {\n                         \"brightness_pct\": brightness,\n                         \"effect\": \"colorloop\",\n                         \"color_name\": \"red\"\n                    \n                }\n               } \n};\nreturn newMsg;\n\n","outputs":1,"noerr":0,"x":1710,"y":1240,"wires":[["b2c67a9a5188d12b"]]},{"id":"b2c67a9a5188d12b","type":"api-call-service","z":"ecbd17e87fcc158a","name":"Server Light Off","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.server_workstation_light"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1875,"y":1239.6666259765625,"wires":[[]]},{"id":"3075072bdf185a49","type":"inject","z":"ecbd17e87fcc158a","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1520,"y":1220,"wires":[["9b09b5ece3546f35"]]},{"id":"07a25a2deaab313c","type":"api-current-state","z":"ecbd17e87fcc158a","name":"Kink?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.kink_party","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1510,"y":160,"wires":[["26f076dbb390e569"],[]]},{"id":"38026934af438d84","type":"api-current-state","z":"ecbd17e87fcc158a","name":"Kink?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.kink_party","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1470,"y":480,"wires":[["01bbef962d79c72a"],[]]},{"id":"fecc01ca46a98ae3","type":"subflow:233ac7dcd801a802","z":"ecbd17e87fcc158a","name":"","x":3210,"y":480,"wires":[]},{"id":"26f076dbb390e569","type":"api-current-state","z":"ecbd17e87fcc158a","name":"psychs","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.acid_time","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"entity.entity_id","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":1690,"y":160,"wires":[["21e7d888746d39b3"],[]]},{"id":"01bbef962d79c72a","type":"api-current-state","z":"ecbd17e87fcc158a","name":"psychs","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.acid_time","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"entity.entity_id","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":1590,"y":480,"wires":[["912b80f94a088a9c"],[]]},{"id":"21ef99190a729577","type":"server-state-changed","z":"ecbd17e87fcc158a","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.sleeper_in_patio","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":1620,"y":2420,"wires":[["e62aeae796047b43"],["0c31099ba5f7510b"]]},{"id":"8b81a478ae9382b7","type":"api-call-service","z":"ecbd17e87fcc158a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"toggle","areaId":[],"deviceId":[],"entityId":["input_boolean.sleeper_in_patio"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1290,"y":2420,"wires":[[]]},{"id":"0c31099ba5f7510b","type":"api-call-service","z":"ecbd17e87fcc158a","name":"Patio lights off","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.plug_patio_lights"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1940,"y":2440,"wires":[[]]},{"id":"26c4484a88c117cc","type":"server-state-changed","z":"ecbd17e87fcc158a","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.remote_patio_quiet_button_action","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":690,"y":2420,"wires":[["26344d790c75554d","51b6bab30611571b"]]},{"id":"26344d790c75554d","type":"debug","z":"ecbd17e87fcc158a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":930,"y":2240,"wires":[]},{"id":"51b6bab30611571b","type":"switch","z":"ecbd17e87fcc158a","name":"click = off ( double) ","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1030,"y":2420,"wires":[["8b81a478ae9382b7"]],"info":"Just expand the flow.count to how ever many\npresses you want/need."},{"id":"e62aeae796047b43","type":"api-call-service","z":"ecbd17e87fcc158a","name":"Patio lights on","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.plug_patio_lights"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1940,"y":2400,"wires":[[]]},{"id":"b6ee0ccf52b87e94","type":"change","z":"ecbd17e87fcc158a","name":"","rules":[{"t":"set","p":"action","pt":"msg","to":"payload.action","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":2860,"wires":[["63eb0e0dc4d5d6da","d716521c052172de"]]},{"id":"6562f5605735a2a9","type":"mqtt in","z":"ecbd17e87fcc158a","name":"","topic":"zigbee2mqtt/remote_patio_dial","qos":"2","datatype":"json","broker":"21000c19b97da572","nl":false,"rap":true,"rh":0,"inputs":0,"x":200,"y":2860,"wires":[["b6ee0ccf52b87e94","ca64edb5b173c13c"]]},{"id":"ca64edb5b173c13c","type":"debug","z":"ecbd17e87fcc158a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":510,"y":2740,"wires":[]},{"id":"63eb0e0dc4d5d6da","type":"api-current-state","z":"ecbd17e87fcc158a","name":"chromecast","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is_not","entity_id":"media_player.patio_chromecast","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"entity","propertyType":"msg","value":"","valueType":"entity"},{"property":"payload.data.entity_id","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":730,"y":2860,"wires":[["83f58e618809fa29"],["536646e1e944cba7"]]},{"id":"83f58e618809fa29","type":"switch","z":"ecbd17e87fcc158a","name":"","property":"action","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1040,"y":2820,"wires":[["a5636fb5f5e318ca"]]},{"id":"a5636fb5f5e318ca","type":"switch","z":"ecbd17e87fcc158a","name":"","property":"action","propertyType":"msg","rules":[{"t":"eq","v":"rotate_right","vt":"str"},{"t":"eq","v":"play_pause","vt":"str"},{"t":"eq","v":"rotate_left","vt":"str"},{"t":"eq","v":"skip_forward","vt":"str"},{"t":"eq","v":"skip_backward","vt":"str"}],"checkall":"true","repair":false,"outputs":5,"x":1160,"y":2820,"wires":[["a83887198e964a70"],["df8dabbacdd1617e"],["69bcccd284e5aa23"],["73a4def35add148e","d716521c052172de"],["198cfbae6d03120b"]]},{"id":"a83887198e964a70","type":"api-call-service","z":"ecbd17e87fcc158a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_up","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1400,"y":2760,"wires":[[]]},{"id":"df8dabbacdd1617e","type":"api-call-service","z":"ecbd17e87fcc158a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"media_play_pause","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1420,"y":2820,"wires":[[]]},{"id":"69bcccd284e5aa23","type":"api-call-service","z":"ecbd17e87fcc158a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_down","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1400,"y":2860,"wires":[[]]},{"id":"73a4def35add148e","type":"switch","z":"ecbd17e87fcc158a","name":"","property":"entity.attributes.is_volume_muted","propertyType":"msg","rules":[{"t":"cont","v":"false","vt":"str"},{"t":"cont","v":"true","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1310,"y":2900,"wires":[["e7bec832ab4b73b9"],["2d6073a40141b94b"]]},{"id":"e7bec832ab4b73b9","type":"api-call-service","z":"ecbd17e87fcc158a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_mute","areaId":[],"deviceId":[],"entityId":[],"data":"{\"is_volume_muted\": 1}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1590,"y":2900,"wires":[[]]},{"id":"2d6073a40141b94b","type":"api-call-service","z":"ecbd17e87fcc158a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_mute","areaId":[],"deviceId":[],"entityId":[],"data":"{\"is_volume_muted\": 0}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1590,"y":2940,"wires":[[]]},{"id":"d716521c052172de","type":"debug","z":"ecbd17e87fcc158a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1220,"y":3020,"wires":[]},{"id":"536646e1e944cba7","type":"api-current-state","z":"ecbd17e87fcc158a","name":"speaker","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is_not","entity_id":"media_player.server_speaker","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"entity","propertyType":"msg","value":"","valueType":"entity"},{"property":"payload.data.entity_id","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":900,"y":2860,"wires":[["83f58e618809fa29"]]},{"id":"198cfbae6d03120b","type":"api-call-service","z":"ecbd17e87fcc158a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"media_next_track","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1410,"y":2980,"wires":[[]]},{"id":"5dbdedf5449893d5","type":"server-state-changed","z":"ecbd17e87fcc158a","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"media_player.patio_chromecast","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is_not","outputs":2,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"entity","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":260,"y":2600,"wires":[["5f784f5a63633f60","b66503f9cdfabcb5"],["46ac55ae5cd1896a"]]},{"id":"3cc32dc5d0103924","type":"api-call-service","z":"ecbd17e87fcc158a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_mute","areaId":[],"deviceId":[],"entityId":["media_player.server_speaker"],"data":"{ \"is_volume_muted\": 1}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":810,"y":2540,"wires":[[]]},{"id":"46ac55ae5cd1896a","type":"api-call-service","z":"ecbd17e87fcc158a","name":"unmute","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_mute","areaId":[],"deviceId":[],"entityId":["media_player.server_speaker"],"data":"{ \"is_volume_muted\": 0}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":680,"y":2640,"wires":[[]]},{"id":"5f784f5a63633f60","type":"switch","z":"ecbd17e87fcc158a","name":"","property":"entity.new_state.attributes.is_volume_muted","propertyType":"msg","rules":[{"t":"cont","v":"false","vt":"str"},{"t":"cont","v":"true","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":550,"y":2560,"wires":[["3cc32dc5d0103924"],["46ac55ae5cd1896a"]]},{"id":"b66503f9cdfabcb5","type":"debug","z":"ecbd17e87fcc158a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":470,"y":2660,"wires":[]},{"id":"9876acab29422d70","type":"server-state-changed","z":"ecbd17e87fcc158a","name":"NOtif light on","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"light.patio_notification_light","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":750,"y":760,"wires":[["2896b9c73ec534f0"],[]]},{"id":"b61ef4e79f387024","type":"api-call-service","z":"ecbd17e87fcc158a","name":"Patio Light Off","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.patio_notification_light"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1160,"y":760,"wires":[[]]},{"id":"2896b9c73ec534f0","type":"trigger","z":"ecbd17e87fcc158a","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"10","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":950,"y":760,"wires":[["b61ef4e79f387024"]]},{"id":"9da2fb699db937af","type":"server-state-changed","z":"ecbd17e87fcc158a","name":"Noise","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.sound_detected_binary","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":310,"y":3400,"wires":[["2f63b042f67c086c"],["2fd34c887990c844"]]},{"id":"5702a016541fe225","type":"trigger","z":"ecbd17e87fcc158a","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"15","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":710,"y":3380,"wires":[["f66ea2f2c2ecc738"]]},{"id":"2fd34c887990c844","type":"change","z":"ecbd17e87fcc158a","name":"reset","rules":[{"t":"set","p":"reset","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":3440,"wires":[["5702a016541fe225","f66ea2f2c2ecc738"]]},{"id":"50ad86f7c9b0b821","type":"api-call-service","z":"ecbd17e87fcc158a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"tts","service":"google_translate_say","areaId":[],"deviceId":[],"entityId":["media_player.patio_chromecast"],"data":"{\"message\": \"Hey kids, Kindly Lower the Volume\"}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1600,"y":3380,"wires":[[]]},{"id":"3645671b810d01cd","type":"inject","z":"ecbd17e87fcc158a","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":720,"y":3300,"wires":[["5702a016541fe225"]]},{"id":"f66ea2f2c2ecc738","type":"trigger","z":"ecbd17e87fcc158a","name":"","op1":"","op2":"1","op1type":"pay","op2type":"str","duration":"-1","extend":false,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":950,"y":3380,"wires":[["68d4cfb18d24db5a"]]},{"id":"63ab36591461142a","type":"server-state-changed","z":"ecbd17e87fcc158a","name":"Noise lvl","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.sound_level_averaged","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"0.08","halt_if_type":"num","halt_if_compare":"gt","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":true,"ignoreCurrentStateUnavailable":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":320,"y":3360,"wires":[["2f63b042f67c086c"],[]]},{"id":"68d4cfb18d24db5a","type":"api-current-state","z":"ecbd17e87fcc158a","name":"Party?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.party_mode","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"entity","propertyType":"msg","value":"","valueType":"entity"},{"property":"payload.data.entity_id","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":1150,"y":3380,"wires":[["ac87f2179b16fd67"],[]]},{"id":"ac87f2179b16fd67","type":"api-current-state","z":"ecbd17e87fcc158a","name":"Occupied?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.patio_occupancy","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"entity","propertyType":"msg","value":"","valueType":"entity"},{"property":"payload.data.entity_id","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":1350,"y":3380,"wires":[["50ad86f7c9b0b821"],[]]},{"id":"c5b5b315321e59c0","type":"comment","z":"ecbd17e87fcc158a","name":"","info":"","x":540,"y":140,"wires":[]},{"id":"b498f36aa34de311","type":"comment","z":"ecbd17e87fcc158a","name":"","info":"","x":700,"y":540,"wires":[]},{"id":"b8bfb1195c944781","type":"comment","z":"ecbd17e87fcc158a","name":"","info":"","x":460,"y":640,"wires":[]},{"id":"9560c9300e4e1c3e","type":"comment","z":"ecbd17e87fcc158a","name":"","info":"","x":540,"y":720,"wires":[]},{"id":"d03b87288849d7e5","type":"comment","z":"ecbd17e87fcc158a","name":"","info":"","x":480,"y":1000,"wires":[]},{"id":"832f37ab0293f84f","type":"comment","z":"ecbd17e87fcc158a","name":"","info":"","x":420,"y":1340,"wires":[]},{"id":"8bcfd0e8727359b3","type":"comment","z":"ecbd17e87fcc158a","name":"","info":"","x":280,"y":2520,"wires":[]},{"id":"dc31e2d5bd757315","type":"comment","z":"ecbd17e87fcc158a","name":"","info":"","x":320,"y":2860,"wires":[]},{"id":"7901846ee942300e","type":"mqtt in","z":"6b01a9ccd3fa048b","name":"","topic":"zigbee2mqtt/remote_xiaomi_cube","qos":"2","datatype":"json","broker":"21000c19b97da572","nl":false,"rap":true,"rh":0,"inputs":0,"x":230,"y":480,"wires":[["2e46d8cd68bf0f55","703fec6beccb3829"]]},{"id":"2e46d8cd68bf0f55","type":"debug","z":"6b01a9ccd3fa048b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":350,"y":400,"wires":[]},{"id":"703fec6beccb3829","type":"switch","z":"6b01a9ccd3fa048b","name":"action","property":"payload.action","propertyType":"msg","rules":[{"t":"cont","v":"tap","vt":"str"},{"t":"cont","v":"right","vt":"str"},{"t":"cont","v":"left","vt":"str"},{"t":"cont","v":"shake","vt":"str"},{"t":"cont","v":"180","vt":"str"}],"checkall":"true","repair":false,"outputs":5,"x":570,"y":480,"wires":[["aad4a99c0d590c9e"],["699ac5d9aeb161e6"],["c04c50f55402136b"],["c7cd87d6084b0d77"],["97dda100fae9bded"]]},{"id":"aad4a99c0d590c9e","type":"switch","z":"6b01a9ccd3fa048b","name":"FAce","property":"payload.side","propertyType":"msg","rules":[{"t":"cont","v":"0","vt":"str"},{"t":"cont","v":"1","vt":"str"},{"t":"cont","v":"2","vt":"str"},{"t":"cont","v":"3","vt":"str"},{"t":"cont","v":"4","vt":"str"},{"t":"cont","v":"5","vt":"str"}],"checkall":"false","repair":true,"outputs":6,"x":1110,"y":400,"wires":[["b17736ebd629acbd"],["f3a0202554c3ea28"],["35c5b1c4d579c2f4"],["735322aa33e55b88"],["de33686f058e0f71"],["74527edd377de7ed"]]},{"id":"699ac5d9aeb161e6","type":"api-call-service","z":"6b01a9ccd3fa048b","name":"Brighten Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.nate_ceiling_light"],"data":"{\"brightness_step_pct\":\"25\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":900,"y":440,"wires":[[]]},{"id":"c04c50f55402136b","type":"api-call-service","z":"6b01a9ccd3fa048b","name":"Dim Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.nate_ceiling_light"],"data":"{\"brightness_step\":-25}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":890,"y":480,"wires":[[]]},{"id":"c7cd87d6084b0d77","type":"api-call-service","z":"6b01a9ccd3fa048b","name":"Toggle Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"toggle","areaId":[],"deviceId":[],"entityId":["light.nate_ceiling_light"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":890,"y":520,"wires":[[]]},{"id":"b17736ebd629acbd","type":"api-call-service","z":"6b01a9ccd3fa048b","name":"White Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.nate_ceiling_light"],"data":"{ \"color_name\": \"white\" }","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1270,"y":300,"wires":[[]]},{"id":"f3a0202554c3ea28","type":"api-call-service","z":"6b01a9ccd3fa048b","name":"Green Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.nate_ceiling_light"],"data":"{ \"color_name\": \"green\" }","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1270,"y":340,"wires":[[]]},{"id":"35c5b1c4d579c2f4","type":"api-call-service","z":"6b01a9ccd3fa048b","name":"Blue Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.nate_ceiling_light"],"data":"{ \"color_name\": \"blue\" }","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1270,"y":380,"wires":[[]]},{"id":"735322aa33e55b88","type":"api-call-service","z":"6b01a9ccd3fa048b","name":"Purple Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.nate_ceiling_light"],"data":"{ \"color_name\": \"purple\" }","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1270,"y":420,"wires":[[]]},{"id":"de33686f058e0f71","type":"api-call-service","z":"6b01a9ccd3fa048b","name":"Pink Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.nate_ceiling_light"],"data":"{ \"color_name\": \"pink\" }","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1270,"y":460,"wires":[[]]},{"id":"74527edd377de7ed","type":"api-call-service","z":"6b01a9ccd3fa048b","name":"Red Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.nate_ceiling_light"],"data":"{ \"color_name\": \"red\" }","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1270,"y":500,"wires":[[]]},{"id":"97dda100fae9bded","type":"function","z":"6b01a9ccd3fa048b","name":"Generate Random saturated color","func":"\nvar hue = Math.floor(Math.random() * 360); //generate a random number up to 360\n\nvar hs_color = hue + \",60\";\nvar hs_color_array = hs_color.split(\",\");\nvar newMsg = {\n    \"payload\": {\n        \"data\": {\n            \"hs_color\": hs_color_array,\n            \"brightness_pct\": 100\n            \n}\n        }\n    }\n;\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":920,"y":640,"wires":[["c2428015969674e0","a20394293cc5a61a"]]},{"id":"c2428015969674e0","type":"api-call-service","z":"6b01a9ccd3fa048b","name":"Red Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.nate_ceiling_light"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1270,"y":660,"wires":[[]]},{"id":"a20394293cc5a61a","type":"debug","z":"6b01a9ccd3fa048b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1270,"y":620,"wires":[]},{"id":"8c6d94ade940476f","type":"server-state-changed","z":"5906a7fb2733fdfc","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"vacuum.xiaomi_vacuum_cleaner","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"error","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":670,"y":380,"wires":[["759b76f802152b90"],["b652acd7f073d43a"]]},{"id":"c9176913f671b44c","type":"change","z":"5906a7fb2733fdfc","name":"VAacuum stuckj","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"message","pt":"msg","to":"Vacuum Stuck","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1360,"y":380,"wires":[["1336b94421bca8c6"]]},{"id":"b652acd7f073d43a","type":"change","z":"5906a7fb2733fdfc","name":"","rules":[{"t":"set","p":"reset","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":960,"y":400,"wires":[["759b76f802152b90"]]},{"id":"759b76f802152b90","type":"trigger","z":"5906a7fb2733fdfc","name":"","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"-10","extend":false,"units":"min","reset":"","bytopic":"all","outputs":1,"x":1150,"y":380,"wires":[["c9176913f671b44c"]]},{"id":"1336b94421bca8c6","type":"link out","z":"5906a7fb2733fdfc","name":"Light and Speakers","mode":"link","links":["45904ca6429d867d"],"x":1495,"y":380,"wires":[]},{"id":"20b02da455a864e4","type":"comment","z":"5906a7fb2733fdfc","name":"","info":"","x":340,"y":400,"wires":[]},{"id":"adf981e5c350077f","type":"http request","z":"c6790bfa88a3b330","name":"POST request","method":"POST","ret":"txt","paytoqs":"ignore","url":"http://192.168.0.210/cgi-bin/api.cgi?cmd=PtzCtrl&token=d7e821956a9d932","tls":"","persist":false,"proxy":"","authType":"","x":900,"y":380,"wires":[["aca8f589caad43dc"]]},{"id":"9342b54773d442f5","type":"inject","z":"c6790bfa88a3b330","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"1","payloadType":"str","x":550,"y":380,"wires":[["db91c582cb88e77b"]]},{"id":"aca8f589caad43dc","type":"debug","z":"c6790bfa88a3b330","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1120,"y":380,"wires":[]},{"id":"db91c582cb88e77b","type":"function","z":"c6790bfa88a3b330","name":"Javascript","func":"var d = new Date();\nvar m = d.getMilliseconds();\nvar url = \"http://192.168.0.12:8765/picture/5/current/?\" + m;\nvar newMsg = {\n    \"payload\": [{\"cmd\":\"PtzCtrl\",\"action\":0,\"param\":{\"channel\":0,\"op\":\"ToPos\",\"id\":1}}]\n};\nreturn newMsg;\n","outputs":1,"noerr":0,"x":700,"y":380,"wires":[["adf981e5c350077f"]]},{"id":"7a80902befcdccf8","type":"server-state-changed","z":"c6790bfa88a3b330","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"script.ptz_to","entityidfiltertype":"substring","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":240,"y":620,"wires":[["8de3b2e6f3e0af19"]]},{"id":"8de3b2e6f3e0af19","type":"trigger","z":"c6790bfa88a3b330","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"10","extend":true,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":850,"y":620,"wires":[["1ac219c27e3b54df"]]},{"id":"b63f39827e4d68ab","type":"api-call-service","z":"c6790bfa88a3b330","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"script","service":"ptz_to_doorway","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1280,"y":560,"wires":[[]]},{"id":"58d9ddb5d65932e5","type":"inject","z":"c6790bfa88a3b330","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":440,"y":520,"wires":[[]]},{"id":"eb19dbde873f9257","type":"debug","z":"c6790bfa88a3b330","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":650,"y":520,"wires":[]},{"id":"19a709312c53342f","type":"comment","z":"c6790bfa88a3b330","name":"","info":"","x":280,"y":460,"wires":[]},{"id":"1ac219c27e3b54df","type":"api-current-state","z":"c6790bfa88a3b330","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.waiting_pakidge","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":870,"y":560,"wires":[["b63f39827e4d68ab"],["8de3b2e6f3e0af19"]]},{"id":"4d6da45af0289951","type":"inject","z":"5f920ffe83bd9adf","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":80,"y":160,"wires":[["99eca477a2993a1a"]]},{"id":"99eca477a2993a1a","type":"api-call-service","z":"5f920ffe83bd9adf","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":true,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.living_room_window"],"data":"{\"color_name\": \"red\" }","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"entity","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":270,"y":160,"wires":[["e40c56b6636cbb10"]]},{"id":"e40c56b6636cbb10","type":"debug","z":"5f920ffe83bd9adf","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":430,"y":160,"wires":[]},{"id":"651f3882df060fbe","type":"bigtimer","z":"4e6f57edbb2d3314","outtopic":"","outpayload1":"1","outpayload2":"","name":"Big Timer","comment":"","lat":0,"lon":0,"starttime":"525","endtime":"540","starttime2":"555","endtime2":"570","startoff":0,"endoff":0,"startoff2":0,"endoff2":0,"offs":0,"outtext1":"","outtext2":"","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"day6":0,"month6":0,"day7":0,"month7":0,"day8":0,"month8":0,"day9":0,"month9":0,"day10":0,"month10":0,"day11":0,"month11":0,"day12":0,"month12":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"d6":0,"w6":0,"xday1":0,"xmonth1":0,"xday2":0,"xmonth2":0,"xday3":0,"xmonth3":0,"xday4":0,"xmonth4":0,"xday5":0,"xmonth5":0,"xday6":0,"xmonth6":0,"xday7":"","xmonth7":"","xday8":"","xmonth8":"","xday9":"","xmonth9":"","xday10":"","xmonth10":"","xday11":"","xmonth11":"","xday12":"","xmonth12":"","xd1":0,"xw1":0,"xd2":0,"xw2":0,"xd3":0,"xw3":0,"xd4":0,"xw4":0,"xd5":0,"xw5":0,"xd6":0,"xw6":0,"suspend":false,"random":false,"randon1":false,"randoff1":false,"randon2":false,"randoff2":false,"repeat":true,"atstart":true,"odd":false,"even":false,"x":500,"y":460,"wires":[["a9ed637a6f71bb73"],[],[]]},{"id":"aeb4d53210de9530","type":"api-current-state","z":"4e6f57edbb2d3314","name":"carla home","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"home","halt_if_type":"str","halt_if_compare":"is","entity_id":"person.carla","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":850,"y":440,"wires":[["2c3d398365cd483b"],[]]},{"id":"2c3d398365cd483b","type":"change","z":"4e6f57edbb2d3314","name":"Move car","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"message","pt":"msg","to":"Carla, go move your car now!","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1040,"y":440,"wires":[["3c1cab3d3f4be5ea"]]},{"id":"a9ed637a6f71bb73","type":"trigger","z":"4e6f57edbb2d3314","name":"trigger","op1":"1","op2":"","op1type":"str","op2type":"nul","duration":"13","extend":false,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":650,"y":460,"wires":[["aeb4d53210de9530"]]},{"id":"3c1cab3d3f4be5ea","type":"link out","z":"4e6f57edbb2d3314","name":"","links":["45904ca6429d867d"],"x":1205,"y":460,"wires":[]},{"id":"2f190c24210948af","type":"inject","z":"4e6f57edbb2d3314","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":530,"y":280,"wires":[["aeb4d53210de9530"]]},{"id":"aa1185695b51b293","type":"server-state-changed","z":"d5c4f13f05d3870d","name":"PHone notifications","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.phone_fold_3_last_notification","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"milliseconds","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":350,"y":560,"wires":[["0b41b7a38ef1c142","6bede5365874928f"]]},{"id":"6bede5365874928f","type":"debug","z":"d5c4f13f05d3870d","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":500,"y":460,"wires":[]},{"id":"327005af6b599f5d","type":"switch","z":"d5c4f13f05d3870d","name":"Message Regex  PEnding Task","property":"payload","propertyType":"msg","rules":[{"t":"regex","v":"(^Pending Task)","vt":"str","case":true},{"t":"cont","v":"pending task","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":770,"y":560,"wires":[["0e8b4919daa1bbdf"],[]]},{"id":"77458a7308b00d0a","type":"function","z":"d5c4f13f05d3870d","name":"","func":"var name = msg.data.new_state.attributes[\"android.title\"];\nvar task = msg.payload.split(\":\")\nvar newMsg = {\n \"payload\": {\n  \"task\": task[1]\n }\n};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1180,"y":180,"wires":[[]]},{"id":"0e8b4919daa1bbdf","type":"switch","z":"d5c4f13f05d3870d","name":"Who?","property":"data.new_state.attributes[\"android.title\"]","propertyType":"msg","rules":[{"t":"regex","v":"(Fay|Rossz|Compound)","vt":"str","case":true}],"checkall":"true","repair":false,"outputs":1,"x":1010,"y":560,"wires":[["7b70b8c07ca62418"]]},{"id":"0391a45725df8d78","type":"debug","z":"d5c4f13f05d3870d","name":"2","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1390,"y":340,"wires":[]},{"id":"7b70b8c07ca62418","type":"api-current-state","z":"d5c4f13f05d3870d","name":"NExt fay event date","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"calendar.faydates","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"faydates","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1190,"y":560,"wires":[["9f052aeee2f3e47c","0391a45725df8d78"]]},{"id":"a33617da8a2e3fa0","type":"inject","z":"d5c4f13f05d3870d","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":770,"y":340,"wires":[[]]},{"id":"9f052aeee2f3e47c","type":"function","z":"d5c4f13f05d3870d","name":"","func":"var name = msg.data.new_state.attributes[\"android.title\"];\nvar task = msg.payload.split(\":\");\nvar date = msg.faydates.attributes.start_time.split(\" \");\n\nif (task[1]){\nvar newMsg = {\n \"payload\": {\n  \"data\": {\n    \"start_date\": date[0],\n    \"end_date\": date[0],\n    \"summary\": task[1],\n    \"calendar_id\": \"4o2d6bnk3m9aruj7kr7ouv8gk0@group.calendar.google.com\"\n  },\n  \"date\": msg.faydates.attributes.start_time\n}\n};\n} else {\nvar newMsg = {\n \"payload\": {\n  \"data\": {\n    \"start_date\": date[0],\n    \"end_date\": date[0],\n    \"summary\": task[0],\n    \"calendar_id\": \"4o2d6bnk3m9aruj7kr7ouv8gk0@group.calendar.google.com\"\n  },\n  \"date\": msg.faydates.attributes.start_time\n}\n};\n}\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1420,"y":560,"wires":[["843a3731c2365883"]]},{"id":"843a3731c2365883","type":"api-call-service","z":"d5c4f13f05d3870d","name":"Add event to calendar","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"google","service":"add_event","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1920,"y":560,"wires":[[]]},{"id":"0b41b7a38ef1c142","type":"switch","z":"d5c4f13f05d3870d","name":"facebook?","property":"data.new_state.attributes.package","propertyType":"msg","rules":[{"t":"eq","v":"com.facebook.orca","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":550,"y":560,"wires":[["327005af6b599f5d"]]},{"id":"a1e6e29e73ba0104","type":"comment","z":"d5c4f13f05d3870d","name":"Receive all Phone Notifications","info":"","x":310,"y":620,"wires":[]},{"id":"80c6ee398f8b9be0","type":"comment","z":"d5c4f13f05d3870d","name":"Confirm it's facebook","info":"","x":550,"y":600,"wires":[]},{"id":"a315d7463f103794","type":"comment","z":"d5c4f13f05d3870d","name":"Look for \"Pending Task\"","info":"","x":760,"y":600,"wires":[]},{"id":"67143abe3825e177","type":"comment","z":"d5c4f13f05d3870d","name":"Confirm Fay","info":"","x":990,"y":600,"wires":[]},{"id":"6e53f375d85cd666","type":"comment","z":"d5c4f13f05d3870d","name":"Check next Calendar event with \"Fay\" in it","info":"","x":1180,"y":520,"wires":[]},{"id":"5ad1b6f4237f7d89","type":"comment","z":"d5c4f13f05d3870d","name":"JS Magic to set the new event as the same date as found event","info":"","x":1490,"y":600,"wires":[]},{"id":"747eca8083207079","type":"comment","z":"d5c4f13f05d3870d","name":"Call Event Creation service","info":"","x":1930,"y":620,"wires":[]},{"id":"0b18f13f7ae5169b","type":"function","z":"d5c4f13f05d3870d","name":"","func":"var name = msg.data.new_state.attributes[\"android.title\"];\nvar task = msg.payload.split(\":\");\nvar date = msg.faydates.attributes.start_time.split(\" \");\n\n\nvar newMsg = {\n \"payload\": {\n  \"data\": {\n    \"start_date\": date[0],\n    \"end_date\": date[0],\n    \"summary\": task[1],\n    \"calendar_id\": \"4o2d6bnk3m9aruj7kr7ouv8gk0@group.calendar.google.com\"\n  },\n  \"date\": msg.faydates.attributes.start_time\n}\n};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1420,"y":460,"wires":[[]]},{"id":"27fb1052fe084931","type":"server-state-changed","z":"413612f0b83809d5","name":"Blind Maxi Button","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.remote_bedroom_blind_button_action","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"(open|close)","halt_if_type":"re","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":360,"y":520,"wires":[["083ea745b5f2f42b"],[]]},{"id":"083ea745b5f2f42b","type":"switch","z":"413612f0b83809d5","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"open","vt":"str"},{"t":"eq","v":"close","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":530,"y":520,"wires":[["36c3fceaf8b13df6"],["b646dca266388ead"]]},{"id":"31b2c037b78943f5","type":"api-call-service","z":"413612f0b83809d5","name":"Light on","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.nate_ceiling_light"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1880,"y":540,"wires":[[]]},{"id":"b646dca266388ead","type":"api-call-service","z":"413612f0b83809d5","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.nate_ceiling_light"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":710,"y":580,"wires":[[]]},{"id":"96cea030c14ae2f0","type":"change","z":"413612f0b83809d5","name":"Single Press","rules":[{"t":"set","p":"pressamount","pt":"msg","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1570,"y":540,"wires":[["31b2c037b78943f5"]]},{"id":"1b5bb738df1d1589","type":"change","z":"413612f0b83809d5","name":"Double Press","rules":[{"t":"set","p":"pressamount","pt":"msg","to":"2","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1580,"y":580,"wires":[["dfead123301f980d"]]},{"id":"dd7bd4045004a719","type":"change","z":"413612f0b83809d5","name":"Triple Press","rules":[{"t":"set","p":"pressamount","pt":"msg","to":"3","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1570,"y":620,"wires":[["f067b203d51e46c1"]]},{"id":"333133b3585b5498","type":"change","z":"413612f0b83809d5","name":"Four Press","rules":[{"t":"set","p":"pressamount","pt":"msg","to":"4","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1570,"y":660,"wires":[["2a3381cd92718e98"]]},{"id":"7907b2479f1391e8","type":"switch","z":"413612f0b83809d5","name":"count presses","property":"count1","propertyType":"flow","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"num"},{"t":"eq","v":"3","vt":"num"},{"t":"eq","v":"4","vt":"num"},{"t":"eq","v":"5","vt":"num"}],"checkall":"true","repair":false,"outputs":5,"x":1360,"y":600,"wires":[["96cea030c14ae2f0"],["1b5bb738df1d1589"],["dd7bd4045004a719"],["333133b3585b5498"],["fd0fbacb9234e786"]],"info":"Just expand the flow.count to how ever many\npresses you want/need."},{"id":"fd0fbacb9234e786","type":"change","z":"413612f0b83809d5","name":"Five Press","rules":[{"t":"set","p":"pressamount","pt":"msg","to":"5","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1580,"y":700,"wires":[["c09657de422c82a2"]]},{"id":"5adfb4c543cbbc48","type":"trigger","z":"413612f0b83809d5","name":"","op1":"","op2":"0","op1type":"nul","op2type":"str","duration":"800","extend":true,"units":"ms","reset":"","bytopic":"all","outputs":1,"x":1030,"y":600,"wires":[["ca29ba931c0857ad","7907b2479f1391e8","d0ca715989cb5b08"]]},{"id":"c09657de422c82a2","type":"debug","z":"413612f0b83809d5","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"count","targetType":"msg","x":1810,"y":1020,"wires":[]},{"id":"ca29ba931c0857ad","type":"delay","z":"413612f0b83809d5","name":"Delay","pauseType":"delay","timeout":"1","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":1000,"y":560,"wires":[["237c0a4c2ab6c75b","a80cfe79fea0025b"]]},{"id":"d0ca715989cb5b08","type":"debug","z":"413612f0b83809d5","name":"TEst2","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1150,"y":440,"wires":[]},{"id":"237c0a4c2ab6c75b","type":"change","z":"413612f0b83809d5","name":"Reset","rules":[{"t":"set","p":"reset","pt":"msg","to":"foo","tot":"str"},{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1180,"y":560,"wires":[["052baa6b08fc2278","21bdfce12cd1b730"]]},{"id":"a80cfe79fea0025b","type":"debug","z":"413612f0b83809d5","name":"TEst3","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1310,"y":440,"wires":[]},{"id":"052baa6b08fc2278","type":"counter","z":"413612f0b83809d5","name":"","init":"0","step":"1","lower":"","upper":"","mode":"increment","outputs":"1","x":1180,"y":500,"wires":[["2743398e3ecb155e","d5636047752f7828"]]},{"id":"a5b3b83c56fca4f8","type":"debug","z":"413612f0b83809d5","name":"TEst1","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":370,"y":680,"wires":[]},{"id":"21bdfce12cd1b730","type":"debug","z":"413612f0b83809d5","name":"TEst5","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1330,"y":540,"wires":[]},{"id":"a1678303e9b0e63c","type":"inject","z":"413612f0b83809d5","name":"Reset","repeat":"","crontab":"","once":true,"onceDelay":"0.5","topic":"","payload":"","payloadType":"date","x":1000,"y":520,"wires":[["237c0a4c2ab6c75b"]]},{"id":"2743398e3ecb155e","type":"change","z":"413612f0b83809d5","name":"Flow set","rules":[{"t":"set","p":"count1","pt":"flow","to":"count","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1340,"y":500,"wires":[["1fd1ba8f638817ac"]]},{"id":"d5636047752f7828","type":"debug","z":"413612f0b83809d5","name":"TEst4","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1330,"y":380,"wires":[]},{"id":"1fd1ba8f638817ac","type":"debug","z":"413612f0b83809d5","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"count","targetType":"msg","x":1570,"y":500,"wires":[]},{"id":"36c3fceaf8b13df6","type":"trigger","z":"413612f0b83809d5","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"1","extend":true,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":790,"y":480,"wires":[["052baa6b08fc2278","5adfb4c543cbbc48"]]},{"id":"dfead123301f980d","type":"api-call-service","z":"413612f0b83809d5","name":"White Light on","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.nate_ceiling_light"],"data":"{\"color_name\": \"white\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1900,"y":580,"wires":[[]]},{"id":"f067b203d51e46c1","type":"api-call-service","z":"413612f0b83809d5","name":"White 100% Light on","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.nate_ceiling_light"],"data":"{\"color_name\": \"white\",\"brightness_pct\": \"100\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1920,"y":620,"wires":[[]]},{"id":"2a3381cd92718e98","type":"api-call-service","z":"413612f0b83809d5","name":"Purple 100% Light on","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.nate_ceiling_light"],"data":"{\"color_name\": \"purple\",\"brightness_pct\": \"100\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1920,"y":660,"wires":[[]]},{"id":"de054abd3224da13","type":"mqtt in","z":"92fbb69b279db47c","name":"","topic":"Fold3/button","qos":"0","datatype":"auto","broker":"21000c19b97da572","nl":false,"rap":false,"inputs":0,"x":210,"y":120,"wires":[["85bda2d25c408642"]]},{"id":"04e66a7068e405aa","type":"switch","z":"92fbb69b279db47c","name":"Actions","property":"action","propertyType":"msg","rules":[{"t":"cont","v":"DoublePress","vt":"str"}],"checkall":"false","repair":true,"outputs":1,"x":580,"y":100,"wires":[["0a82e93fc1b5e496"]]},{"id":"7ab585b589d753f5","type":"switch","z":"92fbb69b279db47c","name":"Location","property":"data.state","propertyType":"msg","rules":[{"t":"cont","v":"bedroom","vt":"str"},{"t":"cont","v":"not_home","vt":"str"},{"t":"cont","v":"hotbox","vt":"str"},{"t":"cont","v":"livingroom","vt":"str"},{"t":"cont","v":"kitchen","vt":"str"},{"t":"cont","v":"patio","vt":"str"}],"checkall":"false","repair":false,"outputs":6,"x":940,"y":120,"wires":[["5a6cf65d1bad6f89"],["5a6cf65d1bad6f89"],["89cabeb44a1d6181"],["6a4f41daef888087"],["068eaae5d885abf9"],["d50750044772edbb"]]},{"id":"85bda2d25c408642","type":"change","z":"92fbb69b279db47c","name":"Move Button","rules":[{"t":"move","p":"payload","pt":"msg","to":"action","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":390,"y":120,"wires":[["04e66a7068e405aa"]]},{"id":"0a82e93fc1b5e496","type":"api-current-state","z":"92fbb69b279db47c","name":"b7","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.b7bracelet1","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":750,"y":120,"wires":[["7ab585b589d753f5"]]},{"id":"5a6cf65d1bad6f89","type":"api-call-service","z":"92fbb69b279db47c","name":"BEdroom","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"toggle","areaId":[],"deviceId":[],"entityId":["light.bedroom_lights"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1100,"y":40,"wires":[[]]},{"id":"6a4f41daef888087","type":"api-call-service","z":"92fbb69b279db47c","name":"Chilling Room","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"toggle","areaId":[],"deviceId":[],"entityId":["light.group_livingroom_lights"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1120,"y":240,"wires":[[]]},{"id":"068eaae5d885abf9","type":"api-call-service","z":"92fbb69b279db47c","name":"Kitchen","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"toggle","areaId":[],"deviceId":[],"entityId":["light.group_kitchen_lights"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1100,"y":280,"wires":[[]]},{"id":"d50750044772edbb","type":"api-call-service","z":"92fbb69b279db47c","name":"Bathroom","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"switch","service":"toggle","areaId":[],"deviceId":[],"entityId":["switch.plug_patio_lights"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1100,"y":320,"wires":[[]]},{"id":"bc0ad0292e85a148","type":"inject","z":"92fbb69b279db47c","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"longpress","payloadType":"str","x":260,"y":60,"wires":[["85bda2d25c408642","04e66a7068e405aa","0a82e93fc1b5e496"]]},{"id":"89cabeb44a1d6181","type":"api-current-state","z":"92fbb69b279db47c","name":"Hotbox All","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.hotbox_all_motion","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":1080,"y":120,"wires":[["4a874a6e12e331cc"],["6da133116b35c4e8","4318d76af7512816","09e7dfcd65d271fd"]]},{"id":"6da133116b35c4e8","type":"api-current-state","z":"92fbb69b279db47c","name":"Hotbox down","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"re","halt_if_compare":"is","entity_id":"binary_sensor.motion_hotbox_down","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":1250,"y":160,"wires":[["4a802614a6391028"],[]]},{"id":"4318d76af7512816","type":"api-current-state","z":"92fbb69b279db47c","name":"Hotbox top","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"re","halt_if_compare":"is","entity_id":"binary_sensor.motion_hotbox_top","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":1250,"y":200,"wires":[["2e6dfa6503f2e06c"],[]]},{"id":"09e7dfcd65d271fd","type":"api-current-state","z":"92fbb69b279db47c","name":"Hotbox All","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.hotbox_all_motion_off","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":1240,"y":120,"wires":[["4a874a6e12e331cc"],[]]},{"id":"4a874a6e12e331cc","type":"api-call-service","z":"92fbb69b279db47c","name":"Hotbox","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"toggle","areaId":[],"deviceId":[],"entityId":["light.hotbox_lights"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1380,"y":120,"wires":[[]]},{"id":"4a802614a6391028","type":"api-call-service","z":"92fbb69b279db47c","name":"Hotbox","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"toggle","areaId":[],"deviceId":[],"entityId":["light.hotbox_bottom"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1400,"y":160,"wires":[[]]},{"id":"2e6dfa6503f2e06c","type":"api-call-service","z":"92fbb69b279db47c","name":"Hotbox","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"toggle","areaId":[],"deviceId":[],"entityId":["light.hotbox_top"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1400,"y":200,"wires":[[]]},{"id":"38d05af222c8c2ef","type":"server-state-changed","z":"92fbb69b279db47c","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.phone_galaxy_fold_4_phone_state","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"ringing","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":370,"y":560,"wires":[["cf2bbfabad520e42"],[]]},{"id":"bb4c9008f4dc6e1c","type":"switch","z":"92fbb69b279db47c","name":"Location","property":"data.state","propertyType":"msg","rules":[{"t":"cont","v":"bedroom","vt":"str"},{"t":"cont","v":"not_home","vt":"str"},{"t":"cont","v":"closet","vt":"str"},{"t":"cont","v":"livingroom","vt":"str"},{"t":"cont","v":"hotbox","vt":"str"},{"t":"cont","v":"kitchen","vt":"str"},{"t":"cont","v":"bathroom","vt":"str"}],"checkall":"false","repair":false,"outputs":7,"x":780,"y":560,"wires":[["b75c436b78a2db6c","e260196e89907e86"],["b75c436b78a2db6c"],["b75c436b78a2db6c","e260196e89907e86"],["e260196e89907e86"],["bdedb20f9338ddcd","432527c002c9480b"],["bdedb20f9338ddcd","432527c002c9480b"],["e260196e89907e86","daac69a5cf6ec582"]]},{"id":"cf2bbfabad520e42","type":"api-current-state","z":"92fbb69b279db47c","name":"Fitbit","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.b7bracelet1","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":650,"y":560,"wires":[["bb4c9008f4dc6e1c"]]},{"id":"f2327bfce2374697","type":"api-call-service","z":"92fbb69b279db47c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"tts","service":"google_translate_say","areaId":[],"deviceId":[],"entityId":["media_player.group_maxi_speakers"],"data":"{\"message\":\"Incoming Call\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1280,"y":420,"wires":[["d1f215e6492373b7"]]},{"id":"888831edad836804","type":"api-call-service","z":"92fbb69b279db47c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"tts","service":"google_translate_say","areaId":[],"deviceId":[],"entityId":["media_player.group_living_room_speakers"],"data":"{\"message\":\"Incoming Call\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1280,"y":480,"wires":[["9d68aadc72027592"]]},{"id":"7faf764f0f3bde7f","type":"api-call-service","z":"92fbb69b279db47c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"tts","service":"google_translate_say","areaId":[],"deviceId":[],"entityId":["media_player.group_hotbox_speakers"],"data":"{\"message\":\"Incoming Call\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1280,"y":540,"wires":[["f87dd9f0c8a97fc9"]]},{"id":"38f7d5fcaeeafa85","type":"api-call-service","z":"92fbb69b279db47c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"tts","service":"google_translate_say","areaId":[],"deviceId":[],"entityId":["media_player.kitchen_speaker"],"data":"{\"message\":\"Incoming Call\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1280,"y":600,"wires":[["ed7c5a901ae4ebbb"]]},{"id":"22ab49ec71e4c781","type":"api-call-service","z":"92fbb69b279db47c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"tts","service":"google_translate_say","areaId":[],"deviceId":[],"entityId":["media_player.bathroom_speaker"],"data":"{\"message\":\"Incoming Call\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1280,"y":660,"wires":[["bd649c731c23b1eb"]]},{"id":"54914da3755c5524","type":"server-state-changed","z":"92fbb69b279db47c","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.phone_galaxy_fold_4_next_alarm","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"unavailable","halt_if_type":"str","halt_if_compare":"is_not","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":270,"y":1000,"wires":[["4a0b3dd16a5f9ac7"],["4a0b3dd16a5f9ac7"]]},{"id":"01f27e5035d61902","type":"switch","z":"92fbb69b279db47c","name":"Location","property":"data.state","propertyType":"msg","rules":[{"t":"cont","v":"bedroom","vt":"str"},{"t":"cont","v":"not_home","vt":"str"},{"t":"cont","v":"thierry","vt":"str"},{"t":"cont","v":"livingroom","vt":"str"},{"t":"cont","v":"hotbox","vt":"str"},{"t":"cont","v":"kitchen","vt":"str"},{"t":"cont","v":"bathroom","vt":"str"}],"checkall":"false","repair":false,"outputs":7,"x":1420,"y":1020,"wires":[["1bbb83b698e89ae8"],["1bbb83b698e89ae8"],["1bbb83b698e89ae8","8e9436ef85d3d8c0"],["8e9436ef85d3d8c0"],["b12da63a0f6d4c57"],["b12da63a0f6d4c57"],["8e9436ef85d3d8c0"]]},{"id":"9af52ba62ada6458","type":"api-current-state","z":"92fbb69b279db47c","name":"Fitbit","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.b7bracelet1","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":1270,"y":1020,"wires":[["01f27e5035d61902"]]},{"id":"1bbb83b698e89ae8","type":"api-call-service","z":"92fbb69b279db47c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"play_media","areaId":[],"deviceId":[],"entityId":["media_player.maxi_speakers"],"data":"{\"media_content_id\":\"http://192.168.0.15:8123/local/alarm.mp3\",\"media_content_type\":\"music\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1810,"y":980,"wires":[["70fae68314442d16"]]},{"id":"6bfaee461d1994a3","type":"debug","z":"92fbb69b279db47c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1070,"y":860,"wires":[]},{"id":"ae4b67ebf2fa51c7","type":"debug","z":"92fbb69b279db47c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"data.new_state.attributes[\"Local Time\"]","targetType":"msg","x":1210,"y":920,"wires":[]},{"id":"342249283ab956e6","type":"function","z":"92fbb69b279db47c","name":"some js","func":"var alarm = msg.data.new_state.attributes[\"Time in Milliseconds\"];\nvar date = new Date();\nvar now = date.getTime();\n\nif (( alarm - now ) >= 86000000 && ( alarm - now ) <= 86500000 ) {\n    var newMsg = {\n \"payload\": \"1\"\n};\n} else {\n        var newMsg = {\n \"payload\": \"0\"\n};\n}\n\n\nreturn newMsg;","outputs":1,"noerr":0,"x":740,"y":1000,"wires":[["6bfaee461d1994a3","e00d1a2353f5556e","2432af96eeb3ce9b"]]},{"id":"4a0b3dd16a5f9ac7","type":"trigger","z":"92fbb69b279db47c","name":"","op1":"","op2":"0","op1type":"pay","op2type":"str","duration":"-1","extend":false,"units":"min","reset":"unavailable","bytopic":"all","outputs":1,"x":550,"y":1000,"wires":[["342249283ab956e6","6bfaee461d1994a3"]]},{"id":"e00d1a2353f5556e","type":"trigger","z":"92fbb69b279db47c","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"10","extend":false,"units":"min","reset":"0","bytopic":"all","outputs":1,"x":1070,"y":1000,"wires":[["9af52ba62ada6458"]]},{"id":"94b193dfe105934b","type":"inject","z":"92fbb69b279db47c","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1320,"y":860,"wires":[["1bbb83b698e89ae8"]]},{"id":"8e9436ef85d3d8c0","type":"api-call-service","z":"92fbb69b279db47c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"play_media","areaId":[],"deviceId":[],"entityId":["media_player.living_room_speakers"],"data":"{\"media_content_id\":\"http://192.168.0.15:8123/local/alarm.mp3\",\"media_content_type\":\"music\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1810,"y":1020,"wires":[["944f964f1d4fddf0"]]},{"id":"b12da63a0f6d4c57","type":"api-call-service","z":"92fbb69b279db47c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"play_media","areaId":[],"deviceId":[],"entityId":["media_player.hotbox_speakers"],"data":"{\"media_content_id\":\"http://192.168.0.15:8123/local/alarm.mp3\",\"media_content_type\":\"music\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1810,"y":1060,"wires":[["b7a71a1d664c4240"]]},{"id":"70fae68314442d16","type":"api-call-service","z":"92fbb69b279db47c","name":"Bathroom Speaker","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_set","areaId":[],"deviceId":[],"entityId":["media_player.maxi_speakers"],"data":"{\"volume_level\": \"0.1\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2070,"y":980,"wires":[[]]},{"id":"944f964f1d4fddf0","type":"api-call-service","z":"92fbb69b279db47c","name":"Bathroom Speaker","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_set","areaId":[],"deviceId":[],"entityId":["media_player.living_room_speakers"],"data":"{\"volume_level\": \"1\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2070,"y":1020,"wires":[[]]},{"id":"b7a71a1d664c4240","type":"api-call-service","z":"92fbb69b279db47c","name":"Bathroom Speaker","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_set","areaId":[],"deviceId":[],"entityId":["media_player.hotbox_speakers"],"data":"{\"volume_level\": \"1\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2070,"y":1060,"wires":[[]]},{"id":"2432af96eeb3ce9b","type":"switch","z":"92fbb69b279db47c","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":750,"y":1060,"wires":[["29a5760aa8a6b01c"]]},{"id":"29a5760aa8a6b01c","type":"change","z":"92fbb69b279db47c","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"unavailable","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":540,"y":1060,"wires":[["4a0b3dd16a5f9ac7"]]},{"id":"5a34c77fcf3df424","type":"mqtt in","z":"92fbb69b279db47c","name":"","topic":"home/home_presence/Bedroom","qos":"2","datatype":"auto","broker":"21000c19b97da572","inputs":0,"x":260,"y":1160,"wires":[["cd539b0f83841d8a"]]},{"id":"74ac149bf11a4e70","type":"debug","z":"92fbb69b279db47c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":640,"y":1160,"wires":[]},{"id":"cd539b0f83841d8a","type":"switch","z":"92fbb69b279db47c","name":"","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"http://maxi.tap","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":500,"y":1180,"wires":[["74ac149bf11a4e70"]]},{"id":"a54b585074b02185","type":"mqtt in","z":"92fbb69b279db47c","name":"","topic":"espresense/rooms/#","qos":"2","datatype":"auto","broker":"21000c19b97da572","nl":false,"rap":false,"inputs":0,"x":130,"y":200,"wires":[["b9dea4052c6587cf","cfbf83a619751b0b"]]},{"id":"b9dea4052c6587cf","type":"switch","z":"92fbb69b279db47c","name":"","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"202017e2-46f5-11ec-81d3-0242ac130003-11-34","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":370,"y":200,"wires":[["aaf19056c03fd980","081d032a72f6c2d6"]]},{"id":"aaf19056c03fd980","type":"trigger","z":"92fbb69b279db47c","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"15","extend":false,"overrideDelay":false,"units":"s","reset":"0","bytopic":"all","topic":"topic","outputs":1,"x":530,"y":180,"wires":[["0a82e93fc1b5e496"]]},{"id":"b75c436b78a2db6c","type":"api-call-service","z":"92fbb69b279db47c","name":"Set Volume","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_set","areaId":[],"deviceId":[],"entityId":["media_player.maxi_speakers"],"data":"{\"volume_level\": \"1\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1070,"y":420,"wires":[["f2327bfce2374697"]]},{"id":"e260196e89907e86","type":"api-call-service","z":"92fbb69b279db47c","name":"Set Volume","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_set","areaId":[],"deviceId":[],"entityId":["media_player.living_room_speakers"],"data":"{\"volume_level\": \"1\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1070,"y":480,"wires":[["888831edad836804"]]},{"id":"bdedb20f9338ddcd","type":"api-call-service","z":"92fbb69b279db47c","name":"Set Volume","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_set","areaId":[],"deviceId":[],"entityId":["media_player.hotbox_speakers"],"data":"{\"volume_level\": \"1\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1070,"y":540,"wires":[["7faf764f0f3bde7f"]]},{"id":"432527c002c9480b","type":"api-call-service","z":"92fbb69b279db47c","name":"Set Volume","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_set","areaId":[],"deviceId":[],"entityId":["media_player.kitchen_speaker"],"data":"{\"volume_level\": \"1\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1070,"y":600,"wires":[["38f7d5fcaeeafa85"]]},{"id":"daac69a5cf6ec582","type":"api-call-service","z":"92fbb69b279db47c","name":"Set Volume","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_set","areaId":[],"deviceId":[],"entityId":["media_player.bathroom_speaker"],"data":"{\"volume_level\": \"1\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1070,"y":660,"wires":[["22ab49ec71e4c781"]]},{"id":"860c2799efed907f","type":"inject","z":"92fbb69b279db47c","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":500,"y":360,"wires":[["cf2bbfabad520e42"]]},{"id":"4631362288c522a6","type":"api-call-service","z":"92fbb69b279db47c","name":"stop speaker","server":"7ab5c227.a3ce8c","version":5,"debugenabled":true,"domain":"media_player","service":"turn_off","areaId":[],"deviceId":[],"entityId":["media_player.group_maxi_speakers"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1670,"y":420,"wires":[[]]},{"id":"23ee45554cf02635","type":"api-call-service","z":"92fbb69b279db47c","name":"stop speaker","server":"7ab5c227.a3ce8c","version":5,"debugenabled":true,"domain":"media_player","service":"turn_off","areaId":[],"deviceId":[],"entityId":["media_player.group_living_room_speakers"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1670,"y":480,"wires":[[]]},{"id":"d96e85146f80b7f8","type":"api-call-service","z":"92fbb69b279db47c","name":"stop speaker","server":"7ab5c227.a3ce8c","version":5,"debugenabled":true,"domain":"media_player","service":"turn_off","areaId":[],"deviceId":[],"entityId":["media_player.group_hotbox_speakers"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1670,"y":540,"wires":[[]]},{"id":"50f2b0a2cd270989","type":"api-call-service","z":"92fbb69b279db47c","name":"stop speaker","server":"7ab5c227.a3ce8c","version":5,"debugenabled":true,"domain":"media_player","service":"turn_off","areaId":[],"deviceId":[],"entityId":["media_player.kitchen_speaker"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1670,"y":600,"wires":[[]]},{"id":"bd7ef0aedbc2a16e","type":"api-call-service","z":"92fbb69b279db47c","name":"stop speaker","server":"7ab5c227.a3ce8c","version":5,"debugenabled":true,"domain":"media_player","service":"turn_off","areaId":[],"deviceId":[],"entityId":[],"data":"media_player.bathroom_speaker","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1670,"y":660,"wires":[[]]},{"id":"d1f215e6492373b7","type":"trigger","z":"92fbb69b279db47c","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"4","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1500,"y":420,"wires":[["4631362288c522a6"]]},{"id":"9d68aadc72027592","type":"trigger","z":"92fbb69b279db47c","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"4","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1500,"y":480,"wires":[["23ee45554cf02635"]]},{"id":"f87dd9f0c8a97fc9","type":"trigger","z":"92fbb69b279db47c","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"4","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1480,"y":540,"wires":[["d96e85146f80b7f8"]]},{"id":"ed7c5a901ae4ebbb","type":"trigger","z":"92fbb69b279db47c","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"4","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1480,"y":600,"wires":[["50f2b0a2cd270989"]]},{"id":"bd649c731c23b1eb","type":"trigger","z":"92fbb69b279db47c","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"4","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1500,"y":660,"wires":[["bd7ef0aedbc2a16e"]]},{"id":"93d445a7941e83db","type":"debug","z":"92fbb69b279db47c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":290,"y":820,"wires":[]},{"id":"081d032a72f6c2d6","type":"debug","z":"92fbb69b279db47c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":630,"y":255.5555419921875,"wires":[]},{"id":"cfbf83a619751b0b","type":"switch","z":"92fbb69b279db47c","name":"","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"iBeacon","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":371.111083984375,"y":246.66665649414062,"wires":[[]]},{"id":"1d66fc88acff4954","type":"debug","z":"92fbb69b279db47c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":300,"y":760,"wires":[]},{"id":"c7f7517f9e72779c","type":"server-state-changed","z":"92fbb69b279db47c","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.watch_toggle_lights","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":290,"y":20,"wires":[["0a82e93fc1b5e496","a02bc169001609fd"],[]]},{"id":"a02bc169001609fd","type":"api-call-service","z":"92fbb69b279db47c","name":"bvoolean off","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.watch_toggle_lights"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":670,"y":20,"wires":[[]]},{"id":"e4369c6ae5641ed1","type":"comment","z":"92fbb69b279db47c","name":"","info":"","x":180,"y":180,"wires":[]},{"id":"3405656052c010b5","type":"comment","z":"92fbb69b279db47c","name":"","info":"","x":160,"y":100,"wires":[]},{"id":"d8ef547c719fbe68","type":"comment","z":"92fbb69b279db47c","name":"","info":"","x":160,"y":560,"wires":[]},{"id":"670a66a10b16f8ad","type":"comment","z":"92fbb69b279db47c","name":"","info":"","x":100,"y":1000,"wires":[]},{"id":"67a7d5ef164aefcc","type":"api-call-service","z":"b961c3ee719fff16","name":"Kitchen Light on","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.group_kitchen_lights"],"data":"{\"color_name\":\"white\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1300,"y":980,"wires":[[]]},{"id":"d1ad9cad1c5d34b0","type":"trigger","z":"b961c3ee719fff16","name":"","op1":"1","op2":"1","op1type":"num","op2type":"str","duration":"-2","extend":false,"units":"min","reset":"off","bytopic":"all","outputs":1,"x":670,"y":980,"wires":[["67a7d5ef164aefcc","d5d6a3ba6d2e34fb","182d7747858ee8e5"]]},{"id":"d5d6a3ba6d2e34fb","type":"api-call-service","z":"b961c3ee719fff16","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"notify","areaId":[],"deviceId":[],"entityId":[],"data":"{ \"message\": \"WATER DETECTED\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1280,"y":940,"wires":[[]]},{"id":"182d7747858ee8e5","type":"change","z":"b961c3ee719fff16","name":"Set Message and color","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"message","pt":"msg","to":"Water Damage Detected In The Kitchen","tot":"str"},{"t":"set","p":"color_value","pt":"msg","to":"[0,255,255]","tot":"json"},{"t":"set","p":"dbrightness","pt":"msg","to":"100","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1020,"y":1020,"wires":[["ccff20a89b18f4b3"]]},{"id":"5913531090bc5482","type":"server-state-changed","z":"b961c3ee719fff16","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.sensor_kitchen_water_detector_water_leak","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"(on|off)","halt_if_type":"re","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":280,"y":980,"wires":[["d1ad9cad1c5d34b0"],[]]},{"id":"74e1ef88a108cf5e","type":"debug","z":"b961c3ee719fff16","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":660,"y":920,"wires":[]},{"id":"36e266a6b3422826","type":"inject","z":"b961c3ee719fff16","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":940,"y":920,"wires":[["182d7747858ee8e5"]]},{"id":"9224c22482fc04dd","type":"trigger","z":"b961c3ee719fff16","name":"","op1":"1","op2":"1","op1type":"num","op2type":"str","duration":"-2","extend":false,"overrideDelay":false,"units":"min","reset":"off","bytopic":"all","topic":"topic","outputs":1,"x":930,"y":620,"wires":[["ad79cdb9bf9be2cd","c79c57e61030ccea","1fceb4766073d1f7","49f5eee28842991a","957bcc19fa2a15fa"]]},{"id":"ad79cdb9bf9be2cd","type":"api-call-service","z":"b961c3ee719fff16","name":"Kitchen Light on","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.group_kitchen_lights"],"data":"{\"color_name\":\"white\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1520,"y":640,"wires":[[]]},{"id":"c79c57e61030ccea","type":"api-call-service","z":"b961c3ee719fff16","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"notify","areaId":[],"deviceId":[],"entityId":[],"data":"{\"message\":\"SMOKE DETECTED\",\"title\":\"Security\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1500,"y":560,"wires":[[]]},{"id":"1fceb4766073d1f7","type":"change","z":"b961c3ee719fff16","name":"Set Message and color","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"message","pt":"msg","to":"Smoke detected in the kitchen","tot":"str"},{"t":"set","p":"color_value","pt":"msg","to":"[255,255,255]","tot":"str"},{"t":"set","p":"dbrightness","pt":"msg","to":"100","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1260,"y":740,"wires":[["e1bfdb2a72ecf64e"]]},{"id":"d6434edbc1e40e48","type":"server-state-changed","z":"b961c3ee719fff16","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.sensor_kitchen_smoke_detector_smoke","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"(on|off)","halt_if_type":"re","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":510,"y":620,"wires":[["9224c22482fc04dd"],[]]},{"id":"9295b441d2988881","type":"inject","z":"b961c3ee719fff16","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1200,"y":560,"wires":[["1fceb4766073d1f7"]]},{"id":"957bcc19fa2a15fa","type":"ha-wait-until","z":"b961c3ee719fff16","name":"","server":"7ab5c227.a3ce8c","version":2,"outputs":1,"entityId":"binary_sensor.sensor_kitchen_smoke_detector_smoke","entityIdFilterType":"exact","property":"state","comparator":"is","value":"off","valueType":"str","timeout":0,"timeoutType":"num","timeoutUnits":"milliseconds","checkCurrentState":true,"blockInputOverrides":true,"outputProperties":[],"x":1500,"y":600,"wires":[["efff1d5e97dcb783"]]},{"id":"efff1d5e97dcb783","type":"api-call-service","z":"b961c3ee719fff16","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"mobile_app_phone_galaxy_fold_4","areaId":[],"deviceId":[],"entityId":[],"data":"{\"message\":\"Fire Alarm Stopped\",\"title\":\"Security\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1950,"y":600,"wires":[[]]},{"id":"1dea2e5ea0559762","type":"inject","z":"b961c3ee719fff16","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1740,"y":500,"wires":[["efff1d5e97dcb783"]]},{"id":"1101083478bf6895","type":"link out","z":"b961c3ee719fff16","name":"Light and Speakers","links":["45904ca6429d867d","ad88dbd2.4726b8","3405e943.fd3ee6","9cf42cf7ef60f645"],"x":1555,"y":880,"wires":[]},{"id":"07013d535d8ccc49","type":"link out","z":"b961c3ee719fff16","name":"Light and Speakers","links":["45904ca6429d867d","ad88dbd2.4726b8","3405e943.fd3ee6","9cf42cf7ef60f645"],"x":1495,"y":1320,"wires":[]},{"id":"16eb9b57ee4552c0","type":"link out","z":"b961c3ee719fff16","name":"Light and Speakers","links":["45904ca6429d867d","ad88dbd2.4726b8","3405e943.fd3ee6","9cf42cf7ef60f645"],"x":1475,"y":1080,"wires":[]},{"id":"917e13c9a14ee4b7","type":"link out","z":"b961c3ee719fff16","name":"Light and Speakers","links":["45904ca6429d867d","ad88dbd2.4726b8","3405e943.fd3ee6","9cf42cf7ef60f645"],"x":2375,"y":1460,"wires":[]},{"id":"b3afea2f1bbb33b7","type":"server-events","z":"b961c3ee719fff16","name":"","server":"7ab5c227.a3ce8c","version":2,"eventType":"timer.finished","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"waitForRunning":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"},{"property":"event_type","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"}],"x":360,"y":2260,"wires":[["6f68f04da1959ea6"]]},{"id":"a9e920997d5026de","type":"debug","z":"b961c3ee719fff16","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1470,"y":2640,"wires":[]},{"id":"6f68f04da1959ea6","type":"switch","z":"b961c3ee719fff16","name":"","property":"payload.entity_id","propertyType":"msg","rules":[{"t":"eq","v":"timer.cooking","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":550,"y":2260,"wires":[["807d111cc9c63b87"]]},{"id":"cd64541cf8e45c2f","type":"change","z":"b961c3ee719fff16","name":"Set Message and color","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"message","pt":"msg","to":"Kitchen Timer Finished","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1200,"y":2260,"wires":[["e986c68d5d9025dd"]]},{"id":"15dc0632de284620","type":"trigger","z":"b961c3ee719fff16","name":"","op1":"","op2":"1","op1type":"num","op2type":"str","duration":"-5","extend":false,"overrideDelay":false,"units":"min","reset":"on","bytopic":"all","topic":"topic","outputs":1,"x":970,"y":2220,"wires":[["cd64541cf8e45c2f"]]},{"id":"ff853761685c9da6","type":"link out","z":"b961c3ee719fff16","name":"Light and Speakers","links":["45904ca6429d867d","ad88dbd2.4726b8","3405e943.fd3ee6","9cf42cf7ef60f645"],"x":2035,"y":2220,"wires":[]},{"id":"15b4691123c72d49","type":"change","z":"b961c3ee719fff16","name":"Set Message and color","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"message","pt":"msg","to":"Kitchen Timer Finished","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":910,"y":2160,"wires":[["e5e32b2a64fc9eb4"]]},{"id":"e5e32b2a64fc9eb4","type":"link out","z":"b961c3ee719fff16","name":"Light and Speakers","links":["45904ca6429d867d","ad88dbd2.4726b8","3405e943.fd3ee6","9cf42cf7ef60f645"],"x":1075,"y":2160,"wires":[]},{"id":"b6f421d2c1ea2705","type":"inject","z":"b961c3ee719fff16","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"on","payload":"on","payloadType":"str","x":490,"y":2380,"wires":[[]]},{"id":"a4a614d005d0a999","type":"switch","z":"b961c3ee719fff16","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"00:00","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":650,"y":2980,"wires":[["184b0417f086b75e"]]},{"id":"e745fc90820a1b3b","type":"change","z":"b961c3ee719fff16","name":"Set Message and color","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"message","pt":"msg","to":"Dryer Finished","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1750,"y":2940,"wires":[["63e9f2977e9e3d61"]]},{"id":"63e9f2977e9e3d61","type":"link out","z":"b961c3ee719fff16","name":"Light and Speakers","links":["45904ca6429d867d","ad88dbd2.4726b8","3405e943.fd3ee6","9cf42cf7ef60f645"],"x":1925,"y":2940,"wires":[]},{"id":"184b0417f086b75e","type":"api-current-state","z":"b961c3ee719fff16","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.sensor_kitchen_motion_occupancy","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":950,"y":2940,"wires":[["d40afaded61a7270"],[]]},{"id":"d40afaded61a7270","type":"trigger","z":"b961c3ee719fff16","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"1","extend":false,"units":"ms","reset":"on","bytopic":"all","outputs":1,"x":1330,"y":2940,"wires":[["a724715ffb7b424b"]]},{"id":"a724715ffb7b424b","type":"trigger","z":"b961c3ee719fff16","name":"","op1":"","op2":"1","op1type":"num","op2type":"str","duration":"-30","extend":false,"overrideDelay":false,"units":"min","reset":"on","bytopic":"all","topic":"topic","outputs":1,"x":1510,"y":2940,"wires":[["e745fc90820a1b3b"]]},{"id":"3ad9b2d177065644","type":"server-state-changed","z":"b961c3ee719fff16","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.sensor_kitchen_motion_occupancy","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":950,"y":2980,"wires":[["d40afaded61a7270","a724715ffb7b424b"],[]]},{"id":"db3c1e763cea52af","type":"server-state-changed","z":"b961c3ee719fff16","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.dryer_dry_completed","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":290,"y":2940,"wires":[["184b0417f086b75e"],[]]},{"id":"49f5eee28842991a","type":"api-call-service","z":"b961c3ee719fff16","name":"BAthroom Fan on","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.bathroom_fan"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1170,"y":500,"wires":[[]]},{"id":"7482b12248222624","type":"inject","z":"b961c3ee719fff16","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"off","payloadType":"str","x":590,"y":480,"wires":[["9224c22482fc04dd"]]},{"id":"ccff20a89b18f4b3","type":"subflow:233ac7dcd801a802","z":"b961c3ee719fff16","name":"","x":1290,"y":1040,"wires":[]},{"id":"e986c68d5d9025dd","type":"subflow:233ac7dcd801a802","z":"b961c3ee719fff16","name":"","x":1430,"y":2260,"wires":[]},{"id":"e1bfdb2a72ecf64e","type":"subflow:233ac7dcd801a802","z":"b961c3ee719fff16","name":"","x":1490,"y":740,"wires":[]},{"id":"654f47404d031f2b","type":"server-state-changed","z":"b961c3ee719fff16","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.kitchen_speaker_alarms","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":320,"y":2640,"wires":[["6cc208d45356089e"]]},{"id":"6cc208d45356089e","type":"function","z":"b961c3ee719fff16","name":"Convert mini alarm to time delta","func":"var time = msg.payload;  // extract time\n\nvar timestamp = Date.parse(time); // set time string to timestamp\nvar now = Date.now(); // get now timestamp\n\nvar finaltemp =  (timestamp - now) / 1000 ;  // get float timestamp\nvar final = Math.round(finaltemp); // remove decimal \n\nconst result = new Date(final * 1000).toISOString().slice(11, 19);\n// ^ convert timestmap to H:M:S: format\n\n\n\nvar newMsg = {\n    \"payload\":{\n        \"data\": {\n        \"time\": result\n    }\n    \n    }\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":690,"y":2580,"wires":[["83b7556609a93e60","f69aa4d7fc0322df"]]},{"id":"83b7556609a93e60","type":"api-call-service","z":"b961c3ee719fff16","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"input_datetime","service":"set_datetime","areaId":[],"deviceId":[],"entityId":["input_datetime.kitchen_timer"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"1","valueType":"str"}],"queue":"none","x":1000,"y":2580,"wires":[["8cf1e6c4f46eba0e"]]},{"id":"8cf1e6c4f46eba0e","type":"api-call-service","z":"b961c3ee719fff16","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"automation","service":"trigger","areaId":[],"deviceId":[],"entityId":["automation.timer_setting"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1320,"y":2580,"wires":[["a9e920997d5026de"]]},{"id":"070b15dd78c3d3a8","type":"inject","z":"b961c3ee719fff16","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"2022-05-02T14:57:30-04:00","payloadType":"str","x":230,"y":2500,"wires":[["6cc208d45356089e"]]},{"id":"f69aa4d7fc0322df","type":"debug","z":"b961c3ee719fff16","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":781.9683837890625,"y":2442.865234375,"wires":[]},{"id":"889ceb4fcc700486","type":"server-state-changed","z":"b961c3ee719fff16","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.sensor_kitchen_motion_occupancy","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":570,"y":2200,"wires":[["15dc0632de284620"],[]]},{"id":"807d111cc9c63b87","type":"api-current-state","z":"b961c3ee719fff16","name":"kitchen PIR off?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.sensor_kitchen_motion_occupancy","state_type":"str","blockInputOverrides":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":700,"y":2260,"wires":[["15dc0632de284620"],["cd64541cf8e45c2f"]]},{"id":"249b063d4cc9dfd1","type":"server-state-changed","z":"b961c3ee719fff16","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.kitchen_speaker_timers","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":320,"y":2580,"wires":[["6cc208d45356089e"]]},{"id":"a47e45f61db4f0ae","type":"inject","z":"b961c3ee719fff16","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":710,"y":2140,"wires":[["15dc0632de284620"]]},{"id":"8784ddb755b48501","type":"comment","z":"b961c3ee719fff16","name":"","info":"","x":220,"y":700,"wires":[]},{"id":"112fe2d84a365034","type":"comment","z":"b961c3ee719fff16","name":"","info":"","x":360,"y":720,"wires":[]},{"id":"1268074429e39d51","type":"comment","z":"b961c3ee719fff16","name":"","info":"","x":100,"y":940,"wires":[]},{"id":"59f451a05f906535","type":"comment","z":"b961c3ee719fff16","name":"","info":"","x":360,"y":2200,"wires":[]},{"id":"2aea59a5d6746ebd","type":"comment","z":"b961c3ee719fff16","name":"","info":"","x":300,"y":2260,"wires":[]},{"id":"0b19f37a1194c634","type":"comment","z":"b961c3ee719fff16","name":"","info":"","x":160,"y":2580,"wires":[]},{"id":"fd82dd36587fecde","type":"comment","z":"b961c3ee719fff16","name":"","info":"","x":140,"y":2640,"wires":[]},{"id":"585c668b4954d6c4","type":"comment","z":"b961c3ee719fff16","name":"","info":"","x":100,"y":2940,"wires":[]},{"id":"84206afeef95c58e","type":"api-current-state","z":"f34519812e7522cf","name":"light.bedroom_lights","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.bedroom_lights","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"status","propertyType":"msg","value":"","valueType":"entityState"},{"property":"entity_old","propertyType":"msg","value":"","valueType":"entity"},{"property":"entity_id","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":920,"y":240,"wires":[["6a24f25866833dac"]],"outputLabels":["data.attributes"]},{"id":"7a4888271498757c","type":"api-call-service","z":"f34519812e7522cf","name":"Change Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2020,"y":240,"wires":[["2664a360b33cbe83"]]},{"id":"c05947f0c2a5e334","type":"change","z":"f34519812e7522cf","name":"","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.data.rgb_color","pt":"msg","to":"entity_old.attributes.rgb_color","tot":"msg"},{"t":"set","p":"payload.data.brightness","pt":"msg","to":"entity_old.attributes.brightness","tot":"msg"},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1620,"y":240,"wires":[["0fcca2f73cc8dc68"]]},{"id":"0fcca2f73cc8dc68","type":"template","z":"f34519812e7522cf","name":"Extract status","field":"payload.service","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"\"turn_{{status}}\"","output":"json","x":1820,"y":240,"wires":[["7a4888271498757c"]]},{"id":"3cc1279d7d4190e8","type":"delay","z":"f34519812e7522cf","name":"","pauseType":"random","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"2","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1460,"y":240,"wires":[["c05947f0c2a5e334"]]},{"id":"6a24f25866833dac","type":"change","z":"f34519812e7522cf","name":"rules","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.data.rgb_color","pt":"msg","to":"color_value","tot":"msg"},{"t":"set","p":"payload.data.brightness_pct","pt":"msg","to":"dbrigthness","tot":"msg"},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1090,"y":240,"wires":[["2a9be14b8d78b8bc"]]},{"id":"2a9be14b8d78b8bc","type":"api-call-service","z":"f34519812e7522cf","name":"Change Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1300,"y":240,"wires":[["3cc1279d7d4190e8"]]},{"id":"6b7d8f02abb2fbce","type":"inject","z":"f34519812e7522cf","name":"","props":[{"p":"payload1","v":"","vt":"date"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":510,"y":240,"wires":[["4de509c258fd2282"]]},{"id":"4de509c258fd2282","type":"change","z":"f34519812e7522cf","name":"Set Data for mass alert","rules":[{"t":"set","p":"color_value","pt":"msg","to":"[0,255,0]","tot":"json"},{"t":"set","p":"dbrigthness","pt":"msg","to":"100","tot":"num"},{"t":"set","p":"message","pt":"msg","to":"A person is at the door","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":680,"y":240,"wires":[["84206afeef95c58e"]]},{"id":"2664a360b33cbe83","type":"api-current-state","z":"f34519812e7522cf","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.bedroom_lights","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":2280,"y":240,"wires":[["0377e3552bbaeafb"]]},{"id":"1b6fac9d5413a108","type":"debug","z":"f34519812e7522cf","name":"test ici 2","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3280,"y":3180,"wires":[]},{"id":"0377e3552bbaeafb","type":"switch","z":"f34519812e7522cf","name":"!=rain","property":"data.attributes.rgb_color","propertyType":"msg","rules":[{"t":"eq","v":"color_value","vt":"msg"}],"checkall":"true","repair":false,"outputs":1,"x":2130,"y":200,"wires":[["7a4888271498757c"]]},{"id":"0605a87c938686a1","type":"delay","z":"f34519812e7522cf","name":"Lights","pauseType":"delay","timeout":"1","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":1070,"y":3380,"wires":[["d4c7ee1c0e38fd48","dbef7ffde79a4607","3005bd6970ed485f","bdf39e4857ea8416","cf7546cf063c2051","e8d9ad3d4692ddee","b921506c085c5cd0"]]},{"id":"42c825401540ba4d","type":"api-current-state","z":"f34519812e7522cf","name":"Party Mode?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.party_mode","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":790,"y":740,"wires":[[],[]]},{"id":"9d67dac53993c6aa","type":"change","z":"f34519812e7522cf","name":"Set Data for mass alert","rules":[{"t":"set","p":"color_name","pt":"msg","to":"red","tot":"str"},{"t":"set","p":"dbrigthness","pt":"msg","to":"100","tot":"num"},{"t":"set","p":"message","pt":"msg","to":"A person is at the door","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":780,"y":3280,"wires":[["b921506c085c5cd0"]]},{"id":"d4c7ee1c0e38fd48","type":"api-current-state","z":"f34519812e7522cf","name":"light.patio","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.patio_notification_light","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"status","propertyType":"msg","value":"","valueType":"entityState"},{"property":"entity_old","propertyType":"msg","value":"","valueType":"entity"},{"property":"entity_id","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":1240,"y":3640,"wires":[["2bb9d64b9347bf12"]],"outputLabels":["data.attributes"]},{"id":"dbef7ffde79a4607","type":"api-current-state","z":"f34519812e7522cf","name":"light.hotbox_lights","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.hotbox_lights","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"status","propertyType":"msg","value":"","valueType":"entityState"},{"property":"entity_old","propertyType":"msg","value":"","valueType":"entity"},{"property":"entity_id","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":1270,"y":3560,"wires":[["807a082d88d07649"]],"outputLabels":["data.attributes"]},{"id":"3005bd6970ed485f","type":"api-current-state","z":"f34519812e7522cf","name":"light.kitchen_lights","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.group_kitchen_lights","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"status","propertyType":"msg","value":"","valueType":"entityState"},{"property":"entity_old","propertyType":"msg","value":"","valueType":"entity"},{"property":"entity_id","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":1270,"y":3480,"wires":[["7ee4c55f07a86639"]],"outputLabels":["data.attributes"]},{"id":"bdf39e4857ea8416","type":"api-current-state","z":"f34519812e7522cf","name":"light.entrance_in","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.group_entrance_lights","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"status","propertyType":"msg","value":"","valueType":"entityState"},{"property":"entity_old","propertyType":"msg","value":"","valueType":"entity"},{"property":"entity_id","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":1260,"y":3400,"wires":[["c5094f52f8b73bc6"]],"outputLabels":["data.attributes"]},{"id":"76367dcda5cece85","type":"switch","z":"f34519812e7522cf","name":"","property":"color_value","propertyType":"msg","rules":[{"t":"nempty"}],"checkall":"true","repair":false,"outputs":1,"x":890,"y":860,"wires":[["42c825401540ba4d","8c30f74dfacc4b95"]]},{"id":"06b392b476daed51","type":"inject","z":"f34519812e7522cf","name":"","props":[{"p":"payload1","v":"","vt":"date"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":790,"y":3080,"wires":[["9d67dac53993c6aa"]]},{"id":"2bb9d64b9347bf12","type":"change","z":"f34519812e7522cf","name":"rules","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.data.rgb_color","pt":"msg","to":"color_value","tot":"msg"},{"t":"set","p":"payload.data.brightness_pct","pt":"msg","to":"dbrigthness","tot":"msg"},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1450,"y":3640,"wires":[["cf527c5b3fb9dcd1"]]},{"id":"807a082d88d07649","type":"change","z":"f34519812e7522cf","name":"rules","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.data.rgb_color","pt":"msg","to":"color_value","tot":"msg"},{"t":"set","p":"payload.data.brightness_pct","pt":"msg","to":"dbrigthness","tot":"msg"},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1450,"y":3560,"wires":[["2d77b28b0bed2a6a"]]},{"id":"7ee4c55f07a86639","type":"change","z":"f34519812e7522cf","name":"rules","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.data.rgb_color","pt":"msg","to":"color_value","tot":"msg"},{"t":"set","p":"payload.data.brightness_pct","pt":"msg","to":"dbrigthness","tot":"msg"},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1450,"y":3480,"wires":[["b769e7a0d5728de6"]]},{"id":"c5094f52f8b73bc6","type":"change","z":"f34519812e7522cf","name":"rules","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.data.rgb_color","pt":"msg","to":"color_value","tot":"msg"},{"t":"set","p":"payload.data.brightness_pct","pt":"msg","to":"dbrigthness","tot":"msg"},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1450,"y":3400,"wires":[["77504ef5fbf4ef2d"]]},{"id":"3d2e4e2ab35afcbe","type":"trigger","z":"f34519812e7522cf","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"30","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":750,"y":860,"wires":[["76367dcda5cece85"]]},{"id":"cf527c5b3fb9dcd1","type":"api-call-service","z":"f34519812e7522cf","name":"Change Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1660,"y":3640,"wires":[["c516aa7d9074d4cc"]]},{"id":"2d77b28b0bed2a6a","type":"api-call-service","z":"f34519812e7522cf","name":"Change Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1660,"y":3560,"wires":[["24e3ca07178d7599"]]},{"id":"b769e7a0d5728de6","type":"api-call-service","z":"f34519812e7522cf","name":"Change Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1660,"y":3480,"wires":[["d0d3af3880fb8143"]]},{"id":"77504ef5fbf4ef2d","type":"api-call-service","z":"f34519812e7522cf","name":"Change Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1660,"y":3400,"wires":[["cda650a1d6dfc699"]]},{"id":"45904ca6429d867d","type":"link in","z":"f34519812e7522cf","name":"Lights output","links":["cda6edfe40da167c","621cf8c7437be5fe","50b11c0933d47453","07dc8ff772761239","26bb1943455ffac1","3c31668009a3d6e2","9790cd5589899bc8","dec00629dd8d0b6f","2185ba65d3b32ccb","e02e42d8570d1e35","1101083478bf6895","f22fd5c50ad88bbd","9bcf0ff17f4166b3","7a91de5bae6af973","fa139ab7677a02b0","363e437bccdc57b7","3c1cab3d3f4be5ea","63e9f2977e9e3d61","d8ce205edf2e27bc","f66eb3a9e4a19b70","16eb9b57ee4552c0","ce20e38b68c63777","ff853761685c9da6","9ad961f55f0e53d5","464e1cbb64c196f9","1336b94421bca8c6","691a7adae76a461c","902a23bee759d216","3c74b545f5aa3550","917e13c9a14ee4b7","333bc07437e9824c","800c68555a289aa4","e5e32b2a64fc9eb4","b61e3fe82467cd65","07013d535d8ccc49","a6b24fae2a2006c2"],"x":615,"y":900,"wires":[["844fb9a7583614fa"]]},{"id":"c516aa7d9074d4cc","type":"delay","z":"f34519812e7522cf","name":"","pauseType":"random","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"1","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1820,"y":3640,"wires":[["24acfb8c936f3f76"]]},{"id":"24e3ca07178d7599","type":"delay","z":"f34519812e7522cf","name":"","pauseType":"random","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"1","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1820,"y":3560,"wires":[["8e8d44abe3b9cbd0"]]},{"id":"d0d3af3880fb8143","type":"delay","z":"f34519812e7522cf","name":"","pauseType":"random","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"1","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1820,"y":3480,"wires":[["5e989e505c0e8306"]]},{"id":"cda650a1d6dfc699","type":"delay","z":"f34519812e7522cf","name":"","pauseType":"random","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"1","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1820,"y":3400,"wires":[["667982ad2bab18b7"]]},{"id":"fcba611dafc02871","type":"switch","z":"f34519812e7522cf","name":"","property":"message","propertyType":"msg","rules":[{"t":"nempty"}],"checkall":"true","repair":false,"outputs":1,"x":750,"y":1120,"wires":[["9d61e81ca21d4495"]]},{"id":"24acfb8c936f3f76","type":"change","z":"f34519812e7522cf","name":"","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.data.rgb_color","pt":"msg","to":"entity_old.attributes.rgb_color","tot":"msg"},{"t":"set","p":"payload.data.brightness","pt":"msg","to":"entity_old.attributes.brightness","tot":"msg"},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1980,"y":3640,"wires":[["5a8b19789337b84d"]]},{"id":"8e8d44abe3b9cbd0","type":"change","z":"f34519812e7522cf","name":"","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.data.rgb_color","pt":"msg","to":"entity_old.attributes.rgb_color","tot":"msg"},{"t":"set","p":"payload.data.brightness","pt":"msg","to":"entity_old.attributes.brightness","tot":"msg"},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1980,"y":3560,"wires":[["9ee487958c658fa5"]]},{"id":"5e989e505c0e8306","type":"change","z":"f34519812e7522cf","name":"","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.data.rgb_color","pt":"msg","to":"entity_old.attributes.rgb_color","tot":"msg"},{"t":"set","p":"payload.data.brightness","pt":"msg","to":"entity_old.attributes.brightness","tot":"msg"},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1980,"y":3480,"wires":[["0b33595834c69a02"]]},{"id":"667982ad2bab18b7","type":"change","z":"f34519812e7522cf","name":"","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.data.rgb_color","pt":"msg","to":"entity_old.attributes.rgb_color","tot":"msg"},{"t":"set","p":"payload.data.brightness","pt":"msg","to":"entity_old.attributes.brightness","tot":"msg"},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1980,"y":3400,"wires":[["cb893b8694b9689e"]]},{"id":"9cd688e5d17c4e4b","type":"change","z":"f34519812e7522cf","name":"Set Data for mass alert","rules":[{"t":"set","p":"color_name","pt":"global","to":"Cyan","tot":"str"},{"t":"set","p":"dbrigthness","pt":"global","to":"100","tot":"num"},{"t":"set","p":"message","pt":"msg","to":"Broadcast Test","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":540,"y":1120,"wires":[["fcba611dafc02871"]]},{"id":"9d61e81ca21d4495","type":"function","z":"f34519812e7522cf","name":" Set payload for assistant relay","func":"var msg = {\n    \"payload\": \n{\n    \"command\": msg.message,\n    \"broadcast\": true,\n    \"converse\": false,\n    \"user\": \"Maxi1134\"\n}\n\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":970,"y":1120,"wires":[["366ed4a484a24d93","2db9515607e68945"]]},{"id":"5a8b19789337b84d","type":"template","z":"f34519812e7522cf","name":"Extract status","field":"payload.service","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"\"turn_{{status}}\"","output":"json","x":2180,"y":3640,"wires":[["dc7de45a9436430f"]]},{"id":"9ee487958c658fa5","type":"template","z":"f34519812e7522cf","name":"Extract status","field":"payload.service","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"\"turn_{{status}}\"","output":"json","x":2180,"y":3560,"wires":[["8c1883bb079789e5"]]},{"id":"0b33595834c69a02","type":"template","z":"f34519812e7522cf","name":"Extract status","field":"payload.service","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"\"turn_{{status}}\"","output":"json","x":2180,"y":3480,"wires":[["024d29cb0ffe7553"]]},{"id":"cb893b8694b9689e","type":"template","z":"f34519812e7522cf","name":"Extract status","field":"payload.service","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"\"turn_{{status}}\"","output":"json","x":2180,"y":3400,"wires":[["50006cb305bbe2cd"]]},{"id":"8564fd8bcc8dd174","type":"inject","z":"f34519812e7522cf","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":290,"y":1120,"wires":[["9cd688e5d17c4e4b"]]},{"id":"366ed4a484a24d93","type":"http request","z":"f34519812e7522cf","name":"POST request","method":"POST","ret":"txt","paytoqs":"ignore","url":"http://192.168.0.15:3000/api/assistant","tls":"","persist":false,"proxy":"","authType":"","senderr":false,"headers":[],"x":1200,"y":1120,"wires":[["2db9515607e68945"]]},{"id":"2db9515607e68945","type":"debug","z":"f34519812e7522cf","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1390,"y":1120,"wires":[]},{"id":"dc7de45a9436430f","type":"api-call-service","z":"f34519812e7522cf","name":"Change Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2380,"y":3640,"wires":[["abfe3b488f4bf0f4"]]},{"id":"8c1883bb079789e5","type":"api-call-service","z":"f34519812e7522cf","name":"Change Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2380,"y":3560,"wires":[["d34d98cf5cd24c91"]]},{"id":"024d29cb0ffe7553","type":"api-call-service","z":"f34519812e7522cf","name":"Change Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2380,"y":3480,"wires":[["aef339e88675e471"]]},{"id":"50006cb305bbe2cd","type":"api-call-service","z":"f34519812e7522cf","name":"Change Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2380,"y":3400,"wires":[["2598ea7ec0c06ec8"]]},{"id":"fb491212c6780cf2","type":"switch","z":"f34519812e7522cf","name":"!=rain","property":"data.attributes.rgb_color","propertyType":"msg","rules":[{"t":"eq","v":"color_value","vt":"msg"}],"checkall":"true","repair":false,"outputs":1,"x":2490,"y":3600,"wires":[["dc7de45a9436430f"]]},{"id":"abfe3b488f4bf0f4","type":"api-current-state","z":"f34519812e7522cf","name":"light.patio","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.patio_notification_light","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":2560,"y":3640,"wires":[["fb491212c6780cf2"]]},{"id":"2f1e51bb8fdf11b7","type":"switch","z":"f34519812e7522cf","name":"!=rain","property":"data.attributes.rgb_color","propertyType":"msg","rules":[{"t":"eq","v":"color_value","vt":"msg"}],"checkall":"true","repair":false,"outputs":1,"x":2490,"y":3520,"wires":[["8c1883bb079789e5"]]},{"id":"d34d98cf5cd24c91","type":"api-current-state","z":"f34519812e7522cf","name":"light.hotbox_lights","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.hotbox_lights","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":2590,"y":3560,"wires":[["2f1e51bb8fdf11b7"]]},{"id":"9ffac0a5b77c636e","type":"switch","z":"f34519812e7522cf","name":"!=rain","property":"data.attributes.rgb_color","propertyType":"msg","rules":[{"t":"eq","v":"color_value","vt":"msg"}],"checkall":"true","repair":false,"outputs":1,"x":2490,"y":3440,"wires":[["024d29cb0ffe7553"]]},{"id":"aef339e88675e471","type":"api-current-state","z":"f34519812e7522cf","name":"light.kitchen_lights","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.group_kitchen_lights","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":2590,"y":3480,"wires":[["9ffac0a5b77c636e"]]},{"id":"a03722945fbbdfaa","type":"switch","z":"f34519812e7522cf","name":"!=rain","property":"data.attributes.rgb_color","propertyType":"msg","rules":[{"t":"eq","v":"color_value","vt":"msg"}],"checkall":"true","repair":false,"outputs":1,"x":2490,"y":3360,"wires":[["50006cb305bbe2cd"]]},{"id":"2598ea7ec0c06ec8","type":"api-current-state","z":"f34519812e7522cf","name":"light.entrance_in","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.group_entrance_lights","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":2580,"y":3400,"wires":[["a03722945fbbdfaa"]]},{"id":"cf7546cf063c2051","type":"api-current-state","z":"f34519812e7522cf","name":"light.livingroom_lights","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.group_livingroom_lights","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"status","propertyType":"msg","value":"","valueType":"entityState"},{"property":"entity_old","propertyType":"msg","value":"","valueType":"entity"},{"property":"entity_id","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":1280,"y":3320,"wires":[["d05d6637664a0dce"]],"outputLabels":["data.attributes"]},{"id":"3fd18274e9e1bd73","type":"api-call-service","z":"f34519812e7522cf","name":"Change Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2380,"y":3320,"wires":[["cc8256ba0583e06c"]]},{"id":"3aa859e9e815cae3","type":"change","z":"f34519812e7522cf","name":"","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.data.rgb_color","pt":"msg","to":"entity_old.attributes.rgb_color","tot":"msg"},{"t":"set","p":"payload.data.brightness","pt":"msg","to":"entity_old.attributes.brightness","tot":"msg"},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1980,"y":3320,"wires":[["eb28c35dfd55656e"]]},{"id":"eb28c35dfd55656e","type":"template","z":"f34519812e7522cf","name":"Extract status","field":"payload.service","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"\"turn_{{status}}\"","output":"json","x":2180,"y":3320,"wires":[["3fd18274e9e1bd73"]]},{"id":"656a71f1cd23f867","type":"delay","z":"f34519812e7522cf","name":"","pauseType":"random","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"1","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1820,"y":3320,"wires":[["3aa859e9e815cae3"]]},{"id":"d05d6637664a0dce","type":"change","z":"f34519812e7522cf","name":"rules","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.data.rgb_color","pt":"msg","to":"color_value","tot":"msg"},{"t":"set","p":"payload.data.brightness_pct","pt":"msg","to":"dbrigthness","tot":"msg"},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1450,"y":3320,"wires":[["c5d2d10c8e686f48"]]},{"id":"c5d2d10c8e686f48","type":"api-call-service","z":"f34519812e7522cf","name":"Change Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1660,"y":3320,"wires":[["656a71f1cd23f867"]]},{"id":"cc8256ba0583e06c","type":"api-current-state","z":"f34519812e7522cf","name":"light.livingroom_lights","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.group_livingroom_lights","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":2600,"y":3320,"wires":[["7aec7ce90475d813"]]},{"id":"7aec7ce90475d813","type":"switch","z":"f34519812e7522cf","name":"!=rain","property":"data.attributes.rgb_color","propertyType":"msg","rules":[{"t":"eq","v":"color_value","vt":"msg"}],"checkall":"true","repair":false,"outputs":1,"x":2490,"y":3280,"wires":[["3fd18274e9e1bd73"]]},{"id":"2549655911d7e342","type":"api-current-state","z":"f34519812e7522cf","name":"light.bedroom_lights","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.bedroom_lights","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"status","propertyType":"msg","value":"","valueType":"entityState"},{"property":"entity_old","propertyType":"msg","value":"","valueType":"entity"},{"property":"entity_id","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":1800,"y":3240,"wires":[["d1d37998ee841405","3561a14b2e4e83f4"]],"outputLabels":["data.attributes"]},{"id":"95b18c742ad346a2","type":"api-call-service","z":"f34519812e7522cf","name":"Change Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2900,"y":3240,"wires":[["e9cf8feebea1fa1b","1b6fac9d5413a108"]]},{"id":"862234128b55035f","type":"change","z":"f34519812e7522cf","name":"","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.data.rgb_color","pt":"msg","to":"entity_old.attributes.rgb_color","tot":"msg"},{"t":"set","p":"payload.data.brightness","pt":"msg","to":"entity_old.attributes.brightness","tot":"msg"},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2500,"y":3240,"wires":[["c70f7ddbaf6229c5"]]},{"id":"c70f7ddbaf6229c5","type":"template","z":"f34519812e7522cf","name":"Extract status","field":"payload.service","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"\"turn_{{status}}\"","output":"json","x":2700,"y":3240,"wires":[["95b18c742ad346a2"]]},{"id":"036e4f7581c049a0","type":"delay","z":"f34519812e7522cf","name":"","pauseType":"random","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"1","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":2340,"y":3240,"wires":[["862234128b55035f"]]},{"id":"d1d37998ee841405","type":"change","z":"f34519812e7522cf","name":"rules","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.data.rgb_color","pt":"msg","to":"color_value","tot":"msg"},{"t":"set","p":"payload.data.brightness_pct","pt":"msg","to":"dbrigthness","tot":"msg"},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1970,"y":3240,"wires":[["2f306deca9f8f71f"]]},{"id":"2f306deca9f8f71f","type":"api-call-service","z":"f34519812e7522cf","name":"Change Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2140,"y":3240,"wires":[["036e4f7581c049a0"]]},{"id":"e9cf8feebea1fa1b","type":"api-current-state","z":"f34519812e7522cf","name":"light.bedroom_lights","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.bedroom_lights","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":3120,"y":3240,"wires":[["99649a611ce21cfe","1b6fac9d5413a108"]]},{"id":"99649a611ce21cfe","type":"switch","z":"f34519812e7522cf","name":"!=rain","property":"data.attributes.rgb_color","propertyType":"msg","rules":[{"t":"eq","v":"color_value","vt":"msg"}],"checkall":"true","repair":false,"outputs":1,"x":3010,"y":3200,"wires":[["95b18c742ad346a2"]]},{"id":"e8d9ad3d4692ddee","type":"api-current-state","z":"f34519812e7522cf","name":"light.thierry","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.thierry","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"status","propertyType":"msg","value":"","valueType":"entityState"},{"property":"entity_old","propertyType":"msg","value":"","valueType":"entity"},{"property":"entity_id","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":1250,"y":3120,"wires":[["19b7c2e8240f6382"]],"outputLabels":["data.attributes"]},{"id":"19b7c2e8240f6382","type":"change","z":"f34519812e7522cf","name":"rules","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.data.rgb_color","pt":"msg","to":"color_value","tot":"msg"},{"t":"set","p":"payload.data.brightness_pct","pt":"msg","to":"dbrigthness","tot":"msg"},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1450,"y":3120,"wires":[["42e5f41425abe751"]]},{"id":"42e5f41425abe751","type":"api-call-service","z":"f34519812e7522cf","name":"Change Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1660,"y":3120,"wires":[["e116b72649f5eabc"]]},{"id":"e116b72649f5eabc","type":"delay","z":"f34519812e7522cf","name":"","pauseType":"random","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"2","randomLast":"3","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1820,"y":3120,"wires":[["b242e3eae8cb626b"]]},{"id":"b242e3eae8cb626b","type":"change","z":"f34519812e7522cf","name":"","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.data.rgb_color","pt":"msg","to":"entity_old.attributes.rgb_color","tot":"msg"},{"t":"set","p":"payload.data.brightness","pt":"msg","to":"entity_old.attributes.brightness","tot":"msg"},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1980,"y":3120,"wires":[["bc5ffcf1e6016dba"]]},{"id":"bc5ffcf1e6016dba","type":"template","z":"f34519812e7522cf","name":"Extract status","field":"payload.service","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"\"turn_{{status}}\"","output":"json","x":2180,"y":3120,"wires":[["1eac1c90635fcf2f"]]},{"id":"1eac1c90635fcf2f","type":"api-call-service","z":"f34519812e7522cf","name":"Change Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2380,"y":3120,"wires":[["eb9e0977fd4823c7"]]},{"id":"fa4a190a5a8cb07b","type":"switch","z":"f34519812e7522cf","name":"!=rain","property":"data.attributes.rgb_color","propertyType":"msg","rules":[{"t":"eq","v":"color_value","vt":"msg"}],"checkall":"true","repair":false,"outputs":1,"x":2490,"y":3080,"wires":[["1eac1c90635fcf2f"]]},{"id":"eb9e0977fd4823c7","type":"api-current-state","z":"f34519812e7522cf","name":"light.thierry","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.thierry","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":2570,"y":3120,"wires":[["fa4a190a5a8cb07b"]]},{"id":"430ef7f959f3acbe","type":"inject","z":"f34519812e7522cf","name":"","props":[{"p":"payload1","v":"","vt":"date"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":350,"y":740,"wires":[["123864baed111d3f"]]},{"id":"123864baed111d3f","type":"change","z":"f34519812e7522cf","name":"Set Data for mass alert","rules":[{"t":"set","p":"color_value","pt":"msg","to":"[0,255,0]","tot":"json"},{"t":"set","p":"dbrigthness","pt":"msg","to":"100","tot":"num"},{"t":"set","p":"message","pt":"msg","to":"A person is at the door","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":540,"y":740,"wires":[["42c825401540ba4d"]]},{"id":"b921506c085c5cd0","type":"api-current-state","z":"f34519812e7522cf","name":"sleeping","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.maxi_sleeping","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":1260,"y":3240,"wires":[["2549655911d7e342"],["20d1f9c83d8d1753"]],"outputLabels":["data.attributes",""]},{"id":"6c95d201f6c9daf3","type":"link in","z":"f34519812e7522cf","name":"TV output","links":["d7ccb3af1a82f471","4a05baf3976bade9","836799ab5789bfdd","e139f44c71b58e6e","c83706e06ce524aa","bdb95ccd4331168c","87741f0405d05c21","071e62f4a8fb4411","2be68eeca4b12515","0361e9a0a13608d3","a9f7a85966e01bbb","f0ab80a27fc67e71","b0a24e5ad5a07b47","4969fb0496c2bff9","5b78416ba629eb77","e00c45cbe3e63bd3","5b1999c656658823","f5393864d1b87876","20a73ed621cdb1fa","d3ff46bcfad26357","679f1d97bea54b16"],"x":605,"y":2300,"wires":[["59b850a1f6e39faf"]]},{"id":"6f09247fb47e9c18","type":"inject","z":"f34519812e7522cf","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":450,"y":2440,"wires":[["59b850a1f6e39faf"]]},{"id":"3561a14b2e4e83f4","type":"debug","z":"f34519812e7522cf","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1830,"y":3180,"wires":[]},{"id":"20d1f9c83d8d1753","type":"switch","z":"f34519812e7522cf","name":"!=green","property":"color_name","propertyType":"msg","rules":[{"t":"neq","v":"green","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1580,"y":3260,"wires":[["2549655911d7e342"]]},{"id":"1aac65146ab06f79","type":"api-current-state","z":"f34519812e7522cf","name":"Living Room  TV?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"playing","halt_if_type":"str","halt_if_compare":"is","entity_id":"media_player.living_room_chromecast","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"input","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":1020,"y":2580,"wires":[["69737479af458639"],["fadf7b02800992bc"]]},{"id":"e0301454afc920c4","type":"api-current-state","z":"f34519812e7522cf","name":"Patio TV?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is_not","entity_id":"media_player.patio_chromecast","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":990,"y":2200,"wires":[["ce2fa106504ff344"],["c7106c1b5d18bf04"]]},{"id":"ce2fa106504ff344","type":"change","z":"f34519812e7522cf","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1230,"y":2200,"wires":[["1a084bc551c189fa"]]},{"id":"1a084bc551c189fa","type":"api-call-service","z":"f34519812e7522cf","name":"pause patio TV","server":"7ab5c227.a3ce8c","version":5,"debugenabled":true,"domain":"media_player","service":"media_pause","areaId":[],"deviceId":[],"entityId":["media_player.patio_chromecast"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1410,"y":2200,"wires":[[]]},{"id":"69737479af458639","type":"change","z":"f34519812e7522cf","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1230,"y":2560,"wires":[["dd10c7f7948c1914"]]},{"id":"dd10c7f7948c1914","type":"api-call-service","z":"f34519812e7522cf","name":"pause living room tv","server":"7ab5c227.a3ce8c","version":5,"debugenabled":true,"domain":"media_player","service":"media_pause","areaId":[],"deviceId":[],"entityId":["media_player.living_room_chromecast"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1430,"y":2560,"wires":[[]]},{"id":"fadf7b02800992bc","type":"api-current-state","z":"f34519812e7522cf","name":"Living Room LG?","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"media_player.living_room_lg","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"input","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":1240,"y":2600,"wires":[["caa2b1f3cc24b5c3"]]},{"id":"caa2b1f3cc24b5c3","type":"switch","z":"f34519812e7522cf","name":"","property":"payload.attributes.source","propertyType":"msg","rules":[{"t":"eq","v":"HDMI 2","vt":"str"},{"t":"neq","v":"HDMI 2","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1400,"y":2600,"wires":[["df06240f96fe6139"],["360c1e3a5d3a9ce3"]]},{"id":"edce802b1e60377b","type":"api-call-service","z":"f34519812e7522cf","name":"stop","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"turn_off","areaId":[],"deviceId":[],"entityId":["media_player.living_room_chromecast"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2420,"y":2660,"wires":[[]]},{"id":"c7106c1b5d18bf04","type":"exec","z":"f34519812e7522cf","command":"/root/.local/bin/catt -d 'Patio TV' cast_site 'http://192.168.0.15:8123/local/reolink.jpg'","addpay":false,"append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"","x":1440,"y":2240,"wires":[["86b7bdca6f8133c7"],[],["86b7bdca6f8133c7"]]},{"id":"86b7bdca6f8133c7","type":"ha-wait-until","z":"f34519812e7522cf","name":"","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"lock.lock_front_door","entityIdFilterType":"exact","property":"state","comparator":"is","value":"unlocked","valueType":"str","timeout":"120","timeoutType":"num","timeoutUnits":"seconds","checkCurrentState":false,"blockInputOverrides":true,"outputProperties":[],"x":1950,"y":2240,"wires":[["77bba7d8ced92853"],["77bba7d8ced92853"]]},{"id":"77bba7d8ced92853","type":"api-call-service","z":"f34519812e7522cf","name":"stop","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"turn_off","areaId":[],"deviceId":[],"entityId":["media_player.patio_chromecast"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2160,"y":2240,"wires":[[]]},{"id":"b61c27e2c6f21854","type":"api-current-state","z":"f34519812e7522cf","name":"Hotbox TV Down","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is_not","entity_id":"media_player.hotbox_down_chromecast","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":1020,"y":2280,"wires":[["c3d06d30b3d41fae"],["9531e41420bdfe66"]]},{"id":"c3d06d30b3d41fae","type":"change","z":"f34519812e7522cf","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1230,"y":2280,"wires":[["1906d50d4bbc0fb4"]]},{"id":"1906d50d4bbc0fb4","type":"api-call-service","z":"f34519812e7522cf","name":"pause","server":"7ab5c227.a3ce8c","version":5,"debugenabled":true,"domain":"media_player","service":"media_pause","areaId":[],"deviceId":[],"entityId":["media_player.hotbox_down_chromecast"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1380,"y":2280,"wires":[[]]},{"id":"9531e41420bdfe66","type":"exec","z":"f34519812e7522cf","command":"/root/.local/bin/catt -d 'Hotbox Top TV' cast_site 'http://192.168.0.15:8123/local/reolink.jpg'","addpay":false,"append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"","x":1460,"y":2320,"wires":[["0b4b69550bfc584f"],[],["0b4b69550bfc584f"]]},{"id":"0b4b69550bfc584f","type":"ha-wait-until","z":"f34519812e7522cf","name":"lock opens","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"lock.lock_front_door, ","entityIdFilterType":"exact","property":"state","comparator":"is","value":"unlocked","valueType":"str","timeout":"120","timeoutType":"num","timeoutUnits":"seconds","checkCurrentState":false,"blockInputOverrides":true,"outputProperties":[],"x":1900,"y":2320,"wires":[["2d361fc5737bb3e6"],["2d361fc5737bb3e6"]]},{"id":"2d361fc5737bb3e6","type":"api-call-service","z":"f34519812e7522cf","name":"stop","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"turn_off","areaId":[],"deviceId":[],"entityId":["media_player.hotbox_down_chromecast"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2220,"y":2320,"wires":[[]]},{"id":"2702e16aba4ee822","type":"api-current-state","z":"f34519812e7522cf","name":"Hotbox TV","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is_not","entity_id":"media_player.hotbox_top_chromecast","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":1000,"y":2360,"wires":[["f57c9b853de6efab"],["69e537dc26949598"]]},{"id":"f57c9b853de6efab","type":"change","z":"f34519812e7522cf","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1230,"y":2360,"wires":[["b6c7584f06d247af"]]},{"id":"b6c7584f06d247af","type":"api-call-service","z":"f34519812e7522cf","name":"pause","server":"7ab5c227.a3ce8c","version":5,"debugenabled":true,"domain":"media_player","service":"media_pause","areaId":[],"deviceId":[],"entityId":["media_player.hotbox_top_chromecast"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1380,"y":2360,"wires":[[]]},{"id":"69e537dc26949598","type":"exec","z":"f34519812e7522cf","command":"/root/.local/bin/catt -d 'Hotbox Down TV' cast_site 'http://192.168.0.15:8123/local/reolink.jpg'","addpay":false,"append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"","x":1470,"y":2400,"wires":[["94583770890a2ced"],[],["94583770890a2ced"]]},{"id":"94583770890a2ced","type":"ha-wait-until","z":"f34519812e7522cf","name":"lock opens","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"lock.lock_front_door, ","entityIdFilterType":"exact","property":"state","comparator":"is","value":"unlocked","valueType":"str","timeout":"120","timeoutType":"num","timeoutUnits":"seconds","checkCurrentState":false,"blockInputOverrides":true,"outputProperties":[],"x":1900,"y":2400,"wires":[["a2d2def8c8fc0b8b"],["a2d2def8c8fc0b8b"]]},{"id":"a2d2def8c8fc0b8b","type":"api-call-service","z":"f34519812e7522cf","name":"stop","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"turn_off","areaId":[],"deviceId":[],"entityId":["media_player.hotbox_top_chromecast"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2220,"y":2400,"wires":[[]]},{"id":"ea684b5f9c34dcdc","type":"api-current-state","z":"f34519812e7522cf","name":"Bedroom TV","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"idle","halt_if_type":"str","halt_if_compare":"is_not","entity_id":"media_player.bedroom_chromecast","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":1000,"y":2460,"wires":[["995e9d4420541afd"],["c6b7d506afe2864a"]]},{"id":"995e9d4420541afd","type":"change","z":"f34519812e7522cf","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1230,"y":2460,"wires":[["b453f66c371a80be"]]},{"id":"b453f66c371a80be","type":"api-call-service","z":"f34519812e7522cf","name":"pause","server":"7ab5c227.a3ce8c","version":5,"debugenabled":true,"domain":"media_player","service":"media_pause","areaId":[],"deviceId":[],"entityId":["media_player.bedroom_chromecast"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1380,"y":2460,"wires":[[]]},{"id":"c6b7d506afe2864a","type":"exec","z":"f34519812e7522cf","command":"/root/.local/bin/catt -d 'Bedroom TV' cast_site 'http://192.168.0.15:8123/local/reolink.jpg'","addpay":false,"append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"","x":1450,"y":2500,"wires":[["11ad85976f1a5319"],[],["11ad85976f1a5319"]]},{"id":"34c48140f16abd1d","type":"ha-wait-until","z":"f34519812e7522cf","name":"lock opens","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"lock.lock_front_door, ","entityIdFilterType":"exact","property":"state","comparator":"is","value":"unlocked","valueType":"str","timeout":"120","timeoutType":"num","timeoutUnits":"seconds","checkCurrentState":false,"blockInputOverrides":true,"outputProperties":[],"x":2080,"y":2500,"wires":[["a2105bf9432218ec"],["a2105bf9432218ec"]]},{"id":"a2105bf9432218ec","type":"api-call-service","z":"f34519812e7522cf","name":"stop","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"turn_off","areaId":[],"deviceId":[],"entityId":["media_player.bedroom_chromecast"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2260,"y":2480,"wires":[["e1f9fb727008e812"]]},{"id":"df06240f96fe6139","type":"exec","z":"f34519812e7522cf","command":"/root/.local/bin/catt -d 'Living Room TV' cast_site 'http://192.168.0.15:8123/local/reolink.jpg'","addpay":false,"append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"","x":1800,"y":2600,"wires":[["dea542cb24956ffc"],[],[]]},{"id":"dea542cb24956ffc","type":"ha-wait-until","z":"f34519812e7522cf","name":"lock opens","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"lock.lock_front_door, ","entityIdFilterType":"exact","property":"state","comparator":"is","value":"unlocked","valueType":"str","timeout":"120","timeoutType":"num","timeoutUnits":"seconds","checkCurrentState":false,"blockInputOverrides":true,"outputProperties":[],"x":2260,"y":2600,"wires":[["dd1bbe7445e9647d"],["dd1bbe7445e9647d"]]},{"id":"dd1bbe7445e9647d","type":"api-call-service","z":"f34519812e7522cf","name":"stop","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"turn_off","areaId":[],"deviceId":[],"entityId":["media_player.living_room_chromecast"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2420,"y":2600,"wires":[["3fc0c17eb04935ce"]]},{"id":"360c1e3a5d3a9ce3","type":"exec","z":"f34519812e7522cf","command":"/root/.local/bin/catt -d 'Living Room TV' cast_site 'http://192.168.0.15:8123/local/reolink.jpg'","addpay":false,"append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"","x":1800,"y":2660,"wires":[["a7767430eda890f3"],[],[]]},{"id":"a7767430eda890f3","type":"ha-wait-until","z":"f34519812e7522cf","name":"lock opens","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"lock.lock_front_door","entityIdFilterType":"exact","property":"state","comparator":"is","value":"unlocked","valueType":"str","timeout":"120","timeoutType":"num","timeoutUnits":"seconds","checkCurrentState":false,"blockInputOverrides":true,"outputProperties":[],"x":2260,"y":2660,"wires":[["edce802b1e60377b"],["edce802b1e60377b"]]},{"id":"3fc0c17eb04935ce","type":"api-call-service","z":"f34519812e7522cf","name":"change source","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"select_source","areaId":[],"deviceId":[],"entityId":["media_player.living_room_lg"],"data":"{\"source\":\"HDMI 2\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2570,"y":2600,"wires":[[]]},{"id":"e1f9fb727008e812","type":"api-call-service","z":"f34519812e7522cf","name":"change source","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"select_source","areaId":[],"deviceId":[],"entityId":["media_player.bedroom_tv"],"data":"{\"source\":\"PC\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2590,"y":2480,"wires":[[]]},{"id":"11ad85976f1a5319","type":"api-call-service","z":"f34519812e7522cf","name":"change source","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"lock.lock_front_door, ","areaId":[],"deviceId":[],"entityId":["media_player.bedroom_tv"],"data":"{\"source\":\"chromecast\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1890,"y":2520,"wires":[["34c48140f16abd1d"]]},{"id":"59b850a1f6e39faf","type":"api-current-state","z":"f34519812e7522cf","name":"Party","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.party_mode","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":800,"y":2340,"wires":[["e0301454afc920c4","b61c27e2c6f21854","2702e16aba4ee822","ea684b5f9c34dcdc","1aac65146ab06f79"],[]]},{"id":"91d140293e8cb5a5","type":"inject","z":"f34519812e7522cf","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1030,"y":3600,"wires":[["d4c7ee1c0e38fd48"]]},{"id":"492e31e090146e2c","type":"inject","z":"f34519812e7522cf","name":"","props":[{"p":"inject","v":"","vt":"date"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":1090,"y":940,"wires":[[]]},{"id":"8c30f74dfacc4b95","type":"ha-get-entities","z":"f34519812e7522cf","name":"Get Lights","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"entity_id","logic":"is","value":"^light.*[a-z].*(?<!s)$","valueType":"re"},{"property":"state","logic":"is_not","value":"unavailable","valueType":"str"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":1450,"y":860,"wires":[["0a11cdf9b61ead73"]]},{"id":"877c737f94f33adc","type":"debug","z":"f34519812e7522cf","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1870,"y":1180,"wires":[]},{"id":"0a11cdf9b61ead73","type":"switch","z":"f34519812e7522cf","name":"Check color support","property":"payload.attributes.supported_color_modes","propertyType":"msg","rules":[{"t":"cont","v":"xy","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1700,"y":860,"wires":[["7687968e986402bb"]]},{"id":"7687968e986402bb","type":"switch","z":"f34519812e7522cf","name":"Check initial light state","property":"payload.state","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1980,"y":860,"wires":[["f64325639791dc5d","7525a7496c9c954a"],[]]},{"id":"603f2117ae97f231","type":"comment","z":"f34519812e7522cf","name":"Pull all individual lights","info":"","x":1460,"y":820,"wires":[]},{"id":"54d13ada3eb1bd61","type":"comment","z":"f34519812e7522cf","name":"Check if they support color","info":"","x":1710,"y":820,"wires":[]},{"id":"9d5c68c7b67c9280","type":"api-call-service","z":"f34519812e7522cf","name":"Change Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2440,"y":860,"wires":[["877c737f94f33adc","810667f9b644c3b4"]]},{"id":"7525a7496c9c954a","type":"change","z":"f34519812e7522cf","name":"Set desired Values","rules":[{"t":"set","p":"payload.data.rgb_color","pt":"msg","to":"color_value","tot":"msg","dc":true},{"t":"set","p":"payload.data.brightness_pct","pt":"msg","to":"dbrigthness","tot":"msg","dc":true},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"payload.entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2210,"y":860,"wires":[["877c737f94f33adc","9d5c68c7b67c9280"]]},{"id":"f64325639791dc5d","type":"debug","z":"f34519812e7522cf","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1290,"y":1500,"wires":[]},{"id":"ad39d3fba55e2a22","type":"change","z":"f34519812e7522cf","name":"","rules":[{"t":"delete","p":"payload.data.brightness_pct","pt":"msg"},{"t":"set","p":"payload.data.rgb_color","pt":"msg","to":"payload.attributes.rgb_color","tot":"msg","dc":true},{"t":"set","p":"payload.data.brightness","pt":"msg","to":"payload.attributes.brightness","tot":"msg","dc":true},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"payload.entity_id","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":2940,"y":860,"wires":[["9e4f2dedb594de4f","cc068abe1e972515"]]},{"id":"9e4f2dedb594de4f","type":"api-call-service","z":"f34519812e7522cf","name":"Change Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3140,"y":860,"wires":[[]]},{"id":"cc068abe1e972515","type":"debug","z":"f34519812e7522cf","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3070,"y":800,"wires":[]},{"id":"810667f9b644c3b4","type":"delay","z":"f34519812e7522cf","name":"","pauseType":"delay","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":2700,"y":860,"wires":[["ad39d3fba55e2a22"]]},{"id":"844fb9a7583614fa","type":"subflow:233ac7dcd801a802","z":"f34519812e7522cf","name":"","x":830,"y":940,"wires":[]},{"id":"aa81cc5ee75d6c63","type":"api-call-service","z":"60d15080ad880ed5","name":"cast to display","server":"7ab5c227.a3ce8c","version":5,"debugenabled":true,"domain":"media_player","service":"play_media","areaId":[],"deviceId":[],"entityId":["media_player.living_room_tv"],"data":"{\"media_content_type\":\"image\",\"media_content_id\":\"http://192.168.0.15:8123/local/reolink.jpg\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":820,"y":1000,"wires":[["73ce0a9ed9c98f8f"]]},{"id":"73ce0a9ed9c98f8f","type":"trigger","z":"60d15080ad880ed5","name":"","op1":"","op2":"1","op1type":"nul","op2type":"num","duration":"20","extend":false,"units":"s","reset":"closed","bytopic":"all","outputs":1,"x":1010,"y":1000,"wires":[["cc7881c3657ee8e1"]]},{"id":"cc7881c3657ee8e1","type":"api-call-service","z":"60d15080ad880ed5","name":"change source","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"select_source","areaId":[],"deviceId":[],"entityId":["media_player.living_room_lg"],"data":"{\"source\":\"HDMI 2\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1180,"y":1000,"wires":[[]]},{"id":"c710a60112927245","type":"api-current-state","z":"60d15080ad880ed5","name":"Living Room  TV?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"playing","halt_if_type":"str","halt_if_compare":"is","entity_id":"media_player.living_room_tv","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"input","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":270,"y":980,"wires":[["89582a6e689437b6"],["92e9d937121cce70"]]},{"id":"89582a6e689437b6","type":"change","z":"60d15080ad880ed5","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":960,"wires":[["4bfc8ef846a9971f"]]},{"id":"4bfc8ef846a9971f","type":"api-call-service","z":"60d15080ad880ed5","name":"pause living room tv","server":"7ab5c227.a3ce8c","version":5,"debugenabled":true,"domain":"media_player","service":"media_pause","areaId":[],"deviceId":[],"entityId":[],"data":"{\"entity_id\":\"media_player.living_room_tv\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":680,"y":960,"wires":[[]]},{"id":"92e9d937121cce70","type":"api-current-state","z":"60d15080ad880ed5","name":"Living Room LG?","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"media_player.living_room_lg","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"input","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":490,"y":1000,"wires":[["086c4b2caa05f483"]]},{"id":"086c4b2caa05f483","type":"switch","z":"60d15080ad880ed5","name":"","property":"payload.attributes.source","propertyType":"msg","rules":[{"t":"eq","v":"HDMI 2","vt":"str"},{"t":"neq","v":"HDMI 2","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":650,"y":1000,"wires":[["aa81cc5ee75d6c63"],["6e209500758d0fbb"]]},{"id":"6e209500758d0fbb","type":"api-call-service","z":"60d15080ad880ed5","name":"cast to display","server":"7ab5c227.a3ce8c","version":5,"debugenabled":true,"domain":"media_player","service":"play_media","areaId":[],"deviceId":[],"entityId":["media_player.living_room_tv"],"data":"{\"media_content_type\":\"image\",\"media_content_id\":\"https://hass.purgatoire.ca/local/reolink.jpg\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":820,"y":1040,"wires":[["57925d66f1757bcb"]]},{"id":"57925d66f1757bcb","type":"trigger","z":"60d15080ad880ed5","name":"","op1":"","op2":"1","op1type":"nul","op2type":"num","duration":"20","extend":false,"units":"s","reset":"closed","bytopic":"all","outputs":1,"x":1010,"y":1040,"wires":[["1093d5b5ae877ab1"]]},{"id":"1093d5b5ae877ab1","type":"api-call-service","z":"60d15080ad880ed5","name":"stop","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"media_stop","areaId":[],"deviceId":[],"entityId":["media_player.living_room_tv"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1150,"y":1040,"wires":[[]]},{"id":"bbac801cfca12719","type":"inject","z":"60d15080ad880ed5","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":80,"y":980,"wires":[["c710a60112927245"]]},{"id":"be1856fa89c02c1c","type":"subflow:dfb97c6505f003d9","z":"60d15080ad880ed5","name":"","x":2000,"y":960,"wires":[]},{"id":"222c6ea37fc5f1fd","type":"inject","z":"60d15080ad880ed5","name":"","props":[{"p":"color_value","v":"[0,255,0]","vt":"json"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":1410,"y":920,"wires":[["8d7549550611cb06"]]},{"id":"d33f7d1e61b49a33","type":"api-call-service","z":"60d15080ad880ed5","name":"Change Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3080,"y":900,"wires":[["af7106e55fc26559"]]},{"id":"6c75e24a2f371759","type":"change","z":"60d15080ad880ed5","name":"","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.data.rgb_color","pt":"msg","to":"entity_old.attributes.rgb_color","tot":"msg"},{"t":"set","p":"payload.data.brightness","pt":"msg","to":"entity_old.attributes.brightness","tot":"msg"},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2680,"y":900,"wires":[["b53220987b3f75a3"]]},{"id":"b53220987b3f75a3","type":"template","z":"60d15080ad880ed5","name":"Extract status","field":"payload.service","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"\"turn_{{status}}\"","output":"json","x":2880,"y":900,"wires":[["d33f7d1e61b49a33"]]},{"id":"6180b4ada706bc70","type":"delay","z":"60d15080ad880ed5","name":"","pauseType":"random","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"1","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":2500,"y":900,"wires":[["6c75e24a2f371759"]]},{"id":"8b5fc8b2dddd61a9","type":"change","z":"60d15080ad880ed5","name":"rules","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.data.rgb_color","pt":"msg","to":"color_value","tot":"msg"},{"t":"set","p":"payload.data.brightness_pct","pt":"msg","to":"dbrigthness","tot":"msg"},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2120,"y":900,"wires":[["0e26c518c4b7f87f"]]},{"id":"0e26c518c4b7f87f","type":"api-call-service","z":"60d15080ad880ed5","name":"Change Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2280,"y":900,"wires":[["6180b4ada706bc70"]]},{"id":"af7106e55fc26559","type":"api-current-state","z":"60d15080ad880ed5","name":"light.bedroom_lights","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.bedroom_lights","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":3320,"y":900,"wires":[["e48b0a2a6c0e603e"]]},{"id":"e48b0a2a6c0e603e","type":"switch","z":"60d15080ad880ed5","name":"!=rain","property":"data.attributes.rgb_color","propertyType":"msg","rules":[{"t":"eq","v":"color_value","vt":"msg"}],"checkall":"true","repair":false,"outputs":1,"x":3190,"y":860,"wires":[["d33f7d1e61b49a33"]]},{"id":"0cdd0984f0759061","type":"debug","z":"60d15080ad880ed5","name":"1","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":870,"y":1300,"wires":[]},{"id":"8426df596c13d4de","type":"api-current-state","z":"60d15080ad880ed5","name":"light.bedroom_lights","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.bedroom_lights","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"status","propertyType":"msg","value":"","valueType":"entityState"},{"property":"entity_old","propertyType":"msg","value":"","valueType":"entity"},{"property":"entity_id","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":1940,"y":900,"wires":[["8b5fc8b2dddd61a9"]],"outputLabels":["data.attributes"]},{"id":"f7f702600182309f","type":"inject","z":"60d15080ad880ed5","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"1","payloadType":"str","x":490,"y":1180,"wires":[["4c4ce8679c935e51"]]},{"id":"59e7c8fdee91b212","type":"change","z":"60d15080ad880ed5","name":"","rules":[{"t":"set","p":"payload.data","pt":"msg","to":"{}","tot":"json"},{"t":"delete","p":"payload.data.brightness","pt":"msg"},{"t":"move","p":"entity_inital.attributes.rgb_color","pt":"msg","to":"payload.data.rgb_color","tot":"msg"},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"data.entity_id","tot":"msg"},{"t":"set","p":"payload.data.brightness","pt":"msg","to":"entity_inital.attributes.brightness","tot":"msg"},{"t":"delete","p":"entity_inital","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1820,"y":1060,"wires":[[]]},{"id":"be8acf73221c1b19","type":"debug","z":"60d15080ad880ed5","name":"3","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1710,"y":1040,"wires":[]},{"id":"303a3c5c50022a22","type":"debug","z":"60d15080ad880ed5","name":"4","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1990,"y":1040,"wires":[]},{"id":"4961393dfa77fc29","type":"change","z":"60d15080ad880ed5","name":"","rules":[{"t":"set","p":"payload.data","pt":"msg","to":"{}","tot":"json"},{"t":"delete","p":"payload.data.brightness","pt":"msg"},{"t":"move","p":"entity_inital.attributes.rgb_color","pt":"msg","to":"payload.data.rgb_color","tot":"msg"},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"entity_initial.entity_id","tot":"msg","dc":true},{"t":"set","p":"payload.data.brightness","pt":"msg","to":"entity_inital.attributes.brightness","tot":"msg"},{"t":"delete","p":"entity_inital","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1820,"y":1100,"wires":[[]]},{"id":"4c4ce8679c935e51","type":"change","z":"60d15080ad880ed5","name":"Set Data for light alert","rules":[{"t":"set","p":"color_value","pt":"msg","to":"[0,255,0]","tot":"json"},{"t":"set","p":"dbrigthness","pt":"msg","to":"100","tot":"num"},{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"message","pt":"msg","to":"this is a test","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":680,"y":1180,"wires":[["7b1ae33189e60228"]]},{"id":"7b1ae33189e60228","type":"subflow:233ac7dcd801a802","z":"60d15080ad880ed5","name":"","x":930,"y":1180,"wires":[]},{"id":"ad0f7b2d36c619f1","type":"switch","z":"60d15080ad880ed5","name":"","property":"message","propertyType":"msg","rules":[{"t":"nempty"}],"checkall":"true","repair":false,"outputs":1,"x":810,"y":1700,"wires":[["09feb048bb363c03"]]},{"id":"652818978159b5a1","type":"trigger","z":"60d15080ad880ed5","name":"MEssage fuse","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"10","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":580,"y":1700,"wires":[["ad0f7b2d36c619f1"]]},{"id":"11c9492a3ef65fc0","type":"api-call-service","z":"60d15080ad880ed5","name":"play media","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"tts","service":"google_translate_say","areaId":[],"deviceId":[],"entityId":["media_player.group_home_speakers","media_player.group_home_speakers"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1630,"y":2280,"wires":[[]]},{"id":"ed8c945d46b67b07","type":"change","z":"60d15080ad880ed5","name":"Set Data for mass alert","rules":[{"t":"set","p":"message","pt":"msg","to":"testing alerts","tot":"str"},{"t":"set","p":"color_value","pt":"msg","to":"[0,0,255]","tot":"json"},{"t":"set","p":"dbrigthness","pt":"msg","to":"100","tot":"num"},{"t":"set","p":"video","pt":"msg","to":"on","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":1460,"wires":[["6b5b11bea220d3eb"]]},{"id":"c6344df5235a60a4","type":"inject","z":"60d15080ad880ed5","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":200,"y":1460,"wires":[["ed8c945d46b67b07"]]},{"id":"67f34e4b412cdbe1","type":"debug","z":"60d15080ad880ed5","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1370,"y":2240,"wires":[]},{"id":"4f4afa06302200e9","type":"change","z":"60d15080ad880ed5","name":"Set message","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.data.message","pt":"msg","to":"message","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":1130,"y":2280,"wires":[["11c9492a3ef65fc0","67f34e4b412cdbe1"]]},{"id":"09feb048bb363c03","type":"function","z":"60d15080ad880ed5","name":" Set payload for play media ","func":"var msg = {\n    \"payload\": {\n      \"message\": msg.message\n}\n\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1160,"y":1580,"wires":[["b33b62e88fc77332"]]},{"id":"b33b62e88fc77332","type":"http request","z":"60d15080ad880ed5","name":"POST request","method":"POST","ret":"obj","paytoqs":"ignore","url":"http://192.168.0.14:8085/broadcast","tls":"","persist":false,"proxy":"","authType":"","senderr":false,"x":1480,"y":1580,"wires":[["48d1de5a66fe3a06"]]},{"id":"48d1de5a66fe3a06","type":"debug","z":"60d15080ad880ed5","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1690,"y":1580,"wires":[]},{"id":"6d2299d0388ebbf2","type":"api-call-service","z":"60d15080ad880ed5","name":"play visuals","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"play_media","areaId":[],"deviceId":[],"entityId":["media_player.bedroom_chromecast"],"data":"{\"media_content_id\":\"jellyfin://{ \\\"title\\\": \\\"Forest Gump\\\" }\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":650,"y":2060,"wires":[[]]},{"id":"e6585439391aca1b","type":"inject","z":"60d15080ad880ed5","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":330,"y":2080,"wires":[["6d2299d0388ebbf2"]]},{"id":"6b5b11bea220d3eb","type":"ha-get-entities","z":"60d15080ad880ed5","name":"Get Lights","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"entity_id","logic":"is","value":"^light.*[a-z].*(?<!s)$","valueType":"re"},{"property":"state","logic":"is_not","value":"unavailable","valueType":"str"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":690,"y":1460,"wires":[["92b0b1407620f85f"]]},{"id":"92b0b1407620f85f","type":"switch","z":"60d15080ad880ed5","name":"Check color support","property":"payload.attributes.supported_color_modes","propertyType":"msg","rules":[{"t":"cont","v":"xy","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":940,"y":1460,"wires":[["d381e97329e6ef70"]]},{"id":"d381e97329e6ef70","type":"switch","z":"60d15080ad880ed5","name":"Check initial light state","property":"payload.state","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1220,"y":1460,"wires":[["53c674301a0a2c44"],["66053ed75200fe0b"]]},{"id":"2c01270cd7ece713","type":"comment","z":"60d15080ad880ed5","name":"Pull all individual lights","info":"","x":700,"y":1420,"wires":[]},{"id":"7936d2da68036493","type":"comment","z":"60d15080ad880ed5","name":"Check if they support color","info":"","x":950,"y":1420,"wires":[]},{"id":"d7063b9d3964f17a","type":"api-call-service","z":"60d15080ad880ed5","name":"Change Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1680,"y":1420,"wires":[["e2741e1d14fbc480"]]},{"id":"53c674301a0a2c44","type":"change","z":"60d15080ad880ed5","name":"Set desired Values","rules":[{"t":"set","p":"payload.data.rgb_color","pt":"msg","to":"color_value","tot":"msg","dc":true},{"t":"set","p":"payload.data.brightness_pct","pt":"msg","to":"dbrigthness","tot":"msg","dc":true},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"payload.entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1450,"y":1420,"wires":[["d7063b9d3964f17a"]]},{"id":"64b3e9d7919fccc1","type":"change","z":"60d15080ad880ed5","name":"Set Initial color","rules":[{"t":"delete","p":"payload.data.brightness_pct","pt":"msg"},{"t":"set","p":"payload.data.rgb_color","pt":"msg","to":"payload.attributes.rgb_color","tot":"msg","dc":true},{"t":"set","p":"payload.data.brightness","pt":"msg","to":"payload.attributes.brightness","tot":"msg","dc":true},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"payload.entity_id","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":2160,"y":1420,"wires":[["d1c74c92d8b884d1"]]},{"id":"d1c74c92d8b884d1","type":"api-call-service","z":"60d15080ad880ed5","name":"Change Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2380,"y":1420,"wires":[[]]},{"id":"e2741e1d14fbc480","type":"delay","z":"60d15080ad880ed5","name":"","pauseType":"delay","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1940,"y":1420,"wires":[["64b3e9d7919fccc1"]]},{"id":"471d148223611eac","type":"api-call-service","z":"60d15080ad880ed5","name":"Change Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1680,"y":1500,"wires":[["4006deb6767c7ac9"]]},{"id":"66053ed75200fe0b","type":"change","z":"60d15080ad880ed5","name":"Set desired Values","rules":[{"t":"set","p":"payload.data.rgb_color","pt":"msg","to":"color_value","tot":"msg","dc":true},{"t":"set","p":"payload.data.brightness_pct","pt":"msg","to":"dbrigthness","tot":"msg","dc":true},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"payload.entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1450,"y":1500,"wires":[["471d148223611eac"]]},{"id":"cde3dacab7301554","type":"api-call-service","z":"60d15080ad880ed5","name":"Turn off lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2360,"y":1500,"wires":[[]]},{"id":"4006deb6767c7ac9","type":"delay","z":"60d15080ad880ed5","name":"","pauseType":"delay","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1940,"y":1500,"wires":[["1fcdac9ab0cf1f3f"]]},{"id":"1fcdac9ab0cf1f3f","type":"change","z":"60d15080ad880ed5","name":"Set entity","rules":[{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"payload.entity_id","tot":"msg","dc":true},{"t":"delete","p":"payload.data.rgb_color","pt":"msg"},{"t":"delete","p":"payload.data.brightness_pct","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2160,"y":1500,"wires":[["cde3dacab7301554"]]},{"id":"6e2778b658d06197","type":"server-state-changed","z":"60d15080ad880ed5","name":"Motion Kitchen ON","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"group.motion_kitchen_group","entityidfiltertype":"regex","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"sensor","propertyType":"msg","value":"","valueType":"triggerId"},{"property":"sensorstate","propertyType":"msg","value":"","valueType":"entityState"}],"x":210,"y":840,"wires":[[],[]]},{"id":"ca492510b6db0635","type":"api-current-state","z":"60d15080ad880ed5","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.group_kitchen_lights","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"entity.entity_id","propertyType":"msg","value":"","valueType":"triggerId"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":520,"y":840,"wires":[["9a2813dc56837f7b"],[]]},{"id":"9a2813dc56837f7b","type":"subflow:cd4b600533b9308c","z":"60d15080ad880ed5","name":"","x":820,"y":840,"wires":[]},{"id":"39ad5887f056ac7d","type":"comment","z":"60d15080ad880ed5","name":"Motion group on","info":"","x":200,"y":800,"wires":[]},{"id":"160142c2e085fef4","type":"comment","z":"60d15080ad880ed5","name":"Set light","info":"","x":470,"y":800,"wires":[]},{"id":"c9c8c07687c1bcd3","type":"comment","z":"60d15080ad880ed5","name":"Send to subflow","info":"","x":820,"y":800,"wires":[]},{"id":"405cc909fae99d9e","type":"debug","z":"60d15080ad880ed5","name":"2","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1170,"y":700,"wires":[]},{"id":"ecf585a68fd38734","type":"debug","z":"60d15080ad880ed5","name":"1","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":210,"y":700,"wires":[]},{"id":"cdedcc37df6c93eb","type":"debug","z":"60d15080ad880ed5","name":"4","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2050,"y":700,"wires":[]},{"id":"b4a9eaa2f2ec29a7","type":"debug","z":"60d15080ad880ed5","name":"3","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2090,"y":660,"wires":[]},{"id":"b157de1ed8d94494","type":"debug","z":"60d15080ad880ed5","name":"5","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2530,"y":700,"wires":[]},{"id":"4a67b311648353b8","type":"debug","z":"60d15080ad880ed5","name":"6","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3190,"y":680,"wires":[]},{"id":"40a542aa75e3c089","type":"debug","z":"60d15080ad880ed5","name":"7","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2950,"y":720,"wires":[]},{"id":"f51a64fec283f48b","type":"inject","z":"60d15080ad880ed5","name":"","props":[{"p":"topic","vt":"str"},{"p":"data","v":"{\"event_type\":\"state_changed\",\"entity_id\":\"binary_sensor.sensor_hotbox_exit_motion_occupancy\",\"event\":{\"entity_id\":\"binary_sensor.sensor_hotbox_exit_motion_occupancy\",\"old_state\":{\"entity_id\":\"binary_sensor.sensor_hotbox_exit_motion_occupancy\",\"state\":\"off\",\"attributes\":{\"battery\":100,\"device\":{\"applicationVersion\":11,\"dateCode\":\"20160524\",\"friendlyName\":\"sensor_hotbox_exit_motion\",\"hardwareVersion\":2,\"ieeeAddr\":\"0x00158d0002c087b5\",\"manufacturerID\":4151,\"manufacturerName\":\"LUMI\",\"model\":\"RTCGQ01LM\",\"networkAddress\":36543,\"powerSource\":\"Battery\",\"softwareBuildID\":\"3000-0001\",\"stackVersion\":2,\"type\":\"EndDevice\",\"zclVersion\":1},\"linkquality\":43,\"occupancy\":true,\"voltage\":3025,\"device_class\":\"motion\",\"friendly_name\":\"sensor_hotbox_exit_motion_occupancy\"},\"last_changed\":\"2022-07-26T20:23:59.903455+00:00\",\"last_updated\":\"2022-07-26T20:42:49.530541+00:00\",\"context\":{\"id\":\"01G8Y3YYSTXRNQ9ZF613DY6W5N\",\"parent_id\":null,\"user_id\":null},\"original_state\":\"off\"},\"new_state\":{\"entity_id\":\"binary_sensor.sensor_hotbox_exit_motion_occupancy\",\"state\":\"off\",\"attributes\":{\"battery\":100,\"device\":{\"applicationVersion\":11,\"dateCode\":\"20160524\",\"friendlyName\":\"sensor_hotbox_exit_motion\",\"hardwareVersion\":2,\"ieeeAddr\":\"0x00158d0002c087b5\",\"manufacturerID\":4151,\"manufacturerName\":\"LUMI\",\"model\":\"RTCGQ01LM\",\"networkAddress\":36543,\"powerSource\":\"Battery\",\"softwareBuildID\":\"3000-0001\",\"stackVersion\":2,\"type\":\"EndDevice\",\"zclVersion\":1},\"linkquality\":43,\"occupancy\":true,\"voltage\":3025,\"device_class\":\"motion\",\"friendly_name\":\"sensor_hotbox_exit_motion_occupancy\"},\"last_changed\":\"2022-07-26T20:42:49.530862+00:00\",\"last_updated\":\"2022-07-26T20:42:49.530862+00:00\",\"context\":{\"id\":\"01G8Y3YYSTC5JNKK4JCEF1WQNQ\",\"parent_id\":null,\"user_id\":null},\"original_state\":\"on\",\"timeSinceChangedMs\":9}},\"origin\":\"LOCAL\",\"time_fired\":\"2022-07-26T20:42:49.530862+00:00\",\"context\":{\"id\":\"01G8Y3YYSTC5JNKK4JCEF1WQNQ\",\"parent_id\":null,\"user_id\":null}}","vt":"json"},{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"binary_sensor.sensor_hotbox_exit_motion_occupancy","payload":"off","payloadType":"str","x":870,"y":700,"wires":[["ecf585a68fd38734"]]},{"id":"0e0e624ef3ca7559","type":"inject","z":"60d15080ad880ed5","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"12345","payloadType":"str","x":430,"y":1300,"wires":[["efd8d877e675377d"]]},{"id":"efd8d877e675377d","type":"function","z":"60d15080ad880ed5","name":"function 1","func":"var number = msg.payload;   // Change this \"msg.payload\" to whatever you need\n\nvar number_end = (number / 1000).toFixed(1);\n\n\nvar msg = {\n    \"payload\": {\n        \"number\": number_end\n    }\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":620,"y":1300,"wires":[["0cdd0984f0759061"]]},{"id":"7b6d6c071c02feaa","type":"api-current-state","z":"4c06c8ed0ae6cd3a","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.closet_light","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":910,"y":1040,"wires":[["b2cc201ce7d93a24","843b152df3fd16c3"],["ee6f732d52d3f87b","839ec6067a62723a"]]},{"id":"dbac23d83b18d71d","type":"trigger","z":"4c06c8ed0ae6cd3a","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"1","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":640,"y":1040,"wires":[["7b6d6c071c02feaa"]]},{"id":"b2cc201ce7d93a24","type":"api-call-service","z":"4c06c8ed0ae6cd3a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.closet_light"],"data":"{\"brightness_pct\":\"5\"}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1290,"y":1220,"wires":[[]]},{"id":"ee6f732d52d3f87b","type":"api-call-service","z":"4c06c8ed0ae6cd3a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.closet_light"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1290,"y":1320,"wires":[[]]},{"id":"e5ebd0d13ff07f57","type":"switch","z":"4c06c8ed0ae6cd3a","name":"command?","property":"payload.action","propertyType":"msg","rules":[{"t":"eq","v":"brightness_step_up","vt":"str"},{"t":"neq","v":"toggle","vt":"str"},{"t":"eq","v":"toggle","vt":"str"}],"checkall":"false","repair":false,"outputs":3,"x":630,"y":1000,"wires":[[],["2ce09a9e6d23c8fd"],["dbac23d83b18d71d"]]},{"id":"fd9a15bf92fc4af1","type":"trigger","z":"4c06c8ed0ae6cd3a","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"150","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":460,"y":1000,"wires":[["e5ebd0d13ff07f57"]]},{"id":"ba2f301894e3cfd9","type":"mqtt in","z":"4c06c8ed0ae6cd3a","name":"","topic":"zigbee2mqtt/remote_ikea_dial","qos":"2","datatype":"json","broker":"21000c19b97da572","nl":false,"rap":true,"rh":0,"inputs":0,"x":220,"y":1000,"wires":[[]]},{"id":"aef63c48ead2f381","type":"debug","z":"4c06c8ed0ae6cd3a","name":"1","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1610,"y":300,"wires":[]},{"id":"f0f52ec250251253","type":"server-state-changed","z":"4c06c8ed0ae6cd3a","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.sensor_closet_motion_occupancy","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":350,"y":140,"wires":[[],[]]},{"id":"80e331e552bec617","type":"api-current-state","z":"4c06c8ed0ae6cd3a","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.sleeper_in_closet","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":840,"y":140,"wires":[["572745650b062d88"],[]]},{"id":"ebf3dd616e52000c","type":"api-call-service","z":"4c06c8ed0ae6cd3a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.closet_light"],"data":"{\"brightness\":\"20\"}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1510,"y":140,"wires":[[]]},{"id":"843b152df3fd16c3","type":"api-call-service","z":"4c06c8ed0ae6cd3a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.sleeper_in_closet"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1320,"y":1260,"wires":[["487e61867289e0bb"]]},{"id":"839ec6067a62723a","type":"api-call-service","z":"4c06c8ed0ae6cd3a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_on","areaId":[],"deviceId":[],"entityId":["input_boolean.sleeper_in_closet"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1320,"y":1360,"wires":[["312565ca602f6614"]]},{"id":"a599848a5b2bc90c","type":"trigger","z":"4c06c8ed0ae6cd3a","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"2","extend":true,"overrideDelay":false,"units":"hr","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1690,"y":1360,"wires":[["2d0ab3cea791ef9d"]]},{"id":"2d0ab3cea791ef9d","type":"api-call-service","z":"4c06c8ed0ae6cd3a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.sleeper_in_closet"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1920,"y":1360,"wires":[[]]},{"id":"907868de85e8b0b7","type":"switch","z":"4c06c8ed0ae6cd3a","name":"Command","property":"payload.action","propertyType":"msg","rules":[{"t":"eq","v":"brightness_move_up","vt":"str"},{"t":"eq","v":"brightness_stop","vt":"str"},{"t":"eq","v":"brightness_move_down","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":2030,"y":460,"wires":[["51f0d1556635cc88","9d6febe7abc5f9db"],["20cac4b86b0ce36c","5bd79ecd04999197"],["c791a7a5c0111cfe","8c172670f821a1e1"]]},{"id":"34e56cdbc7fb21ca","type":"api-call-service","z":"4c06c8ed0ae6cd3a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.closet_light"],"data":"{\"brightness_step_pct\":10}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2490,"y":380,"wires":[[]]},{"id":"91047739409819b5","type":"api-call-service","z":"4c06c8ed0ae6cd3a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.closet_light"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2510,"y":320,"wires":[[]]},{"id":"b82bff5ada1ef21d","type":"api-current-state","z":"4c06c8ed0ae6cd3a","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.closet_light","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"state","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":1990,"y":280,"wires":[["017820a86f50f563"],[]]},{"id":"017820a86f50f563","type":"switch","z":"4c06c8ed0ae6cd3a","name":"Brightness","property":"state.attributes.brightness","propertyType":"msg","rules":[{"t":"lt","v":"5","vt":"num"},{"t":"gte","v":"5","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":2270,"y":280,"wires":[["edba2d6e15d82649"],["91047739409819b5"]]},{"id":"edba2d6e15d82649","type":"api-call-service","z":"4c06c8ed0ae6cd3a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.closet_light"],"data":"{\"brightness_step_pct\":-10}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2510,"y":260,"wires":[[]]},{"id":"51f0d1556635cc88","type":"trigger","z":"4c06c8ed0ae6cd3a","name":"","op1":"","op2":"1","op1type":"pay","op2type":"str","duration":"-2","extend":true,"overrideDelay":false,"units":"s","reset":"brightness_stop","bytopic":"all","topic":"topic","outputs":1,"x":2300,"y":380,"wires":[["34e56cdbc7fb21ca"]]},{"id":"20cac4b86b0ce36c","type":"change","z":"4c06c8ed0ae6cd3a","name":"command","rules":[{"t":"move","p":"payload.action","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2300,"y":420,"wires":[["51f0d1556635cc88"]]},{"id":"9d6febe7abc5f9db","type":"trigger","z":"4c06c8ed0ae6cd3a","name":"","op1":"","op2":"brightness_stop","op1type":"nul","op2type":"str","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"brightness_stop","bytopic":"all","topic":"topic","outputs":1,"x":2080,"y":380,"wires":[["51f0d1556635cc88"]]},{"id":"dcc6698e2396cf6c","type":"api-call-service","z":"4c06c8ed0ae6cd3a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.closet_light"],"data":"{\"brightness_step_pct\":-10}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2510,"y":540,"wires":[[]]},{"id":"8c172670f821a1e1","type":"trigger","z":"4c06c8ed0ae6cd3a","name":"","op1":"","op2":"1","op1type":"pay","op2type":"str","duration":"-2","extend":true,"overrideDelay":false,"units":"s","reset":"brightness_stop","bytopic":"all","topic":"topic","outputs":1,"x":2300,"y":540,"wires":[["dcc6698e2396cf6c"]]},{"id":"5bd79ecd04999197","type":"change","z":"4c06c8ed0ae6cd3a","name":"command","rules":[{"t":"move","p":"payload.action","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2300,"y":500,"wires":[["8c172670f821a1e1"]]},{"id":"c791a7a5c0111cfe","type":"trigger","z":"4c06c8ed0ae6cd3a","name":"","op1":"","op2":"brightness_stop","op1type":"nul","op2type":"str","duration":"5","extend":true,"overrideDelay":false,"units":"s","reset":"brightness_stop","bytopic":"all","topic":"topic","outputs":1,"x":2100,"y":540,"wires":[["8c172670f821a1e1"]]},{"id":"572745650b062d88","type":"api-current-state","z":"4c06c8ed0ae6cd3a","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.closet_light","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":1190,"y":140,"wires":[["ebf3dd616e52000c"],[]]},{"id":"684e57334c32f25c","type":"trigger","z":"4c06c8ed0ae6cd3a","name":"","op1":"","op2":"brightness_stop","op1type":"nul","op2type":"str","duration":"45","extend":false,"overrideDelay":false,"units":"min","reset":"on","bytopic":"all","topic":"topic","outputs":1,"x":710,"y":220,"wires":[["dd6bac848f0129b7"]]},{"id":"dd6bac848f0129b7","type":"api-call-service","z":"4c06c8ed0ae6cd3a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.closet_light"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":970,"y":220,"wires":[[]]},{"id":"c60f946ed34bb660","type":"api-call-service","z":"4c06c8ed0ae6cd3a","name":"Orange Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.closet_light"],"data":"{\"color_name\":\"orange\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"sentdata","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1420,"y":760,"wires":[["c97045cf92a2ec4a"]]},{"id":"5eccd74808436b11","type":"api-call-service","z":"4c06c8ed0ae6cd3a","name":"Cyan Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.closet_light"],"data":"{\"color_name\":\"cyan\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"sentdata","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1410,"y":800,"wires":[["c97045cf92a2ec4a"]]},{"id":"b3bda182ed3f015d","type":"inject","z":"4c06c8ed0ae6cd3a","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":460,"y":780,"wires":[["0594e94b4362bc25"]]},{"id":"c8cf794ae5c22a06","type":"api-call-service","z":"4c06c8ed0ae6cd3a","name":"Blue Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.closet_light"],"data":"{\"color_name\":\"blue\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"sentdata","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1400,"y":640,"wires":[["c97045cf92a2ec4a"]]},{"id":"91554ba55e4d7b1b","type":"api-call-service","z":"4c06c8ed0ae6cd3a","name":"Red lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.closet_light"],"data":"{\"color_name\":\"red\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"sentdata","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1410,"y":680,"wires":[["c97045cf92a2ec4a"]]},{"id":"efb1bb401b4184a0","type":"switch","z":"4c06c8ed0ae6cd3a","name":"","property":"number","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"str"},{"t":"eq","v":"2","vt":"str"},{"t":"eq","v":"3","vt":"str"},{"t":"eq","v":"4","vt":"str"},{"t":"eq","v":"5","vt":"str"},{"t":"eq","v":"6","vt":"str"}],"checkall":"true","repair":false,"outputs":6,"x":1250,"y":740,"wires":[["1f4c0a17245d25b8"],["c8cf794ae5c22a06"],["91554ba55e4d7b1b"],["dd36efc110ebf85c"],["c60f946ed34bb660"],["5eccd74808436b11"]]},{"id":"1f4c0a17245d25b8","type":"api-call-service","z":"4c06c8ed0ae6cd3a","name":"Purple lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.closet_light"],"data":"{\"color_name\":\"purple\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"sentdata","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1400,"y":600,"wires":[["c97045cf92a2ec4a"]]},{"id":"dd36efc110ebf85c","type":"api-call-service","z":"4c06c8ed0ae6cd3a","name":"GReen Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.closet_light"],"data":"{\"color_name\":\"green\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"sentdata","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1410,"y":720,"wires":[["c97045cf92a2ec4a"]]},{"id":"0594e94b4362bc25","type":"random","z":"4c06c8ed0ae6cd3a","name":"","low":1,"high":"6","inte":"true","property":"number","x":580,"y":820,"wires":[["d3c4dfebd4f830e6","c92f239aba21f19d"]]},{"id":"2ce09a9e6d23c8fd","type":"change","z":"4c06c8ed0ae6cd3a","name":"command","rules":[{"t":"move","p":"payload.brightness","pt":"msg","to":"payload.data.brightness","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":940,"y":1000,"wires":[["6d7494951e4421f0","31f6ddf7a86f4c72"]]},{"id":"6d7494951e4421f0","type":"switch","z":"4c06c8ed0ae6cd3a","name":"BRightness","property":"payload.data.brightness","propertyType":"msg","rules":[{"t":"lt","v":"2","vt":"num"},{"t":"lt","v":"35","vt":"num"},{"t":"gte","v":"35","vt":"num"}],"checkall":"false","repair":false,"outputs":3,"x":1410,"y":920,"wires":[["4b682645551bd7df"],["257d7ac36afa93cb"],["57f09ab968622a66"]]},{"id":"31f6ddf7a86f4c72","type":"debug","z":"4c06c8ed0ae6cd3a","name":"1","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1359,"y":871,"wires":[]},{"id":"4b682645551bd7df","type":"change","z":"4c06c8ed0ae6cd3a","name":"command","rules":[{"t":"delete","p":"payload.data","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1560,"y":860,"wires":[["7ae88f6bdcd5420f"]]},{"id":"57f09ab968622a66","type":"api-call-service","z":"4c06c8ed0ae6cd3a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.closet_light"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1750,"y":960,"wires":[["84c73e592ed30e44"]]},{"id":"7ae88f6bdcd5420f","type":"trigger","z":"4c06c8ed0ae6cd3a","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"1","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1720,"y":860,"wires":[["f23954372958c893"]]},{"id":"84c73e592ed30e44","type":"debug","z":"4c06c8ed0ae6cd3a","name":"2","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1990,"y":960,"wires":[]},{"id":"f23954372958c893","type":"api-call-service","z":"4c06c8ed0ae6cd3a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.closet_light"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1890,"y":860,"wires":[[]]},{"id":"81cdcfababe07e8d","type":"debug","z":"4c06c8ed0ae6cd3a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1690,"y":1240,"wires":[]},{"id":"487e61867289e0bb","type":"change","z":"4c06c8ed0ae6cd3a","name":"set reset","rules":[{"t":"set","p":"reset","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1520,"y":1240,"wires":[["81cdcfababe07e8d","a599848a5b2bc90c","cbb9bb05e2f00ab4"]]},{"id":"312565ca602f6614","type":"api-current-state","z":"4c06c8ed0ae6cd3a","name":"M sleep","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.maxi_sleeping","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":1520,"y":1360,"wires":[["a599848a5b2bc90c"],["cbb9bb05e2f00ab4"]]},{"id":"cbb9bb05e2f00ab4","type":"trigger","z":"4c06c8ed0ae6cd3a","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"10","extend":true,"overrideDelay":false,"units":"hr","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1710,"y":1320,"wires":[["2d0ab3cea791ef9d"]]},{"id":"d3c4dfebd4f830e6","type":"debug","z":"4c06c8ed0ae6cd3a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":820,"y":920,"wires":[]},{"id":"db83093bce98fb78","type":"change","z":"4c06c8ed0ae6cd3a","name":"","rules":[{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":610,"y":920,"wires":[["0594e94b4362bc25"]]},{"id":"257d7ac36afa93cb","type":"change","z":"4c06c8ed0ae6cd3a","name":"command","rules":[{"t":"delete","p":"payload.data","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1580,"y":900,"wires":[["16b97a3c58d98e53"]]},{"id":"16b97a3c58d98e53","type":"trigger","z":"4c06c8ed0ae6cd3a","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"1","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1740,"y":900,"wires":[["da01e08e99d9b83f"]]},{"id":"da01e08e99d9b83f","type":"api-call-service","z":"4c06c8ed0ae6cd3a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.closet_light"],"data":"{ \"brightness_pct\": 3}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1910,"y":900,"wires":[[]]},{"id":"c92f239aba21f19d","type":"api-current-state","z":"4c06c8ed0ae6cd3a","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.closet_light","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"closet","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":790,"y":760,"wires":[["bd1459417cc4d9f7","060c4e135a3502be"]]},{"id":"bd1459417cc4d9f7","type":"debug","z":"4c06c8ed0ae6cd3a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1030,"y":800,"wires":[]},{"id":"060c4e135a3502be","type":"change","z":"4c06c8ed0ae6cd3a","name":"set brigthness","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"move","p":"closet.attributes.brightness","pt":"msg","to":"payload.data.brightness","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1080,"y":700,"wires":[["efb1bb401b4184a0"]]},{"id":"c97045cf92a2ec4a","type":"api-call-service","z":"4c06c8ed0ae6cd3a","name":"change brightness","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.closet_light"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"sentdata","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1684.765625,"y":688.75,"wires":[[]]},{"id":"8c1eb44e6440c341","type":"debug","z":"4c06c8ed0ae6cd3a","name":"1","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":510,"y":360,"wires":[]},{"id":"db8ae70dfe3eae80","type":"debug","z":"4c06c8ed0ae6cd3a","name":"2","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":690,"y":380,"wires":[]},{"id":"cc2a470e6ecee657","type":"debug","z":"4c06c8ed0ae6cd3a","name":"3","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":890,"y":380,"wires":[]},{"id":"09bd894bedfb8e67","type":"debug","z":"4c06c8ed0ae6cd3a","name":"4","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1170,"y":380,"wires":[]},{"id":"3c01f84c7e767c18","type":"mqtt in","z":"4c06c8ed0ae6cd3a","name":"","topic":"zigbee2mqtt/remote_closet_dial","qos":"2","datatype":"json","broker":"21000c19b97da572","nl":false,"rap":true,"rh":0,"inputs":0,"x":270,"y":1700,"wires":[["7dc9855f3b94a40c","a825d14aebb8eb2a"]]},{"id":"7dc9855f3b94a40c","type":"change","z":"4c06c8ed0ae6cd3a","name":"","rules":[{"t":"set","p":"action","pt":"msg","to":"payload.action","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":580,"y":1700,"wires":[["995d47e79655efdf"]]},{"id":"a825d14aebb8eb2a","type":"debug","z":"4c06c8ed0ae6cd3a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":580,"y":1580,"wires":[]},{"id":"3f16ba71fc7db4c0","type":"inject","z":"4c06c8ed0ae6cd3a","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":660,"y":1780,"wires":[[]]},{"id":"995d47e79655efdf","type":"switch","z":"4c06c8ed0ae6cd3a","name":"","property":"action","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":810,"y":1680,"wires":[["32ecd318141cebb7","01f51f2bb482a57b","f42df09cf81a05d6"]]},{"id":"01f51f2bb482a57b","type":"trigger","z":"4c06c8ed0ae6cd3a","name":"","op1":"1","op2":"","op1type":"num","op2type":"nul","duration":"100","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1040,"y":1780,"wires":[["b150b2fd99485e41"]]},{"id":"f42df09cf81a05d6","type":"switch","z":"4c06c8ed0ae6cd3a","name":"","property":"action","propertyType":"msg","rules":[{"t":"eq","v":"play_pause","vt":"str"},{"t":"eq","v":"skip_forward","vt":"str"},{"t":"eq","v":"skip_backward","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":1230,"y":1660,"wires":[[],["4d52d1bb540328a4"],["a1818de053b71ffa"]]},{"id":"32ecd318141cebb7","type":"debug","z":"4c06c8ed0ae6cd3a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1130,"y":1580,"wires":[]},{"id":"b150b2fd99485e41","type":"switch","z":"4c06c8ed0ae6cd3a","name":"","property":"action","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1110,"y":1860,"wires":[["b2960ecf1922266c","c8db5e3d19f6eef6"]]},{"id":"56e55a83088d50ba","type":"api-call-service","z":"4c06c8ed0ae6cd3a","name":"light up 5%","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["{\"step_pct\": 5}"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1440,"y":1540,"wires":[[]]},{"id":"36d8b0028f06bbe4","type":"api-call-service","z":"4c06c8ed0ae6cd3a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_down","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1500,"y":1640,"wires":[[]]},{"id":"a1818de053b71ffa","type":"api-call-service","z":"4c06c8ed0ae6cd3a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"media_next_track","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1470,"y":1720,"wires":[[]]},{"id":"b2960ecf1922266c","type":"switch","z":"4c06c8ed0ae6cd3a","name":"","property":"action","propertyType":"msg","rules":[{"t":"eq","v":"rotate_right","vt":"str"},{"t":"eq","v":"play_pause","vt":"str"},{"t":"eq","v":"rotate_left","vt":"str"},{"t":"eq","v":"skip_forward","vt":"str"},{"t":"eq","v":"skip_backward","vt":"str"}],"checkall":"true","repair":false,"outputs":5,"x":1230,"y":1860,"wires":[["3b72699ded6b61d9"],["f7eda6633323c646"],["3068948f4b3467eb"],[],[]]},{"id":"c8db5e3d19f6eef6","type":"debug","z":"4c06c8ed0ae6cd3a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1190,"y":1980,"wires":[]},{"id":"3b72699ded6b61d9","type":"api-call-service","z":"4c06c8ed0ae6cd3a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.group_closet_lights"],"data":"{\"brightness_step_pct\": 10}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1410,"y":1820,"wires":[[]]},{"id":"3068948f4b3467eb","type":"api-call-service","z":"4c06c8ed0ae6cd3a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.group_closet_lights"],"data":"{\"brightness_step_pct\": -10}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1410,"y":1900,"wires":[[]]},{"id":"bbaba3b210a0f53b","type":"debug","z":"4c06c8ed0ae6cd3a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":440,"y":2180,"wires":[]},{"id":"4d52d1bb540328a4","type":"change","z":"4c06c8ed0ae6cd3a","name":"","rules":[{"t":"delete","p":"payload","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1790,"y":1660,"wires":[["85690ffd6e52b00d"]]},{"id":"85690ffd6e52b00d","type":"random","z":"4c06c8ed0ae6cd3a","name":"","low":1,"high":"6","inte":"true","property":"number","x":1760,"y":1560,"wires":[["7e635c2eab326e5b","cc18bd4f81c17e59"]]},{"id":"0d12271b391e4827","type":"inject","z":"4c06c8ed0ae6cd3a","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1640,"y":1520,"wires":[["85690ffd6e52b00d"]]},{"id":"7e635c2eab326e5b","type":"debug","z":"4c06c8ed0ae6cd3a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2000,"y":1660,"wires":[]},{"id":"cc18bd4f81c17e59","type":"api-current-state","z":"4c06c8ed0ae6cd3a","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.group_closet_lights","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"closet","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":2030,"y":1480,"wires":[["ce18b6b507ab5cfd","7a09e8c006de7ab2"]]},{"id":"ce18b6b507ab5cfd","type":"debug","z":"4c06c8ed0ae6cd3a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2160,"y":1400,"wires":[]},{"id":"7a09e8c006de7ab2","type":"change","z":"4c06c8ed0ae6cd3a","name":"set brigthness","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"move","p":"closet.attributes.brightness","pt":"msg","to":"payload.data.brightness","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2240,"y":1520,"wires":[["324bc4e6549dec38"]]},{"id":"324bc4e6549dec38","type":"switch","z":"4c06c8ed0ae6cd3a","name":"","property":"number","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"str"},{"t":"eq","v":"2","vt":"str"},{"t":"eq","v":"3","vt":"str"},{"t":"eq","v":"4","vt":"str"},{"t":"eq","v":"5","vt":"str"},{"t":"eq","v":"6","vt":"str"}],"checkall":"true","repair":false,"outputs":6,"x":2370,"y":1440,"wires":[["e97828ac4dbec867"],["ee33e623b574114d"],["5792f42728ac5e89"],["969803b63d99fe8f"],["6dac8e4c26f742ea"],["69d4fa574755bb02"]]},{"id":"e97828ac4dbec867","type":"api-call-service","z":"4c06c8ed0ae6cd3a","name":"Purple lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.group_closet_lights"],"data":"{\"color_name\":\"purple\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"sentdata","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2580,"y":1340,"wires":[["c9a2b3aeee2612d5"]]},{"id":"ee33e623b574114d","type":"api-call-service","z":"4c06c8ed0ae6cd3a","name":"Blue Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.group_closet_lights"],"data":"{\"color_name\":\"blue\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"sentdata","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2580,"y":1380,"wires":[["c9a2b3aeee2612d5"]]},{"id":"5792f42728ac5e89","type":"api-call-service","z":"4c06c8ed0ae6cd3a","name":"Red lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.group_closet_lights"],"data":"{\"color_name\":\"red\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"sentdata","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2590,"y":1420,"wires":[["c9a2b3aeee2612d5"]]},{"id":"969803b63d99fe8f","type":"api-call-service","z":"4c06c8ed0ae6cd3a","name":"GReen Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.group_closet_lights"],"data":"{\"color_name\":\"green\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"sentdata","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2590,"y":1460,"wires":[["c9a2b3aeee2612d5"]]},{"id":"6dac8e4c26f742ea","type":"api-call-service","z":"4c06c8ed0ae6cd3a","name":"Orange Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.group_closet_lights"],"data":"{\"color_name\":\"orange\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"sentdata","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2600,"y":1500,"wires":[["c9a2b3aeee2612d5"]]},{"id":"69d4fa574755bb02","type":"api-call-service","z":"4c06c8ed0ae6cd3a","name":"Cyan Lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.group_closet_lights"],"data":"{\"color_name\":\"cyan\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"sentdata","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2590,"y":1540,"wires":[["c9a2b3aeee2612d5"]]},{"id":"c9a2b3aeee2612d5","type":"api-call-service","z":"4c06c8ed0ae6cd3a","name":"change brightness","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.group_closet_lights"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"sentdata","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2864.765625,"y":1428.75,"wires":[[]]},{"id":"f7eda6633323c646","type":"trigger","z":"4c06c8ed0ae6cd3a","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"1","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1200,"y":2080,"wires":[["05b60f5777abdfca"]]},{"id":"05b60f5777abdfca","type":"api-current-state","z":"4c06c8ed0ae6cd3a","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.group_closet_lights","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":1490,"y":2080,"wires":[["e42bcd3af9de7220","65ba8e701610d795"],["5b436a531aa1ebf5","a0a1f3a7308e92bc"]]},{"id":"e42bcd3af9de7220","type":"api-call-service","z":"4c06c8ed0ae6cd3a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.group_closet_lights"],"data":"{\"brightness_pct\":\"5\"}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1850,"y":2260,"wires":[[]]},{"id":"65ba8e701610d795","type":"api-call-service","z":"4c06c8ed0ae6cd3a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.sleeper_in_closet"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1880,"y":2300,"wires":[["5312b878ddb7dd70"]]},{"id":"5b436a531aa1ebf5","type":"api-call-service","z":"4c06c8ed0ae6cd3a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.group_closet_lights"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1850,"y":2360,"wires":[[]]},{"id":"a0a1f3a7308e92bc","type":"api-call-service","z":"4c06c8ed0ae6cd3a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_on","areaId":[],"deviceId":[],"entityId":["input_boolean.sleeper_in_closet"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1880,"y":2400,"wires":[["d9d90da421754842"]]},{"id":"5312b878ddb7dd70","type":"change","z":"4c06c8ed0ae6cd3a","name":"set reset","rules":[{"t":"set","p":"reset","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2080,"y":2280,"wires":[["cbe49e28817528f4","e50edc606f4b3752","910e7019c045e484"]]},{"id":"d9d90da421754842","type":"api-current-state","z":"4c06c8ed0ae6cd3a","name":"M sleep","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.maxi_sleeping","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":2080,"y":2400,"wires":[["e50edc606f4b3752"],["910e7019c045e484"]]},{"id":"cbe49e28817528f4","type":"debug","z":"4c06c8ed0ae6cd3a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2250,"y":2280,"wires":[]},{"id":"e50edc606f4b3752","type":"trigger","z":"4c06c8ed0ae6cd3a","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"2","extend":true,"overrideDelay":false,"units":"hr","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2250,"y":2400,"wires":[["9e8663b34fc2683f"]]},{"id":"910e7019c045e484","type":"trigger","z":"4c06c8ed0ae6cd3a","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"10","extend":true,"overrideDelay":false,"units":"hr","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2270,"y":2360,"wires":[["9e8663b34fc2683f"]]},{"id":"9e8663b34fc2683f","type":"api-call-service","z":"4c06c8ed0ae6cd3a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.sleeper_in_closet"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2480,"y":2400,"wires":[[]]},{"id":"428e553c6425dd45","type":"comment","z":"4c06c8ed0ae6cd3a","name":"","info":"","x":120,"y":140,"wires":[]},{"id":"562c3e7be8873386","type":"comment","z":"4c06c8ed0ae6cd3a","name":"","info":"","x":160,"y":1720,"wires":[]},{"id":"8b49904f52f9bb6e","type":"comment","z":"4c06c8ed0ae6cd3a","name":"","info":"","x":160,"y":1020,"wires":[]},{"id":"66655583bb656d0b","type":"api-call-service","z":"af76f8fdc5fbe12b","name":"light.kitchen_lights, ","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.group_kitchen_lights"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1110,"y":1400,"wires":[[]]},{"id":"6ab781e7219e4930","type":"server-state-changed","z":"af76f8fdc5fbe12b","name":"PHone notifications","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.phone_fold3_last_notification","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"milliseconds","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":110,"y":1640,"wires":[["7dbdd3975fff13f2","9ff030971cfb87bb"]]},{"id":"7dbdd3975fff13f2","type":"switch","z":"af76f8fdc5fbe12b","name":"facebook?","property":"data.new_state.attributes.package","propertyType":"msg","rules":[{"t":"eq","v":"com.facebook.orca","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":310,"y":1640,"wires":[["9ff030971cfb87bb","3dc965452c97b69d"]]},{"id":"e36b2e9dd44a9ab9","type":"api-call-service","z":"af76f8fdc5fbe12b","name":"Waitng = on","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_on","areaId":[],"deviceId":[],"entityId":["input_boolean.waiting_someone"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1150,"y":2840,"wires":[["11ebdf39fe582916"]]},{"id":"08964d4a1673ade2","type":"api-current-state","z":"af76f8fdc5fbe12b","name":"AM I home?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"home","halt_if_type":"str","halt_if_compare":"is","entity_id":"person.maxi","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":610,"y":1640,"wires":[["4812e2866bb6ad10"],["4812e2866bb6ad10"]]},{"id":"11ebdf39fe582916","type":"trigger","z":"af76f8fdc5fbe12b","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"80","extend":false,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1350,"y":2840,"wires":[["0d7ba1a7f2716b26"]]},{"id":"0d7ba1a7f2716b26","type":"api-call-service","z":"af76f8fdc5fbe12b","name":"Waitng = off","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.waiting_someone"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1510,"y":2840,"wires":[[]]},{"id":"9ff030971cfb87bb","type":"debug","z":"af76f8fdc5fbe12b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":260,"y":1540,"wires":[]},{"id":"4812e2866bb6ad10","type":"function","z":"af76f8fdc5fbe12b","name":"","func":"var name = msg.data.new_state.attributes[\"android.title\"];\n\nvar newMsg = {\n \"payload\": {\n  \"data\": {\n  \"title\": \"Arrival in progress\",\n  \"message\": name + \" is on the way\",\n  \"data\": {\n    \"actions\": [\n      {\n        \"action\": \"wait_for_someone\",\n        \"title\": \"Welcome Them\"\n      },{\n        \"action\": \"wait_and_add\",\n        \"title\": \"Welcome and Register\"\n      }\n                \n    ]\n  }\n}\n }\n};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":520,"y":1600,"wires":[["fb03d4a43f80503d"]]},{"id":"b363fc9a44556f50","type":"inject","z":"af76f8fdc5fbe12b","name":"","props":[{"p":"data","v":"{\"entity_id\":\"sensor.sm_f926w_last_notification\",\"old_state\":{\"entity_id\":\"sensor.sm_f926w_last_notification\",\"state\":\"On my way\",\"attributes\":{\"android.appInfo\":\"ApplicationInfo{2e79110 com.facebook.orca}\",\"android.car.EXTENSIONS\":\"Bundle[mParcelledData.dataSize=1476]\",\"android.conversationUnreadMessageCount\":0,\"android.hiddenConversationTitle\":\"null\",\"android.infoText\":\"null\",\"android.isGroupConversation\":false,\"android.largeIcon\":\"Icon(typ=BITMAP size=95x95)\",\"android.messages\":\"[Landroid.os.Parcelable;@d2bd409\",\"android.messagingStyleUser\":\"Bundle[mParcelledData.dataSize=184]\",\"android.messagingUser\":\"android.app.Person@5f10cd3d\",\"android.progress\":0,\"android.progressIndeterminate\":false,\"android.progressMax\":0,\"android.reduced.images\":true,\"android.remoteInputHistory\":\"null\",\"android.selfDisplayName\":\"Maximiliano Pena-Roig\",\"android.showChronometer\":false,\"android.showWhen\":true,\"android.subText\":\"null\",\"android.template\":\"android.app.Notification$MessagingStyle\",\"android.text\":\"On my way\",\"android.title\":\"Belier Blanc Propre\",\"android.wearable.EXTENSIONS\":\"Bundle[mParcelledData.dataSize=1420]\",\"androidx.core.app.extra.COMPAT_TEMPLATE\":\"androidx.core.app.NotificationCompat$MessagingStyle\",\"is_clearable\":true,\"is_ongoing\":false,\"package\":\"com.facebook.orca\",\"post_time\":1634802661028,\"friendly_name\":\"SM-F926W Last Notification\",\"icon\":\"mdi:bell-ring\"},\"last_changed\":\"2021-10-21T07:51:02.062089+00:00\",\"last_updated\":\"2021-10-21T07:51:02.062089+00:00\",\"context\":{\"id\":\"f7ab1680e058b88d6fa2e921317e8e62\",\"parent_id\":null,\"user_id\":null},\"original_state\":\"On my way\"},\"new_state\":{\"entity_id\":\"sensor.sm_f926w_last_notification\",\"state\":\"J'arrive\",\"attributes\":{\"android.appInfo\":\"ApplicationInfo{f1c3f23 com.facebook.orca}\",\"android.car.EXTENSIONS\":\"Bundle[mParcelledData.dataSize=948]\",\"android.conversationUnreadMessageCount\":0,\"android.hiddenConversationTitle\":\"null\",\"android.infoText\":\"null\",\"android.isGroupConversation\":false,\"android.largeIcon\":\"Icon(typ=BITMAP size=95x95)\",\"android.messages\":\"[Landroid.os.Parcelable;@255bc20\",\"android.messagingStyleUser\":\"Bundle[mParcelledData.dataSize=184]\",\"android.messagingUser\":\"android.app.Person@5f10cd3d\",\"android.progress\":0,\"android.progressIndeterminate\":false,\"android.progressMax\":0,\"android.reduced.images\":true,\"android.remoteInputHistory\":\"null\",\"android.selfDisplayName\":\"Maximiliano Pena-Roig\",\"android.showChronometer\":false,\"android.showWhen\":true,\"android.subText\":\"null\",\"android.template\":\"android.app.Notification$MessagingStyle\",\"android.text\":\"J'arrive\",\"android.title\":\"Belier Blanc Propre\",\"android.wearable.EXTENSIONS\":\"Bundle[mParcelledData.dataSize=852]\",\"androidx.core.app.extra.COMPAT_TEMPLATE\":\"androidx.core.app.NotificationCompat$MessagingStyle\",\"is_clearable\":true,\"is_ongoing\":false,\"package\":\"com.facebook.orca\",\"post_time\":1634802939806,\"friendly_name\":\"SM-F926W Last Notification\",\"icon\":\"mdi:bell-ring\"},\"last_changed\":\"2021-10-21T07:55:41.091083+00:00\",\"last_updated\":\"2021-10-21T07:55:41.091083+00:00\",\"context\":{\"id\":\"cb081ffb32417545c6a9ece2c5e5f0d2\",\"parent_id\":null,\"user_id\":null},\"original_state\":\"J'arrive\",\"timeSinceChangedMs\":9}}","vt":"json"},{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"j'arrive","payloadType":"str","x":2090,"y":1480,"wires":[["7dbdd3975fff13f2"]]},{"id":"fb03d4a43f80503d","type":"api-call-service","z":"af76f8fdc5fbe12b","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"mobile_app_phone_fold3","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":760,"y":1560,"wires":[[]]},{"id":"a132b9fe6df63fa5","type":"server-events","z":"af76f8fdc5fbe12b","name":"","server":"7ab5c227.a3ce8c","version":2,"eventType":"mobile_app_notification_action","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"waitForRunning":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"},{"property":"event_type","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"}],"x":870,"y":2840,"wires":[["f5942b8e3f6e071d","099b012d3987e7c8"]]},{"id":"f5942b8e3f6e071d","type":"debug","z":"af76f8fdc5fbe12b","name":"actionable","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1010,"y":2800,"wires":[]},{"id":"099b012d3987e7c8","type":"switch","z":"af76f8fdc5fbe12b","name":"wait_for_someone","property":"payload.event.action","propertyType":"msg","rules":[{"t":"eq","v":"wait_for_someone","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1030,"y":2880,"wires":[["e36b2e9dd44a9ab9"]]},{"id":"c293a526f635d416","type":"server-events","z":"af76f8fdc5fbe12b","name":"","server":"7ab5c227.a3ce8c","version":2,"eventType":"mobile_app_notification_action","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"waitForRunning":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"},{"property":"event_type","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"}],"x":730,"y":1800,"wires":[["ad742bfc62fbc44e","d142eb1c7275bcfb"]]},{"id":"ad742bfc62fbc44e","type":"debug","z":"af76f8fdc5fbe12b","name":"actionable 1","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":870,"y":1760,"wires":[]},{"id":"d142eb1c7275bcfb","type":"switch","z":"af76f8fdc5fbe12b","name":"wait_and_add","property":"payload.event.action","propertyType":"msg","rules":[{"t":"eq","v":"wait_and_add","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":880,"y":1840,"wires":[["9fa562ad48c0b0f9","da7d5f149d23ca54"]]},{"id":"f53de9b97bebc4e0","type":"switch","z":"af76f8fdc5fbe12b","name":"Enter Image URL","property":"payload.event.action_1_title","propertyType":"msg","rules":[{"t":"eq","v":"Enter URL","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1890,"y":1620,"wires":[["ae3f55097fb0e689","fd81cb384523c376"]]},{"id":"a8f4e18f77c80e04","type":"debug","z":"af76f8fdc5fbe12b","name":"actionable 4","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1750,"y":1480,"wires":[]},{"id":"ae3f55097fb0e689","type":"function","z":"af76f8fdc5fbe12b","name":"extract url + set command","func":"var urltemp = msg.payload.event.reply_text;\nvar urlarray = urltemp.split(\"?\");\nvar url = urlarray[0];\n\nvar pathname = url.slice(66);  // OLD METHOD\n\nvar spliturl = url.split(\"/\"); // NEW METHOD\nvar pathname1 = spliturl[spliturl.length - 1]; // NEW METHOD\n\n\n\n\n\n\nvar newMsg = {\n\t\"payload\": {\n\t    \"url\": urltemp,\n\t    \"path\": pathname1\n\t    \n\t},\n\t\"command\": \"wget -O /mnt/double-take/portraits/facebook/\" + pathname1 + \" \" + \"\\'\" +  urltemp + \"\\'\"\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2190,"y":1620,"wires":[["981f9a452a0e6558","17a78e99ceca77c4","43a556c55f461002"]]},{"id":"c62f1b3e88f5a1e8","type":"api-call-service","z":"af76f8fdc5fbe12b","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"mobile_app_phone_fold3","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1120,"y":1900,"wires":[[]]},{"id":"9fa562ad48c0b0f9","type":"function","z":"af76f8fdc5fbe12b","name":"Javascript Name","func":"var nametemp = msg.payload.event.message;\nname = nametemp.slice(0, -13); \n\n\nvar newMsg = {\n\t\"payload\": {\n\t\t\"data\": {\n\t\t\t\"message\": name +\" Name Registration\",\n\t\t\t\"title\": \"Arrival Registration Name\",\n\t\t\t\"data\": {\n\t\t\t\t\"actions\": [{\n\t\t\t\t\t\t\"action\": \"REPLY\",\n\t\t\t\t\t\t\"title\": \"Enter Name\"\n\t\t\t\t\t}\n\n\t\t\t\t]\n\t\t\t}\n\t\t}\n\t}\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":850,"y":1900,"wires":[["c62f1b3e88f5a1e8"]]},{"id":"018243403d2c8262","type":"server-events","z":"af76f8fdc5fbe12b","name":"","server":"7ab5c227.a3ce8c","version":2,"eventType":"mobile_app_notification_action","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"waitForRunning":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"},{"property":"event_type","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"}],"x":1310,"y":1680,"wires":[["f7cc4bc222578a5e","a8f4e18f77c80e04"]]},{"id":"061b19cc69710102","type":"debug","z":"af76f8fdc5fbe12b","name":"actionable 4","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1930,"y":2020,"wires":[]},{"id":"f7cc4bc222578a5e","type":"switch","z":"af76f8fdc5fbe12b","name":"","property":"payload.event.action","propertyType":"msg","rules":[{"t":"eq","v":"REPLY","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1590,"y":1680,"wires":[["d1fe8052c35ad61e"]]},{"id":"d1fe8052c35ad61e","type":"switch","z":"af76f8fdc5fbe12b","name":"Enter Name","property":"payload.event.action_1_title","propertyType":"msg","rules":[{"t":"eq","v":"Enter Name","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1730,"y":1680,"wires":[["21ed8812414437ef","8b90c337c13e4471"]]},{"id":"c05b59e95a408a54","type":"function","z":"af76f8fdc5fbe12b","name":"Javascript","func":"var d = new Date();\nvar m = d.getMilliseconds();\nvar url = msg.payload.finalpath;\n\n\n\nvar newMsg = {\n \"name\": msg.payload.name,\n \"url\": \"http://192.168.0.14:3000/api/train/retrain/\" + msg.payload.name.toLowerCase(),\n \"data\":{\n    \"data\":{\n\t\"file_path\": url,\n\t\"name\": msg.payload.name.toLowerCase(),\n\t\"url\": \"http://192.168.0.14:3000/api/train/retrain/\" + msg.payload.name.toLowerCase()\n}}\n};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3180,"y":1660,"wires":[["56764a8fbd4bce10"]]},{"id":"ed0b58e7122a02d3","type":"debug","z":"af76f8fdc5fbe12b","name":"command block","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3100,"y":1600,"wires":[]},{"id":"56764a8fbd4bce10","type":"http request","z":"af76f8fdc5fbe12b","name":"POST request","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","senderr":false,"headers":[],"x":3340,"y":1660,"wires":[["f9c4b12b961ca510","90c6903cef67da07"]]},{"id":"6915773e668366cf","type":"debug","z":"af76f8fdc5fbe12b","name":"result of snapchot","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2550,"y":2220,"wires":[]},{"id":"f9c4b12b961ca510","type":"debug","z":"af76f8fdc5fbe12b","name":"POST RETURN","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3480,"y":1600,"wires":[]},{"id":"51e76360e71a590d","type":"function","z":"af76f8fdc5fbe12b","name":"Javascript","func":"var d = new Date();\nvar m = d.getMilliseconds();\nvar url = msg.data.data.file_path;\n\n\nvar snapshot = \"https://hass.purgatoire.ca/local/nodered/latest.jpg\";\n\nvar newMsg = {\n \"payload\": {\n  \"data\": {\n  \"message\": \"Faces learning for\" + \" \" + msg.name,\n  \"data\": {\n    \"image\": snapshot\n  }\n}\n }\n};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3680,"y":1660,"wires":[["9ba84809a91a9a8e","860cf8fa69444e44"]]},{"id":"9ba84809a91a9a8e","type":"api-call-service","z":"af76f8fdc5fbe12b","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"notify","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3880,"y":1660,"wires":[["860cf8fa69444e44"]]},{"id":"860cf8fa69444e44","type":"debug","z":"af76f8fdc5fbe12b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3890,"y":1620,"wires":[]},{"id":"da7d5f149d23ca54","type":"api-call-service","z":"af76f8fdc5fbe12b","name":"Waitng = on","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_on","areaId":[],"deviceId":[],"entityId":["input_boolean.waiting_someone"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1090,"y":1840,"wires":[["f0ffce0ecbe57b3b"]]},{"id":"f0ffce0ecbe57b3b","type":"trigger","z":"af76f8fdc5fbe12b","name":"","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"80","extend":true,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1270,"y":1840,"wires":[["444b076bf7c1a3bc"]]},{"id":"444b076bf7c1a3bc","type":"api-call-service","z":"af76f8fdc5fbe12b","name":"Waitng = off","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.waiting_someone"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1450,"y":1840,"wires":[[]]},{"id":"981f9a452a0e6558","type":"exec","z":"af76f8fdc5fbe12b","command":"","addpay":"command","append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"","x":2390,"y":1560,"wires":[[],[],["afb6acc94d2f26f1"]]},{"id":"afb6acc94d2f26f1","type":"debug","z":"af76f8fdc5fbe12b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2510,"y":1560,"wires":[]},{"id":"8a0e418ab1f5d71b","type":"debug","z":"af76f8fdc5fbe12b","name":"url","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2790,"y":1860,"wires":[]},{"id":"fd81cb384523c376","type":"debug","z":"af76f8fdc5fbe12b","name":"Enter Image URL","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2010,"y":1560,"wires":[]},{"id":"6e283815fb340ed5","type":"debug","z":"af76f8fdc5fbe12b","name":"Enter Name","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2390,"y":1780,"wires":[]},{"id":"3a6867d3cd383509","type":"api-call-service","z":"af76f8fdc5fbe12b","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"mobile_app_phone_fold3","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2140,"y":1720,"wires":[[]]},{"id":"21ed8812414437ef","type":"function","z":"af76f8fdc5fbe12b","name":"Javascript URL","func":"var nametemp = msg.payload.event.message;\nnamesliced = nametemp.slice(0, -18); \nname = namesliced.trim();\n\n\nvar newMsg = {\n\t\"payload\": {\n\t\t\"data\": {\n\t\t\t\"message\": name +\" URL Registration\",\n\t\t\t\"title\": \"Arrival Registration URL\",\n\t\t\t\"data\": {\n\t\t\t\t\"actions\": [{\n\t\t\t\t\t\t\"action\": \"REPLY\",\n\t\t\t\t\t\t\"title\": \"Enter URL\"\n\t\t\t\t\t}\n\n\t\t\t\t]\n\t\t\t}\n\t\t}\n\t}\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1900,"y":1720,"wires":[["3a6867d3cd383509"]]},{"id":"1cb4da1396d7cfab","type":"server-events","z":"af76f8fdc5fbe12b","name":"","server":"7ab5c227.a3ce8c","version":2,"eventType":"mobile_app_notification_action","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"waitForRunning":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"},{"property":"event_type","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"}],"x":1630,"y":1620,"wires":[["f53de9b97bebc4e0"]]},{"id":"8b90c337c13e4471","type":"function","z":"af76f8fdc5fbe12b","name":"Extract name","func":"var name = msg.payload.event.reply_text.trim();\n\n\nvar newMsg = {\n\t\"payload\": {\n\t\t\"name\": name\n\t}\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2210,"y":1680,"wires":[["6e283815fb340ed5","d308c21ff0f1210a"]]},{"id":"d308c21ff0f1210a","type":"join","z":"af76f8fdc5fbe12b","name":"","mode":"custom","build":"merged","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":" 600","count":"2","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":2530,"y":1660,"wires":[["1d3a78d1ab841e38","2e4b6431b9fcb188"]]},{"id":"1d3a78d1ab841e38","type":"debug","z":"af76f8fdc5fbe12b","name":"Joined","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2670,"y":1920,"wires":[]},{"id":"17a78e99ceca77c4","type":"debug","z":"af76f8fdc5fbe12b","name":"command","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2400,"y":1600,"wires":[]},{"id":"43a556c55f461002","type":"trigger","z":"af76f8fdc5fbe12b","name":"","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"3","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2390,"y":1640,"wires":[["d308c21ff0f1210a"]]},{"id":"ac37daae526dff9c","type":"inject","z":"af76f8fdc5fbe12b","name":"","props":[{"p":"command","v":"mkdir /mnt/double-take/portraits/steven | rm /mnt/homeassistant/nodered/latest.jpg | cp /mnt/double-take/portraits/facebook/13220998_10209522579010166_4388796869278787967_n.jpg /mnt/homeassistant/nodered/latest.jpg | mv /mnt/double-take/portraits/facebook/13220998_10209522579010166_4388796869278787967_n.jpg /mnt/double-take/portraits/steven/","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":2270,"y":1460,"wires":[["981f9a452a0e6558"]]},{"id":"74206209be0ef161","type":"exec","z":"af76f8fdc5fbe12b","command":"","addpay":"command","append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"","x":2910,"y":1600,"wires":[[],[],["ed0b58e7122a02d3"]]},{"id":"a4fbaaa95e292860","type":"function","z":"af76f8fdc5fbe12b","name":"extract url + command","func":"var name = msg.payload.name;\nvar path = msg.payload.path;\nvar finalpath =  \"/mnt/double-take/portraits/facebook/\" + name.toLowerCase() + \"/\" + path\nvar newMsg = {\n\t\"command\": \"mkdir /mnt/double-take/portraits/\" + name.toLowerCase() + \" | rm /mnt/homeassistant/nodered/latest.jpg | \" + \"cp /mnt/double-take/portraits/facebook/\" + path + \" /mnt/homeassistant/nodered/latest.jpg \"  +  \"| mv /mnt/double-take/portraits/facebook/\" + path + \" \"  + \"/mnt/double-take/portraits/\" + name.toLowerCase() + \"/\",\n\t\"payload\": { \n\t    name: name,\n\t    path: path,\n\t    finalpath: finalpath\n\t} \n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2840,"y":1660,"wires":[["74206209be0ef161","8a0e418ab1f5d71b","33d3d16ceb2d6444"]]},{"id":"33d3d16ceb2d6444","type":"trigger","z":"af76f8fdc5fbe12b","name":"","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"3","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":3040,"y":1660,"wires":[["c05b59e95a408a54"]]},{"id":"3dc965452c97b69d","type":"switch","z":"af76f8fdc5fbe12b","name":"regex","property":"payload","propertyType":"msg","rules":[{"t":"regex","v":"(je pars|omw|on my way|j'arrive|m'en viens|men viens|jarrive|be right there| i am coming|be there soon)","vt":"str","case":true}],"checkall":"true","repair":false,"outputs":1,"x":450,"y":1640,"wires":[["08964d4a1673ade2"]]},{"id":"2e4b6431b9fcb188","type":"switch","z":"af76f8fdc5fbe12b","name":"","property":"payload.path","propertyType":"msg","rules":[{"t":"nnull"},{"t":"null"}],"checkall":"true","repair":false,"outputs":2,"x":2660,"y":1660,"wires":[["a4fbaaa95e292860"],["cce9a9640cee5063"]]},{"id":"cce9a9640cee5063","type":"function","z":"af76f8fdc5fbe12b","name":"Notif Setter","func":"var newMsg = {\n \"payload\": {\n  \"data\": {\n  \"message\": \"No URL provided for\" + \" \" + msg.payload.name\n}\n }\n};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2830,"y":1720,"wires":[["057753a54d140765"]]},{"id":"057753a54d140765","type":"api-call-service","z":"af76f8fdc5fbe12b","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"notify","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3020,"y":1720,"wires":[[]]},{"id":"90c6903cef67da07","type":"switch","z":"af76f8fdc5fbe12b","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"num"},{"t":"neq","v":"200","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":3510,"y":1660,"wires":[["51e76360e71a590d"],["91cf9426b56087c7"]]},{"id":"91cf9426b56087c7","type":"function","z":"af76f8fdc5fbe12b","name":"Javascript","func":"var d = new Date();\nvar m = d.getMilliseconds();\nvar url = msg.data.data.file_path;\n\n\nvar snapshot = url.replace(\"\\/config\\/www\",\"https:\\/\\/hass.purgatoire.ca\\/local\");\n\nvar newMsg = {\n \"payload\": {\n  \"data\": {\n  \"message\": \"Faces learning for\" + \" \" + msg.name + \" entountered a problem\",\n  \"data\": {\n    \"image\": snapshot\n  }\n}\n }\n};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3680,"y":1740,"wires":[["c6e901335b2f6d64"]]},{"id":"c6e901335b2f6d64","type":"api-call-service","z":"af76f8fdc5fbe12b","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"notify","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3880,"y":1740,"wires":[[]]},{"id":"b680bdf8f4435e71","type":"inject","z":"af76f8fdc5fbe12b","name":"","props":[{"p":"command","v":"wget 'https://scontent.fymy1-1.fna.fbcdn.net/v/t1.6435-9/fr/cp0/e15/q65/80524747_2828438077202436_9206619164729409536_n.jpg?_nc_cat=109&ccb=1-5&_nc_sid=7aed08&efg=eyJpIjoidCJ9&_nc_ohc=AOTjGnNDSiwAX9fTK2d&_nc_ht=scontent.fymy1-1.fna&oh=edc3289d840defc4304f9effb981f41a&oe=61932591' -P /mnt/double-take/portraits/facebook","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","x":2730,"y":1500,"wires":[["74206209be0ef161"]]},{"id":"29e83831f00501fe","type":"server-events","z":"af76f8fdc5fbe12b","name":"","server":"7ab5c227.a3ce8c","version":2,"eventType":"zha_event","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"waitForRunning":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"}],"x":150,"y":2700,"wires":[["3272ab99814f1923","d6381403021c339c"]]},{"id":"3272ab99814f1923","type":"switch","z":"af76f8fdc5fbe12b","name":"payload.event.device_ieee","property":"payload.event.device_ieee","propertyType":"msg","rules":[{"t":"eq","v":"0c:43:14:ff:fe:a5:54:08","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":380,"y":2700,"wires":[[]]},{"id":"d6381403021c339c","type":"debug","z":"af76f8fdc5fbe12b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":310,"y":2660,"wires":[]},{"id":"c907406a0a55438d","type":"bigtimer","z":"af76f8fdc5fbe12b","outtopic":"","outpayload1":"1","outpayload2":"","name":"Big Timer","comment":"","lat":0,"lon":0,"starttime":"1320","endtime":"1335","starttime2":"1350","endtime2":"1365","startoff":0,"endoff":0,"startoff2":0,"endoff2":0,"offs":0,"outtext1":"","outtext2":"","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"day6":0,"month6":0,"day7":0,"month7":0,"day8":0,"month8":0,"day9":0,"month9":0,"day10":0,"month10":0,"day11":0,"month11":0,"day12":0,"month12":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"d6":0,"w6":0,"xday1":0,"xmonth1":0,"xday2":0,"xmonth2":0,"xday3":0,"xmonth3":0,"xday4":0,"xmonth4":0,"xday5":0,"xmonth5":0,"xday6":0,"xmonth6":0,"xday7":"","xmonth7":"","xday8":"","xmonth8":"","xday9":"","xmonth9":"","xday10":"","xmonth10":"","xday11":"","xmonth11":"","xday12":"","xmonth12":"","xd1":0,"xw1":0,"xd2":0,"xw2":0,"xd3":0,"xw3":0,"xd4":0,"xw4":0,"xd5":0,"xw5":0,"xd6":0,"xw6":0,"suspend":false,"random":false,"randon1":false,"randoff1":false,"randon2":false,"randoff2":false,"repeat":true,"atstart":true,"odd":false,"even":false,"x":280,"y":3080,"wires":[["1b0a24639bd3d80b"],[],[]]},{"id":"c99bc6a52fcb5a39","type":"api-current-state","z":"af76f8fdc5fbe12b","name":"Monday","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"0","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.recycling_day","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":560,"y":3060,"wires":[["95319a406576817b"],[]]},{"id":"f833442fb4e6ba27","type":"api-current-state","z":"af76f8fdc5fbe12b","name":"Thursday","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"0","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.trash_day","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":560,"y":3120,"wires":[["75c25bff4cbc96c9"],[]]},{"id":"1b0a24639bd3d80b","type":"trigger","z":"af76f8fdc5fbe12b","name":"trigger","op1":"1","op2":"","op1type":"str","op2type":"nul","duration":"20","extend":false,"units":"min","reset":"","bytopic":"all","outputs":1,"x":430,"y":3080,"wires":[["c99bc6a52fcb5a39","f833442fb4e6ba27"]]},{"id":"95319a406576817b","type":"change","z":"af76f8fdc5fbe12b","name":"Recycle","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"message","pt":"msg","to":"It's time to recycle!","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":940,"y":3040,"wires":[["2d29fa42b8775aac"]]},{"id":"7a69818a6ceefdb4","type":"cast-to-client","z":"af76f8fdc5fbe12b","name":"","url":"","contentType":"audio","message":"It's time to recycle!","language":"en","ip":"192.168.0.37","port":"","volume":"55","x":970,"y":3080,"wires":[[]]},{"id":"75c25bff4cbc96c9","type":"change","z":"af76f8fdc5fbe12b","name":"Trash","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"message","pt":"msg","to":"It's trash time!","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":3120,"wires":[["2d29fa42b8775aac"]]},{"id":"6b385b1ac27ba669","type":"inject","z":"af76f8fdc5fbe12b","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":370,"y":2980,"wires":[["1b0a24639bd3d80b"]]},{"id":"2d29fa42b8775aac","type":"subflow:233ac7dcd801a802","z":"af76f8fdc5fbe12b","name":"","x":1230,"y":3080,"wires":[]},{"id":"4e4b5512c415ba1d","type":"debug","z":"af76f8fdc5fbe12b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"count","targetType":"msg","statusVal":"","statusType":"auto","x":1480,"y":2200,"wires":[]},{"id":"8bf23ccb46ee2df5","type":"comment","z":"af76f8fdc5fbe12b","name":"","info":"","x":560,"y":1800,"wires":[]},{"id":"01a2c104062f94ef","type":"comment","z":"af76f8fdc5fbe12b","name":"","info":"","x":60,"y":1640,"wires":[]},{"id":"1d3e0b619d5adb3d","type":"comment","z":"af76f8fdc5fbe12b","name":"","info":"","x":220,"y":3020,"wires":[]},{"id":"05fec2b668a6fbb5","type":"comment","z":"af76f8fdc5fbe12b","name":"","info":"","x":720,"y":2840,"wires":[]},{"id":"e3a3ae9d2537c03e","type":"server-state-changed","z":"dd89857c15f353c7","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.remote_doorbell_button_action","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"None","halt_if_type":"str","halt_if_compare":"is_not","outputs":2,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":true,"ignorePrevStateUnknown":true,"ignorePrevStateUnavailable":true,"ignoreCurrentStateUnknown":true,"ignoreCurrentStateUnavailable":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":300,"y":520,"wires":[[],[]]},{"id":"911f051bb678cd1b","type":"debug","z":"dd89857c15f353c7","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2910,"y":160,"wires":[]},{"id":"5339f9d4e1b48ed7","type":"server-state-changed","z":"dd89857c15f353c7","name":"Doorbell","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.remote_doorbell_button_action","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"None","halt_if_type":"str","halt_if_compare":"is_not","outputs":2,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":true,"ignorePrevStateUnknown":true,"ignorePrevStateUnavailable":true,"ignoreCurrentStateUnknown":true,"ignoreCurrentStateUnavailable":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":80,"y":1480,"wires":[["59f49b000db10ed9"],[]]},{"id":"59f49b000db10ed9","type":"trigger","z":"dd89857c15f353c7","name":"20s Cooldown","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"2","extend":false,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":240,"y":1480,"wires":[["f0ad81c29d51bce5","a8f19ee85e24054c"]]},{"id":"a8f19ee85e24054c","type":"api-call-service","z":"dd89857c15f353c7","name":"Turn on Door Rang","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_on","areaId":[],"deviceId":[],"entityId":["input_boolean.door_rang"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":450,"y":1520,"wires":[["9d0699203619db9f"]]},{"id":"9d0699203619db9f","type":"ha-wait-until","z":"dd89857c15f353c7","name":"Wait for door to lock","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"lock.lock_front_door","entityIdFilterType":"exact","property":"state","comparator":"is","value":"locked","valueType":"str","timeout":"60","timeoutType":"num","timeoutUnits":"seconds","checkCurrentState":false,"blockInputOverrides":true,"outputProperties":[],"x":660,"y":1520,"wires":[["717675b89a8e5a53"],["717675b89a8e5a53"]]},{"id":"717675b89a8e5a53","type":"api-call-service","z":"dd89857c15f353c7","name":"Turn off \"Door rang\"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.door_rang"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":880,"y":1520,"wires":[[]]},{"id":"3d6f34f957597508","type":"function","z":"dd89857c15f353c7","name":"Double take URL set","func":"// SETTINGS\nvar cameraurl = \"http://192.168.0.15:8123\" + msg.data.attributes.entity_picture;\n// SETTINGS\n\n  var test = {\n   \t\"payload\":  {\n\t\t\"url\": \"http://192.168.0.14:3000/api/recognize?url=\" + cameraurl + \"&camera=camera.facecam\"\n   \t},\n   \t\"url\": \"http://192.168.0.14:3000/api/recognize?url=\" + cameraurl + \"&camera=camera.facecam\"\n  };\n  return test;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":100,"y":840,"wires":[[]]},{"id":"12d39ed3c0fd5f25","type":"api-current-state","z":"dd89857c15f353c7","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"0","halt_if_type":"num","halt_if_compare":"gt","entity_id":"sensor.double_take_facecam","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":910,"y":1480,"wires":[["177471418c06f764"],["e2c29f7712b2d101"]]},{"id":"3c28784c1321d67d","type":"function","z":"dd89857c15f353c7","name":"Face Extractor compare 10.4","func":"var matches = msg.data.attributes.matches;\n//-----------------------------------------\nvar today = new Date();\nvar dd = String(today.getDate()).padStart(2, '0');\nvar hh = today.getHours();\nvar month = String(today.getMonth() + 1).padStart(2, '0');\nvar minutes = today.getMinutes();\nvar yyyy = today.getFullYear();\nvar today = yyyy + '-' + month  + '-' + dd + '---' + hh + minutes;\n\n//-----------------------------------------\n\nif ( matches.length > 0){\nmatches.sort(({confidence:a}, {confidence:b}) => b-a);\nvar highest_match = matches[0];\n\n\nvar newMsg = {\n\t\"payload\": {\n\t\t\"matches\": matches,\n\t\t\"highest_match\": highest_match ,\n\t\t\"image_url\": \"http://192.168.0.14:3000/api/storage/matches/\" + highest_match.filename,\n\t\t\"save_path\": \"/mnt/hass/\" + highest_match.name + \"/\" + today + \"---\" + highest_match.confidence + \".jpg\",\n\t\t\"confidence\": highest_match.confidence\n\t}\n}\n\nreturn newMsg;\n\n}\nelse {\n\nvar newMsg = {\n\t\"payload\": {\n\t\t\"matches\": \"none\"}}\n\nreturn newMsg; \n\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1760,"y":1400,"wires":[["e5da28d1a2c6e1c8","7a3e943cd0c65032"]]},{"id":"f0ad81c29d51bce5","type":"api-current-state","z":"dd89857c15f353c7","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"0","halt_if_type":"num","halt_if_compare":"gt","entity_id":"sensor.double_take_front_door","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":530,"y":1480,"wires":[["2b2e4a2f72d68f73","9b5bc74d89ac6854"],["12d39ed3c0fd5f25"]]},{"id":"84982b380a3a869b","type":"debug","z":"dd89857c15f353c7","name":"debug 2","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1960,"y":1580,"wires":[]},{"id":"8b0da6d89e41b31e","type":"function","z":"dd89857c15f353c7","name":"Face Extractor compare 10.0","func":"// SETTINGS\nvar required_conf = 80;\n// SETTINGS\n\n\nvar recoface = new Object();\nvar recofacesortable = [];\nvar name = \"\";\nvar camera = \"\";\nvar conf = \"\";\nvar reconame = \"\";\nvar recognized = 69;\nvar confidence = \"\";\nvar reco = \"\";\nvar recognized_confidently = 0;\n//declarations\n\n    for (i = 0; i < msg.data.attributes.matches.length; i++){\n         for (y = 0; y < Object.keys(msg.data.attributes.matches[i]).length; y++){\n                var name = msg.data.attributes.matches[i][y][0];\n \t\t\t\tvar conf = msg.data.attributes.matches[i][y][1];\n \t\t\t\tvar camera = msg.data.attributes.matches[i][y][2];\n \t\t\t// \tif (conf > 0){\n \t\t\t\t    recofacesortable.push([name, conf, camera]);\n \t\t\t// \t}\n \t\t\t\t\n        }\n    }\n    var recomsg = {\n\t\"payload\": {\n\t\t\"recofacesortable\": recofacesortable\n\t}\n};\n\nreturn recomsg;\n    \n     \trecofacesortable.sort(function(a, b) {\n \t\treturn a[1] - b[1];\n \t}).reverse();\n \t\n\n    for (i = 0; i < recofacesortable.length; i++){\n        var reconame = recofacesortable[0][0];\n        var confidence = recofacesortable[0][1]\n        var camera = recofacesortable[0][2]\n        \n        \n    }\n\n\nif (confidence > required_conf) {\n\tvar recognized_confidently = 1;\n}\n\nif (confidence != \"\") {\n\tvar recognized = 1;\n} else if (confidence == \"\") {\n    var recognized = 0;\n} else { \n var recognized = \"bugging\";\n    \n}\n\n if (camera == \"camera.front_door\"){\n     var camera = \"camera.reolink_static\";\n } else if (camera == \"camera.facecam\"){\n     var camera = \"camera.facecam_static\"\n }\n\nvar newMsg = {\n\t\"payload\": {\n\t\t\"name\": reconame,\n\t\t\"confidence\": confidence,\n\t//\t\"matched_faces\": total_matched_faces,\n\t//\t\"total_faces\": total_faces,\n\t\t\"recognized_confidently\": recognized_confidently,\n\t\t\"recognized\": recognized,\n \t\t\"camera\": camera \n\t}\n};\n\nreturn newMsg;\n\n\n//  var test = {\n//  \t\"payload\": {\n// \t\t\"name\": reconame,\n// \t\t\"confidence\": confidence,\n// \t\t\"matched_faces\": total_matched_faces,\n// \t\t\"total_faces\": total_faces,\n// \t\t\"recognized\": recognized,\n// \t\t\"camera\": camera ,\n// \t\t\"recofacesortable\": recofacesortable\n//  \t}\n//  };\n//  return test;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":120,"y":760,"wires":[[]]},{"id":"2b2e4a2f72d68f73","type":"debug","z":"dd89857c15f353c7","name":"debug 1","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":760,"y":1300,"wires":[]},{"id":"5945b7bdeca6f1f1","type":"debug","z":"dd89857c15f353c7","name":"debug 3","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2000,"y":1760,"wires":[]},{"id":"5775b7cccd31e62b","type":"api-call-service","z":"dd89857c15f353c7","name":"Save Facecam Ring.jpg For Debug","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"camera","service":"snapshot","areaId":[],"deviceId":[],"entityId":["camera.facecam"],"data":"{\"filename\":\"/config/www/ring.jpg\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":900,"y":1100,"wires":[[]]},{"id":"4e0625ca602e7a8f","type":"api-call-service","z":"dd89857c15f353c7","name":"Save Reolink.jpgFor Debug","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"camera","service":"snapshot","areaId":[],"deviceId":[],"entityId":["camera.front_door"],"data":"{\"filename\":\"/config/www/reolink.jpg\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":880,"y":1140,"wires":[[]]},{"id":"9fb469eeb7720250","type":"http request","z":"dd89857c15f353c7","name":"[POST] Recognize Double-Take","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","authType":"","senderr":false,"headers":[],"x":1870,"y":920,"wires":[[]]},{"id":"d73bf749ab740a63","type":"comment","z":"dd89857c15f353c7","name":"Doorbell pressed","info":"","x":100,"y":1440,"wires":[]},{"id":"a6bc5667c6639558","type":"comment","z":"dd89857c15f353c7","name":"20 seconds cooldown","info":"","x":480,"y":1200,"wires":[]},{"id":"e3254a08ffcbaea5","type":"comment","z":"dd89857c15f353c7","name":"Is double-take-front-door seeing someone?","info":"","x":520,"y":1440,"wires":[]},{"id":"41b845b86c3c5d99","type":"comment","z":"dd89857c15f353c7","name":"Is double-take-facecam seeing someone?","info":"","x":1040,"y":1060,"wires":[]},{"id":"614f12eee2c671d3","type":"inject","z":"dd89857c15f353c7","name":"1","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"1","payloadType":"num","x":270,"y":1440,"wires":[["f0ad81c29d51bce5"]]},{"id":"123f5ee375252c85","type":"inject","z":"dd89857c15f353c7","name":"Maxi at door","props":[{"p":"payload"},{"p":"data","v":"{\"entity_id\":\"sensor.double_take_front_door\",\"state\":\"3\",\"attributes\":{\"id\":\"1659459685.953183-1shuyf\",\"duration\":3.53,\"timestamp\":\"2022-08-02T17:01:31.497Z\",\"attempts\":11,\"camera\":\"front_door\",\"zones\":[\"entrance\",\"faceshot_zone\"],\"misses\":[{\"name\":\"alphonso\",\"confidence\":79.16,\"match\":false,\"box\":{\"top\":210,\"left\":529,\"width\":85,\"height\":105},\"checks\":[\"box area too low: 8925 < 10000\"],\"type\":\"latest\",\"duration\":0.21,\"detector\":\"deepstack\",\"filename\":\"bcfcd360-f639-45ef-97fa-2f68aa01d8eb.jpg\",\"base64\":null},{\"name\":\"maxi\",\"confidence\":75.7,\"match\":false,\"box\":{\"top\":212,\"left\":354,\"width\":62,\"height\":95},\"checks\":[\"box area too low: 5890 < 10000\"],\"type\":\"latest\",\"duration\":0.19,\"detector\":\"deepstack\",\"filename\":\"49e449d6-65e0-45c6-a21d-237a673b91da.jpg\",\"base64\":null}],\"matches\":[{\"name\":\"maxi\",\"confidence\":72.28,\"match\":true,\"box\":{\"top\":220,\"left\":244,\"width\":102,\"height\":104},\"type\":\"latest\",\"duration\":0.19,\"detector\":\"deepstack\",\"filename\":\"2a731787-cb90-4c90-bbc2-05e910f1576e.jpg\",\"base64\":null},{\"name\":\"nate\",\"confidence\":72.15,\"match\":true,\"box\":{\"top\":228,\"left\":203,\"width\":106,\"height\":98},\"type\":\"snapshot\",\"duration\":0.2,\"detector\":\"deepstack\",\"filename\":\"b5678550-20b0-4b04-a1b5-db4297d7a7ed.jpg\",\"base64\":null}],\"personCount\":3,\"icon\":\"mdi:camera\",\"friendly_name\":\"double_take_front_door\"},\"last_changed\":\"2022-08-02T17:01:31.518682+00:00\",\"last_updated\":\"2022-08-02T17:01:31.518682+00:00\",\"context\":{\"id\":\"01G9FR2RZYY9SBNXVSHJ5T9E0S\",\"parent_id\":null,\"user_id\":null},\"timeSinceChangedMs\":1499,\"original_state\":\"3\"}","vt":"json"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"sensor.remote_doorbell_button_action","payload":"3","payloadType":"num","x":1510,"y":1360,"wires":[["3c28784c1321d67d"]]},{"id":"4e6508dd082279dc","type":"inject","z":"dd89857c15f353c7","name":"Maxi recoed","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"matches\":[{\"name\":\"maxi\",\"confidence\":97.05,\"match\":true,\"box\":{\"top\":42,\"left\":6,\"width\":138,\"height\":171},\"type\":\"latest\",\"duration\":0,\"detector\":\"compreface\",\"filename\":\"248edd4f-c0e9-4060-88f5-ef9d9e36551d.jpg\",\"base64\":null}],\"highest_match\":{\"name\":\"maxi\",\"confidence\":97.05,\"match\":true,\"box\":{\"top\":42,\"left\":6,\"width\":138,\"height\":171},\"type\":\"latest\",\"duration\":0,\"detector\":\"compreface\",\"filename\":\"248edd4f-c0e9-4060-88f5-ef9d9e36551d.jpg\",\"base64\":null},\"image_url\":\"http://192.168.0.14:3000/api/storage/matches/248edd4f-c0e9-4060-88f5-ef9d9e36551d.jpg\"}","payloadType":"json","x":1810,"y":1480,"wires":[["84982b380a3a869b"]]},{"id":"2a6a536226e61940","type":"function","z":"dd89857c15f353c7","name":"Javascript","func":"var name = msg.payload.highest_match.name;\nvar url = msg.payload.save_path.replace(\"/mnt/hass\",\"https://hass.purgatoire.ca/local/nodered/\")\n\n\nvar newMsg = {\n\t\"payload\": {\n\t\t\"data\": {\n\t\t\t\"message\": \"Doorbell Alert\",\n\t\t\t\"title\": name + \" is at the door\",\n\t\t\t\"data\": {\n\t\t\t\t\"image\": url,\n\t\t\t\t\"actions\": [{\n\t\t\t\t\t\t\"action\": \"REPLY\",\n\t\t\t\t\t\t\"title\": \"Enter Text\"\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"action\": \"unlock_door\",\n\t\t\t\t\t\t\"title\": \"Unlock The Door\"\n\t\t\t\t\t}\n\n\t\t\t\t]\n\t\t\t}\n\t\t}\n\t}\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2280,"y":1500,"wires":[["58d1fd26ab7e5f70"]]},{"id":"58d1fd26ab7e5f70","type":"api-call-service","z":"dd89857c15f353c7","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"mobile_app_phone_galaxy_fold_4","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2490,"y":1440,"wires":[["e9e86f9f799dfc77","7e4a013511f695fb","a0c364c1923cfa06"]]},{"id":"32cedbc3a70263d5","type":"function","z":"dd89857c15f353c7","name":"Javascript","func":"var name = \"Someone\";\nvar url = \"https://hass.purgatoire.ca/local/reolinkring.jpg\";\nvar random = Date.now();\n\nvar newMsg = {\n\t\"payload\": {\n\t\t\"data\": {\n\t\t\t\"message\": \"Doorbell Alert\",\n\t\t\t\"title\": name + \" is at the door\",\n\t\t\t\"data\": {\n\t\t\t\t\"image\": url + \"?\" + random,\n\t\t\t\t\"actions\": [{\n\t\t\t\t\t\t\"action\": \"REPLY\",\n\t\t\t\t\t\t\"title\": \"Enter Text\"\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"action\": \"unlock_door\",\n\t\t\t\t\t\t\"title\": \"Unlock The Door\"\n\t\t\t\t\t}\n\n\t\t\t\t]\n\t\t\t}\n\t\t}\n\t}\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2120,"y":1300,"wires":[["ca897dec181fdc7d"]]},{"id":"ca897dec181fdc7d","type":"api-call-service","z":"dd89857c15f353c7","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"mobile_app_phone_galaxy_fold_4","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2370,"y":1300,"wires":[["3a18cd6f1cd00ffc","f415b56cb85073c5"]]},{"id":"97040eba8079d710","type":"comment","z":"dd89857c15f353c7","name":"LINK TO FIX DOORBELL","info":"","x":1450,"y":560,"wires":[]},{"id":"7e4a013511f695fb","type":"change","z":"dd89857c15f353c7","name":"Set Data for mass alert","rules":[{"t":"move","p":"payload.data.title","pt":"msg","to":"message","tot":"msg"},{"t":"set","p":"color_value","pt":"msg","to":"[0,0,255]","tot":"json"},{"t":"set","p":"dbrigthness","pt":"msg","to":"100","tot":"num"},{"t":"set","p":"video","pt":"msg","to":"on","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2820,"y":1460,"wires":[["e7bb87f2ce260b7c","085bae77e989c9f5"]]},{"id":"e7bb87f2ce260b7c","type":"subflow:233ac7dcd801a802","z":"dd89857c15f353c7","name":"","x":3050,"y":1460,"wires":[]},{"id":"e9e86f9f799dfc77","type":"debug","z":"dd89857c15f353c7","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2710,"y":1660,"wires":[]},{"id":"085bae77e989c9f5","type":"debug","z":"dd89857c15f353c7","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3010,"y":1400,"wires":[]},{"id":"e5da28d1a2c6e1c8","type":"debug","z":"dd89857c15f353c7","name":"debug 18","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1800,"y":1360,"wires":[]},{"id":"7a3e943cd0c65032","type":"switch","z":"dd89857c15f353c7","name":"Matches?","property":"payload.matches","propertyType":"msg","rules":[{"t":"eq","v":"none","vt":"str"},{"t":"nempty"}],"checkall":"false","repair":false,"outputs":2,"x":2000,"y":1400,"wires":[["5a9b99ad63b0e10d","c183cccda922e06d"],["2a6a536226e61940"]]},{"id":"2aafb5ed5fb7221d","type":"api-call-service","z":"dd89857c15f353c7","name":"Save Reolink.jpg for ingress","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"camera","service":"snapshot","areaId":[],"deviceId":[],"entityId":["camera.front_door"],"data":"{\"filename\":\"/config/www/reolink.jpg\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1160,"y":1540,"wires":[["de195cac02da5925"]]},{"id":"f415b56cb85073c5","type":"change","z":"dd89857c15f353c7","name":"Set Data for mass alert","rules":[{"t":"move","p":"payload.data.title","pt":"msg","to":"message","tot":"msg"},{"t":"set","p":"color_value","pt":"msg","to":"[0,0,255]","tot":"json"},{"t":"set","p":"dbrigthness","pt":"msg","to":"100","tot":"num"},{"t":"set","p":"video","pt":"msg","to":"on","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2720,"y":1300,"wires":[["74ae8cacb6d117d0"]]},{"id":"74ae8cacb6d117d0","type":"subflow:233ac7dcd801a802","z":"dd89857c15f353c7","name":"","x":2970,"y":1300,"wires":[]},{"id":"4dcbf0f53e16ca0a","type":"comment","z":"dd89857c15f353c7","name":"Save Reolink.jpg","info":"","x":1200,"y":1500,"wires":[]},{"id":"84c1917b4af61c0e","type":"comment","z":"dd89857c15f353c7","name":"No matches","info":"","x":2130,"y":1340,"wires":[]},{"id":"2d52e4dfe1464a83","type":"comment","z":"dd89857c15f353c7","name":"Matches over 85%","info":"","x":2790,"y":1560,"wires":[]},{"id":"3a9125b4093ed157","type":"api-current-state","z":"dd89857c15f353c7","name":"Acid time off","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.acid_time","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":3210,"y":1540,"wires":[["25f8feee00f8a4ca"],[]]},{"id":"813d47bcf5474aba","type":"api-current-state","z":"dd89857c15f353c7","name":"Front House Motion","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.motion_front","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"partyon","propertyType":"msg","value":"","valueType":"entityState"},{"property":"partydata","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":3270,"y":1460,"wires":[["25f8feee00f8a4ca"],[]]},{"id":"25f8feee00f8a4ca","type":"api-current-state","z":"dd89857c15f353c7","name":"kink off","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.kink_party","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":3400,"y":1540,"wires":[["92b9b19da0cc50b3","0cfa322e2f86ac01"],[]]},{"id":"cc9b4a03e1350d55","type":"api-current-state","z":"dd89857c15f353c7","name":"Waiting Friend?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.waiting_someone","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"partyon","propertyType":"msg","value":"","valueType":"entityState"},{"property":"partydata","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":3640,"y":1560,"wires":[["001784db32fff1e2"],[]]},{"id":"92b9b19da0cc50b3","type":"api-current-state","z":"dd89857c15f353c7","name":"Party on","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.party_mode","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":3540,"y":1500,"wires":[["8494a9adf85edace"],["9c935c7956118916"]]},{"id":"47f7f690aa57721a","type":"api-call-service","z":"dd89857c15f353c7","name":"unLock Door","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"lock","service":"unlock","areaId":[],"deviceId":[],"entityId":["lock.lock_front_door"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3950,"y":1540,"wires":[["9f712fd9a5e423d9","12255b636177e345"]]},{"id":"9f712fd9a5e423d9","type":"debug","z":"dd89857c15f353c7","name":"unlock","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":4090,"y":1500,"wires":[]},{"id":"12255b636177e345","type":"ha-wait-until","z":"dd89857c15f353c7","name":"","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"lock.lock_front_door","entityIdFilterType":"exact","property":"state","comparator":"is","value":"unlocked","valueType":"str","timeout":"2","timeoutType":"num","timeoutUnits":"minutes","checkCurrentState":true,"blockInputOverrides":true,"outputProperties":[],"x":4100,"y":1540,"wires":[["e6d464424eb269b3"],[]]},{"id":"e6d464424eb269b3","type":"api-call-service","z":"dd89857c15f353c7","name":"toggle boolean","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_on","areaId":[],"deviceId":[],"entityId":["input_boolean.face_recognized"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4260,"y":1540,"wires":[["6080d27c4c13a53e"]]},{"id":"6080d27c4c13a53e","type":"ha-wait-until","z":"dd89857c15f353c7","name":"","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"lock.lock_front_door","entityIdFilterType":"exact","property":"state","comparator":"is","value":"locked","valueType":"str","timeout":"30","timeoutType":"num","timeoutUnits":"seconds","checkCurrentState":true,"blockInputOverrides":true,"outputProperties":[],"x":4440,"y":1540,"wires":[["f21a81aa4f977386"],["f21a81aa4f977386"]]},{"id":"f21a81aa4f977386","type":"api-call-service","z":"dd89857c15f353c7","name":"toggle boolean","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.face_recognized","input_boolean.waiting_someone"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4620,"y":1540,"wires":[["b4db6f7962fed84e"]]},{"id":"9f08c99e58fab78f","type":"inject","z":"dd89857c15f353c7","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":4420,"y":1640,"wires":[["f21a81aa4f977386"]]},{"id":"b4db6f7962fed84e","type":"api-call-service","z":"dd89857c15f353c7","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"input_text","service":"set_value","areaId":[],"deviceId":[],"entityId":["input_text.recognized_face"],"data":" {             \"value\": \"UNKNOWN\"         }","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4830,"y":1540,"wires":[[]]},{"id":"001784db32fff1e2","type":"trigger","z":"dd89857c15f353c7","name":"1","op1":"1","op2":"","op1type":"num","op2type":"nul","duration":"2","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":3810,"y":1540,"wires":[["47f7f690aa57721a"]]},{"id":"cc3499d9e94623c4","type":"api-current-state","z":"dd89857c15f353c7","name":"Waiting Uber off","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.waiting_uber","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":3020,"y":1540,"wires":[["3a9125b4093ed157"],[]]},{"id":"8b8ab6894608285c","type":"api-call-service","z":"dd89857c15f353c7","name":"Save Ring.jpg for ingress","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"camera","service":"snapshot","areaId":[],"deviceId":[],"entityId":["camera.facecam"],"data":"{\"filename\":\"/config/www/ring.jpg\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1150,"y":1580,"wires":[["bba1e45017de6f51"]]},{"id":"bba1e45017de6f51","type":"http request","z":"dd89857c15f353c7","name":"POST request","method":"GET","ret":"obj","paytoqs":"ignore","url":"http://192.168.0.14:3000/api/recognize?url=http://192.168.0.15:8123/local/ring.jpg&camera=camera.facecam","tls":"","persist":false,"proxy":"","authType":"","senderr":false,"headers":[],"x":1380,"y":1580,"wires":[["46dfa9ffd07570ac"]]},{"id":"972f72dcf25a5390","type":"change","z":"dd89857c15f353c7","name":"Move matches","rules":[{"t":"move","p":"payload.matches","pt":"msg","to":"data.attributes.matches","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1680,"y":1560,"wires":[["5945b7bdeca6f1f1","3c28784c1321d67d"]]},{"id":"3ed2d0362f2fb2d4","type":"function","z":"dd89857c15f353c7","name":"Face Extractor compare 10.0","func":"var matches = msg.data.attributes.matches;\n//-----------------------------------------\nvar today = new Date();\nvar dd = String(today.getDate()).padStart(2, '0');\nvar hh = today.getHours();\nvar month = String(today.getMonth() + 1).padStart(2, '0');\nvar minutes = today.getMinutes();\nvar yyyy = today.getFullYear();\nvar today = yyyy + '-' + month  + '-' + dd + '---' + hh + minutes;\n\n//-----------------------------------------\n\nif ( matches.length > 0){\nmatches.sort(function(a, b) {return a[1] - b[1];}).reverse();\n\nvar highest_match = matches[0];\n\nif (highest_match.confidence > 85){\nvar newMsg = {\n\t\"payload\": {\n\t\t\"matches\": matches,\n\t\t\"highest_match\": highest_match ,\n\t\t\"image_url\": \"http://192.168.0.14:3000/api/storage/matches/\" + highest_match.filename,\n\t\t\"save_path\": \"/mnt/hass/\" + highest_match.name + \"/\" + today + \"---\" + highest_match.confidence + \".jpg\"\n\t}\n}\n\nreturn newMsg;\n} else {\n    var newMsg = {\n\t\"payload\": {\n\t\t\"matches\": \"none\"}}\n\nreturn newMsg; \n}\n}\nelse {\n\nvar newMsg = {\n\t\"payload\": {\n\t\t\"matches\": \"none\"}}\n\nreturn newMsg; \n\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1800,"y":1060,"wires":[[]]},{"id":"a0c364c1923cfa06","type":"switch","z":"dd89857c15f353c7","name":"Confidence > 85","property":"payload.highest_match.confidence","propertyType":"msg","rules":[{"t":"gt","v":"85","vt":"num"}],"checkall":"false","repair":false,"outputs":1,"x":2800,"y":1520,"wires":[["cc3499d9e94623c4"]]},{"id":"b64c54bd69ba1414","type":"comment","z":"dd89857c15f353c7","name":"Is double-take-facecam seeing someone?","info":"","x":900,"y":1440,"wires":[]},{"id":"46dfa9ffd07570ac","type":"join","z":"dd89857c15f353c7","name":"","mode":"custom","build":"merged","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"7","count":"2","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"num","reduceFixup":"","x":1530,"y":1560,"wires":[["972f72dcf25a5390"]]},{"id":"de195cac02da5925","type":"http request","z":"dd89857c15f353c7","name":"POST request","method":"GET","ret":"obj","paytoqs":"ignore","url":"http://192.168.0.14:3000/api/recognize?url=http://192.168.0.15:8123/local/reolink.jpg&camera=camera.front_door","tls":"","persist":false,"proxy":"","authType":"","senderr":false,"headers":[],"x":1380,"y":1540,"wires":[["46dfa9ffd07570ac"]]},{"id":"39b095ab9eebbffd","type":"function","z":"dd89857c15f353c7","name":"Face Extractor compare 10.1","func":"var matches = msg.data.attributes.matches;\n//-----------------------------------------\nvar today = new Date();\nvar dd = String(today.getDate()).padStart(2, '0');\nvar hh = today.getHours();\nvar month = String(today.getMonth() + 1).padStart(2, '0');\nvar minutes = today.getMinutes();\nvar yyyy = today.getFullYear();\nvar today = yyyy + '-' + month  + '-' + dd + '---' + hh + minutes;\n\n//-----------------------------------------\n\nif ( matches.length > 0){\nmatches.sort(function(a, b) {return a[1] - b[1];}).reverse();\n\nvar highest_match = matches[0];\n\n\nvar newMsg = {\n\t\"payload\": {\n\t\t\"matches\": matches,\n\t\t\"highest_match\": highest_match ,\n\t\t\"image_url\": \"http://192.168.0.14:3000/api/storage/matches/\" + highest_match.filename,\n\t\t\"save_path\": \"/mnt/hass/\" + highest_match.name + \"/\" + today + \"---\" + highest_match.confidence + \".jpg\",\n\t\t\"confidence\": highest_match.confidence\n\t}\n}\n\nreturn newMsg;\n\n}\nelse {\n\nvar newMsg = {\n\t\"payload\": {\n\t\t\"matches\": \"none\"}}\n\nreturn newMsg; \n\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1800,"y":1020,"wires":[[]]},{"id":"5584461278c6fbeb","type":"function","z":"dd89857c15f353c7","name":"Face Extractor compare 5.1","func":"// SETTINGS\nvar required_conf = 80;\n// SETTINGS\n\n\nvar recoface = new Object();\nvar recofacesortable = [];\nvar name = \"\";\nvar camera = \"\";\nvar conf = \"\";\nvar reconame = \"\";\nvar confidence = \"\";\nvar reco = \"\";\n//declarations\n\n    for (i = 0; i < msg.payload.matches.length; i++){\n         for (y = 0; y < Object.keys(msg.payload.matches[i]).length; y++){\n                var name = msg.payload.matches[i][y][0];\n \t\t\t\tvar conf = msg.payload.matches[i][y][1];\n \t\t\t\tvar camera = msg.payload.matches[i][y][2];\n \t\t\t// \tif (conf > 0){\n \t\t\t\t    recofacesortable.push([name, conf, camera]);\n \t\t\t// \t}\n \t\t\t\t\n        }\n    }\n    \n    \n     \trecofacesortable.sort(function(a, b) {\n \t\treturn a[1] - b[1];\n \t}).reverse();\n \t\n    for (i = 0; i < recofacesortable.length; i++){\n        var reconame = recofacesortable[0][0];\n        var confidence = recofacesortable[0][1]\n        var camera = recofacesortable[0][2]\n        \n        \n    }\n\n\n\nif (confidence > required_conf) {\n\tvar recognized = 1;\n} else {\n\tvar recognized = 0;\n}\n\n if (camera == \"camera.front_door\"){\n     var camera = \"camera.reolink_static\";\n } else if (camera == \"camera.facecam\"){\n     var camera = \"camera.facecam_static\"\n }\n\nvar newMsg = {\n\t\"payload\": {\n\t\t\"name\": reconame,\n\t\t\"confidence\": confidence,\n\t//\t\"matched_faces\": total_matched_faces,\n\t//\t\"total_faces\": total_faces,\n\t\t\"recognized\": recognized,\n \t\t\"camera\": camera \n\t}\n};\n\nreturn newMsg;\n\n\n//  var test = {\n//  \t\"payload\": {\n// \t\t\"name\": reconame,\n// \t\t\"confidence\": confidence,\n// \t\t\"matched_faces\": total_matched_faces,\n// \t\t\"total_faces\": total_faces,\n// \t\t\"recognized\": recognized,\n// \t\t\"camera\": camera ,\n// \t\t\"recofacesortable\": recofacesortable\n//  \t}\n//  };\n//  return test;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1800,"y":840,"wires":[[]]},{"id":"ca9e4a8107a70787","type":"function","z":"dd89857c15f353c7","name":"Face Extractor compare 10.2","func":"var matches = msg.data.attributes.matches;\nvar recofacesortable = [];\n//-----------------------------------------\nvar today = new Date();\nvar dd = String(today.getDate()).padStart(2, '0');\nvar hh = today.getHours();\nvar month = String(today.getMonth() + 1).padStart(2, '0');\nvar minutes = today.getMinutes();\nvar yyyy = today.getFullYear();\nvar today = yyyy + '-' + month  + '-' + dd + '---' + hh + minutes;\n\n//-----------------------------------------\n\n\nif ( matches.length > 0){\n    \nfor (i = 0; i < matches.length; i++){\n    \n    if (matches[i].length > 0){\n\nrecofacesortable.push([name, confidence, filename]);\n}\n}\nrecofacesortable.sort(function(a, b) {return a[1] - b[1];}).reverse();\n\nvar highest_match = recofacesortable[0];\nvar newMsg = {\n\t\"payload\": {\n\t\t\"matches\": matches,\n\t\t\"highest_match\": highest_match ,\n\t\t\"image_url\": \"http://192.168.0.14:3000/api/storage/matches/\" + highest_match.filename,\n\t\t\"save_path\": \"/mnt/hass/\" + highest_match.name + \"/\" + today + \"---\" + highest_match.confidence + \".jpg\",\n\t\t\"confidence\": highest_match.confidence\n\t}\n}\n\nreturn newMsg;\n}\nelse {\n\nvar newMsg = {\n\t\"payload\": {\n\t\t\"matches\": \"none\"}}\n\nreturn newMsg; \n\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1800,"y":980,"wires":[[]]},{"id":"02421cc520e1fe71","type":"inject","z":"dd89857c15f353c7","name":"Maxi recoed","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"matches\":[{\"name\":\"maxi\",\"confidence\":97.05,\"match\":true,\"box\":{\"top\":42,\"left\":6,\"width\":138,\"height\":171},\"type\":\"latest\",\"duration\":0,\"detector\":\"compreface\",\"filename\":\"248edd4f-c0e9-4060-88f5-ef9d9e36551d.jpg\",\"base64\":null}],\"highest_match\":{\"name\":\"maxi\",\"confidence\":97.05,\"match\":true,\"box\":{\"top\":42,\"left\":6,\"width\":138,\"height\":171},\"type\":\"latest\",\"duration\":0,\"detector\":\"compreface\",\"filename\":\"248edd4f-c0e9-4060-88f5-ef9d9e36551d.jpg\",\"base64\":null},\"image_url\":\"http://192.168.0.14:3000/api/storage/matches/248edd4f-c0e9-4060-88f5-ef9d9e36551d.jpg\"}","payloadType":"json","x":2890,"y":1600,"wires":[["cc3499d9e94623c4"]]},{"id":"0b9af757ed9854ac","type":"function","z":"dd89857c15f353c7","name":"Face Extractor compare 10.1","func":"var matches = msg.data.attributes.matches;\n//-----------------------------------------\nvar today = new Date();\nvar dd = String(today.getDate()).padStart(2, '0');\nvar hh = today.getHours();\nvar month = String(today.getMonth() + 1).padStart(2, '0');\nvar minutes = today.getMinutes();\nvar yyyy = today.getFullYear();\nvar today = yyyy + '-' + month  + '-' + dd + '---' + hh + minutes;\n\n//-----------------------------------------\n\nif ( matches.length > 0){\nmatches.sort(function(a, b) {return a[1] - b[1];}).reverse();\n\nvar highest_match = matches[0];\n\n\nvar newMsg = {\n\t\"payload\": {\n\t\t\"matches\": matches,\n\t\t\"highest_match\": highest_match ,\n\t\t\"image_url\": \"http://192.168.0.14:3000/api/storage/matches/\" + highest_match.filename,\n\t\t\"save_path\": \"/mnt/hass/\" + highest_match.name + \"/\" + today + \"---\" + highest_match.confidence + \".jpg\",\n\t\t\"confidence\": highest_match.confidence\n\t}\n}\n\nreturn newMsg;\n\n}\nelse {\n\nvar newMsg = {\n\t\"payload\": {\n\t\t\"matches\": \"none\"}}\n\nreturn newMsg; \n\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1800,"y":1100,"wires":[[]]},{"id":"5a9b99ad63b0e10d","type":"api-call-service","z":"dd89857c15f353c7","name":"Save Reolink.jpg for notif","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"camera","service":"snapshot","areaId":[],"deviceId":[],"entityId":["camera.front_door_camera_person"],"data":"{\"filename\":\"/config/www/reolinkring.jpg\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1930,"y":1300,"wires":[["32cedbc3a70263d5"]]},{"id":"2b01aa4d53a72942","type":"server-events","z":"dd89857c15f353c7","name":"","server":"7ab5c227.a3ce8c","version":2,"eventType":"mobile_app_notification_action","exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"waitForRunning":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"},{"property":"event_type","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"}],"x":510,"y":2060,"wires":[["c02a5fbe787f494c","b204f545004af541"]]},{"id":"c02a5fbe787f494c","type":"debug","z":"dd89857c15f353c7","name":"actionable","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1010,"y":1940,"wires":[]},{"id":"b204f545004af541","type":"switch","z":"dd89857c15f353c7","name":"","property":"payload.event.action_1_title","propertyType":"msg","rules":[{"t":"eq","v":"Enter Text","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":750,"y":2120,"wires":[["c0da18a53116c3bd","5e5f5fd648ca6fd0"]]},{"id":"c0da18a53116c3bd","type":"function","z":"dd89857c15f353c7","name":"Javascript","func":"var text = msg.payload.event.reply_text;\n\n\n\nvar newMsg = {\n    \"text\": msg.payload.event.image,\n    \"payload\": {\n        \"data\": {\n            \"value\": text\n        }\n    }\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":860,"y":2180,"wires":[["5e5f5fd648ca6fd0","9b02d7dfc1fe644e"]]},{"id":"5e5f5fd648ca6fd0","type":"debug","z":"dd89857c15f353c7","name":"actionable","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1050,"y":2060,"wires":[]},{"id":"776066a2f5ffd3ea","type":"api-call-service","z":"dd89857c15f353c7","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"notify","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1980,"y":2080,"wires":[[]]},{"id":"9b02d7dfc1fe644e","type":"api-call-service","z":"dd89857c15f353c7","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"input_text","service":"set_value","areaId":[],"deviceId":[],"entityId":["input_text.front_door_phone_text"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1070,"y":2180,"wires":[["3c23b48c5835cf28"]]},{"id":"01d31433b8cc6c52","type":"api-call-service","z":"dd89857c15f353c7","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"input_text","service":"set_value","areaId":[],"deviceId":[],"entityId":["input_text.front_door_phone_text"],"data":"{\"value\":\"Empty\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1770,"y":2180,"wires":[[]]},{"id":"5ab089c1d413064b","type":"inject","z":"dd89857c15f353c7","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1300,"y":2000,"wires":[["01d31433b8cc6c52"]]},{"id":"f90dcdf6497b6ea0","type":"inject","z":"dd89857c15f353c7","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2500,"y":1200,"wires":[["f415b56cb85073c5"]]},{"id":"3c23b48c5835cf28","type":"trigger","z":"dd89857c15f353c7","name":"","op1":"","op2":"Empty","op1type":"nul","op2type":"str","duration":"2","extend":false,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1310,"y":2180,"wires":[["01d31433b8cc6c52"]]},{"id":"ebb7333b43a91f16","type":"inject","z":"dd89857c15f353c7","name":"Maxi at door","props":[{"p":"payload"},{"p":"data","v":"{\"entity_id\":\"sensor.double_take_front_door\",\"state\":\"3\",\"attributes\":{\"id\":\"1659459685.953183-1shuyf\",\"duration\":3.53,\"timestamp\":\"2022-08-02T17:01:31.497Z\",\"attempts\":11,\"camera\":\"front_door\",\"zones\":[\"entrance\",\"faceshot_zone\"],\"misses\":[{\"name\":\"alphonso\",\"confidence\":79.16,\"match\":false,\"box\":{\"top\":210,\"left\":529,\"width\":85,\"height\":105},\"checks\":[\"box area too low: 8925 < 10000\"],\"type\":\"latest\",\"duration\":0.21,\"detector\":\"deepstack\",\"filename\":\"bcfcd360-f639-45ef-97fa-2f68aa01d8eb.jpg\",\"base64\":null},{\"name\":\"maxi\",\"confidence\":75.7,\"match\":false,\"box\":{\"top\":212,\"left\":354,\"width\":62,\"height\":95},\"checks\":[\"box area too low: 5890 < 10000\"],\"type\":\"latest\",\"duration\":0.19,\"detector\":\"deepstack\",\"filename\":\"49e449d6-65e0-45c6-a21d-237a673b91da.jpg\",\"base64\":null}],\"matches\":[{\"name\":\"maxi\",\"confidence\":72.28,\"match\":true,\"box\":{\"top\":220,\"left\":244,\"width\":102,\"height\":104},\"type\":\"latest\",\"duration\":0.19,\"detector\":\"deepstack\",\"filename\":\"2a731787-cb90-4c90-bbc2-05e910f1576e.jpg\",\"base64\":null},{\"name\":\"nate\",\"confidence\":72.15,\"match\":true,\"box\":{\"top\":228,\"left\":203,\"width\":106,\"height\":98},\"type\":\"snapshot\",\"duration\":0.2,\"detector\":\"deepstack\",\"filename\":\"b5678550-20b0-4b04-a1b5-db4297d7a7ed.jpg\",\"base64\":null}],\"personCount\":3,\"icon\":\"mdi:camera\",\"friendly_name\":\"double_take_front_door\"},\"last_changed\":\"2022-08-02T17:01:31.518682+00:00\",\"last_updated\":\"2022-08-02T17:01:31.518682+00:00\",\"context\":{\"id\":\"01G9FR2RZYY9SBNXVSHJ5T9E0S\",\"parent_id\":null,\"user_id\":null},\"timeSinceChangedMs\":1499,\"original_state\":\"3\"}","vt":"json"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"sensor.remote_doorbell_button_action","payload":"3","payloadType":"num","x":1650,"y":1280,"wires":[["5a9b99ad63b0e10d","c183cccda922e06d"]]},{"id":"cba214656fa06f15","type":"inject","z":"dd89857c15f353c7","name":"Maxi at door","props":[{"p":"payload"},{"p":"data","v":"{\"entity_id\":\"sensor.double_take_front_door\",\"state\":\"3\",\"attributes\":{\"id\":\"1659459685.953183-1shuyf\",\"duration\":3.53,\"timestamp\":\"2022-08-02T17:01:31.497Z\",\"attempts\":11,\"camera\":\"front_door\",\"zones\":[\"entrance\",\"faceshot_zone\"],\"misses\":[{\"name\":\"alphonso\",\"confidence\":79.16,\"match\":false,\"box\":{\"top\":210,\"left\":529,\"width\":85,\"height\":105},\"checks\":[\"box area too low: 8925 < 10000\"],\"type\":\"latest\",\"duration\":0.21,\"detector\":\"deepstack\",\"filename\":\"bcfcd360-f639-45ef-97fa-2f68aa01d8eb.jpg\",\"base64\":null},{\"name\":\"maxi\",\"confidence\":75.7,\"match\":false,\"box\":{\"top\":212,\"left\":354,\"width\":62,\"height\":95},\"checks\":[\"box area too low: 5890 < 10000\"],\"type\":\"latest\",\"duration\":0.19,\"detector\":\"deepstack\",\"filename\":\"49e449d6-65e0-45c6-a21d-237a673b91da.jpg\",\"base64\":null}],\"matches\":[{\"name\":\"maxi\",\"confidence\":72.28,\"match\":true,\"box\":{\"top\":220,\"left\":244,\"width\":102,\"height\":104},\"type\":\"latest\",\"duration\":0.19,\"detector\":\"deepstack\",\"filename\":\"2a731787-cb90-4c90-bbc2-05e910f1576e.jpg\",\"base64\":null},{\"name\":\"nate\",\"confidence\":72.15,\"match\":true,\"box\":{\"top\":228,\"left\":203,\"width\":106,\"height\":98},\"type\":\"snapshot\",\"duration\":0.2,\"detector\":\"deepstack\",\"filename\":\"b5678550-20b0-4b04-a1b5-db4297d7a7ed.jpg\",\"base64\":null}],\"personCount\":3,\"icon\":\"mdi:camera\",\"friendly_name\":\"double_take_front_door\"},\"last_changed\":\"2022-08-02T17:01:31.518682+00:00\",\"last_updated\":\"2022-08-02T17:01:31.518682+00:00\",\"context\":{\"id\":\"01G9FR2RZYY9SBNXVSHJ5T9E0S\",\"parent_id\":null,\"user_id\":null},\"timeSinceChangedMs\":1499,\"original_state\":\"3\"}","vt":"json"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"sensor.remote_doorbell_button_action","payload":"3","payloadType":"num","x":2210,"y":1220,"wires":[[]]},{"id":"3a18cd6f1cd00ffc","type":"debug","z":"dd89857c15f353c7","name":"debug 177","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2590,"y":1240,"wires":[]},{"id":"e474e1b9570f0a2f","type":"function","z":"dd89857c15f353c7","name":"Javascript","func":"var name = \"Someone\";\nvar url = \"https://hass.purgatoire.ca/local/faceshot.jpg\";\nvar random = Date.now();\n\nvar newMsg = {\n\t\"payload\": {\n\t\t\"data\": {\n\t\t\t\"message\": \"Doorbell Alert\",\n\t\t\t\"title\": name + \" is at the door\",\n\t\t\t\"data\": {\n\t\t\t\t\"image\": url + \"?\" + random,\n\t\t\t\t\"actions\": [{\n\t\t\t\t\t\t\"action\": \"REPLY\",\n\t\t\t\t\t\t\"title\": \"Enter Text\"\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"action\": \"unlock_door\",\n\t\t\t\t\t\t\"title\": \"Unlock The Door\"\n\t\t\t\t\t}\n\n\t\t\t\t]\n\t\t\t}\n\t\t}\n\t}\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2100,"y":1260,"wires":[["e92f1d561b9915fa"]]},{"id":"e92f1d561b9915fa","type":"api-call-service","z":"dd89857c15f353c7","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"mobile_app_phone_galaxy_fold_4","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2350,"y":1260,"wires":[[]]},{"id":"c183cccda922e06d","type":"api-call-service","z":"dd89857c15f353c7","name":"Save Reolink.jpg for notif","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"camera","service":"snapshot","areaId":[],"deviceId":[],"entityId":["camera.faceshot_camera_person"],"data":"{\"filename\":\"/config/www/faceshot.jpg\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1910,"y":1260,"wires":[["e474e1b9570f0a2f"]]},{"id":"44af710f486167d5","type":"api-call-service","z":"4cbffab723828705","name":"Hotbox top on","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.hotbox_top"],"data":"{\"color_name\":\"purple\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1520,"y":180,"wires":[[]]},{"id":"f11d2c66787196bd","type":"api-call-service","z":"4cbffab723828705","name":"Hotbox down off","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.hotbox_bottom"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1860,"y":720,"wires":[[]]},{"id":"d387dc73476a8baa","type":"api-call-service","z":"4cbffab723828705","name":"Hotbox down  on","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.hotbox_bottom"],"data":"{\"color_name\":\"white\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1620,"y":780,"wires":[[]]},{"id":"372930905749afc3","type":"trigger","z":"4cbffab723828705","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"15","extend":false,"units":"min","reset":"on","bytopic":"all","outputs":1,"x":970,"y":140,"wires":[["861c9c7db1b8e103"]]},{"id":"bf987c1cb3e627b2","type":"change","z":"4cbffab723828705","name":"off","rules":[{"t":"set","p":"payload","pt":"msg","to":"off","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":830,"y":140,"wires":[["372930905749afc3"]]},{"id":"5ab5b4ec3ecdd2f6","type":"change","z":"4cbffab723828705","name":"on","rules":[{"t":"set","p":"payload","pt":"msg","to":"on","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":830,"y":180,"wires":[["372930905749afc3","95d16ae3af37602e","7222c4a49a42a510","861c9c7db1b8e103"]]},{"id":"0c2569dc38a7315a","type":"trigger","z":"4cbffab723828705","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"15","extend":true,"units":"min","reset":"on","bytopic":"all","outputs":1,"x":890,"y":740,"wires":[["58e7cd551fd0df3b"]]},{"id":"93b80b4876603ee0","type":"change","z":"4cbffab723828705","name":"off","rules":[{"t":"set","p":"payload","pt":"msg","to":"off","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":750,"y":740,"wires":[["0c2569dc38a7315a"]]},{"id":"87bad31a60da52c0","type":"change","z":"4cbffab723828705","name":"on","rules":[{"t":"set","p":"payload","pt":"msg","to":"on","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":750,"y":780,"wires":[["0c2569dc38a7315a","9d882b94466b454a"]]},{"id":"9d882b94466b454a","type":"api-current-state","z":"4cbffab723828705","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.hotbox_down_light","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":1010,"y":780,"wires":[[],["f79b4c7f2f3c1f5d"]]},{"id":"9a27c667d993eaf9","type":"api-current-state","z":"4cbffab723828705","name":"Party Mode?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.party_mode","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":1130,"y":60,"wires":[[],["a5694868dd658427"]]},{"id":"58e7cd551fd0df3b","type":"api-current-state","z":"4cbffab723828705","name":"Party Mode?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.party_mode","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1070,"y":740,"wires":[[],["cf1f3492286ccd5a"]]},{"id":"f79b4c7f2f3c1f5d","type":"function","z":"4cbffab723828705","name":"Time","func":"var d = new Date();\nvar h = d.getHours();\n\nif (h > 22){\n    var brightness = \"200\";\n}\nelse if (h >= 0 && h <= 2 ){\n    var brightness = \"150\";\n}\nelse if (h>2 && h<7){\n    var brightness = \"100\";\n}\nelse{\n    var brightness = \"230\";\n}\n\nvar newMsg = \n\n{ \n    \"payload\": {\n                data: {\n                         \"brightness\": brightness                      }\n               } \n};\nreturn newMsg;\n\n","outputs":1,"noerr":0,"x":1250,"y":780,"wires":[["d8cb0a0f983f8b55"]]},{"id":"d6a2c8b3655d04da","type":"function","z":"4cbffab723828705","name":"Time","func":"var d = new Date();\nvar h = d.getHours();\n\nif (h > 22){\n    var brightness = \"40\";\n}\nelse if (h >= 0 && h <= 2 ){\n    var brightness = \"30\";\n}\nelse if (h>2 && h<7){\n    var brightness = \"20\";\n}\nelse{\n    var brightness = \"50\";\n}\n\nvar newMsg = \n\n{ \n    \"payload\": {\n                data: {\n                         \"brightness_pct\": brightness                      }\n               } \n};\nreturn newMsg;\n\n","outputs":1,"noerr":0,"x":1290,"y":180,"wires":[["44af710f486167d5"]]},{"id":"95d16ae3af37602e","type":"api-current-state","z":"4cbffab723828705","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.hotbox_top","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":1030,"y":180,"wires":[[],["d6a2c8b3655d04da"]]},{"id":"44b5bc4faefb1e14","type":"server-state-changed","z":"4cbffab723828705","name":"Roku Changes","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"remote.hotbox_top_roku","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":380,"y":1040,"wires":[["404ecaebc962233c"]]},{"id":"404ecaebc962233c","type":"switch","z":"4cbffab723828705","name":"","property":"data.new_state.attributes.source","propertyType":"msg","rules":[{"t":"cont","v":"Plex","vt":"str"},{"t":"cont","v":"Netflix","vt":"str"},{"t":"cont","v":"Xbox","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":670,"y":1040,"wires":[["6796fb06bd462591"],["6796fb06bd462591"],["32b6d425f6afdbd3"]]},{"id":"6796fb06bd462591","type":"api-current-state","z":"4cbffab723828705","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.hotbox_ceiling","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":1060,"y":1020,"wires":[["5bc2cb0e759e793b"],[]]},{"id":"5bc2cb0e759e793b","type":"api-call-service","z":"4cbffab723828705","name":"Hotbox lamp  on","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.hotbox_top"],"data":"{\"brightness_pct\":\"35\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1340,"y":1020,"wires":[[]]},{"id":"0f3eed9ec082c47c","type":"server-state-changed","z":"4cbffab723828705","name":"Hotbox TV Changes","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"media_player.hotbox_tv","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":310,"y":1100,"wires":[["a450b1fcd21678b3"]]},{"id":"932c5b54ab9b3743","type":"api-current-state","z":"4cbffab723828705","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.hotbox_ceiling","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":1060,"y":1140,"wires":[["c9faa285f341f6ce"],[]]},{"id":"c9faa285f341f6ce","type":"api-call-service","z":"4cbffab723828705","name":"Hotbox lamp  on","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.hotbox_top"],"data":"{\"brightness_pct\":\"20\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1300,"y":1140,"wires":[[]]},{"id":"4c9c596e9ba58f17","type":"switch","z":"4cbffab723828705","name":"","property":"data.new_state.attributes.app_name","propertyType":"msg","rules":[{"t":"cont","v":"Plex","vt":"str"},{"t":"cont","v":"Netflix","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":830,"y":1140,"wires":[["932c5b54ab9b3743"],["932c5b54ab9b3743"]]},{"id":"32b6d425f6afdbd3","type":"api-current-state","z":"4cbffab723828705","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.hotbox_ceiling","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":1080,"y":1060,"wires":[["05e5eed63bc8631e"],[]]},{"id":"05e5eed63bc8631e","type":"api-call-service","z":"4cbffab723828705","name":"Hotbox lamp  on","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.hotbox_top"],"data":"{\"brightness_pct\":\"35\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1320,"y":1060,"wires":[[]]},{"id":"7222c4a49a42a510","type":"api-current-state","z":"4cbffab723828705","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"media_player.roku","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":1040,"y":220,"wires":[[],["3e3e3889c2d0631e"]]},{"id":"3e3e3889c2d0631e","type":"api-call-service","z":"4cbffab723828705","name":"Hotbox Roku on","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"turn_on","areaId":[],"deviceId":[],"entityId":["media_player.roku"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1520,"y":220,"wires":[[]]},{"id":"611891a1a226cf34","type":"api-call-service","z":"4cbffab723828705","name":"Hotbox roky off","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"turn_off","areaId":[],"deviceId":[],"entityId":["media_player.roku"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2400,"y":120,"wires":[[]]},{"id":"5c6a0951cb8c72f9","type":"api-current-state","z":"4cbffab723828705","name":"Hotbox playing?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"playing","halt_if_type":"re","halt_if_compare":"is","entity_id":"media_player.hotbox_tv","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":1560,"y":60,"wires":[["64fe168c68d2f663"],["a2f9f9a5e536047d"]]},{"id":"ce0c59416aeec22e","type":"inject","z":"4cbffab723828705","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":900,"y":60,"wires":[["9a27c667d993eaf9"]]},{"id":"64fe168c68d2f663","type":"api-call-service","z":"4cbffab723828705","name":"Hotbox top chromecast pause","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"media_pause","areaId":[],"deviceId":[],"entityId":["media_player.hotbox_tv"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1930,"y":40,"wires":[["17250148bb929964"]]},{"id":"29790d16d943b1b2","type":"api-call-service","z":"4cbffab723828705","name":"Hotbox hotbox top tv  off","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"turn_off","areaId":[],"deviceId":[],"entityId":["media_player.hotbox_tv"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2430,"y":240,"wires":[[]]},{"id":"5e492913c3eb5069","type":"switch","z":"4cbffab723828705","name":"","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"paused","vt":"str"},{"t":"cont","v":"playing","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":670,"y":1100,"wires":[["2b13ec11795c59e1"],["4c9c596e9ba58f17"]]},{"id":"2b13ec11795c59e1","type":"api-call-service","z":"4cbffab723828705","name":"Hotbox lamp  on","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.hotbox_top"],"data":"{\"brightness_pct\":\"50\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":860,"y":1100,"wires":[[]]},{"id":"d18b83ddde482f4d","type":"api-call-service","z":"4cbffab723828705","name":"Hotbox lamp off","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.hotbox_top"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2500,"y":40,"wires":[[]]},{"id":"17250148bb929964","type":"trigger","z":"4cbffab723828705","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"15","extend":false,"units":"min","reset":"on","bytopic":"all","outputs":1,"x":2270,"y":40,"wires":[["d18b83ddde482f4d"]]},{"id":"df03737c044e84d1","type":"server-state-changed","z":"4cbffab723828705","name":"Hotbox Top Ocupancy","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.sensor_hotbox_top_motion_occupancy","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":620,"y":160,"wires":[[],[]]},{"id":"8c121a5662ec77fb","type":"server-state-changed","z":"4cbffab723828705","name":"motion hotbox down","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.sensor_hotbox_down_motion_occupancy","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":550,"y":740,"wires":[[],[]]},{"id":"0435d61c00179661","type":"server-state-changed","z":"4cbffab723828705","name":"motion hotbox exit","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.sensor_hotbox_exit_motion_occupancy","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":550,"y":780,"wires":[[],[]]},{"id":"15acfa68dc9e1fca","type":"api-current-state","z":"4cbffab723828705","name":"MOtion hotbox down","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.sensor_hotbox_down_motion_occupancy","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1620,"y":720,"wires":[["f11d2c66787196bd"],[]]},{"id":"d8cb0a0f983f8b55","type":"api-current-state","z":"4cbffab723828705","name":"Sleeper?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.sleeper_in_hotbox","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1380,"y":780,"wires":[[],["d387dc73476a8baa","fc5ec2bb06d2ce7d"]]},{"id":"22ab22a16f66a8ee","type":"server-state-changed","z":"4cbffab723828705","name":"Light top on","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"light.hotbox_top","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":610,"y":360,"wires":[[],[]]},{"id":"7ad7d37513b2e235","type":"trigger","z":"4cbffab723828705","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"30","extend":false,"units":"min","reset":"","bytopic":"all","outputs":1,"x":970,"y":360,"wires":[["562000d2e0633206"]]},{"id":"ab2545749ae621d6","type":"server-state-changed","z":"4cbffab723828705","name":"Motion top","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.motion_hotbox_top_occupancy","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":620,"y":400,"wires":[["99a675202ef15ef9"],[]]},{"id":"99a675202ef15ef9","type":"change","z":"4cbffab723828705","name":"","rules":[{"t":"set","p":"reset","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":780,"y":400,"wires":[[]]},{"id":"562000d2e0633206","type":"api-current-state","z":"4cbffab723828705","name":"MOtion top","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.sensor_hotbox_top_motion_occupancy","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":1150,"y":360,"wires":[["8870cdfbddcec47d"],[]]},{"id":"8870cdfbddcec47d","type":"api-call-service","z":"4cbffab723828705","name":"Hotbox top off","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.hotbox_top"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1360,"y":360,"wires":[[]]},{"id":"74ae4721d93804d8","type":"server-state-changed","z":"4cbffab723828705","name":"Light down on","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"light.hotbox_bottom","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":590,"y":880,"wires":[[],[]]},{"id":"2177784bbec21ac3","type":"trigger","z":"4cbffab723828705","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"30","extend":false,"units":"min","reset":"","bytopic":"all","outputs":1,"x":930,"y":880,"wires":[["95f0342255f47e35"]]},{"id":"42891d6b7c9ef0ca","type":"server-state-changed","z":"4cbffab723828705","name":"Motion bot","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.sensor_hotbox_down_motion_occupancy","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":580,"y":920,"wires":[["df41aeea06a11378"],[]]},{"id":"df41aeea06a11378","type":"change","z":"4cbffab723828705","name":"","rules":[{"t":"set","p":"reset","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":740,"y":920,"wires":[[]]},{"id":"95f0342255f47e35","type":"api-current-state","z":"4cbffab723828705","name":"MOtion down","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.sensor_hotbox_down_motion_occupancy","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":1210,"y":880,"wires":[["f43bbd42a55a395a"],[]]},{"id":"f43bbd42a55a395a","type":"api-call-service","z":"4cbffab723828705","name":"Hotbox bottom off","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.hotbox_bottom"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1550,"y":880,"wires":[[]]},{"id":"a19ab7474312a7f7","type":"switch","z":"4cbffab723828705","name":"","property":"data.attributes.source","propertyType":"msg","rules":[{"t":"eq","v":"Chromecast","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":2090,"y":140,"wires":[["29790d16d943b1b2","611891a1a226cf34","e1609baaedced700","d630b0e57d61995d"]]},{"id":"cc5884fb3ba00bfa","type":"inject","z":"4cbffab723828705","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1740,"y":240,"wires":[[]]},{"id":"a2f9f9a5e536047d","type":"api-current-state","z":"4cbffab723828705","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"media_player.roku","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1880,"y":140,"wires":[["a19ab7474312a7f7","2f686119884becd7"]]},{"id":"e1609baaedced700","type":"api-call-service","z":"4cbffab723828705","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.hotbox_top"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2410,"y":200,"wires":[[]]},{"id":"d630b0e57d61995d","type":"debug","z":"4cbffab723828705","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":2140,"y":220,"wires":[]},{"id":"861c9c7db1b8e103","type":"trigger","z":"4cbffab723828705","name":"","op1":"","op2":"1","op1type":"pay","op2type":"str","duration":"-15","extend":false,"units":"min","reset":"on","bytopic":"all","outputs":1,"x":1170,"y":140,"wires":[["9a27c667d993eaf9"]]},{"id":"91440e0fc7e65475","type":"server-state-changed","z":"4cbffab723828705","name":"Hotbox Top Ocupancy","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.sensor_hotbox_top_motion_occupancy","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":1960,"y":80,"wires":[["17250148bb929964"],[]]},{"id":"a450b1fcd21678b3","type":"trigger","z":"4cbffab723828705","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"10","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":510,"y":1100,"wires":[["5e492913c3eb5069"]]},{"id":"f7f45b1f947bb772","type":"server-state-changed","z":"4cbffab723828705","name":"Hotbox motion off","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.hotbox_all_motion_off","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":280,"y":1540,"wires":[["7fec982efa636709"],["6ddc0d74a1c525bf","7fec982efa636709","ee99b04caf860613","b9b981fb42a7b10e"]]},{"id":"ee99b04caf860613","type":"trigger","z":"4cbffab723828705","name":"","op1":"","op2":"","op1type":"pay","op2type":"pay","duration":"-20","extend":false,"overrideDelay":false,"units":"min","reset":"off","bytopic":"all","topic":"topic","outputs":1,"x":850,"y":1540,"wires":[["414ee57d8ac5883e"]]},{"id":"19de06f312d97ab7","type":"api-call-service","z":"4cbffab723828705","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"climate","service":"set_preset_mode","areaId":[],"deviceId":[],"entityId":["climate.hotbox_ac"],"data":"{\"preset_mode\":\"away\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1330,"y":1520,"wires":[[]]},{"id":"6ddc0d74a1c525bf","type":"api-call-service","z":"4cbffab723828705","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"climate","service":"turn_on","areaId":[],"deviceId":[],"entityId":["climate.hotbox_ac"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":540,"y":1580,"wires":[[]]},{"id":"414ee57d8ac5883e","type":"api-current-state","z":"4cbffab723828705","name":"party?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.party_mode","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":1050,"y":1540,"wires":[[],[]]},{"id":"7fec982efa636709","type":"trigger","z":"4cbffab723828705","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"20","extend":false,"units":"min","reset":"off","bytopic":"all","outputs":1,"x":550,"y":1500,"wires":[["ee99b04caf860613"]]},{"id":"b9b981fb42a7b10e","type":"api-call-service","z":"4cbffab723828705","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"climate","service":"set_preset_mode","areaId":[],"deviceId":[],"entityId":["climate.hotbox_ac"],"data":"{\"preset_mode\":\"none\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":570,"y":1640,"wires":[["cbc4778f6b95a574"]]},{"id":"f072966fb0f261a4","type":"server-state-changed","z":"4cbffab723828705","name":"CPU TEMP","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.proxmox_tdie_temperature","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"65","halt_if_type":"num","halt_if_compare":"gt","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":70,"y":1620,"wires":[["e90ad6c88651f2e8"],[]]},{"id":"2b8bfd930a233f78","type":"api-current-state","z":"4cbffab723828705","name":"back door open","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.door_server","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":320,"y":1620,"wires":[["b9b981fb42a7b10e","6ddc0d74a1c525bf"],[]]},{"id":"c793be5ead68d293","type":"api-call-service","z":"4cbffab723828705","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"climate","service":"set_temperature","areaId":[],"deviceId":[],"entityId":["climate.hotbox_ac"],"data":"{\"temperature\":\"24\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1200,"y":1640,"wires":[[]]},{"id":"e90ad6c88651f2e8","type":"api-current-state","z":"4cbffab723828705","name":"patio door closed","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.door_patio","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":210,"y":1680,"wires":[["2b8bfd930a233f78"],[]]},{"id":"cbc4778f6b95a574","type":"trigger","z":"4cbffab723828705","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"20","extend":false,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":810,"y":1640,"wires":[[]]},{"id":"2f686119884becd7","type":"debug","z":"4cbffab723828705","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2060,"y":300,"wires":[]},{"id":"fc5ec2bb06d2ce7d","type":"api-call-service","z":"4cbffab723828705","name":"Hotbox down  on","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.hotbox_down_behind_tv_light"],"data":"{\"color_name\":\"purple\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1610,"y":820,"wires":[[]]},{"id":"0372a84cce23819c","type":"inject","z":"4cbffab723828705","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1370,"y":580,"wires":[["d8cb0a0f983f8b55"]]},{"id":"cf1f3492286ccd5a","type":"api-current-state","z":"4cbffab723828705","name":"Kink?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.kink_party","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1230,"y":740,"wires":[["15acfa68dc9e1fca"],[]]},{"id":"a5694868dd658427","type":"api-current-state","z":"4cbffab723828705","name":"Kink?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.kink_party","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1310,"y":60,"wires":[["5c6a0951cb8c72f9"],[]]},{"id":"608dd2e367f9317b","type":"inject","z":"4cbffab723828705","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":330,"y":1460,"wires":[["6ddc0d74a1c525bf"]]},{"id":"04e20d78621b2d90","type":"comment","z":"4cbffab723828705","name":"","info":"","x":360,"y":1020,"wires":[]},{"id":"58ed5667ef55170a","type":"comment","z":"4cbffab723828705","name":"","info":"","x":320,"y":1160,"wires":[]},{"id":"ea7afe92ad8a676b","type":"comment","z":"4cbffab723828705","name":"","info":"","x":420,"y":1380,"wires":[]},{"id":"608105172bcaa9a4","type":"comment","z":"4cbffab723828705","name":"","info":"","x":822.5177612304688,"y":320.0071105957031,"wires":[]},{"id":"5476dce8255eccfa","type":"comment","z":"4cbffab723828705","name":"","info":"","x":640,"y":680,"wires":[]},{"id":"954d45bd924b483e","type":"comment","z":"4cbffab723828705","name":"","info":"","x":680,"y":120,"wires":[]},{"id":"db3a1b30ea9ad262","type":"api-call-service","z":"4cbffab723828705","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"toggle","areaId":[],"deviceId":[],"entityId":["light.group_livingroom_lights"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2980,"y":3000,"wires":[[]]},{"id":"91be676060f44885","type":"api-call-service","z":"dddedf805803d84c","name":"LV lights off","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.group_livingroom_lights"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1950,"y":180,"wires":[[]]},{"id":"0cf7e2dc91e9b335","type":"trigger","z":"dddedf805803d84c","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"5","extend":false,"overrideDelay":false,"units":"min","reset":"on","bytopic":"all","topic":"topic","outputs":1,"x":1010,"y":200,"wires":[["9bcdfaa23ba0c085"]]},{"id":"419b97660df30845","type":"api-call-service","z":"dddedf805803d84c","name":"Lights on","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.group_livingroom_lights"],"data":"{\"color_name\":\"white\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1860,"y":240,"wires":[[]]},{"id":"14278f6a793fcbde","type":"change","z":"dddedf805803d84c","name":"off","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"off","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":200,"wires":[["0cf7e2dc91e9b335"]]},{"id":"d2d20eddc3e1c454","type":"change","z":"dddedf805803d84c","name":"on","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"on","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":570,"y":240,"wires":[["0cf7e2dc91e9b335","5850af88341d93cd"]]},{"id":"be37e4134918fab5","type":"api-current-state","z":"dddedf805803d84c","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.group_livingroom_lights","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"state","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1350,"y":240,"wires":[[],["6ca5c8d439b78501"]]},{"id":"c454315f259e7dc8","type":"api-current-state","z":"dddedf805803d84c","name":"Party Mode?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.party_mode","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1590,"y":180,"wires":[[],["30a90cdc58f0e9a4"]]},{"id":"30a90cdc58f0e9a4","type":"api-current-state","z":"dddedf805803d84c","name":"TV PLAYING?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"playing","halt_if_type":"str","halt_if_compare":"is","entity_id":"media_player.livingroom_chromecast","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1780,"y":180,"wires":[[],["91be676060f44885"]]},{"id":"7e1ba261abe6cf39","type":"api-current-state","z":"dddedf805803d84c","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.living_room_window","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"state","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1420,"y":320,"wires":[[],["47ba35121f57d2cf"]]},{"id":"271c78018eb8b41f","type":"api-call-service","z":"dddedf805803d84c","name":"Lights on","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.living_room_window"],"data":"{\"color_name\":\"white\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1800,"y":320,"wires":[[]]},{"id":"6ca5c8d439b78501","type":"function","z":"dddedf805803d84c","name":"Time","func":"var d = new Date();\nvar h = d.getHours();\n\nif (h > 22){\n    var brightness = \"80\";\n}\nelse if (h >= 0 && h <= 2 ){\n    var brightness = \"75\";\n}\nelse if (h>2 && h<7){\n    var brightness = \"50\";\n}\nelse{\n    var brightness = \"100\";\n}\n\nvar newMsg = \n\n{ \n    \"payload\": {\n                data: {\n                         \"brightness_pct\": brightness                      }\n               } \n};\nreturn newMsg;\n\n","outputs":1,"noerr":0,"x":1670,"y":240,"wires":[["419b97660df30845"]]},{"id":"47ba35121f57d2cf","type":"function","z":"dddedf805803d84c","name":"Time","func":"var d = new Date();\nvar h = d.getHours();\n\nif (h > 22){\n    var brightness = \"80\";\n}\nelse if (h >= 0 && h <= 2 ){\n    var brightness = \"75\";\n}\nelse if (h>2 && h<7){\n    var brightness = \"50\";\n}\nelse{\n    var brightness = \"100\";\n}\n\nvar newMsg = \n\n{ \n    \"payload\": {\n                data: {\n                         \"brightness_pct\": brightness                      }\n               } \n};\nreturn newMsg;\n\n","outputs":1,"noerr":0,"x":1650,"y":320,"wires":[["271c78018eb8b41f"]]},{"id":"1dac6356f61e5482","type":"server-state-changed","z":"dddedf805803d84c","name":"Motion Hallway","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.sensor_entrance_motion_occupancy","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":360,"y":360,"wires":[[],[]]},{"id":"9ee6f335706bb79f","type":"server-state-changed","z":"dddedf805803d84c","name":"Motion Living occupancy","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.sensor_livingroom_motion_occupancy","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":370,"y":160,"wires":[[],[]]},{"id":"32cd935ba2e8754d","type":"server-state-changed","z":"dddedf805803d84c","name":"Motion Kitchen Entry","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.sensor_kitchen_entry_motion_occupancy","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":370,"y":320,"wires":[[],[]]},{"id":"16e4fc1c0672cdd3","type":"api-current-state","z":"dddedf805803d84c","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.living_room_tv","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"state","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1400,"y":360,"wires":[[],["1b4073a027e62fdf"]]},{"id":"3c05273de6a65792","type":"api-call-service","z":"dddedf805803d84c","name":"Lights on","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.living_room_tv"],"data":"{\"color_name\":\"white\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1800,"y":360,"wires":[[]]},{"id":"1b4073a027e62fdf","type":"function","z":"dddedf805803d84c","name":"Time","func":"var d = new Date();\nvar h = d.getHours();\n\nif (h > 22){\n    var brightness = \"80\";\n}\nelse if (h >= 0 && h <= 2 ){\n    var brightness = \"75\";\n}\nelse if (h>2 && h<7){\n    var brightness = \"50\";\n}\nelse{\n    var brightness = \"100\";\n}\n\nvar newMsg = \n\n{ \n    \"payload\": {\n                data: {\n                         \"brightness_pct\": brightness                      }\n               } \n};\nreturn newMsg;\n\n","outputs":1,"noerr":0,"x":1650,"y":360,"wires":[["3c05273de6a65792"]]},{"id":"d0abde8caf124a92","type":"inject","z":"dddedf805803d84c","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1800,"y":620,"wires":[[]]},{"id":"9e2f69d35ceb3456","type":"api-call-service","z":"dddedf805803d84c","name":"Lights on","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.quotra"],"data":"{\"effect\":\"colorloop\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1800,"y":400,"wires":[[]]},{"id":"dd1ebeaed7bf1dcd","type":"server-state-changed","z":"dddedf805803d84c","name":"FP1 Livingroom","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.sensor_livingroom_fp1_presence","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":true,"ignoreCurrentStateUnavailable":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":340,"y":200,"wires":[[],[]]},{"id":"258ff369b2560eec","type":"api-current-state","z":"dddedf805803d84c","name":"Sleeper?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.sleeper_in_living_room","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":1060,"y":240,"wires":[["be37e4134918fab5"],["334024c0889b719f"]]},{"id":"68abe06b8da8b9db","type":"api-call-service","z":"dddedf805803d84c","name":"Lights on","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.living_room"],"data":"{\"color_name\":\"white\",\"brightness_pct\":\"5\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1300,"y":460,"wires":[["13ff0b5f9ae65699"]]},{"id":"334024c0889b719f","type":"api-current-state","z":"dddedf805803d84c","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.group_livingroom_lights, ","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"state","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1010,"y":460,"wires":[[],["68abe06b8da8b9db"]]},{"id":"6cc64e7641533bc6","type":"api-call-service","z":"dddedf805803d84c","name":"Lights on","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.group_livingroom_lights"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1620,"y":460,"wires":[[]]},{"id":"13ff0b5f9ae65699","type":"trigger","z":"dddedf805803d84c","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"4","extend":false,"units":"min","reset":"on","bytopic":"all","outputs":1,"x":1470,"y":460,"wires":[["6cc64e7641533bc6"]]},{"id":"5850af88341d93cd","type":"api-current-state","z":"dddedf805803d84c","name":"all sleep","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"(off|unavailable|unkown)","halt_if_type":"re","halt_if_compare":"is","entity_id":"binary_sensor.all_sleeping","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":720,"y":280,"wires":[["258ff369b2560eec"],["334024c0889b719f","dba2be23e6df6424"]]},{"id":"dba2be23e6df6424","type":"api-current-state","z":"dddedf805803d84c","name":"Sunup?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"above_horizon","halt_if_type":"str","halt_if_compare":"is","entity_id":"sun.sun","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":900,"y":320,"wires":[["258ff369b2560eec"],["334024c0889b719f"]]},{"id":"4f56ca9982b373ad","type":"function","z":"dddedf805803d84c","name":"Time","func":"var d = new Date();\nvar h = d.getHours();\n\nif (h > 22){\n    var brightness = \"80\";\n}\nelse if (h >= 0 && h <= 2 ){\n    var brightness = \"75\";\n}\nelse if (h>2 && h<7){\n    var brightness = \"50\";\n}\nelse{\n    var brightness = \"100\";\n}\n\nvar newMsg = \n\n{ \n    \"payload\": {\n                data: {\n                         \"brightness_pct\": brightness,\n                         \"effect\": \"colorloop\",\n                         \"color_name\": \"red\"\n                    \n                }\n               } \n};\nreturn newMsg;\n\n","outputs":1,"noerr":0,"x":1590,"y":400,"wires":[["9e2f69d35ceb3456"]]},{"id":"c35ee5edd4e8c961","type":"api-current-state","z":"dddedf805803d84c","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.quotra","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"state","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1370,"y":400,"wires":[[],["4f56ca9982b373ad"]]},{"id":"9bcdfaa23ba0c085","type":"api-current-state","z":"dddedf805803d84c","name":"Kink?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.kink_party","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1150,"y":200,"wires":[["4e111dca2a9fd857"],[]]},{"id":"8e28c51464f175b2","type":"server-state-changed","z":"dddedf805803d84c","name":"Motion LV Entry","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.sensor_livingroom_entry_motion_occupancy","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":360,"y":280,"wires":[[],[]]},{"id":"ad15c1f60a2aef34","type":"api-current-state","z":"dddedf805803d84c","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.sleeper_in_living_room","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":800,"y":1180,"wires":[["52c475b041b38763"],[]]},{"id":"44c5ec5054044a0e","type":"server-state-changed","z":"dddedf805803d84c","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"media_player.living_room_lg","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"re","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":370,"y":1180,"wires":[["ad15c1f60a2aef34"],[]]},{"id":"28828c070f3a4cfc","type":"inject","z":"dddedf805803d84c","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":840,"y":1120,"wires":[["52c475b041b38763"]]},{"id":"52c475b041b38763","type":"api-call-service","z":"dddedf805803d84c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"turn_on","areaId":[],"deviceId":[],"entityId":["media_player.livingroom_chromecast"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1180,"y":1180,"wires":[["67f05292fc6a4bc6"]]},{"id":"67f05292fc6a4bc6","type":"api-call-service","z":"dddedf805803d84c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"turn_off","areaId":[],"deviceId":[],"entityId":["media_player.livingroom_chromecast"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1520,"y":1180,"wires":[[]]},{"id":"4e111dca2a9fd857","type":"api-current-state","z":"dddedf805803d84c","name":"psychs","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.acid_time","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"entity.entity_id","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":1330,"y":180,"wires":[["c454315f259e7dc8"],[]]},{"id":"2a15fa61b6ddd3be","type":"comment","z":"dddedf805803d84c","name":"","info":"","x":360,"y":260,"wires":[]},{"id":"05433a3327327e63","type":"comment","z":"dddedf805803d84c","name":"","info":"","x":380,"y":320,"wires":[]},{"id":"3e2dac607b871b09","type":"comment","z":"dddedf805803d84c","name":"","info":"","x":368.76776123046875,"y":796.257080078125,"wires":[]},{"id":"b15ddc3f7ce1c66d","type":"comment","z":"dddedf805803d84c","name":"","info":"","x":1200,"y":1800,"wires":[]},{"id":"e91e51da55a36952","type":"comment","z":"dddedf805803d84c","name":"","info":"","x":1100,"y":1940,"wires":[]},{"id":"dd92294670fe6c0a","type":"trigger","z":"9129ecb0b2e786b5","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"2","extend":false,"units":"min","reset":"off","bytopic":"all","outputs":1,"x":1110,"y":120,"wires":[["55bc58b8ee7f542d"]]},{"id":"6877bf1fa1529499","type":"change","z":"9129ecb0b2e786b5","name":"Alert","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"message","pt":"msg","to":"Front Door Open","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1870,"y":120,"wires":[["e3e25ac88e5ab623"]]},{"id":"44eb2a79358c3a5b","type":"delay","z":"9129ecb0b2e786b5","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":100,"y":60,"wires":[[]]},{"id":"55bc58b8ee7f542d","type":"trigger","z":"9129ecb0b2e786b5","name":"","op1":"","op2":"1","op1type":"num","op2type":"str","duration":"-5","extend":false,"units":"min","reset":"off","bytopic":"all","outputs":1,"x":1330,"y":120,"wires":[["a54db271c14c6fdb"]]},{"id":"6fa95abdf2c98257","type":"server-state-changed","z":"9129ecb0b2e786b5","name":"Front door Sensor","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.sensor_front_door_contact","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"(on|off)","halt_if_type":"re","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":910,"y":120,"wires":[["dd92294670fe6c0a","0c08ef841416b2f3"],[]]},{"id":"a54db271c14c6fdb","type":"api-current-state","z":"9129ecb0b2e786b5","name":"Aerating?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.aerating_appartment","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1520,"y":120,"wires":[["c6bf404c85cc060d"],[]]},{"id":"0c08ef841416b2f3","type":"switch","z":"9129ecb0b2e786b5","name":"","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1110,"y":80,"wires":[["55bc58b8ee7f542d"]]},{"id":"50b11c0933d47453","type":"link out","z":"9129ecb0b2e786b5","name":"Light and Speakers","links":["45904ca6429d867d","ad88dbd2.4726b8","3405e943.fd3ee6","9cf42cf7ef60f645"],"x":2275,"y":100,"wires":[]},{"id":"e38272d3ac048e18","type":"function","z":"9129ecb0b2e786b5","name":"Javascript","func":"var recoface = [];\nvar facestring = \"\"\nvar d = new Date();\nvar m = d.getMilliseconds();\nvar url = \"https://purgatoire.ca/local/unlocked.jpg?\" + m;\nvar facestring = msg.payload;\n\nvar newMsg = {\n \"payload\": {\n  \"data\": {\n   \"message\": \"Door Unlocked\",\n   \"title\": facestring + \" has arrived.\",\n   \"data\": {\n    \"image\": url\n   }\n  }\n }\n};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1460,"y":580,"wires":[["d1e8a3dbffe3f075","691e9022fe16ec9b","deddd4dc7f47bae4"]]},{"id":"26be1721f3ca5e63","type":"change","z":"9129ecb0b2e786b5","name":"Myriam","rules":[{"t":"set","p":"payload","pt":"msg","to":"Myriam","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1280,"y":580,"wires":[["e38272d3ac048e18"]]},{"id":"724812ec05282b10","type":"change","z":"9129ecb0b2e786b5","name":"Maxi","rules":[{"t":"set","p":"payload","pt":"msg","to":"Maxi","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1270,"y":540,"wires":[["e38272d3ac048e18","0961c8af0f67865e"]]},{"id":"d1e8a3dbffe3f075","type":"change","z":"9129ecb0b2e786b5","name":"Set Data for mass alert","rules":[{"t":"set","p":"message","pt":"msg","to":"payload.data.title","tot":"msg"},{"t":"set","p":"color_value","pt":"msg","to":"[0,255,0]","tot":"json"},{"t":"set","p":"dbrigthness","pt":"msg","to":"100","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1660,"y":620,"wires":[["7f5ab158dfc055c8"]]},{"id":"691e9022fe16ec9b","type":"api-call-service","z":"9129ecb0b2e786b5","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"notify","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1640,"y":580,"wires":[["cfd4896e081ff7c5"]]},{"id":"62fb4d107a99134e","type":"delay","z":"9129ecb0b2e786b5","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":1580,"y":660,"wires":[["7e9f0f5b73f37738"]]},{"id":"0961c8af0f67865e","type":"delay","z":"9129ecb0b2e786b5","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":1580,"y":520,"wires":[["1eb528200b9ffec8"]]},{"id":"996f7f569698d0e9","type":"switch","z":"9129ecb0b2e786b5","name":"WHO","property":"payload.action_user","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"str"},{"t":"eq","v":"3","vt":"num"},{"t":"eq","v":"4","vt":"num"},{"t":"eq","v":"6","vt":"num"},{"t":"null"}],"checkall":"false","repair":false,"outputs":6,"x":1110,"y":600,"wires":[["724812ec05282b10"],[],["26be1721f3ca5e63"],["3d691f6efc74ddfa"],[],["6e9fda890201b1e9"]]},{"id":"f22fd5c50ad88bbd","type":"link out","z":"9129ecb0b2e786b5","name":"Light and Speakers","links":["45904ca6429d867d","ad88dbd2.4726b8","3405e943.fd3ee6","9cf42cf7ef60f645"],"x":2055,"y":620,"wires":[]},{"id":"cfd4896e081ff7c5","type":"api-current-state","z":"9129ecb0b2e786b5","name":"alarm on?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"disarmed","halt_if_type":"str","halt_if_compare":"is_not","entity_id":"alarm_control_panel.home_alarm","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1820,"y":580,"wires":[["d29ef9c2c6d106f6"],["8506be8d1d88153a"]]},{"id":"7e9f0f5b73f37738","type":"api-call-service","z":"9129ecb0b2e786b5","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.thierry_light"],"data":"{ \"color_name\": \"white\" }","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1790,"y":660,"wires":[["77ce8b8709bb65b2"]]},{"id":"1eb528200b9ffec8","type":"api-call-service","z":"9129ecb0b2e786b5","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.bedroom_lights"],"data":"{ \"color_name\": \"white\" }","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1770,"y":520,"wires":[["3b3cdaea7116bbef"]]},{"id":"a0423f3ca89f42c2","type":"switch","z":"9129ecb0b2e786b5","name":"Action","property":"payload.action","propertyType":"msg","rules":[{"t":"eq","v":"unlock","vt":"str"},{"t":"eq","v":"manual_unlock","vt":"str"},{"t":"eq","v":"manual_lock","vt":"str"},{"t":"eq","v":"lock","vt":"str"},{"t":"eq","v":"ontouchlock","vt":"str"},{"t":"eq","v":"UnlockFailureInvalidPINorID","vt":"str"},{"t":"eq","v":"unlock_failure_invalid_schedule","vt":"str"}],"checkall":"false","repair":false,"outputs":7,"x":390,"y":600,"wires":[["2eb9820b2c85f933","01ef1fd070b77b42"],["235495c97163b63d"],["801e0eb6ad4cbc0b"],["801e0eb6ad4cbc0b"],["801e0eb6ad4cbc0b"],[],["5766b84ea23f309d"]]},{"id":"d29ef9c2c6d106f6","type":"api-call-service","z":"9129ecb0b2e786b5","name":"Disable Alarm","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"alarm_control_panel","service":"alarm_disarm","areaId":[],"deviceId":[],"entityId":["alarm_control_panel.home_alarm"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1980,"y":560,"wires":[["8506be8d1d88153a"]]},{"id":"77ce8b8709bb65b2","type":"api-call-service","z":"9129ecb0b2e786b5","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.plug_thierry_screens"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2010,"y":660,"wires":[[]]},{"id":"3b3cdaea7116bbef","type":"api-call-service","z":"9129ecb0b2e786b5","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.screens"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1970,"y":520,"wires":[[]]},{"id":"01ef1fd070b77b42","type":"debug","z":"9129ecb0b2e786b5","name":"mqtt lock here","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":560,"y":460,"wires":[]},{"id":"8506be8d1d88153a","type":"delay","z":"9129ecb0b2e786b5","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":2160,"y":620,"wires":[["3e70e78e029dd3d1"]]},{"id":"3e70e78e029dd3d1","type":"api-call-service","z":"9129ecb0b2e786b5","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.group_livingroom_lights","light.group_entrance_lights"],"data":"{ \"color_name\": \"white\" }","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2350,"y":620,"wires":[[]]},{"id":"4e7d3ae95043cb22","type":"api-current-state","z":"9129ecb0b2e786b5","name":"Front Door open?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.sensor_front_door_contact","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":870,"y":600,"wires":[["996f7f569698d0e9","a12ee8e37d267bc9"],["397ffc396432a16c"]]},{"id":"397ffc396432a16c","type":"change","z":"9129ecb0b2e786b5","name":"Set Data for someone going out","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"color_value","pt":"msg","to":"[0,255,0]","tot":"json"},{"t":"set","p":"dbrigthness","pt":"msg","to":"100","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":910,"y":700,"wires":[["bc9650546cbcae8c"]]},{"id":"d8ce205edf2e27bc","type":"link out","z":"9129ecb0b2e786b5","name":"Light and Speakers","links":["45904ca6429d867d","ad88dbd2.4726b8","3405e943.fd3ee6","9cf42cf7ef60f645"],"x":1255,"y":760,"wires":[]},{"id":"28d9b113bc53f0fc","type":"inject","z":"9129ecb0b2e786b5","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1720,"y":1020,"wires":[[]]},{"id":"2da76789fd72da56","type":"api-current-state","z":"9129ecb0b2e786b5","name":"Party Mode?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.party_mode","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1530,"y":460,"wires":[["179a383907a148d4"],[]]},{"id":"cb69c31a1388cef3","type":"api-current-state","z":"9129ecb0b2e786b5","name":"Living Room TV","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"(playing|paused)","halt_if_type":"re","halt_if_compare":"is_not","entity_id":"media_player.livingroom_chromecast","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":2020,"y":460,"wires":[["54ce6cc92fae344e"],["6a5d68c9f5b70812"]]},{"id":"179a383907a148d4","type":"api-current-state","z":"9129ecb0b2e786b5","name":"MSleeping?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.maxi_sleeping","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1690,"y":460,"wires":[["765ebe1ddb375dc4"],[]]},{"id":"765ebe1ddb375dc4","type":"api-current-state","z":"9129ecb0b2e786b5","name":"Docked?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"docked","halt_if_type":"str","halt_if_compare":"is","entity_id":"vacuum.xiaomi_vacuum_cleaner","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1840,"y":460,"wires":[["cb69c31a1388cef3"],[]]},{"id":"54ce6cc92fae344e","type":"function","z":"9129ecb0b2e786b5","name":"Time","func":"var d = new Date();\nvar h = d.getHours();\n\nif (h > 22){\n    var night = \"1\";\n}\nelse if (h >= 0 && h <= 8 ){\n    var night = \"1\";\n}\nelse{\n    var night = \"0\";\n}\n\nvar newMsg = \n\n{ \n    \"payload\": {\n        \"night_time\": night\n    }\n};\nreturn newMsg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2190,"y":440,"wires":[["16b1a0fe8ee2e860"]]},{"id":"16b1a0fe8ee2e860","type":"switch","z":"9129ecb0b2e786b5","name":"","property":"payload.night_time","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":2310,"y":440,"wires":[["c296be187e895cd5"]]},{"id":"6a5d68c9f5b70812","type":"function","z":"9129ecb0b2e786b5","name":"Time","func":"var d = new Date();\nvar h = d.getHours();\n\nif (h > 22){\n    var night = \"1\";\n}\nelse if (h >= 0 && h <= 8 ){\n    var night = \"1\";\n}\nelse{\n    var night = \"0\";\n}\n\nvar newMsg = \n\n{ \n    \"payload\": {\n        \"night_time\": night\n    }\n};\nreturn newMsg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2190,"y":480,"wires":[["a222e56adc4874cf"]]},{"id":"a222e56adc4874cf","type":"switch","z":"9129ecb0b2e786b5","name":"","property":"payload.night_time","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":2310,"y":480,"wires":[["c296be187e895cd5"]]},{"id":"6638248c783be854","type":"ha-wait-until","z":"9129ecb0b2e786b5","name":"","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"binary_sensor.sensor_entrance_motion_occupancy","entityIdFilterType":"exact","property":"state","comparator":"is","value":"off","valueType":"str","timeout":"1","timeoutType":"num","timeoutUnits":"hours","checkCurrentState":true,"blockInputOverrides":true,"outputProperties":[],"x":1360,"y":480,"wires":[["2da76789fd72da56"],[]]},{"id":"235495c97163b63d","type":"trigger","z":"9129ecb0b2e786b5","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"2","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":680,"y":600,"wires":[["4e7d3ae95043cb22"]]},{"id":"801e0eb6ad4cbc0b","type":"change","z":"9129ecb0b2e786b5","name":"","rules":[{"t":"set","p":"reset","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":680,"y":640,"wires":[["235495c97163b63d"]]},{"id":"deddd4dc7f47bae4","type":"trigger","z":"9129ecb0b2e786b5","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"5","extend":false,"overrideDelay":false,"units":"min","reset":"off","bytopic":"all","topic":"topic","outputs":1,"x":1130,"y":500,"wires":[["6638248c783be854","a12ee8e37d267bc9"]]},{"id":"033b1ec54a679634","type":"change","z":"9129ecb0b2e786b5","name":"Set Data for someone coming in","rules":[{"t":"set","p":"color_value","pt":"msg","to":"[0,255,0]","tot":"json"},{"t":"set","p":"dbrigthness","pt":"msg","to":"100","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1330,"y":900,"wires":[["64dae779b17457c4"]]},{"id":"fa139ab7677a02b0","type":"link out","z":"9129ecb0b2e786b5","name":"Light and Speakers","links":["45904ca6429d867d","ad88dbd2.4726b8","3405e943.fd3ee6","9cf42cf7ef60f645"],"x":1835,"y":900,"wires":[]},{"id":"a12ee8e37d267bc9","type":"debug","z":"9129ecb0b2e786b5","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1160,"y":420,"wires":[]},{"id":"c296be187e895cd5","type":"api-current-state","z":"9129ecb0b2e786b5","name":"Kink?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.kink_party","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":2450,"y":440,"wires":[[],[]]},{"id":"cf82956fa021871a","type":"server-state-changed","z":"9129ecb0b2e786b5","name":"Front Lock","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"lock.lock_front_door","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"unlocked","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":80,"y":600,"wires":[["af83d038ad2b5fb4"],[]]},{"id":"af83d038ad2b5fb4","type":"debug","z":"9129ecb0b2e786b5","name":"lock here","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":220,"y":520,"wires":[]},{"id":"b890e582f478cfc3","type":"mqtt in","z":"9129ecb0b2e786b5","name":"","topic":"zigbee2mqtt/lock_front_door","qos":"2","datatype":"json","broker":"21000c19b97da572","nl":false,"rap":true,"rh":0,"inputs":0,"x":280,"y":460,"wires":[["a0423f3ca89f42c2","01ef1fd070b77b42"]]},{"id":"2eb9820b2c85f933","type":"switch","z":"9129ecb0b2e786b5","name":"","property":"payload.action_source_name","propertyType":"msg","rules":[{"t":"eq","v":"keypad","vt":"str"}],"checkall":"false","repair":false,"outputs":1,"x":570,"y":560,"wires":[["4e7d3ae95043cb22"]]},{"id":"fe424f7f0df4b835","type":"delay","z":"9129ecb0b2e786b5","name":"Waiting someone","pauseType":"delay","timeout":"1","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":2090,"y":780,"wires":[["1defc449734c6789"]]},{"id":"efc3ace2f5459c3d","type":"api-current-state","z":"9129ecb0b2e786b5","name":"Waiting Friend?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.waiting_someone","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":1400,"y":800,"wires":[["dc6ce34e3cd606ee"],[]]},{"id":"1defc449734c6789","type":"api-call-service","z":"9129ecb0b2e786b5","name":"toggle boolean","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.waiting_someone"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2400,"y":780,"wires":[[]]},{"id":"dc6ce34e3cd606ee","type":"api-call-service","z":"9129ecb0b2e786b5","name":"Unlock Door","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"lock","service":"unlock","areaId":[],"deviceId":[],"entityId":["lock.lock_front_door"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1850,"y":780,"wires":[["fe424f7f0df4b835"]]},{"id":"5766b84ea23f309d","type":"trigger","z":"9129ecb0b2e786b5","name":"Conditional unlock","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"2","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":590,"y":780,"wires":[["164444a432f43b30"]]},{"id":"135ffc12cc8a9219","type":"change","z":"9129ecb0b2e786b5","name":"fay","rules":[{"t":"set","p":"message","pt":"msg","to":"Fay has arrived","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1070,"y":860,"wires":[["033b1ec54a679634","efc3ace2f5459c3d"]]},{"id":"bb4fc65e4c3771da","type":"change","z":"9129ecb0b2e786b5","name":"Nate","rules":[{"t":"set","p":"message","pt":"msg","to":"Nate has arrived","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1070,"y":820,"wires":[["033b1ec54a679634","efc3ace2f5459c3d"]]},{"id":"164444a432f43b30","type":"switch","z":"9129ecb0b2e786b5","name":"WHO","property":"payload.action_user","propertyType":"msg","rules":[{"t":"eq","v":"4","vt":"num"},{"t":"eq","v":"6","vt":"num"},{"t":"eq","v":"2","vt":"num"}],"checkall":"false","repair":false,"outputs":3,"x":890,"y":780,"wires":[["bb4fc65e4c3771da"],["135ffc12cc8a9219"],["87ed40203b0dd275"]]},{"id":"6e9fda890201b1e9","type":"change","z":"9129ecb0b2e786b5","name":"Set Data for someone coming in","rules":[{"t":"set","p":"color_value","pt":"msg","to":"[0,255,0]","tot":"json"},{"t":"set","p":"dbrigthness","pt":"msg","to":"100","tot":"num"},{"t":"set","p":"message","pt":"msg","to":"Someone Has Arrived","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1430,"y":720,"wires":[["e8ec9cc76512c674"]]},{"id":"464e1cbb64c196f9","type":"link out","z":"9129ecb0b2e786b5","name":"Light and Speakers","links":["45904ca6429d867d","ad88dbd2.4726b8","3405e943.fd3ee6","9cf42cf7ef60f645"],"x":1855,"y":720,"wires":[]},{"id":"3d691f6efc74ddfa","type":"change","z":"9129ecb0b2e786b5","name":"Nate","rules":[{"t":"set","p":"payload","pt":"msg","to":"Nate","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1290,"y":640,"wires":[["e38272d3ac048e18"]]},{"id":"e8ec9cc76512c674","type":"subflow:233ac7dcd801a802","z":"9129ecb0b2e786b5","name":"","x":1670,"y":720,"wires":[]},{"id":"64dae779b17457c4","type":"subflow:233ac7dcd801a802","z":"9129ecb0b2e786b5","name":"","x":1610,"y":900,"wires":[]},{"id":"7f5ab158dfc055c8","type":"subflow:233ac7dcd801a802","z":"9129ecb0b2e786b5","name":"","x":1910,"y":620,"wires":[]},{"id":"e3e25ac88e5ab623","type":"subflow:233ac7dcd801a802","z":"9129ecb0b2e786b5","name":"","x":2100,"y":120,"wires":[]},{"id":"bc9650546cbcae8c","type":"subflow:233ac7dcd801a802","z":"9129ecb0b2e786b5","name":"","x":1170,"y":720,"wires":[]},{"id":"28a14dc96797d297","type":"inject","z":"9129ecb0b2e786b5","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":790,"y":840,"wires":[["397ffc396432a16c"]]},{"id":"87ed40203b0dd275","type":"change","z":"9129ecb0b2e786b5","name":"Thierry","rules":[{"t":"set","p":"payload","pt":"msg","to":"Thierry","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1040,"y":920,"wires":[["033b1ec54a679634","efc3ace2f5459c3d"]]},{"id":"1d8627470cc42d59","type":"trigger","z":"9129ecb0b2e786b5","name":"TV Fuse","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"10","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":900,"y":1500,"wires":[[]]},{"id":"2420a8742b41f8c4","type":"inject","z":"9129ecb0b2e786b5","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1320,"y":60,"wires":[["a54db271c14c6fdb"]]},{"id":"c6bf404c85cc060d","type":"api-current-state","z":"9129ecb0b2e786b5","name":"Temp","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"22","halt_if_type":"num","halt_if_compare":"lt","entity_id":"sensor.sensor_outside_temperature_temperature","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1690,"y":120,"wires":[["6877bf1fa1529499"],["6877bf1fa1529499"]]},{"id":"825422edd568257b","type":"comment","z":"9129ecb0b2e786b5","name":"","info":"","x":740,"y":120,"wires":[]},{"id":"f44b280056ae23f9","type":"comment","z":"9129ecb0b2e786b5","name":"","info":"","x":120,"y":620,"wires":[]},{"id":"b24be01b08a4ae3e","type":"server-state-changed","z":"fbee724e036776a8","name":"Humidity over 65","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.sensor_bathroom_temperature_humidity","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"70","halt_if_type":"num","halt_if_compare":"gt","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":260,"y":1200,"wires":[["8f5029a7732431a1","f186e9ea925af2ec"],["2852a4909668e796"]]},{"id":"8f5029a7732431a1","type":"api-call-service","z":"fbee724e036776a8","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.bathroom_fan"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":710,"y":1180,"wires":[[]]},{"id":"2852a4909668e796","type":"api-call-service","z":"fbee724e036776a8","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.bathroom_fan"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":710,"y":1240,"wires":[[]]},{"id":"f186e9ea925af2ec","type":"trigger","z":"fbee724e036776a8","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"20","extend":false,"overrideDelay":false,"units":"min","reset":"on","bytopic":"all","topic":"topic","outputs":1,"x":690,"y":1140,"wires":[["d9fca36cb2a4092d"]]},{"id":"d9fca36cb2a4092d","type":"api-current-state","z":"fbee724e036776a8","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.sensor_bathroom_door_contact","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1020,"y":1140,"wires":[[],["b596e9a2015af841"]]},{"id":"b596e9a2015af841","type":"api-call-service","z":"fbee724e036776a8","name":"Bathroom Speaker","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_up","areaId":[],"deviceId":[],"entityId":["media_player.bathroom_speaker"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1350,"y":1140,"wires":[["b2412d064f56fa8f"]]},{"id":"b2412d064f56fa8f","type":"api-call-service","z":"fbee724e036776a8","name":"Bathroom Speaker","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_up","areaId":[],"deviceId":[],"entityId":["media_player.bathroom_speaker"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1550,"y":1140,"wires":[[]]},{"id":"93adc38d854d7460","type":"api-current-state","z":"2d6a330c11854cb5","name":"alarm on?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"armed_home","halt_if_type":"str","halt_if_compare":"is","entity_id":"alarm_control_panel.home_alarm","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":380,"y":420,"wires":[["638856532dd30b3e"],[]]},{"id":"7a1ec2fba26a47d0","type":"server-state-changed","z":"2d6a330c11854cb5","name":"Maxi's Door","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.sensor_bedroom_door_contact","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":190,"y":420,"wires":[[],["93adc38d854d7460"]]},{"id":"638856532dd30b3e","type":"api-call-service","z":"2d6a330c11854cb5","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"mobile_app_phone_galaxy_fold_4","areaId":[],"deviceId":[],"entityId":[],"data":"{\"message\":\"Bedroom door open\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":670,"y":420,"wires":[[]]},{"id":"29b35589c2243599","type":"server-state-changed","z":"2d6a330c11854cb5","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.aerating_appartment","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":230,"y":660,"wires":[["c915141251579780"],["c915141251579780"]]},{"id":"c915141251579780","type":"trigger","z":"2d6a330c11854cb5","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"4","extend":false,"units":"hr","reset":"off","bytopic":"all","outputs":1,"x":570,"y":660,"wires":[["62828b024111a509"]]},{"id":"62828b024111a509","type":"api-call-service","z":"2d6a330c11854cb5","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.aerating_appartment"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":820,"y":660,"wires":[[]]},{"id":"64760f998ab03189","type":"server-state-changed","z":"2d6a330c11854cb5","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.sleeper_in_hotbox_down","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":240,"y":720,"wires":[["37ecdb11bfa11ae2"],["37ecdb11bfa11ae2"]]},{"id":"37ecdb11bfa11ae2","type":"trigger","z":"2d6a330c11854cb5","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"12","extend":false,"units":"hr","reset":"off","bytopic":"all","outputs":1,"x":570,"y":720,"wires":[["9093da61f51fa457"]]},{"id":"9093da61f51fa457","type":"api-call-service","z":"2d6a330c11854cb5","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.sleeper_in_hotbox_down"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":820,"y":720,"wires":[[]]},{"id":"a1f6ae705980aa72","type":"server-state-changed","z":"2d6a330c11854cb5","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.party_mode","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":200,"y":600,"wires":[["f3a62a39186f0880"],["f3a62a39186f0880"]]},{"id":"f3a62a39186f0880","type":"trigger","z":"2d6a330c11854cb5","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"16","extend":false,"units":"hr","reset":"off","bytopic":"all","outputs":1,"x":570,"y":600,"wires":[["1858e80fd72d7331"]]},{"id":"1858e80fd72d7331","type":"api-call-service","z":"2d6a330c11854cb5","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.party_mode"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":820,"y":600,"wires":[[]]},{"id":"a545098e93063c30","type":"poll-state","z":"2d6a330c11854cb5","name":"","server":"7ab5c227.a3ce8c","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"10","updateIntervalType":"num","updateIntervalUnits":"minutes","outputinitially":true,"outputonchanged":true,"entity_id":"sensor.guest_wifi_count","state_type":"str","halt_if":"5","halt_if_type":"num","halt_if_compare":"gt","outputs":2,"x":180,"y":1080,"wires":[["7f0ee9081156fcfb"],[]]},{"id":"5bcbff91150259e8","type":"api-call-service","z":"2d6a330c11854cb5","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_on","areaId":[],"deviceId":[],"entityId":["input_boolean.party_mode"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":800,"y":1080,"wires":[[]]},{"id":"912b12a79e73067f","type":"debug","z":"2d6a330c11854cb5","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":320,"y":1140,"wires":[]},{"id":"dc677e1625f9f7d7","type":"server-state-changed","z":"2d6a330c11854cb5","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.sleeper_in_living_room","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":240,"y":760,"wires":[["f43b056a40b85b61"],["f43b056a40b85b61"]]},{"id":"f43b056a40b85b61","type":"trigger","z":"2d6a330c11854cb5","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"16","extend":false,"overrideDelay":false,"units":"hr","reset":"off","bytopic":"all","topic":"topic","outputs":1,"x":570,"y":760,"wires":[["9028e01c481ed0bf"]]},{"id":"9028e01c481ed0bf","type":"api-call-service","z":"2d6a330c11854cb5","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.sleeper_in_living_room"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":820,"y":760,"wires":[[]]},{"id":"ae8214fef4794096","type":"server-state-changed","z":"2d6a330c11854cb5","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.waiting_uber","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":210,"y":560,"wires":[["802487c0a965ce8f"],["802487c0a965ce8f"]]},{"id":"802487c0a965ce8f","type":"trigger","z":"2d6a330c11854cb5","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"2","extend":false,"units":"hr","reset":"off","bytopic":"all","outputs":1,"x":570,"y":560,"wires":[["10bf613b28d2b771"]]},{"id":"10bf613b28d2b771","type":"api-call-service","z":"2d6a330c11854cb5","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.waiting_uber"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":820,"y":560,"wires":[[]]},{"id":"97a724886d64a97c","type":"server-state-changed","z":"2d6a330c11854cb5","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.waiting_someone","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":220,"y":980,"wires":[["6665d2f0a62b2458"],["6665d2f0a62b2458"]]},{"id":"6665d2f0a62b2458","type":"trigger","z":"2d6a330c11854cb5","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"4","extend":false,"units":"hr","reset":"off","bytopic":"all","outputs":1,"x":570,"y":980,"wires":[["1169bfdff2196c25"]]},{"id":"1169bfdff2196c25","type":"api-call-service","z":"2d6a330c11854cb5","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.waiting_someone"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":820,"y":980,"wires":[[]]},{"id":"41b855c4656819d9","type":"api-call-service","z":"2d6a330c11854cb5","name":"Waiting Uber On","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_on","areaId":[],"deviceId":[],"entityId":["input_boolean.waiting_uber"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":540,"y":500,"wires":[["204698739c72ab37"]]},{"id":"fdf7a6c89fe9963a","type":"server-state-changed","z":"2d6a330c11854cb5","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.purgatoire1134_uber","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"On","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":210,"y":500,"wires":[["41b855c4656819d9"],[]]},{"id":"204698739c72ab37","type":"trigger","z":"2d6a330c11854cb5","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"2","extend":false,"units":"hr","reset":"off","bytopic":"all","outputs":1,"x":750,"y":500,"wires":[["e177626eb96a0b33"]]},{"id":"96902e73ee61f8e9","type":"inject","z":"2d6a330c11854cb5","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1120,"y":600,"wires":[[]]},{"id":"e177626eb96a0b33","type":"api-call-service","z":"2d6a330c11854cb5","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.waiting_uber"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1000,"y":500,"wires":[[]]},{"id":"0a8395570fa2f6bc","type":"server-state-changed","z":"2d6a330c11854cb5","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.sleeper_in_patio","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":260,"y":1280,"wires":[["b7f43b455d51f470"],["b7f43b455d51f470"]]},{"id":"b7f43b455d51f470","type":"trigger","z":"2d6a330c11854cb5","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"50","extend":false,"overrideDelay":false,"units":"min","reset":"off","bytopic":"all","topic":"topic","outputs":1,"x":610,"y":1280,"wires":[["b96e4355a27da356"]]},{"id":"728f7e9fda6c598e","type":"api-call-service","z":"2d6a330c11854cb5","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.sleeper_in_patio"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1040,"y":1280,"wires":[[]]},{"id":"56a835fbda1b9848","type":"server-state-changed","z":"2d6a330c11854cb5","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.acid_time","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":180,"y":860,"wires":[["76287bfdba498114"],["76287bfdba498114"]]},{"id":"76287bfdba498114","type":"trigger","z":"2d6a330c11854cb5","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"10","extend":false,"units":"hr","reset":"off","bytopic":"all","outputs":1,"x":550,"y":860,"wires":[["c83d633b59202aef"]]},{"id":"c83d633b59202aef","type":"api-call-service","z":"2d6a330c11854cb5","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.acid_time"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":800,"y":860,"wires":[[]]},{"id":"e99ef5d6c51baecd","type":"server-state-changed","z":"2d6a330c11854cb5","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.maxi_sleeping","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"re","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":530,"y":900,"wires":[["c83d633b59202aef"],[]]},{"id":"b96e4355a27da356","type":"ha-wait-until","z":"2d6a330c11854cb5","name":"","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"binary_sensor.patio_occupancy","entityIdFilterType":"exact","property":"state","comparator":"is","value":"off","valueType":"str","timeout":"1","timeoutType":"num","timeoutUnits":"hours","checkCurrentState":false,"blockInputOverrides":false,"outputProperties":[],"x":780,"y":1280,"wires":[["728f7e9fda6c598e"],["728f7e9fda6c598e"]]},{"id":"5054b8f14e130019","type":"comment","z":"2d6a330c11854cb5","name":"","info":"","x":120,"y":1080,"wires":[]},{"id":"2ff6d60b902197c9","type":"comment","z":"2d6a330c11854cb5","name":"","info":"","x":100,"y":1280,"wires":[]},{"id":"9d147c8af2667865","type":"comment","z":"2d6a330c11854cb5","name":"","info":"","x":80,"y":980,"wires":[]},{"id":"69cf6e9e9ba39e25","type":"comment","z":"2d6a330c11854cb5","name":"","info":"","x":60,"y":840,"wires":[]},{"id":"7f0ee9081156fcfb","type":"api-current-state","z":"2d6a330c11854cb5","name":"kink?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.kink_party","state_type":"str","blockInputOverrides":true,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":430,"y":1080,"wires":[["29a06ed07402c034"],[]]},{"id":"29a06ed07402c034","type":"api-current-state","z":"2d6a330c11854cb5","name":"Acid?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.acid_time","state_type":"str","blockInputOverrides":true,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":550,"y":1080,"wires":[["5bcbff91150259e8"],[]]},{"id":"365fec807dfe5446","type":"inject","z":"a63e8f060776799f","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1040,"y":200,"wires":[["20533b4330450f4a"]]},{"id":"760b43caaf04e1f3","type":"server-state-changed","z":"a63e8f060776799f","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.maxi_sleeping","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":330,"y":220,"wires":[["a70d7c2077155953"]]},{"id":"a70d7c2077155953","type":"switch","z":"a63e8f060776799f","name":"","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"off","vt":"str"},{"t":"cont","v":"on","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":630,"y":200,"wires":[["28dfaa2ad5d1b5ac"],["91bf062a0f1540ac","aa4ba674728f9164","8e811592c7e817cc"]]},{"id":"7c1f43deb3fe618b","type":"server-state-changed","z":"a63e8f060776799f","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.plug_bedroom_screens","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":410,"y":80,"wires":[[],[]]},{"id":"90548905ad8e1a3b","type":"api-call-service","z":"a63e8f060776799f","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"cover","service":"close_cover","areaId":[],"deviceId":[],"entityId":["cover.cover_bedroom_blinds"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":880,"y":320,"wires":[[]]},{"id":"91bf062a0f1540ac","type":"api-call-service","z":"a63e8f060776799f","name":"Door on","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.front_door_light"],"data":"{\"color_name\":\"white\",\"brightness_pct\":\"30\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":840,"y":280,"wires":[[]]},{"id":"98e4aa6366974d78","type":"api-current-state","z":"a63e8f060776799f","name":"Cell Battery State off for test","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"discharging","halt_if_type":"re","halt_if_compare":"is_not","entity_id":"sensor.phone_fold3_battery_state","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":940,"y":380,"wires":[[],["51c0515398c5ff74"]]},{"id":"e8202430f35c1ff8","type":"change","z":"a63e8f060776799f","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1690,"y":360,"wires":[["75b2c6cc4d3e4f1c"]]},{"id":"75b2c6cc4d3e4f1c","type":"trigger","z":"a63e8f060776799f","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"10","extend":false,"overrideDelay":false,"units":"hr","reset":"open","bytopic":"all","topic":"topic","outputs":1,"x":1940,"y":360,"wires":[["4e0a7f2f5610297b"]]},{"id":"59ebd9db56bfb1d3","type":"trigger","z":"a63e8f060776799f","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"1","extend":false,"overrideDelay":false,"units":"ms","reset":"open","bytopic":"all","topic":"topic","outputs":1,"x":1460,"y":360,"wires":[["e8202430f35c1ff8"]]},{"id":"bc79300b82747379","type":"inject","z":"a63e8f060776799f","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"bedroom","payload":"bedroom","payloadType":"str","x":190,"y":1740,"wires":[["7267ca78a237f765"]]},{"id":"20533b4330450f4a","type":"exec","z":"a63e8f060776799f","command":"catt -d 'Kitchen display' cast_site 'http://192.168.0.15:8123/lovelace-hub/kitchen-hub'","addpay":false,"append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"","x":1410,"y":80,"wires":[[],[],[]]},{"id":"aa4ba674728f9164","type":"api-call-service","z":"a63e8f060776799f","name":"Entrance Light off","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.group_entrance_lights"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":870,"y":420,"wires":[[]]},{"id":"5d35a988b722286a","type":"cast-to-client","z":"a63e8f060776799f","name":"Cast rain","url":"","contentType":"","message":"","language":"en","ip":"192.168.0.31","port":"","volume":"100","x":2000,"y":1300,"wires":[[]]},{"id":"a1efc077dfcf27ab","type":"inject","z":"a63e8f060776799f","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":500,"y":1280,"wires":[[]]},{"id":"e272a021e42cab07","type":"debug","z":"a63e8f060776799f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":410,"y":1540,"wires":[]},{"id":"51c0515398c5ff74","type":"api-current-state","z":"a63e8f060776799f","name":"Sun","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"below_horizon","halt_if_type":"str","halt_if_compare":"is","entity_id":"sun.sun","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1150,"y":360,"wires":[["59ebd9db56bfb1d3"],[]]},{"id":"f6c4312697ffa9b2","type":"inject","z":"a63e8f060776799f","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":580,"y":840,"wires":[[]]},{"id":"299bc6e5ba30085c","type":"api-current-state","z":"a63e8f060776799f","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"playing","halt_if_type":"str","halt_if_compare":"is","entity_id":"media_player.bedroom_display","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":910,"y":100,"wires":[["20533b4330450f4a"],[]]},{"id":"24911765eed39973","type":"api-current-state","z":"a63e8f060776799f","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"playing","halt_if_type":"str","halt_if_compare":"is","entity_id":"media_player.bedroom_display","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":910,"y":60,"wires":[["20533b4330450f4a"],[]]},{"id":"c149bb96919fc469","type":"api-call-service","z":"a63e8f060776799f","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"play_media","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1950,"y":920,"wires":[["6820d39e35eb567f","64abad6dcb7e88aa"]]},{"id":"4a6939092c4913b8","type":"debug","z":"a63e8f060776799f","name":"1","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1850,"y":720,"wires":[]},{"id":"549e205775ac8960","type":"change","z":"a63e8f060776799f","name":"","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"media_player.dungeon_speaker","tot":"str"},{"t":"set","p":"payload.data.media_content_id","pt":"msg","to":"url","tot":"msg"},{"t":"set","p":"payload.data.media_content_type","pt":"msg","to":"music","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1700,"y":920,"wires":[["c149bb96919fc469","4a6939092c4913b8"]]},{"id":"6820d39e35eb567f","type":"debug","z":"a63e8f060776799f","name":"2","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":2110,"y":820,"wires":[]},{"id":"79a7fa4a36c8080b","type":"api-call-service","z":"a63e8f060776799f","name":"volume to 100%","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_set","areaId":[],"deviceId":[],"entityId":["media_player.dungeon_speaker"],"data":"{\"volume_level\":\"0.5\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2460,"y":920,"wires":[[]]},{"id":"64abad6dcb7e88aa","type":"change","z":"a63e8f060776799f","name":"","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2240,"y":920,"wires":[["79a7fa4a36c8080b"]]},{"id":"47c3b01d2b44d1ba","type":"api-call-service","z":"a63e8f060776799f","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"tts","service":"google_say","areaId":[],"deviceId":[],"entityId":["media_player.dungeon_speaker"],"data":"{\"message\":\"Phone Unplugged\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2350,"y":360,"wires":[[]]},{"id":"4e0a7f2f5610297b","type":"api-call-service","z":"a63e8f060776799f","name":"volume to 100%","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_set","areaId":[],"deviceId":[],"entityId":["media_player.dungeon_speaker"],"data":"{\"volume_level\":\"1.0\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2140,"y":360,"wires":[["47c3b01d2b44d1ba"]]},{"id":"2f71f59792af3bf6","type":"server-state-changed","z":"a63e8f060776799f","name":"fitbit","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.b7bracelet1","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":150,"y":1920,"wires":[["183e626415b39074","7267ca78a237f765","ab0fe11c795af373"]]},{"id":"183e626415b39074","type":"trigger","z":"a63e8f060776799f","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"25","extend":false,"overrideDelay":false,"units":"min","reset":"bedroom","bytopic":"all","topic":"topic","outputs":1,"x":310,"y":1920,"wires":[["71b0161976eeb6c6","ab0fe11c795af373"]]},{"id":"d3c816eec1d52897","type":"api-current-state","z":"a63e8f060776799f","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"not_home","halt_if_type":"str","halt_if_compare":"is","entity_id":"person.maxi","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":940,"y":1880,"wires":[["c8ffc52813ab4c6e"],[]]},{"id":"64c50d4caf88a7ae","type":"switch","z":"a63e8f060776799f","name":"","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"not_home","vt":"str"},{"t":"nempty"}],"checkall":"false","repair":false,"outputs":2,"x":750,"y":1920,"wires":[["d3c816eec1d52897"],["c8ffc52813ab4c6e"]]},{"id":"c8ffc52813ab4c6e","type":"api-current-state","z":"a63e8f060776799f","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"closed","halt_if_type":"str","halt_if_compare":"is_not","entity_id":"cover.cover_bedroom_blinds","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1270,"y":1920,"wires":[["880e01781d449cb1"],[]]},{"id":"0e5ef086fa90ee87","type":"api-call-service","z":"a63e8f060776799f","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"cover","service":"close_cover","areaId":[],"deviceId":[],"entityId":["cover.cover_bedroom_blinds"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1920,"y":1920,"wires":[[]]},{"id":"8e811592c7e817cc","type":"api-call-service","z":"a63e8f060776799f","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.galaxy_tab_a7_lite_screen"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":870,"y":240,"wires":[[]]},{"id":"880e01781d449cb1","type":"api-current-state","z":"a63e8f060776799f","name":"Motion Bedroom","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.sensor_bedroom_motion_occupancy","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1540,"y":1920,"wires":[["8ff5c5dbbc899cc2"],[]]},{"id":"8ff5c5dbbc899cc2","type":"api-current-state","z":"a63e8f060776799f","name":"Motion Dungeon","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.sensor_dungeon_motion_occupancy","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1720,"y":1920,"wires":[["0e5ef086fa90ee87"],[]]},{"id":"71b0161976eeb6c6","type":"trigger","z":"a63e8f060776799f","name":"","op1":"","op2":"","op1type":"pay","op2type":"payl","duration":"-5","extend":false,"overrideDelay":false,"units":"min","reset":"bedroom","bytopic":"all","topic":"topic","outputs":1,"x":530,"y":1920,"wires":[["ab0fe11c795af373"]]},{"id":"7267ca78a237f765","type":"switch","z":"a63e8f060776799f","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"bedroom","vt":"str"},{"t":"regex","v":"(nate|closet)","vt":"str","case":true}],"checkall":"true","repair":false,"outputs":2,"x":310,"y":1840,"wires":[["71b0161976eeb6c6"],["1474666815686ef0"]]},{"id":"7a1992166567db89","type":"exec","z":"a63e8f060776799f","command":"catt -d 'Bedroom display' cast_site 'http://192.168.0.15:8123/lovelace-hub/hub-view'","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"Nest Hub","x":1000,"y":880,"wires":[[],[],[]]},{"id":"ab0fe11c795af373","type":"debug","z":"a63e8f060776799f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":660,"y":2000,"wires":[]},{"id":"e5a2bf75fcebfef9","type":"exec","z":"a63e8f060776799f","command":"catt -d 'Bedroom display' cast_site 'http://192.168.0.15:8123/lovelace-hub/hub-view'","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":1930,"y":2980,"wires":[[],[],[]]},{"id":"7c9eb686ba46b2d1","type":"inject","z":"a63e8f060776799f","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1500,"y":2980,"wires":[["e5a2bf75fcebfef9"]]},{"id":"83e67b3475a4e571","type":"server-state-changed","z":"a63e8f060776799f","name":"screens","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.plug_bedroom_screens","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":150,"y":1200,"wires":[["e41336d8cd464693"],["f965d6b36db21ca8"]]},{"id":"587d714c0583f41d","type":"api-call-service","z":"a63e8f060776799f","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"select_source","areaId":[],"deviceId":[],"entityId":["media_player.bedroom_roku"],"data":"{\"source\": \"PC\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":850,"y":1160,"wires":[[]]},{"id":"329756e0d730423e","type":"api-call-service","z":"a63e8f060776799f","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"select_source","areaId":[],"deviceId":[],"entityId":["media_player.bedroom_roku"],"data":"{\"source\": \"chromecast\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1190,"y":1220,"wires":[[]]},{"id":"5d520d0d1b5f89e2","type":"api-current-state","z":"a63e8f060776799f","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"remote.bedroom_roku","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":850,"y":1220,"wires":[["329756e0d730423e"],[]]},{"id":"f965d6b36db21ca8","type":"api-current-state","z":"a63e8f060776799f","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.maxi_sleeping","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":490,"y":1220,"wires":[["5d520d0d1b5f89e2"],["6d8113a9f743ca23"]]},{"id":"e41336d8cd464693","type":"api-current-state","z":"a63e8f060776799f","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"(paused|playing)","halt_if_type":"re","halt_if_compare":"is_not","entity_id":"media_player.bedroom_chromecast","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":510,"y":1160,"wires":[["587d714c0583f41d"],[]]},{"id":"6d8113a9f743ca23","type":"api-call-service","z":"a63e8f060776799f","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"turn_off","areaId":[],"deviceId":[],"entityId":["media_player.bedroom_tv"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":820,"y":1260,"wires":[[]]},{"id":"d6339aa3be357df9","type":"inject","z":"a63e8f060776799f","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":200,"y":1160,"wires":[["e41336d8cd464693"]]},{"id":"0fe9233e4dddbb6b","type":"server-state-changed","z":"a63e8f060776799f","name":"dab timer","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.dab_timer","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":180,"y":2880,"wires":[["7fa433b334953ab9"],["7fa433b334953ab9"]]},{"id":"7fa433b334953ab9","type":"trigger","z":"a63e8f060776799f","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"37","extend":false,"overrideDelay":false,"units":"s","reset":"off","bytopic":"all","topic":"topic","outputs":1,"x":410,"y":2880,"wires":[["3e29f4f311826d3c","189ed02d888af947"]]},{"id":"d142f0727ab9682a","type":"api-call-service","z":"a63e8f060776799f","name":"Output speaker","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"tts","service":"google_say","areaId":[],"deviceId":[],"entityId":["media_player.office_speaker"],"data":"{\"message\":\"SMOKE UP!\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":780,"y":2880,"wires":[["c6268f0fdf508144"]]},{"id":"e3b437d2ce5552b4","type":"inject","z":"a63e8f060776799f","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":460,"y":2800,"wires":[["189ed02d888af947"]]},{"id":"3e29f4f311826d3c","type":"api-call-service","z":"a63e8f060776799f","name":"dab timer off","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.dab_timer"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":750,"y":2840,"wires":[[]]},{"id":"59f68293cfc7a9a9","type":"api-call-service","z":"a63e8f060776799f","name":"Stop cast ","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"turn_off","areaId":[],"deviceId":[],"entityId":["media_player.office_speaker"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1380,"y":2880,"wires":[[]]},{"id":"66a9f55810d27b23","type":"trigger","z":"a63e8f060776799f","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"6","extend":false,"units":"s","reset":"off","bytopic":"all","outputs":1,"x":1220,"y":2880,"wires":[["59f68293cfc7a9a9"]]},{"id":"189ed02d888af947","type":"change","z":"a63e8f060776799f","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":2880,"wires":[["d142f0727ab9682a"]]},{"id":"c6268f0fdf508144","type":"api-call-service","z":"a63e8f060776799f","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":true,"domain":"media_player","service":"volume_set","areaId":[],"deviceId":[],"entityId":["media_player.office_speaker"],"data":"{ \"volume_level\": \"0.6\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1010,"y":2880,"wires":[["66a9f55810d27b23"]]},{"id":"b1eb0f65e6afc34c","type":"bigtimer","z":"a63e8f060776799f","outtopic":"","outpayload1":"","outpayload2":"","name":"Big Timer","comment":"","lat":0,"lon":0,"starttime":"510","endtime":"525","starttime2":0,"endtime2":0,"startoff":0,"endoff":0,"startoff2":0,"endoff2":0,"offs":0,"outtext1":"","outtext2":"","timeout":1440,"sun":false,"mon":true,"tue":true,"wed":false,"thu":true,"fri":true,"sat":false,"jan":true,"feb":true,"mar":true,"apr":true,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"day6":0,"month6":0,"day7":0,"month7":0,"day8":0,"month8":0,"day9":0,"month9":0,"day10":0,"month10":0,"day11":0,"month11":0,"day12":0,"month12":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"d6":0,"w6":0,"xday1":0,"xmonth1":0,"xday2":0,"xmonth2":0,"xday3":0,"xmonth3":0,"xday4":0,"xmonth4":0,"xday5":0,"xmonth5":0,"xday6":0,"xmonth6":0,"xday7":0,"xmonth7":0,"xday8":0,"xmonth8":0,"xday9":0,"xmonth9":0,"xday10":0,"xmonth10":0,"xday11":0,"xmonth11":0,"xday12":0,"xmonth12":0,"xd1":0,"xw1":0,"xd2":0,"xw2":0,"xd3":0,"xw3":0,"xd4":0,"xw4":0,"xd5":0,"xw5":0,"xd6":0,"xw6":0,"suspend":false,"random":false,"randon1":false,"randoff1":false,"randon2":false,"randoff2":false,"repeat":true,"atstart":true,"odd":false,"even":false,"x":140,"y":3020,"wires":[[],[],[]]},{"id":"d31dee63f8e40582","type":"debug","z":"a63e8f060776799f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1050,"y":3020,"wires":[]},{"id":"515e12022a8a684d","type":"api-call-service","z":"a63e8f060776799f","name":"Brigthen lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.bedroom_lights"],"data":"{\"brightness_step\":20}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":940,"y":2980,"wires":[[]]},{"id":"9dbcdb47c5d21212","type":"switch","z":"a63e8f060776799f","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":780,"y":3020,"wires":[["d31dee63f8e40582","515e12022a8a684d"]]},{"id":"4e1dd84c28420888","type":"api-call-service","z":"a63e8f060776799f","name":"1% light","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.bedroom_lights"],"data":"{\"brightness\":1,\"color_name\":\"yellow\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":500,"y":3000,"wires":[[]]},{"id":"fb2298c75280ec47","type":"inject","z":"a63e8f060776799f","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":720,"y":2980,"wires":[["515e12022a8a684d"]]},{"id":"5b30c0a9f8d3301a","type":"api-current-state","z":"a63e8f060776799f","name":"Chandelier","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.maxi_chandelier","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":350,"y":3000,"wires":[["4e1dd84c28420888"],[]]},{"id":"4ad2f8a4e4e5d72f","type":"api-call-service","z":"a63e8f060776799f","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"play_media","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1950,"y":880,"wires":[["fae21ab79b3f6373"]]},{"id":"f028ca2de3623e41","type":"change","z":"a63e8f060776799f","name":"","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"media_player.bedroom_speaker","tot":"str"},{"t":"set","p":"payload.data.media_content_id","pt":"msg","to":"url","tot":"msg"},{"t":"set","p":"payload.data.media_content_type","pt":"msg","to":"music","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1700,"y":880,"wires":[["4ad2f8a4e4e5d72f"]]},{"id":"791b334c94095e17","type":"api-call-service","z":"a63e8f060776799f","name":"volume to 100%","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_set","areaId":[],"deviceId":[],"entityId":["media_player.bedroom_speaker"],"data":"{\"volume_level\":\"0.4\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2460,"y":880,"wires":[[]]},{"id":"fae21ab79b3f6373","type":"change","z":"a63e8f060776799f","name":"","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2240,"y":880,"wires":[["791b334c94095e17"]]},{"id":"4976d18b20e988eb","type":"server-state-changed","z":"a63e8f060776799f","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"media_player.bedroom_speaker","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is_not","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":340,"y":3380,"wires":[["4006878153070816"],[]]},{"id":"4006878153070816","type":"switch","z":"a63e8f060776799f","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"playing","vt":"str"},{"t":"eq","v":"paused","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":590,"y":3380,"wires":[["48caf1fe83b12624"],["21627fa81186b760"]]},{"id":"48caf1fe83b12624","type":"api-current-state","z":"a63e8f060776799f","name":"current_volume","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"0","halt_if_type":"num","halt_if_compare":"gt","entity_id":"sensor.pc_maxi_desktop_audio_peak_volume","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":740,"y":3360,"wires":[["61ad21bce2a590ef"],[]]},{"id":"ae633845b12d621b","type":"api-call-service","z":"a63e8f060776799f","name":"Press Mute PC","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"button","service":"press","areaId":[],"deviceId":[],"entityId":["button.pc_maxi_desktop_mediamute"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1440,"y":3360,"wires":[[]]},{"id":"a4337ad1cfcc2473","type":"server-state-changed","z":"a63e8f060776799f","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"media_player.bedroom_chromecast","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is_not","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":290,"y":3580,"wires":[["a6ab2a3d4e637f37"],[]]},{"id":"7f9e6155ec276a39","type":"api-current-state","z":"a63e8f060776799f","name":"current_volume","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"0","halt_if_type":"num","halt_if_compare":"gt","entity_id":"sensor.pc_maxi_desktop_audio_peak_volume","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"entity","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":840,"y":3580,"wires":[["66cb4b0252d59597"],[]]},{"id":"a6ab2a3d4e637f37","type":"switch","z":"a63e8f060776799f","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"playing","vt":"str"},{"t":"eq","v":"paused","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":630,"y":3580,"wires":[["7f9e6155ec276a39"],["99f041244c587270"],["99f041244c587270"]]},{"id":"55e256c1b7656db1","type":"inject","z":"a63e8f060776799f","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":660,"y":3520,"wires":[["7f9e6155ec276a39"]]},{"id":"66cb4b0252d59597","type":"api-call-service","z":"a63e8f060776799f","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"button","service":"press","areaId":[],"deviceId":[],"entityId":["button.pc_maxi_desktop_mediamute"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1290,"y":3580,"wires":[["36f0305a718a12de"]]},{"id":"36f0305a718a12de","type":"ha-wait-until","z":"a63e8f060776799f","name":"","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"media_player.bedroom_chromecast","entityIdFilterType":"exact","property":"attributes.volume_level","comparator":"lte","value":"0","valueType":"num","timeout":"120","timeoutType":"num","timeoutUnits":"seconds","checkCurrentState":true,"blockInputOverrides":true,"outputProperties":[],"x":1530,"y":3580,"wires":[["079a60465433d21b"],[]]},{"id":"9ffd6ebbcb2be97e","type":"inject","z":"a63e8f060776799f","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":600,"y":300,"wires":[["8e811592c7e817cc"]]},{"id":"28dfaa2ad5d1b5ac","type":"api-call-service","z":"a63e8f060776799f","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.galaxy_tab_a7_lite_screen"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":830,"y":160,"wires":[[]]},{"id":"9aeb99eff65888c8","type":"server-state-changed","z":"a63e8f060776799f","name":"Blind Button","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.remote_bedroom_blind_button_action","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"(open|close)","halt_if_type":"re","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":270,"y":1620,"wires":[["df4dfc6634396e31"],[]]},{"id":"df4dfc6634396e31","type":"switch","z":"a63e8f060776799f","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"open","vt":"str"},{"t":"eq","v":"close","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":450,"y":1620,"wires":[["98ea96b27706b031"],["6d77d1280ae4a187"]]},{"id":"98ea96b27706b031","type":"api-call-service","z":"a63e8f060776799f","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"cover","service":"open_cover","areaId":[],"deviceId":[],"entityId":["cover.cover_bedroom_blinds"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":680,"y":1600,"wires":[[]]},{"id":"6d77d1280ae4a187","type":"api-call-service","z":"a63e8f060776799f","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"cover","service":"close_cover","areaId":[],"deviceId":[],"entityId":["cover.cover_bedroom_blinds"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":630,"y":1640,"wires":[[]]},{"id":"61ad21bce2a590ef","type":"api-current-state","z":"a63e8f060776799f","name":"t headset?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"4- CORSAIR VOID ELITE Wireless Gaming Dongle","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.pc_maxi_desktop_audio_default_device","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":950,"y":3360,"wires":[["dc20f2bb5752ad2d"],[]]},{"id":"079a60465433d21b","type":"api-call-service","z":"a63e8f060776799f","name":"volume up","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"button","service":"press","areaId":[],"deviceId":[],"entityId":["button.pc_maxi_desktop_mediavolumeup"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1710,"y":3580,"wires":[[]]},{"id":"99f041244c587270","type":"api-call-service","z":"a63e8f060776799f","name":"volume up","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"button","service":"press","areaId":[],"deviceId":[],"entityId":["button.pc_maxi_desktop_mediavolumeup"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":830,"y":3640,"wires":[[]]},{"id":"21627fa81186b760","type":"api-call-service","z":"a63e8f060776799f","name":"volume up","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"button","service":"press","areaId":[],"deviceId":[],"entityId":["button.pc_maxi_desktop_mediavolumeup"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":730,"y":3400,"wires":[[]]},{"id":"0e2db767e92ce8f9","type":"debug","z":"a63e8f060776799f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":650,"y":3060,"wires":[]},{"id":"dc20f2bb5752ad2d","type":"api-current-state","z":"a63e8f060776799f","name":"gaming?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"Unknown","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.currentgamemaxi","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":1160,"y":3360,"wires":[["ae633845b12d621b"],[]]},{"id":"1daaf232867ba293","type":"server-state-changed","z":"a63e8f060776799f","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.maxi_pc_audio_audio_sessions","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is_not","outputs":1,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":260,"y":3160,"wires":[[]]},{"id":"b06487a807f61d1a","type":"switch","z":"a63e8f060776799f","name":"","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"Discord","vt":"str"},{"t":"eq","v":"[]","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":810,"y":3160,"wires":[["4211be611a001988","23e6ad615a6c6d2e"],["b1e36c74c06fd001","a080713765fe26e4"]]},{"id":"4211be611a001988","type":"trigger","z":"a63e8f060776799f","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"4","extend":false,"overrideDelay":false,"units":"s","reset":"notdiscord","bytopic":"all","topic":"topic","outputs":1,"x":1400,"y":3160,"wires":[["91a9b27800a70c02"]]},{"id":"b1e36c74c06fd001","type":"change","z":"a63e8f060776799f","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"notdiscord","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1160,"y":3200,"wires":[["4211be611a001988","2a2e40fb693189b9","15fdf1df952b6be9"]]},{"id":"2a2e40fb693189b9","type":"trigger","z":"a63e8f060776799f","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"2","extend":false,"overrideDelay":false,"units":"s","reset":"discord","bytopic":"all","topic":"topic","outputs":1,"x":1400,"y":3200,"wires":[["b2936f33846ebd93"]]},{"id":"23e6ad615a6c6d2e","type":"change","z":"a63e8f060776799f","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"discord","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1160,"y":3140,"wires":[["2a2e40fb693189b9"]]},{"id":"b2936f33846ebd93","type":"api-call-service","z":"a63e8f060776799f","name":"unmute","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_mute","areaId":[],"deviceId":[],"entityId":["media_player.bedroom_speaker","media_player.bedroom_ceiling_speaker","media_player.dungeon_speaker"],"data":"{\"is_volume_muted\": \"false\"}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1580,"y":3200,"wires":[[]]},{"id":"91a9b27800a70c02","type":"api-call-service","z":"a63e8f060776799f","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_mute","areaId":[],"deviceId":[],"entityId":["media_player.bedroom_speaker","media_player.bedroom_ceiling_speaker","media_player.dungeon_speaker"],"data":"{\"is_volume_muted\": \"true\"}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1650,"y":3160,"wires":[[]]},{"id":"a080713765fe26e4","type":"debug","z":"a63e8f060776799f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":890,"y":3240,"wires":[]},{"id":"15fdf1df952b6be9","type":"debug","z":"a63e8f060776799f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1290,"y":3260,"wires":[]},{"id":"c1ed70c25fdb3f35","type":"comment","z":"a63e8f060776799f","name":"mute speaker when discord","info":"","x":620,"y":3240,"wires":[]},{"id":"1474666815686ef0","type":"change","z":"a63e8f060776799f","name":"","rules":[{"t":"set","p":"reset","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":540,"y":1840,"wires":[["71b0161976eeb6c6","183e626415b39074"]]},{"id":"d0707dc12842a485","type":"comment","z":"a63e8f060776799f","name":"","info":"","x":240,"y":320,"wires":[]},{"id":"0fdb5e7a59e074e9","type":"comment","z":"a63e8f060776799f","name":"","info":"","x":320,"y":980,"wires":[]},{"id":"153257f4ebe93de8","type":"comment","z":"a63e8f060776799f","name":"","info":"","x":200,"y":1260,"wires":[]},{"id":"7425c22e927c4a97","type":"comment","z":"a63e8f060776799f","name":"","info":"","x":280,"y":1300,"wires":[]},{"id":"a1cbe895f291cfe9","type":"comment","z":"a63e8f060776799f","name":"","info":"","x":240,"y":1540,"wires":[]},{"id":"78d6ecc9d8dac95d","type":"comment","z":"a63e8f060776799f","name":"","info":"","x":180,"y":1960,"wires":[]},{"id":"c216323ed0350aef","type":"comment","z":"a63e8f060776799f","name":"","info":"","x":180,"y":3140,"wires":[]},{"id":"8cfaa38a6145827f","type":"comment","z":"a63e8f060776799f","name":"","info":"","x":220,"y":3320,"wires":[]},{"id":"b80f01f2c8e346af","type":"comment","z":"a63e8f060776799f","name":"","info":"","x":320,"y":3380,"wires":[]},{"id":"13107f5a195ecdd5","type":"api-call-service","z":"89a78322a7b36ae2","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"mobile_app_phone_galaxy_fold_4","areaId":[],"deviceId":[],"entityId":[],"data":"{ \"message\": \"INTRUDER ALERT\", \"data\": {} }","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1610,"y":220,"wires":[[]]},{"id":"3aab6d918795a654","type":"api-current-state","z":"89a78322a7b36ae2","name":"alarm armed away?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"armed_away","halt_if_type":"str","halt_if_compare":"is","entity_id":"alarm_control_panel.home_alarm","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":510,"y":220,"wires":[["feda33fbeb16ebd6"],[]]},{"id":"f24e0f769fba9600","type":"change","z":"89a78322a7b36ae2","name":"Security","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"message","pt":"msg","to":"Get the fuck out, Police has been Contacted. The cameras have you recorded.","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2000,"y":220,"wires":[["161fa57ab473b724"]]},{"id":"6873123afe62e21f","type":"server-state-changed","z":"89a78322a7b36ae2","name":"Motion?","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor\\.sensor([a-z\"_\"])*_occupancy","entityidfiltertype":"regex","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":150,"y":220,"wires":[["8122f10a246c277c"],[]]},{"id":"9912d2deccb46658","type":"api-call-service","z":"89a78322a7b36ae2","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.all_lights"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":910,"y":220,"wires":[["abf72664ee5876c3"]]},{"id":"161fa57ab473b724","type":"subflow:233ac7dcd801a802","z":"89a78322a7b36ae2","name":"","x":2210,"y":220,"wires":[]},{"id":"ece23f848ca93ba3","type":"comment","z":"89a78322a7b36ae2","name":"Motion anywhere?","info":"","x":150,"y":180,"wires":[]},{"id":"736fce70133cc368","type":"comment","z":"89a78322a7b36ae2","name":"Yes","info":"","x":310,"y":220,"wires":[]},{"id":"2c49ba6874cad203","type":"comment","z":"89a78322a7b36ae2","name":"Armed away alarm?","info":"","x":510,"y":180,"wires":[]},{"id":"f00ef8a51da77fb0","type":"comment","z":"89a78322a7b36ae2","name":"Yes","info":"","x":710,"y":220,"wires":[]},{"id":"11184af31ac91a72","type":"comment","z":"89a78322a7b36ae2","name":"Turn all lights off","info":"","x":900,"y":180,"wires":[]},{"id":"3a178507934682ad","type":"comment","z":"89a78322a7b36ae2","name":"5 seconds cooldown","info":"","x":1110,"y":180,"wires":[]},{"id":"34aa8682666b12a0","type":"comment","z":"89a78322a7b36ae2","name":"Notify my phone","info":"","x":1600,"y":180,"wires":[]},{"id":"c3e8f5a282cadc1d","type":"comment","z":"89a78322a7b36ae2","name":"Set Announcement","info":"","x":2010,"y":180,"wires":[]},{"id":"b39099b6cb17c497","type":"comment","z":"89a78322a7b36ae2","name":"Send Announcement","info":"","x":2210,"y":180,"wires":[]},{"id":"abf72664ee5876c3","type":"delay","z":"89a78322a7b36ae2","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1110,"y":220,"wires":[["4932da4542af5a26","2f3fe23dec8fe0a2"]]},{"id":"4932da4542af5a26","type":"debug","z":"89a78322a7b36ae2","name":"debug 68","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1280,"y":100,"wires":[]},{"id":"2f3fe23dec8fe0a2","type":"function","z":"89a78322a7b36ae2","name":"Javascript","func":"var sensor = msg.topic;\n\nvar newMsg = {\n\t\"payload\": {\n\t\t\"data\": {\n\t\t\t\"title\": \"Security Alert\",\n\t\t\t\"message\": sensor + \" has been triggered\"\n\t\t}\n\t}\n};\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1300,"y":220,"wires":[["13107f5a195ecdd5"]]},{"id":"9abc6bf90bea613e","type":"switch","z":"89a78322a7b36ae2","name":"action: unlock_failure_invalid_schedule","property":"payload.action","propertyType":"msg","rules":[{"t":"eq","v":"unlock_failure_invalid_schedule","vt":"str"}],"checkall":"false","repair":false,"outputs":1,"x":450,"y":1100,"wires":[["4841450949c7d9e5"]]},{"id":"4841450949c7d9e5","type":"trigger","z":"89a78322a7b36ae2","name":"Conditional unlock","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"1","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":750,"y":1100,"wires":[["0f6f3939fc31b412"]]},{"id":"1b59826fbe1d34e5","type":"switch","z":"89a78322a7b36ae2","name":"WHO","property":"payload.action_user","propertyType":"msg","rules":[{"t":"eq","v":"4","vt":"num"},{"t":"eq","v":"6","vt":"num"},{"t":"eq","v":"2","vt":"num"},{"t":"eq","v":"13","vt":"num"}],"checkall":"false","repair":false,"outputs":4,"x":1130,"y":1020,"wires":[["768294738567315f"],["f5f19fea537c849a"],["8f0c3df71928ed70"],["6aa93395c75d3c04"]]},{"id":"f5f19fea537c849a","type":"change","z":"89a78322a7b36ae2","name":"fay","rules":[{"t":"set","p":"message","pt":"msg","to":"Fay has arrived","tot":"str"},{"t":"set","p":"payload.name","pt":"msg","to":"Fay","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1310,"y":1020,"wires":[["1fc38a6d436e5401"]]},{"id":"768294738567315f","type":"change","z":"89a78322a7b36ae2","name":"Nate","rules":[{"t":"set","p":"message","pt":"msg","to":"Nate has arrived","tot":"str"},{"t":"set","p":"payload.name","pt":"msg","to":"Nate","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1310,"y":980,"wires":[["1fc38a6d436e5401"]]},{"id":"0f6f3939fc31b412","type":"api-current-state","z":"89a78322a7b36ae2","name":"Maxi home?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"home","halt_if_type":"str","halt_if_compare":"is","entity_id":"person.maximiliano","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":970,"y":1100,"wires":[["1b59826fbe1d34e5"],[]]},{"id":"995c67a6597ab468","type":"subflow:233ac7dcd801a802","z":"89a78322a7b36ae2","name":"","x":1650,"y":1020,"wires":[]},{"id":"17022c97071074b8","type":"api-call-service","z":"89a78322a7b36ae2","name":"toggle boolean","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_on","areaId":[],"deviceId":[],"entityId":["input_boolean.face_recognized"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2060,"y":1080,"wires":[["2ae2baa69569d00f"]]},{"id":"2ae2baa69569d00f","type":"ha-wait-until","z":"89a78322a7b36ae2","name":"","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"lock.lock_front_door","entityIdFilterType":"exact","property":"state","comparator":"is","value":"locked","valueType":"str","timeout":"50","timeoutType":"num","timeoutUnits":"seconds","checkCurrentState":true,"blockInputOverrides":true,"outputProperties":[],"x":2220,"y":1080,"wires":[["72e7725486573888"],["72e7725486573888"]]},{"id":"72e7725486573888","type":"api-call-service","z":"89a78322a7b36ae2","name":"toggle boolean","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.face_recognized","input_boolean.waiting_someone"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2400,"y":1080,"wires":[["23ac817267ade3a3"]]},{"id":"23ac817267ade3a3","type":"api-call-service","z":"89a78322a7b36ae2","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"input_text","service":"set_value","areaId":[],"deviceId":[],"entityId":["input_text.recognized_face"],"data":" {             \"value\": \"UNKNOWN\"         }","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2610,"y":1080,"wires":[[]]},{"id":"26c3ccc9500c7846","type":"api-call-service","z":"89a78322a7b36ae2","name":"unLock Door","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"lock","service":"unlock","areaId":[],"deviceId":[],"entityId":["lock.lock_front_door"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1750,"y":1080,"wires":[["4058f004bd6e6039"]]},{"id":"4058f004bd6e6039","type":"ha-wait-until","z":"89a78322a7b36ae2","name":"","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"lock.lock_front_door","entityIdFilterType":"exact","property":"state","comparator":"is","value":"unlocked","valueType":"str","timeout":"2","timeoutType":"num","timeoutUnits":"minutes","checkCurrentState":true,"blockInputOverrides":true,"outputProperties":[],"x":1900,"y":1080,"wires":[["17022c97071074b8"],[]]},{"id":"f2830de63ada8f0e","type":"api-call-service","z":"89a78322a7b36ae2","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"input_text","service":"set_value","areaId":[],"deviceId":[],"entityId":["input_text.recognized_face"],"data":" {             \"value\": \"UNKNOWN\"         }","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2030,"y":1360,"wires":[[]]},{"id":"73634a14fd698218","type":"function","z":"89a78322a7b36ae2","name":"Name Payload","func":"var name = msg.payload.name;\n\nvar newMsg = {\n    \"payload\": {\n        \"data\": {\n            \"value\": name\n        }}};\nreturn newMsg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1740,"y":960,"wires":[["dc9c1a9c0274250e"]]},{"id":"dc9c1a9c0274250e","type":"api-call-service","z":"89a78322a7b36ae2","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"input_text","service":"set_value","areaId":[],"deviceId":[],"entityId":["input_text.recognized_face"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1950,"y":960,"wires":[[]]},{"id":"8f0c3df71928ed70","type":"change","z":"89a78322a7b36ae2","name":"alexe","rules":[{"t":"set","p":"message","pt":"msg","to":"Alexe has arrived","tot":"str"},{"t":"set","p":"payload.name","pt":"msg","to":"Alexe","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1304.673583984375,"y":1068.3333740234375,"wires":[["1fc38a6d436e5401"]]},{"id":"eb3e489f030d78b0","type":"mqtt in","z":"89a78322a7b36ae2","name":"","topic":"zigbee2mqtt/lock_front_door","qos":"2","datatype":"json","broker":"21000c19b97da572","nl":false,"rap":true,"rh":0,"inputs":0,"x":200,"y":1040,"wires":[["9abc6bf90bea613e"]]},{"id":"6aa93395c75d3c04","type":"change","z":"89a78322a7b36ae2","name":"Carla","rules":[{"t":"set","p":"message","pt":"msg","to":"Carla has arrived","tot":"str"},{"t":"set","p":"payload.name","pt":"msg","to":"Carla","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1310,"y":1120,"wires":[["1fc38a6d436e5401"]]},{"id":"f64e5ed993c199f5","type":"api-call-service","z":"56c911ff62a860ba","name":"Cololight on","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.bedroom_cololight"],"data":"{\"effect\":\"Cocktail Parade\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":490,"y":160,"wires":[[]]},{"id":"1b96bc646d4e56c7","type":"server-state-changed","z":"56c911ff62a860ba","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"light.bedroom_cololight","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":170,"y":160,"wires":[["f64e5ed993c199f5"],[]]},{"id":"bf4db16910c7618b","type":"trigger-state","z":"56c911ff62a860ba","name":"Cover Closed and AC on","server":"7ab5c227.a3ce8c","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"switch.bedroom_ac","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"entity_id","targetValue":"cover.cover_bedroom_blinds","propertyType":"property","comparatorType":"<","comparatorValueDatatype":"num","comparatorValue":"26","propertyValue":"attributes.current_position"},{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on","propertyValue":"new_state.state"}],"inputs":0,"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","enableInput":false,"x":150,"y":440,"wires":[["dc0f74507fa165b1"],[]]},{"id":"dc0f74507fa165b1","type":"api-call-service","z":"56c911ff62a860ba","name":"Blinds at 26% ","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"cover","service":"set_cover_position","areaId":[],"deviceId":[],"entityId":["cover.cover_bedroom_blinds"],"data":"{\"position\": \"26\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":460,"y":440,"wires":[[]]},{"id":"90d211d6a743e930","type":"api-call-service","z":"56c911ff62a860ba","name":"CLose blinds","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"cover","service":"set_cover_position","areaId":[],"deviceId":[],"entityId":["cover.cover_bedroom_blinds"],"data":"{\"position\": \"0\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":450,"y":540,"wires":[[]]},{"id":"56c93fec23942ed9","type":"api-call-service","z":"56c911ff62a860ba","name":"Blinds at 26% ","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"cover","service":"set_cover_position","areaId":[],"deviceId":[],"entityId":["cover.cover_bedroom_blinds"],"data":"{\"position\": \"26\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":460,"y":360,"wires":[[]]},{"id":"8f1b1ff4d20a8d6d","type":"trigger-state","z":"56c911ff62a860ba","name":"Cover Closed and AC Off","server":"7ab5c227.a3ce8c","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"switch.bedroom_ac","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"entity_id","targetValue":"cover.cover_bedroom_blinds","propertyType":"property","comparatorType":"<","comparatorValueDatatype":"num","comparatorValue":"27","propertyValue":"attributes.current_position"},{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off","propertyValue":"new_state.state"}],"inputs":0,"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","enableInput":false,"x":150,"y":540,"wires":[["90d211d6a743e930"],[]]},{"id":"722aab7f36fe606a","type":"trigger-state","z":"56c911ff62a860ba","name":"Closed Cover and AC on","server":"7ab5c227.a3ce8c","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"cover.cover_bedroom_blinds","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"property","comparatorType":"<","comparatorValueDatatype":"num","comparatorValue":"26","propertyValue":"new_state.attributes.current_position"},{"targetType":"entity_id","targetValue":"switch.bedroom_ac","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on","propertyValue":"new_state.state"}],"inputs":0,"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","enableInput":false,"x":150,"y":360,"wires":[["56c93fec23942ed9"],[]]},{"id":"0200854bb6e793fc","type":"comment","z":"56c911ff62a860ba","name":"Chose specific effect on lighting on","info":"","x":160,"y":200,"wires":[]},{"id":"85a44af769293504","type":"comment","z":"56c911ff62a860ba","name":"Trigger on cololight on","info":"","x":160,"y":120,"wires":[]},{"id":"bafdd5fa51ef66e1","type":"comment","z":"56c911ff62a860ba","name":"Select Cocktail effect","info":"","x":490,"y":120,"wires":[]},{"id":"b991422029043762","type":"comment","z":"56c911ff62a860ba","name":"If cover is under 26% and AC is on","info":"","x":160,"y":400,"wires":[]},{"id":"d38eb955df6f7d83","type":"comment","z":"56c911ff62a860ba","name":"Set cover to 26% open","info":"","x":460,"y":400,"wires":[]},{"id":"981662dd196ab250","type":"comment","z":"56c911ff62a860ba","name":"If cover is under 26% and AC is off","info":"","x":160,"y":500,"wires":[]},{"id":"5108e856fc604908","type":"comment","z":"56c911ff62a860ba","name":"Close blinds","info":"","x":450,"y":500,"wires":[]},{"id":"bb96b4c786d1bcd0","type":"comment","z":"56c911ff62a860ba","name":"If cover is under 26% and AC is on","info":"","x":160,"y":600,"wires":[]},{"id":"745abffeb3ac07e0","type":"comment","z":"56c911ff62a860ba","name":"Set cover to 26% open","info":"","x":460,"y":600,"wires":[]},{"id":"590f6e877edea304","type":"server-state-changed","z":"56c911ff62a860ba","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.bedroom_ac","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"(on)","halt_if_type":"re","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":180,"y":1200,"wires":[["f497510b82dd7301"],["420c70dfa3d8d0ec"]]},{"id":"ba2eb5bc9188d9ad","type":"api-call-service","z":"56c911ff62a860ba","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_down","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1130,"y":1220,"wires":[[]]},{"id":"2d83a7425a360b6f","type":"api-call-service","z":"56c911ff62a860ba","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_up","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1130,"y":1160,"wires":[[]]},{"id":"83089d56e084c667","type":"comment","z":"56c911ff62a860ba","name":"AC turns on","info":"","x":170,"y":1160,"wires":[]},{"id":"70bd27facdf67f36","type":"comment","z":"56c911ff62a860ba","name":"Turn volume up","info":"","x":1140,"y":1120,"wires":[]},{"id":"456d111f76c9e5ba","type":"comment","z":"56c911ff62a860ba","name":"Turn volume down","info":"","x":1130,"y":1260,"wires":[]},{"id":"4691cec247ae0d28","type":"comment","z":"56c911ff62a860ba","name":"WIP TO MUTE THE SPEAKERS IN THE ROOM WHEN I DO SOMETHING","info":"","x":380,"y":1620,"wires":[]},{"id":"7ce0151cf49af272","type":"comment","z":"56c911ff62a860ba","name":"","info":"","x":200,"y":1720,"wires":[]},{"id":"ba9ad4a01577490e","type":"trigger-state","z":"56c911ff62a860ba","name":"","server":"7ab5c227.a3ce8c","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"binary_sensor.maxi_s_ears_busy","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on","propertyValue":"new_state.state"}],"inputs":0,"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","enableInput":false,"x":290,"y":1660,"wires":[["97782e8105e0aca6"],["892ae2c600ad5bc3"]]},{"id":"97782e8105e0aca6","type":"api-call-service","z":"56c911ff62a860ba","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_mute","areaId":[],"deviceId":[],"entityId":["media_player.bedroom_speaker","media_player.bedroom_ceiling_speaker","media_player.dungeon_speaker"],"data":"{\"is_volume_muted\": \"true\"}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":790,"y":1660,"wires":[[]]},{"id":"892ae2c600ad5bc3","type":"api-call-service","z":"56c911ff62a860ba","name":"unmute","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_mute","areaId":[],"deviceId":[],"entityId":["media_player.bedroom_speaker","media_player.bedroom_ceiling_speaker","media_player.dungeon_speaker"],"data":"{\"is_volume_muted\": \"false\"}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":580,"y":1720,"wires":[[]]},{"id":"f497510b82dd7301","type":"ha-get-entities","z":"56c911ff62a860ba","name":"","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"entity_id","logic":"is","value":"media_player\\.bedroom(?!plex).*","valueType":"re"},{"property":"state","logic":"is","value":"playing","valueType":"str"},{"property":"attributes.is_volume_muted","logic":"is","value":"false","valueType":"bool"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":450,"y":1160,"wires":[["7e6b3ecd6a4aacaf"]]},{"id":"420c70dfa3d8d0ec","type":"ha-get-entities","z":"56c911ff62a860ba","name":"","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"entity_id","logic":"is","value":"media_player\\.bedroom(?!plex).*_speaker","valueType":"re"},{"property":"state","logic":"is","value":"playing","valueType":"str"},{"property":"attributes.is_volume_muted","logic":"is","value":"false","valueType":"bool"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":450,"y":1220,"wires":[["9912e9487152918c"]]},{"id":"7e6b3ecd6a4aacaf","type":"change","z":"56c911ff62a860ba","name":"","rules":[{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"payload.entity_id","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":770,"y":1160,"wires":[["2d83a7425a360b6f"]]},{"id":"9912e9487152918c","type":"change","z":"56c911ff62a860ba","name":"","rules":[{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"payload.entity_id","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":770,"y":1220,"wires":[["ba2eb5bc9188d9ad"]]},{"id":"50a0ed02b34007b2","type":"comment","z":"56c911ff62a860ba","name":"Extract the entity id","info":"","x":770,"y":1120,"wires":[]},{"id":"9fb5e92b2b1915a0","type":"comment","z":"56c911ff62a860ba","name":"Get playing unmuted media players","info":"","x":440,"y":1120,"wires":[]},{"id":"f7120ca1b394c661","type":"ha-get-entities","z":"56c911ff62a860ba","name":"Get  Light entities","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"entity_id","logic":"is","value":"light.nzxt_kraken_x3_0_led.*","valueType":"re"},{"property":"state","logic":"is","value":"on","valueType":"str"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":810,"y":800,"wires":[["99e20b0177f7561f"]]},{"id":"531000a71e6c28be","type":"trigger","z":"56c911ff62a860ba","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"-5","extend":false,"overrideDelay":false,"units":"s","reset":"off","bytopic":"all","topic":"topic","outputs":1,"x":580,"y":800,"wires":[["f7120ca1b394c661"]]},{"id":"3b635711e7577c2a","type":"inject","z":"56c911ff62a860ba","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":560,"y":840,"wires":[["f7120ca1b394c661"]]},{"id":"99e20b0177f7561f","type":"switch","z":"56c911ff62a860ba","name":"","property":"payload.attributes.supported_color_modes","propertyType":"msg","rules":[{"t":"regex","v":"(xy|hs)","vt":"str","case":false}],"checkall":"true","repair":false,"outputs":1,"x":1050,"y":800,"wires":[["0087f0f75eb01d35"]]},{"id":"f2ac7dd61031a577","type":"server-state-changed","z":"56c911ff62a860ba","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.acid_time","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":240,"y":760,"wires":[["531000a71e6c28be"],["531000a71e6c28be"]]},{"id":"0087f0f75eb01d35","type":"switch","z":"56c911ff62a860ba","name":"Exclude groups","property":"payload.attributes.entity_id","propertyType":"msg","rules":[{"t":"null"}],"checkall":"true","repair":false,"outputs":1,"x":1280,"y":800,"wires":[["331bd7216cf8fee5"]]},{"id":"331bd7216cf8fee5","type":"function","z":"56c911ff62a860ba","name":"Generate Random saturated color","func":"var entity_id = msg.payload.entity_id;\n\n\nvar hue = Math.floor(Math.random() * 360); //generate a random number up to 360\n\nvar hs_color = hue + \",100\";\nvar hs_color_array = hs_color.split(\",\");\nvar newMsg = {\n    \"payload\": {\n        \"data\": {\n            \"hs_color\": hs_color_array,\n            \"entity_id\": entity_id,\n            \"brightness_pct\": 100\n            \n}\n        }\n    }\n;\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1580,"y":800,"wires":[["2cf82a093dd760e3"]]},{"id":"2cf82a093dd760e3","type":"api-call-service","z":"56c911ff62a860ba","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1870,"y":800,"wires":[[]]},{"id":"258cd36e9485d649","type":"server-state-changed","z":"56c911ff62a860ba","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.party_mode","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":240,"y":820,"wires":[["531000a71e6c28be"],["531000a71e6c28be"]]},{"id":"da2979028867adeb","type":"inject","z":"56c911ff62a860ba","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":420,"y":700,"wires":[["531000a71e6c28be"]]},{"id":"4dadb04b275734e6","type":"server-state-changed","z":"56c911ff62a860ba","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.bedroom_lights_color","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"re","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":290,"y":2040,"wires":[["20c7b8b91e1321d1","5157a396e885f85e","d65fa189f58d8fe2"]]},{"id":"20c7b8b91e1321d1","type":"function","z":"56c911ff62a860ba","name":"Extract RGB from entity and divive each value by 255 (color)","func":"var rgb_value = msg.payload.replace(\"\\(\",\"\").replace(\"\\)\",\"\");\nconst color_array = rgb_value.split(\", \");\nvar RV = (color_array[0]  / 255);\nvar GV = (color_array[1]  / 255);\nvar BV = (color_array[2]  / 255);\n\nvar RVT = RV.toString().substring(0, 3);\nvar GVT = GV.toString().substring(0, 3);\nvar BVT = BV.toString().substring(0, 3);\n\nvar msg = {\n    \"payload\": {\n        \"data\": {\n            \"topic\": \"homeassistant/button/PC_Maxi_Desktop/Maxi_pc_customcommand/action\",\n            \"payload\": \"%wpe% -control applyProperties -properties RAW~\\(\\{\\\"color\\\":\\\"\" + RVT + \" \" + GVT + \" \" + BVT + \"\\\"\\}\\)~END\"\n        }\n    }\n\n}\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":720,"y":2040,"wires":[["47b6335b71c4ec73"]]},{"id":"47b6335b71c4ec73","type":"api-call-service","z":"56c911ff62a860ba","name":"Send MQTT Command","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"mqtt","service":"publish","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1170,"y":2040,"wires":[[]]},{"id":"5157a396e885f85e","type":"function","z":"56c911ff62a860ba","name":"Extract RGB from entity and divive each value by 255 (Backgroundcolor)","func":"var rgb_value = msg.payload.replace(\"\\(\",\"\").replace(\"\\)\",\"\");\nconst color_array = rgb_value.split(\", \");\nvar RV = (color_array[0]  / 255);\nvar GV = (color_array[1]  / 255);\nvar BV = (color_array[2]  / 255);\n\nvar RVT = RV.toString().substring(0, 3);\nvar GVT = GV.toString().substring(0, 3);\nvar BVT = BV.toString().substring(0, 3);\n\nvar msg = {\n    \"payload\": {\n        \"data\": {\n            \"topic\": \"homeassistant/button/PC_Maxi_Desktop/Maxi_pc_customcommand/action\",\n            \"payload\": \"%wpe% -control applyProperties -properties RAW~\\(\\{\\\"backgroundcolor\\\":\\\"\" + RVT + \" \" + GVT + \" \" + BVT + \"\\\"\\}\\)~END\"\n        }\n    }\n\n}\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":760,"y":2000,"wires":[["24fde9116e9678ee"]]},{"id":"24fde9116e9678ee","type":"api-call-service","z":"56c911ff62a860ba","name":"Send MQTT Command","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"mqtt","service":"publish","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1170,"y":2000,"wires":[[]]},{"id":"d65fa189f58d8fe2","type":"function","z":"56c911ff62a860ba","name":"Extract RGB from entity and divive each value by 255 (clouds)","func":"var rgb_value = msg.payload.replace(\"\\(\",\"\").replace(\"\\)\",\"\");\nconst color_array = rgb_value.split(\", \");\nvar RV = (color_array[0]  / 255);\nvar GV = (color_array[1]  / 255);\nvar BV = (color_array[2]  / 255);\n\nvar RVT = RV.toString().substring(0, 3);\nvar GVT = GV.toString().substring(0, 3);\nvar BVT = BV.toString().substring(0, 3);\n\nvar msg = {\n    \"payload\": {\n        \"data\": {\n            \"topic\": \"homeassistant/button/PC_Maxi_Desktop/Maxi_pc_customcommand/action\",\n            \"payload\": \"%wpe% -control applyProperties -properties RAW~\\(\\{\\\"clouds\\\":\\\"\" + RVT + \" \" + GVT + \" \" + BVT + \"\\\"\\}\\)~END\"\n        }\n    }\n\n}\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":730,"y":2080,"wires":[["1dbb2ec92ed06bce"]]},{"id":"1dbb2ec92ed06bce","type":"api-call-service","z":"56c911ff62a860ba","name":"Send MQTT Command","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"mqtt","service":"publish","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1170,"y":2080,"wires":[[]]},{"id":"01780bc3dd73580d","type":"mqtt in","z":"56c911ff62a860ba","name":"","topic":"zigbee2mqtt/remote_bedroom_dial","qos":"2","datatype":"json","broker":"21000c19b97da572","nl":false,"rap":true,"rh":0,"inputs":0,"x":180,"y":2380,"wires":[["2529837d24d60972"]]},{"id":"45be97c8c7c6ddf5","type":"server-state-changed","z":"56c911ff62a860ba","name":"Is chromecast off?","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"media_player.bedroom_chromecast","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":170,"y":2720,"wires":[["45ba6c7a5dc2c856"],[]]},{"id":"3829f58e5346acbe","type":"api-call-service","z":"56c911ff62a860ba","name":"Change Input","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"select_source","areaId":[],"deviceId":[],"entityId":["media_player.bedroom_roku"],"data":"{\"source\":\"PC\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":940,"y":2720,"wires":[[]]},{"id":"236198ebec8250eb","type":"api-current-state","z":"56c911ff62a860ba","name":"Are screens on?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.plug_bedroom_screens","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":560,"y":2720,"wires":[["f3c1d585e8c1c7aa"],[]]},{"id":"5b104236d44d89a8","type":"comment","z":"56c911ff62a860ba","name":"Is the chromecast off?","info":"","x":180,"y":2680,"wires":[]},{"id":"53028653048fea96","type":"api-call-service","z":"56c911ff62a860ba","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"remote","service":"turn_off","areaId":[],"deviceId":[],"entityId":["remote.bedroom_roku"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1150,"y":3020,"wires":[[]]},{"id":"64d6748ddd537f10","type":"api-current-state","z":"56c911ff62a860ba","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.maxi_sleeping","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":670,"y":2940,"wires":[["dc9de2460902cda5"],["fac8de6c16c3bc0d"]]},{"id":"3759f1783ecd37e5","type":"server-state-changed","z":"56c911ff62a860ba","name":"Are Screens on?","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.plug_bedroom_screens","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":160,"y":2920,"wires":[["5a87f306db7cc2d8"],["7f9505f93fed223b"]]},{"id":"b782f8d84067fbe5","type":"api-current-state","z":"56c911ff62a860ba","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"remote.bedroom_roku","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1210,"y":2940,"wires":[["51e1ef0d6364a338"],[]]},{"id":"78975ac16646d1d2","type":"api-current-state","z":"56c911ff62a860ba","name":"Chromecast is Off","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"(paused|playing)","halt_if_type":"re","halt_if_compare":"is_not","entity_id":"media_player.bedroom_chromecast","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":590,"y":2880,"wires":[["62afc933c5ab4425"],[]]},{"id":"60a1fa9156969f48","type":"api-call-service","z":"56c911ff62a860ba","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"select_source","areaId":[],"deviceId":[],"entityId":["media_player.bedroom_roku"],"data":"{\"source\": \"chromecast\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1670,"y":2940,"wires":[[]]},{"id":"e0576eb5e30134c2","type":"api-call-service","z":"56c911ff62a860ba","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"select_source","areaId":[],"deviceId":[],"entityId":["media_player.bedroom_roku"],"data":"{\"source\": \"PC\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1030,"y":2840,"wires":[[]]},{"id":"b6d1c4da352bd314","type":"comment","z":"56c911ff62a860ba","name":"Are the screens on?","info":"","x":570,"y":2680,"wires":[]},{"id":"e537d2a780ce9c79","type":"comment","z":"56c911ff62a860ba","name":"yes","info":"","x":750,"y":2720,"wires":[]},{"id":"909c850d8473c58f","type":"comment","z":"56c911ff62a860ba","name":"yes","info":"","x":370,"y":2720,"wires":[]},{"id":"97a090e45b0c7ec2","type":"comment","z":"56c911ff62a860ba","name":"Set input to PC","info":"","x":940,"y":2680,"wires":[]},{"id":"953464f97d60fe10","type":"comment","z":"56c911ff62a860ba","name":"Are the screens on?","info":"","x":170,"y":2880,"wires":[]},{"id":"e0c0aadfaadda7dd","type":"comment","z":"56c911ff62a860ba","name":"Is the chromecast off?","info":"","x":600,"y":2840,"wires":[]},{"id":"54aef7e6bb373b64","type":"comment","z":"56c911ff62a860ba","name":"yes","info":"","x":370,"y":2880,"wires":[]},{"id":"21fbd0f97b9fb41e","type":"comment","z":"56c911ff62a860ba","name":"yes","info":"","x":810,"y":2840,"wires":[]},{"id":"4766ddcb2b8d0111","type":"comment","z":"56c911ff62a860ba","name":"no","info":"","x":370,"y":2940,"wires":[]},{"id":"2bd4a7b4a70c9ae1","type":"comment","z":"56c911ff62a860ba","name":"Is maxi sleeping?","info":"","x":660,"y":2980,"wires":[]},{"id":"e0e08f203bc43ccc","type":"comment","z":"56c911ff62a860ba","name":"Set TV source as PC","info":"","x":1030,"y":2800,"wires":[]},{"id":"4420ca23f3ce5c19","type":"comment","z":"56c911ff62a860ba","name":"Is TV on?","info":"","x":1180,"y":2900,"wires":[]},{"id":"7b42bb99378495d6","type":"comment","z":"56c911ff62a860ba","name":"yes","info":"","x":1450,"y":2940,"wires":[]},{"id":"f734bf69fc9636ff","type":"comment","z":"56c911ff62a860ba","name":"no","info":"","x":950,"y":2940,"wires":[]},{"id":"20163b4a2ec75263","type":"comment","z":"56c911ff62a860ba","name":"yes","info":"","x":950,"y":3020,"wires":[]},{"id":"eb1a62319bc90b10","type":"comment","z":"56c911ff62a860ba","name":"Turn TV off","info":"","x":1180,"y":2980,"wires":[]},{"id":"deb09c33c273799c","type":"trigger","z":"56c911ff62a860ba","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"100","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1620,"y":2500,"wires":[["7259d2ee7447680a"]]},{"id":"fb2143f4c309b849","type":"switch","z":"56c911ff62a860ba","name":"","property":"action","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1870,"y":2500,"wires":[["0a76d1b3ef445b11"]]},{"id":"1fe679033954ae4e","type":"change","z":"56c911ff62a860ba","name":"set entity","rules":[{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"media_player.dungeon_speaker,media_player.bedroom_ceiling_speaker,media_player.bedroom_speaker","tot":"str","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":1160,"y":2360,"wires":[["19e4edab9a1c9c36"]]},{"id":"5c7c08eeb0c4ce20","type":"api-current-state","z":"56c911ff62a860ba","name":"speaker","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is_not","entity_id":"media_player.bedroom_speaker","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"entity","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":800,"y":2380,"wires":[["79b4373c7f81277b"],["bd147fda0c88cc70"]]},{"id":"1ce9b7d4ca4fba3c","type":"switch","z":"56c911ff62a860ba","name":"","property":"action","propertyType":"msg","rules":[{"t":"eq","v":"rotate_right","vt":"str"},{"t":"eq","v":"rotate_left","vt":"str"},{"t":"eq","v":"play_pause","vt":"str"},{"t":"eq","v":"skip_forward","vt":"str"},{"t":"eq","v":"skip_backward","vt":"str"}],"checkall":"true","repair":false,"outputs":5,"x":2310,"y":2500,"wires":[["c395da374fdab735"],["41e08dfbb0e04a2a"],["25ea085a99170204"],["56c2574f49363475"],[]]},{"id":"de676d463545890a","type":"change","z":"56c911ff62a860ba","name":"Move action","rules":[{"t":"set","p":"action","pt":"msg","to":"payload.action","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":590,"y":2380,"wires":[["5c7c08eeb0c4ce20"]]},{"id":"3be1e0c8f5c69755","type":"comment","z":"56c911ff62a860ba","name":"Set speakers entities","info":"","x":1170,"y":2320,"wires":[]},{"id":"abe1cd1e08726b1e","type":"comment","z":"56c911ff62a860ba","name":"Is speaker off?","info":"","x":800,"y":2340,"wires":[]},{"id":"6376094a5e563400","type":"comment","z":"56c911ff62a860ba","name":"No","info":"","x":990,"y":2360,"wires":[]},{"id":"5f46d2a113cdf9cf","type":"comment","z":"56c911ff62a860ba","name":"Yes","info":"","x":990,"y":2500,"wires":[]},{"id":"be201149b072f263","type":"comment","z":"56c911ff62a860ba","name":"Move payload.action to action","info":"","x":580,"y":2340,"wires":[]},{"id":"c1541d070610956e","type":"comment","z":"56c911ff62a860ba","name":"Check that action is not empty","info":"","x":1880,"y":2460,"wires":[]},{"id":"0c4a805dea4c7427","type":"switch","z":"56c911ff62a860ba","name":"","property":"action","propertyType":"msg","rules":[{"t":"eq","v":"rotate_right","vt":"str"},{"t":"eq","v":"play_pause","vt":"str"},{"t":"eq","v":"rotate_left","vt":"str"},{"t":"eq","v":"skip_forward","vt":"str"},{"t":"eq","v":"skip_backward","vt":"str"}],"checkall":"false","repair":false,"outputs":5,"x":1590,"y":2360,"wires":[["8cc0c1ba628498df"],["8a24becba7f06b80"],["c1946a64db4473ee"],["843ad0bd7a1da088"],["e3124f8324c3d69f"]]},{"id":"843ad0bd7a1da088","type":"api-call-service","z":"56c911ff62a860ba","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"media_next_track","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1890,"y":2320,"wires":[[]]},{"id":"8cc0c1ba628498df","type":"api-call-service","z":"56c911ff62a860ba","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_up","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1870,"y":2200,"wires":[[]]},{"id":"8a24becba7f06b80","type":"api-call-service","z":"56c911ff62a860ba","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"media_play_pause","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1890,"y":2240,"wires":[[]]},{"id":"c1946a64db4473ee","type":"api-call-service","z":"56c911ff62a860ba","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_down","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1870,"y":2280,"wires":[[]]},{"id":"0a76d1b3ef445b11","type":"change","z":"56c911ff62a860ba","name":"set entity","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"light.group_bedroom_lights","tot":"str","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":2100,"y":2500,"wires":[["1ce9b7d4ca4fba3c","27a2d8f4858f1acd"]]},{"id":"8daa468074ad91b6","type":"comment","z":"56c911ff62a860ba","name":"Set Lights entities","info":"","x":2130,"y":2460,"wires":[]},{"id":"e3124f8324c3d69f","type":"change","z":"56c911ff62a860ba","name":"set flow light mode = 1","rules":[{"t":"set","p":"lightmode","pt":"flow","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1820,"y":2400,"wires":[["2866114df72da874"]]},{"id":"066dfc535a4c0837","type":"change","z":"56c911ff62a860ba","name":"set flow light mode = 0","rules":[{"t":"set","p":"lightmode","pt":"flow","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":2240,"y":2400,"wires":[[]]},{"id":"2866114df72da874","type":"trigger","z":"56c911ff62a860ba","name":"","op1":"","op2":"0","op1type":"nul","op2type":"str","duration":"10","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2030,"y":2400,"wires":[["066dfc535a4c0837"]]},{"id":"19e4edab9a1c9c36","type":"switch","z":"56c911ff62a860ba","name":"Light mode off?","property":"lightmode","propertyType":"flow","rules":[{"t":"neq","v":"1","vt":"num"},{"t":"null"},{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":3,"x":1380,"y":2360,"wires":[["5518bc361860479b"],["5518bc361860479b"],["09b22e59ecc224df"]]},{"id":"56c2574f49363475","type":"api-call-service","z":"56c911ff62a860ba","name":"Max white brightness","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"{\"brightness_pct\": 100,\"color_name\": \"white\"}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2540,"y":2580,"wires":[[]]},{"id":"70a54e82a47016b6","type":"comment","z":"56c911ff62a860ba","name":"These nodes set a flow variable \"lightmode\" to \"1\" for 10 seconds before setting it to \"0\"","info":"","x":2040,"y":2360,"wires":[]},{"id":"081622ed823bf530","type":"comment","z":"56c911ff62a860ba","name":"Check if lightmode is on","info":"","x":1380,"y":2320,"wires":[]},{"id":"6fab207376ba33bd","type":"api-call-service","z":"56c911ff62a860ba","name":"Screens Turn On","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.plug_bedroom_screens"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1030,"y":3880,"wires":[[]]},{"id":"10150c00ffc0cbb7","type":"api-current-state","z":"56c911ff62a860ba","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.bedroom_main","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":570,"y":3860,"wires":[[],["3edcabdc80dca9a4","6f2411dd5520a17b"]]},{"id":"6f2411dd5520a17b","type":"api-call-service","z":"56c911ff62a860ba","name":"LavalampTurn On","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.bedroom_cololight","light.bedroom_lavalamp","light.dungeon_plasmaball"],"data":"{\"brightness_pct\":\"100\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":890,"y":3940,"wires":[[]]},{"id":"3edcabdc80dca9a4","type":"api-current-state","z":"56c911ff62a860ba","name":"Off?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.plug_bedroom_screens","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":830,"y":3860,"wires":[[],["6fab207376ba33bd"]]},{"id":"776e29c29a700ebf","type":"comment","z":"56c911ff62a860ba","name":"Detect motion in both bedrooms","info":"","x":210,"y":3240,"wires":[]},{"id":"9c4876d3ee59c222","type":"server-state-changed","z":"56c911ff62a860ba","name":"Motion Bedroom","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.sensor_bedroom_motion_occupancy","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":160,"y":3280,"wires":[["767790809a831eac"],[]]},{"id":"e9a22764061fa841","type":"server-state-changed","z":"56c911ff62a860ba","name":"Motion Dungeon","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.sensor_dungeon_motion_occupancy","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":160,"y":3320,"wires":[["767790809a831eac"],[]]},{"id":"8350009f75c56ebb","type":"api-current-state","z":"56c911ff62a860ba","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.maxi_sleeping","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":550,"y":3300,"wires":[["1ba06d9b72807126"],[]]},{"id":"8e84dbb736508e34","type":"comment","z":"56c911ff62a860ba","name":"Turn on night lights","info":"","x":1190,"y":3260,"wires":[]},{"id":"1ba06d9b72807126","type":"api-call-service","z":"56c911ff62a860ba","name":"Quotra Lamp on","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.quotra_bedroom_light"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":820,"y":3300,"wires":[["312f051da6281688"]]},{"id":"312f051da6281688","type":"api-call-service","z":"56c911ff62a860ba","name":"Cololight on","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.bedroom_cololight"],"data":"{\"brightness_pct\":10,\"effect\":\"Cocktail Parade\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1010,"y":3300,"wires":[["85ce88d1c607f709"]]},{"id":"e61c06640673566c","type":"api-call-service","z":"56c911ff62a860ba","name":"Quotra Lamp off","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.quotra_bedroom_light"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1640,"y":3300,"wires":[["8bb11bda7fc7af73"]]},{"id":"8bb11bda7fc7af73","type":"api-call-service","z":"56c911ff62a860ba","name":"Cololight off","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.bedroom_cololight"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1830,"y":3300,"wires":[["a86ee3246f03b15e"]]},{"id":"ae0d50d9353f1911","type":"trigger","z":"56c911ff62a860ba","name":"","op1":"","op2":"off","op1type":"nul","op2type":"str","duration":"45","extend":false,"overrideDelay":false,"units":"s","reset":"open","bytopic":"all","topic":"topic","outputs":1,"x":1410,"y":3300,"wires":[["e61c06640673566c"]]},{"id":"a86ee3246f03b15e","type":"api-call-service","z":"56c911ff62a860ba","name":"Dungeon off","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.dungeon_light"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2010,"y":3300,"wires":[[]]},{"id":"85ce88d1c607f709","type":"api-call-service","z":"56c911ff62a860ba","name":"Dungeon on","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.dungeon_light"],"data":"{\"brightness_pct\":1,\"color_name\":\"red\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1190,"y":3300,"wires":[["ae0d50d9353f1911"]]},{"id":"03f89b90923ada12","type":"inject","z":"56c911ff62a860ba","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":240,"y":3820,"wires":[[]]},{"id":"9bed38c77813b09d","type":"comment","z":"56c911ff62a860ba","name":"Turn on night lights","info":"","x":830,"y":3260,"wires":[]},{"id":"6ff557c4c85f1f47","type":"comment","z":"56c911ff62a860ba","name":"Turn on night lights","info":"","x":1010,"y":3260,"wires":[]},{"id":"9d976b75140b2f9e","type":"comment","z":"56c911ff62a860ba","name":"Is Maxi sleeping?","info":"","x":560,"y":3260,"wires":[]},{"id":"6460af32146e0c4a","type":"comment","z":"56c911ff62a860ba","name":"wait 45 seconds","info":"","x":1412,"y":3258,"wires":[]},{"id":"bcf23cd85cbad0c6","type":"comment","z":"56c911ff62a860ba","name":"Turn of night lights","info":"","x":1650,"y":3260,"wires":[]},{"id":"4bb72cbe6bcb6391","type":"comment","z":"56c911ff62a860ba","name":"Turn of night lights","info":"","x":1830,"y":3260,"wires":[]},{"id":"1b06f512f847af76","type":"comment","z":"56c911ff62a860ba","name":"Turn of night lights","info":"","x":2010,"y":3260,"wires":[]},{"id":"93ac24df9da4508d","type":"comment","z":"56c911ff62a860ba","name":"Detect motion in both bedrooms","info":"","x":190,"y":3480,"wires":[]},{"id":"979a10bd1d1fc4fc","type":"server-state-changed","z":"56c911ff62a860ba","name":"Motion Bedroom","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.sensor_bedroom_motion_occupancy","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":140,"y":3520,"wires":[["52d630b4e77d7e77"],[]]},{"id":"3c0a8978b5527753","type":"server-state-changed","z":"56c911ff62a860ba","name":"Motion Dungeon","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.sensor_dungeon_motion_occupancy","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":140,"y":3560,"wires":[["52d630b4e77d7e77"],[]]},{"id":"d369acf347893c0c","type":"api-current-state","z":"56c911ff62a860ba","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.maxi_sleeping","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":550,"y":3540,"wires":[["c9be378d904127e5"],[]]},{"id":"a59bc13f7db146be","type":"api-current-state","z":"56c911ff62a860ba","name":"screens Off?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.plug_bedroom_screens","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":1270,"y":3540,"wires":[["2ae7ead99ef35184"],[]]},{"id":"2ae7ead99ef35184","type":"api-call-service","z":"56c911ff62a860ba","name":"Screens Turn On","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.plug_bedroom_screens"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1510,"y":3540,"wires":[[]]},{"id":"eb7886e47779f798","type":"comment","z":"56c911ff62a860ba","name":"Is Maxi awake?","info":"","x":560,"y":3500,"wires":[]},{"id":"d74e11d0d9adf30c","type":"comment","z":"56c911ff62a860ba","name":"are the screens off?","info":"","x":1270,"y":3500,"wires":[]},{"id":"19ed40e68b47702a","type":"comment","z":"56c911ff62a860ba","name":"Turn screens on","info":"","x":1500,"y":3500,"wires":[]},{"id":"c9be378d904127e5","type":"api-current-state","z":"56c911ff62a860ba","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"media_player.bedroom_chromecast","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","x":930,"y":3540,"wires":[["a59bc13f7db146be"],[]]},{"id":"cee1b026bc1781d6","type":"comment","z":"56c911ff62a860ba","name":"Is the TV not playing media?","info":"","x":960,"y":3500,"wires":[]},{"id":"ce6f5961f3329bae","type":"api-call-service","z":"56c911ff62a860ba","name":"Brightnen light","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"{\"brightness_step_pct\": 10}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3920,"y":2460,"wires":[[]]},{"id":"44381b21f26a82e2","type":"ha-get-entities","z":"56c911ff62a860ba","name":"","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"","logic":"is","value":"","valueType":"str"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":3070,"y":2460,"wires":[["febc6f69607bb482","31c842a432e40ed6"]]},{"id":"c395da374fdab735","type":"function","z":"56c911ff62a860ba","name":"Extract room from motion sensor entity an extract off lights to regex","func":"var group_light_entity_id = msg.payload.data.entity_id; // light group\nvar group_light_entity_id = group_light_entity_id.split(\".\");// split on the dot to separate domain and entity\n//var group_entity_split = group_light_entity_id[1].split(\"group\");\nvar room = group_light_entity_id[1].replace(\"_lights\", \"\").replace(\"group_\", \"\");\n\n\nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': \"light.\" + room ,  'valueType': 're' },{ 'property': 'state' ,  'logic': 'is' , 'value': \"on\" ,  'valueType': 'str' }];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object}\n\n}\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2680,"y":2460,"wires":[["91a4363c73e59e07","44381b21f26a82e2"]]},{"id":"3fe35a9df98d37b9","type":"switch","z":"56c911ff62a860ba","name":"Brightness?","property":"payload.attributes.brightness","propertyType":"msg","rules":[{"t":"lt","v":"250","vt":"str"},{"t":"gte","v":"250","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":3510,"y":2460,"wires":[["3d9adea8a98a9521"],["ea17c26b26577823","70066917f7712936"]]},{"id":"3d9adea8a98a9521","type":"change","z":"56c911ff62a860ba","name":"set entity","rules":[{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"payload.entity_id","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":3680,"y":2460,"wires":[["ce6f5961f3329bae"]]},{"id":"b06972483dde2445","type":"comment","z":"56c911ff62a860ba","name":"Check Brightness","info":"","x":3520,"y":2420,"wires":[]},{"id":"35e4b1a8ceee16f3","type":"comment","z":"56c911ff62a860ba","name":"Set entity id","info":"","x":3690,"y":2420,"wires":[]},{"id":"eab0a76879940e00","type":"api-call-service","z":"56c911ff62a860ba","name":"Add white","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3900,"y":2540,"wires":[[]]},{"id":"ea17c26b26577823","type":"debug","z":"56c911ff62a860ba","name":"debug 61","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":3680,"y":2500,"wires":[]},{"id":"70066917f7712936","type":"function","z":"56c911ff62a860ba","name":"White addist","func":"// Declare variation\nvar saturation = msg.payload.attributes.hs_color[1];\nvar colorfinal = msg.payload.attributes.hs_color[0];\nvar entity_id = msg.payload.entity_id;\n\n// If saturation is over 10\nif(saturation > 10){\nvar saturationlesser = saturation - 10;\n} else if(saturation < 10){// If saturation is under 10\nvar saturationlesser = 0;\nvar colorfinal = 0;\n}\n else {\nvar saturationlesser = saturation;}\n\n\n\n\n\n\nvar newMsg = {\n    \"payload\": {\n            \"data\": {\n            \"hs_color\": [colorfinal, saturationlesser],\n            \"entity_id\": entity_id\n            }\n            }\n            \n   }\n\nreturn newMsg;\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3690,"y":2540,"wires":[["091f86530d465f70","eab0a76879940e00"]]},{"id":"091f86530d465f70","type":"debug","z":"56c911ff62a860ba","name":"debug 62","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3900,"y":2500,"wires":[]},{"id":"91a4363c73e59e07","type":"debug","z":"56c911ff62a860ba","name":"debug 64","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":3080,"y":2500,"wires":[]},{"id":"29ac2e9fc90b0b57","type":"debug","z":"56c911ff62a860ba","name":"debug 66","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":3240,"y":2560,"wires":[]},{"id":"25ea085a99170204","type":"api-call-service","z":"56c911ff62a860ba","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"toggle","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2520,"y":2540,"wires":[[]]},{"id":"41e08dfbb0e04a2a","type":"api-call-service","z":"56c911ff62a860ba","name":"Dim light","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"{\"brightness_step_pct\": -10}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2500,"y":2500,"wires":[[]]},{"id":"febc6f69607bb482","type":"trigger","z":"56c911ff62a860ba","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"300","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"topic","topic":"payload.entity_id","outputs":1,"x":3320,"y":2460,"wires":[["3fe35a9df98d37b9"]]},{"id":"6961b2c7d032d4bd","type":"ha-get-entities","z":"56c911ff62a860ba","name":"","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"","logic":"is","value":"","valueType":"str"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":2110,"y":2580,"wires":[[]]},{"id":"27a2d8f4858f1acd","type":"function","z":"56c911ff62a860ba","name":"Extract room from motion sensor entity an extract off lights to regex","func":"var group_light_entity_id = msg.payload.data.entity_id; // light group\nvar group_light_entity_id = group_light_entity_id.split(\".\");// split on the dot to separate domain and entity\n//var group_entity_split = group_light_entity_id[1].split(\"group\");\nvar room = group_light_entity_id[1].replace(\"_lights\", \"\").replace(\"group_\", \"\");\n\n\nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': \"light.\" + room + \"_lights\" ,  'valueType': 're' },{ 'property': 'state' ,  'logic': 'is' , 'value': \"on\" ,  'valueType': 'str' }];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object}\n\n}\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1720,"y":2580,"wires":[["6961b2c7d032d4bd"]]},{"id":"31c842a432e40ed6","type":"debug","z":"56c911ff62a860ba","name":"debug 60","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":3320,"y":2500,"wires":[]},{"id":"3c049bdac85dc7a3","type":"function","z":"56c911ff62a860ba","name":"Extract room from dial mqtt name","func":"var group_light_entity_id = msg.payload.device.friendlyName; // light group\nvar room = group_light_entity_id.replace(\"remote_\", \"\").replace(\"_dial\", \"\");\n\n\nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': \"light.group_\" + room + \"_lights\" ,  'valueType': 're' },{ 'property': 'state' ,  'logic': 'is' , 'value': \"on\" ,  'valueType': 'str' }];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object}\n\n}\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":400,"y":2520,"wires":[["ec5617525020a1fe","c92143da1f1d9037"]]},{"id":"2529837d24d60972","type":"debug","z":"56c911ff62a860ba","name":"debug 69","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":420,"y":2380,"wires":[]},{"id":"ec5617525020a1fe","type":"ha-get-entities","z":"56c911ff62a860ba","name":"","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"","logic":"is","value":"","valueType":"str"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":690,"y":2520,"wires":[[]]},{"id":"c92143da1f1d9037","type":"debug","z":"56c911ff62a860ba","name":"debug 70","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":620,"y":2480,"wires":[]},{"id":"d432b74ed5bc885f","type":"ha-get-entities","z":"56c911ff62a860ba","name":"","server":"7ab5c227.a3ce8c","version":0,"rules":[],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":1330,"y":4940,"wires":[["9848d3d557dc45a7"]]},{"id":"aff835383a56eb40","type":"function","z":"56c911ff62a860ba","name":"Extract room from dial mqtt name and set regex to find light groups","func":"var group_light_entity_id = msg.payload.device.friendlyName; // light group\nvar room = group_light_entity_id.replace(\"remote_\", \"\").replace(\"_dial\", \"\");\nvar action = msg.payload.action\n\nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': \"light.group_\" + room + \"_lights\" ,  'valueType': 're' },{ 'property': 'state' ,  'logic': 'is' , 'value': \"on\" ,  'valueType': 'str' }];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object},\n     \"action\": action,\n     \"room\": room\n\n}\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":960,"y":4880,"wires":[["d432b74ed5bc885f","2d738e7cc26bf507"]]},{"id":"9bd077f7ed29fb10","type":"mqtt in","z":"56c911ff62a860ba","name":"","topic":"zigbee2mqtt/remote_bedroom_dial","qos":"2","datatype":"json","broker":"21000c19b97da572","nl":false,"rap":true,"rh":0,"inputs":0,"x":200,"y":4400,"wires":[["7a7293667d475c2d","acd5834be9900ca4"]]},{"id":"2d738e7cc26bf507","type":"debug","z":"56c911ff62a860ba","name":"debug 71","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1420,"y":4860,"wires":[]},{"id":"46c0fe602f8a5f6d","type":"change","z":"56c911ff62a860ba","name":"Move action","rules":[{"t":"set","p":"action","pt":"msg","to":"payload.action","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":4200,"wires":[[]]},{"id":"a4576c59e8771a1e","type":"debug","z":"56c911ff62a860ba","name":"debug 72","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":280,"y":4180,"wires":[]},{"id":"9848d3d557dc45a7","type":"debug","z":"56c911ff62a860ba","name":"debug 77","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1420,"y":4980,"wires":[]},{"id":"d1d25525472e0a51","type":"comment","z":"56c911ff62a860ba","name":"Check payload lenght","info":"","x":1760,"y":4960,"wires":[]},{"id":"acd5834be9900ca4","type":"subflow:61f53235c712b2c2","z":"56c911ff62a860ba","name":"","x":450,"y":4400,"wires":[]},{"id":"a724e1763b88fb2d","type":"function","z":"56c911ff62a860ba","name":"Extract room from dial mqtt name and set regex to find chromecast playing","func":"var group_light_entity_id = msg.payload.device.friendlyName; // light group\nvar room = group_light_entity_id.replace(\"remote_\", \"\").replace(\"_dial\", \"\");\nvar action = msg.payload.action\n\nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': \"media_player.\" + room + \"_chromecast\" ,  'valueType': 're' },{ 'property': 'state' ,  'logic': 'is' , 'value': \"playing\" ,  'valueType': 'str' }];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object},\n     \"action\": action,\n     \"room\": room\n\n}\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":360,"y":4500,"wires":[["0edce96971be17a5"]]},{"id":"0edce96971be17a5","type":"ha-get-entities","z":"56c911ff62a860ba","name":"","server":"7ab5c227.a3ce8c","version":0,"rules":[],"output_type":"array","output_empty_results":true,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":710,"y":4500,"wires":[["29efcf8c85caf49c"]]},{"id":"29efcf8c85caf49c","type":"switch","z":"56c911ff62a860ba","name":"Device present?","property":"payload","propertyType":"msg","rules":[{"t":"nempty"},{"t":"empty"}],"checkall":"true","repair":false,"outputs":2,"x":880,"y":4500,"wires":[["0ae8584150128610"],["72ad3c21a0eccc80"]]},{"id":"0ae8584150128610","type":"switch","z":"56c911ff62a860ba","name":"muted?","property":"payload[0].attributes.is_volume_muted","propertyType":"msg","rules":[{"t":"false"},{"t":"true"}],"checkall":"true","repair":false,"outputs":2,"x":1060,"y":4480,"wires":[["3e8a41b674122b66"],["72ad3c21a0eccc80"]]},{"id":"19134c9f6301f620","type":"function","z":"56c911ff62a860ba","name":"Extract room from dial mqtt name and set regex to find speaker playing","func":"\nvar room = msg.room\nvar action = msg.action\n\nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': \"media_player.\" + room + \".*_speaker\" ,  'valueType': 're' },{ 'property': 'state' ,  'logic': 'is_not' , 'value': \"off\" ,  'valueType': 'str' }];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object},\n     \"action\": action,\n     \"room\": room\n\n}\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":350,"y":4560,"wires":[["6d5ab8ea39347484"]]},{"id":"6d5ab8ea39347484","type":"ha-get-entities","z":"56c911ff62a860ba","name":"","server":"7ab5c227.a3ce8c","version":0,"rules":[],"output_type":"array","output_empty_results":true,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":710,"y":4560,"wires":[["5b1c5c53e4af6d79","1797aa4a8d603733"]]},{"id":"b8f8b3ddd7dd6fc0","type":"split","z":"56c911ff62a860ba","name":"Split entities","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":1430,"y":4500,"wires":[["0ef8891178484047","f58371ed96ce559c"]]},{"id":"5b1c5c53e4af6d79","type":"switch","z":"56c911ff62a860ba","name":"Device present?","property":"payload","propertyType":"msg","rules":[{"t":"nempty"},{"t":"empty"}],"checkall":"true","repair":false,"outputs":2,"x":880,"y":4560,"wires":[["5d43ee01bb7b15cd"],["f819df21174b26ee","8bbdc3d386dc4ac9"]]},{"id":"55f0a526ba729d77","type":"switch","z":"56c911ff62a860ba","name":"muted?","property":"payload[0].attributes.is_volume_muted","propertyType":"msg","rules":[{"t":"false"},{"t":"true"}],"checkall":"true","repair":false,"outputs":2,"x":1540,"y":4560,"wires":[["b8f8b3ddd7dd6fc0"],["bb1bca2bc9621ec6"]]},{"id":"0ef8891178484047","type":"change","z":"56c911ff62a860ba","name":"set entity data","rules":[{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"payload.entity_id","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":1620,"y":4500,"wires":[["d86a7f55c8341be7"]]},{"id":"0ac503a61ccf454c","type":"switch","z":"56c911ff62a860ba","name":"Play_Pause action?","property":"action","propertyType":"msg","rules":[{"t":"eq","v":"play_pause","vt":"str"},{"t":"nnull"}],"checkall":"false","repair":false,"outputs":2,"x":1380,"y":4600,"wires":[["a0cb7613100fad18"],["a0cb7613100fad18","a82e490fcd04de19"]]},{"id":"d86a7f55c8341be7","type":"switch","z":"56c911ff62a860ba","name":"Light mode off?","property":"lightmode","propertyType":"flow","rules":[{"t":"neq","v":"1","vt":"num"},{"t":"null"},{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":3,"x":1800,"y":4500,"wires":[["bd1bb829a3c241ee"],["bd1bb829a3c241ee"],["424cf08b2a94875d"]]},{"id":"ce0f449abcde3750","type":"switch","z":"56c911ff62a860ba","name":"paused?","property":"payload[0].state","propertyType":"msg","rules":[{"t":"eq","v":"playing","vt":"str"},{"t":"eq","v":"paused","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":1160,"y":4560,"wires":[["039a10fd2af9f969"],["860a651fd82196b2"]]},{"id":"424cf08b2a94875d","type":"trigger","z":"56c911ff62a860ba","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"100","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2020,"y":4600,"wires":[["e27ef39b11be745f","0f961855656e3b5e"]]},{"id":"e27ef39b11be745f","type":"switch","z":"56c911ff62a860ba","name":"","property":"action","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":2170,"y":4600,"wires":[["2ee3681d34ec0b84","6f386606d77706ef"]]},{"id":"98702dbb26e3ab8b","type":"switch","z":"56c911ff62a860ba","name":"","property":"action","propertyType":"msg","rules":[{"t":"eq","v":"rotate_right","vt":"str"},{"t":"eq","v":"play_pause","vt":"str"},{"t":"eq","v":"rotate_left","vt":"str"},{"t":"eq","v":"skip_forward","vt":"str"},{"t":"eq","v":"skip_backward","vt":"str"}],"checkall":"false","repair":false,"outputs":5,"x":2030,"y":4500,"wires":[["81c37c4e877e6ff0"],["564a9d207f13fe52"],["c391ba60724b13ea"],["8df6afa74adc0e27"],["84f8ae901142c56a"]]},{"id":"2ee3681d34ec0b84","type":"function","z":"56c911ff62a860ba","name":"Extract room from dial mqtt name and set regex to find light groups","func":"\nvar room = msg.room;\nvar action = msg.action\n\nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': \"light.group_\" + room + \"_lights\" ,  'valueType': 're' }];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object},\n     \"action\": action,\n     \"room\": room\n\n}\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2480,"y":4600,"wires":[["234c8d7a701568ad","61849aafe6c42ca1"]]},{"id":"81c37c4e877e6ff0","type":"api-call-service","z":"56c911ff62a860ba","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_up","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2250,"y":4380,"wires":[[]]},{"id":"564a9d207f13fe52","type":"api-call-service","z":"56c911ff62a860ba","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"media_play_pause","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2290,"y":4420,"wires":[[]]},{"id":"c391ba60724b13ea","type":"api-call-service","z":"56c911ff62a860ba","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_down","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2280,"y":4460,"wires":[[]]},{"id":"8df6afa74adc0e27","type":"api-call-service","z":"56c911ff62a860ba","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"media_next_track","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2310,"y":4500,"wires":[[]]},{"id":"84f8ae901142c56a","type":"change","z":"56c911ff62a860ba","name":"set flow light mode = 1","rules":[{"t":"set","p":"lightmode","pt":"flow","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":2220,"y":4540,"wires":[["1369ad4536f96f5b"]]},{"id":"234c8d7a701568ad","type":"ha-get-entities","z":"56c911ff62a860ba","name":"","server":"7ab5c227.a3ce8c","version":0,"rules":[],"output_type":"array","output_empty_results":true,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":2830,"y":4600,"wires":[["887387747c349432","a04f6cf0b79c1b1e"]]},{"id":"1369ad4536f96f5b","type":"trigger","z":"56c911ff62a860ba","name":"","op1":"","op2":"0","op1type":"nul","op2type":"str","duration":"10","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2430,"y":4540,"wires":[["4f5c9e9b75ba2f11"]]},{"id":"887387747c349432","type":"split","z":"56c911ff62a860ba","name":"Split entities","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":3010,"y":4600,"wires":[["02262693da18834e","d65d6b8ff808825f"]]},{"id":"4f5c9e9b75ba2f11","type":"change","z":"56c911ff62a860ba","name":"set flow light mode = 0","rules":[{"t":"set","p":"lightmode","pt":"flow","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":2640,"y":4540,"wires":[[]]},{"id":"02262693da18834e","type":"change","z":"56c911ff62a860ba","name":"set entity data","rules":[{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"payload.entity_id","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":3200,"y":4600,"wires":[["61e78178a1842898","d2822f755839c1e6"]]},{"id":"61e78178a1842898","type":"switch","z":"56c911ff62a860ba","name":"","property":"action","propertyType":"msg","rules":[{"t":"eq","v":"rotate_right","vt":"str"},{"t":"eq","v":"rotate_left","vt":"str"},{"t":"cont","v":"play_pause","vt":"str"},{"t":"eq","v":"skip_forward","vt":"str"},{"t":"eq","v":"skip_backward","vt":"str"}],"checkall":"true","repair":false,"outputs":5,"x":3350,"y":4600,"wires":[["7387cadcd6ecb959"],["927046bee06012dd"],["a4881931c7c397c5","d2822f755839c1e6"],["47e3940bdb68f95c"],[]]},{"id":"7387cadcd6ecb959","type":"function","z":"56c911ff62a860ba","name":"Extract room from motion sensor entity an extract off lights to regex","func":"var room = msg.room;\n\n\nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': \"light.\" + room ,  'valueType': 're' }];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object}\n\n}\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3680,"y":4540,"wires":[["ba60e73a129e0b13","86ff53c15b013eb2"]]},{"id":"927046bee06012dd","type":"api-call-service","z":"56c911ff62a860ba","name":"Dim light","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"{\"brightness_step_pct\": -10}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3500,"y":4580,"wires":[[]]},{"id":"a4881931c7c397c5","type":"api-call-service","z":"56c911ff62a860ba","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"toggle","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3720,"y":4620,"wires":[[]]},{"id":"47e3940bdb68f95c","type":"api-call-service","z":"56c911ff62a860ba","name":"Max white brightness","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"{\"brightness_pct\": 100,\"color_name\": \"white\"}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3540,"y":4660,"wires":[[]]},{"id":"ba60e73a129e0b13","type":"debug","z":"56c911ff62a860ba","name":"debug 153","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":4080,"y":4580,"wires":[]},{"id":"86ff53c15b013eb2","type":"ha-get-entities","z":"56c911ff62a860ba","name":"","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"","logic":"is","value":"","valueType":"str"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":4090,"y":4520,"wires":[["81e5d72ac9529d48","e7ed4da3d89ee0c8"]]},{"id":"81e5d72ac9529d48","type":"trigger","z":"56c911ff62a860ba","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"600","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"topic","topic":"payload.entity_id","outputs":1,"x":4320,"y":4540,"wires":[["389a0c874415626f"]]},{"id":"e7ed4da3d89ee0c8","type":"debug","z":"56c911ff62a860ba","name":"debug 154","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":4320,"y":4580,"wires":[]},{"id":"389a0c874415626f","type":"switch","z":"56c911ff62a860ba","name":"Brightness?","property":"payload.attributes.brightness","propertyType":"msg","rules":[{"t":"null"},{"t":"lt","v":"250","vt":"str"},{"t":"gte","v":"250","vt":"str"}],"checkall":"false","repair":false,"outputs":3,"x":4510,"y":4540,"wires":[["d663a37c17f20669"],["d663a37c17f20669"],["a4907ebdc77e0b02","76cd4e0002c94460"]]},{"id":"d663a37c17f20669","type":"change","z":"56c911ff62a860ba","name":"set entity","rules":[{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"payload.entity_id","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":4680,"y":4540,"wires":[["4203d41fadaa61b4"]]},{"id":"a4907ebdc77e0b02","type":"debug","z":"56c911ff62a860ba","name":"debug 155","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":4680,"y":4580,"wires":[]},{"id":"76cd4e0002c94460","type":"function","z":"56c911ff62a860ba","name":"White addist","func":"// Declare variation\nvar saturation = msg.payload.attributes.hs_color[1];\nvar colorfinal = msg.payload.attributes.hs_color[0];\nvar entity_id = msg.payload.entity_id;\n\n// If saturation is over 10\nif(saturation > 10){\nvar saturationlesser = saturation - 10;\n} else if(saturation < 10){// If saturation is under 10\nvar saturationlesser = 0;\nvar colorfinal = 0;\n}\n else {\nvar saturationlesser = saturation;}\n\n\n\n\n\n\nvar newMsg = {\n    \"payload\": {\n            \"data\": {\n            \"hs_color\": [colorfinal, saturationlesser],\n            \"entity_id\": entity_id\n            }\n            }\n            \n   }\n\nreturn newMsg;\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4690,"y":4620,"wires":[["33bfd0f56ab12662","8f6bb1444c6788c2"]]},{"id":"4203d41fadaa61b4","type":"api-call-service","z":"56c911ff62a860ba","name":"Brightnen light","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"{\"brightness_step_pct\": 10}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4920,"y":4540,"wires":[[]]},{"id":"33bfd0f56ab12662","type":"debug","z":"56c911ff62a860ba","name":"debug 156","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":4900,"y":4580,"wires":[]},{"id":"8f6bb1444c6788c2","type":"api-call-service","z":"56c911ff62a860ba","name":"Add white","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4900,"y":4620,"wires":[[]]},{"id":"18744539a62b9326","type":"trigger","z":"56c911ff62a860ba","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"200","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"topic","topic":"topic","outputs":1,"x":2060,"y":4340,"wires":[["81c37c4e877e6ff0"]]},{"id":"d65d6b8ff808825f","type":"debug","z":"56c911ff62a860ba","name":"split entity","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3200,"y":4500,"wires":[]},{"id":"d2822f755839c1e6","type":"debug","z":"56c911ff62a860ba","name":"debug 157","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"payload","targetType":"msg","statusVal":"payload","statusType":"msg","x":3530,"y":4740,"wires":[]},{"id":"b715c3cb842ad2a5","type":"debug","z":"56c911ff62a860ba","name":"debug 158","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1750,"y":4540,"wires":[]},{"id":"0f961855656e3b5e","type":"debug","z":"56c911ff62a860ba","name":"debug 159","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2190,"y":4680,"wires":[]},{"id":"a04f6cf0b79c1b1e","type":"debug","z":"56c911ff62a860ba","name":"debug 160","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2910,"y":4540,"wires":[]},{"id":"6f386606d77706ef","type":"debug","z":"56c911ff62a860ba","name":"debug 161","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2370,"y":4680,"wires":[]},{"id":"61849aafe6c42ca1","type":"debug","z":"56c911ff62a860ba","name":"debug 162","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2770,"y":4700,"wires":[]},{"id":"f58371ed96ce559c","type":"debug","z":"56c911ff62a860ba","name":"debug 163","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1710,"y":4300,"wires":[]},{"id":"a82e490fcd04de19","type":"debug","z":"56c911ff62a860ba","name":"debug 164","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1550,"y":4680,"wires":[]},{"id":"83deeefdbbac5a61","type":"debug","z":"56c911ff62a860ba","name":"debug 165","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1710,"y":4620,"wires":[]},{"id":"7466ff4627565211","type":"debug","z":"56c911ff62a860ba","name":"debug 166","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":950,"y":4680,"wires":[]},{"id":"7a7293667d475c2d","type":"debug","z":"56c911ff62a860ba","name":"debug 167","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":430,"y":4320,"wires":[]},{"id":"1797aa4a8d603733","type":"debug","z":"56c911ff62a860ba","name":"debug 168","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":910,"y":4620,"wires":[]},{"id":"8bbdc3d386dc4ac9","type":"debug","z":"56c911ff62a860ba","name":"debug 169","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1210,"y":4640,"wires":[]},{"id":"e66e110e65248f33","type":"trigger-state","z":"881898b44ee6eb81","name":"Bathroom empty","server":"7ab5c227.a3ce8c","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"binary_sensor.sensor_bathroom_motion_occupancy","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"},{"targetType":"entity_id","targetValue":"binary_sensor.sensor_bathroom_door_contact","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"targetType":"entity_id","targetValue":"binary_sensor.shower_in_use","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"inputs":0,"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","enableInput":false,"x":180,"y":760,"wires":[["de9f4c34e00835c7"],["12dd6306bdf52a97"]]},{"id":"f00baa6a10259753","type":"api-call-service","z":"881898b44ee6eb81","name":"Bathroom Light Off","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.group_bathroom_lights"],"data":"{\"transition\": 10}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1030,"y":760,"wires":[[]]},{"id":"4df7dfe163f24063","type":"api-call-service","z":"881898b44ee6eb81","name":"Stop cast","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"turn_off","areaId":[],"deviceId":[],"entityId":["media_player.bathroom_speaker"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1440,"y":480,"wires":[[]]},{"id":"133f0e3df82044b9","type":"trigger-state","z":"881898b44ee6eb81","name":"Bathroom Motion","server":"7ab5c227.a3ce8c","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"binary_sensor.sensor_bathroom_motion_occupancy","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on","propertyValue":"new_state.state"},{"targetType":"entity_id","targetValue":"media_player.bathroom_speaker","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off","propertyValue":"new_state.state"}],"inputs":0,"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","enableInput":false,"x":180,"y":260,"wires":[["2b67f9d16cec1c09"],[]]},{"id":"2792eb2e57bd9533","type":"api-call-service","z":"881898b44ee6eb81","name":"Speaker 30% volume","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_set","areaId":[],"deviceId":[],"entityId":["media_player.bathroom_speaker"],"data":"{\"volume_level\": 0.3}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":980,"y":320,"wires":[[]]},{"id":"13d82a2362d4ab1a","type":"api-current-state","z":"881898b44ee6eb81","name":"Door state","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.sensor_bathroom_door_contact","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":770,"y":260,"wires":[["faa507096bd4db40"],["2792eb2e57bd9533"]]},{"id":"2b67f9d16cec1c09","type":"api-call-service","z":"881898b44ee6eb81","name":"Plex shuffle","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"play_media","areaId":[],"deviceId":[],"entityId":["media_player.bathroom_speaker"],"data":"{\"media_content_id\":\"plex://{ \\\"library_name\\\": \\\"Muzak\\\", \\\"shuffle\\\": 1, \\\"allow_multiple\\\": 1 }\",\"media_content_type\":\"music\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":490,"y":260,"wires":[["13d82a2362d4ab1a"]]},{"id":"faa507096bd4db40","type":"api-call-service","z":"881898b44ee6eb81","name":"Speaker 10% volume","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_set","areaId":[],"deviceId":[],"entityId":["media_player.bathroom_speaker"],"data":"{\"volume_level\": 0.1}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":980,"y":200,"wires":[[]]},{"id":"f25da7166587499b","type":"trigger","z":"881898b44ee6eb81","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"5","extend":false,"overrideDelay":false,"units":"min","reset":"0","bytopic":"all","topic":"topic","outputs":1,"x":770,"y":760,"wires":[["f00baa6a10259753"]]},{"id":"b90340783739c82f","type":"api-current-state","z":"881898b44ee6eb81","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"playing","halt_if_type":"str","halt_if_compare":"is_not","entity_id":"media_player.group_home_speakers","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":1150,"y":480,"wires":[["4df7dfe163f24063"],[]]},{"id":"8a87371543b31002","type":"change","z":"881898b44ee6eb81","name":"1","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":740,"wires":[["f25da7166587499b"]]},{"id":"cf3320ead9bdaf99","type":"change","z":"881898b44ee6eb81","name":"0","rules":[{"t":"set","p":"payload","pt":"msg","to":"0","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":530,"y":780,"wires":[["f25da7166587499b"]]},{"id":"9ef1ba67723e18e1","type":"trigger-state","z":"881898b44ee6eb81","name":"Bathroom empty","server":"7ab5c227.a3ce8c","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"binary_sensor.sensor_bathroom_motion_occupancy","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"},{"targetType":"entity_id","targetValue":"binary_sensor.sensor_bathroom_door_contact","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on"},{"targetType":"entity_id","targetValue":"binary_sensor.shower_in_use","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"},{"targetType":"entity_id","targetValue":"media_player.group_home_speakers","propertyType":"current_state","propertyValue":"new_state.state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off"}],"inputs":0,"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","enableInput":false,"x":140,"y":480,"wires":[["6c7ad1714992bdd3"],["ed840b70957315b2"]]},{"id":"e00a291148e13b68","type":"trigger","z":"881898b44ee6eb81","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"2","extend":false,"overrideDelay":false,"units":"min","reset":"0","bytopic":"all","topic":"topic","outputs":1,"x":850,"y":480,"wires":[["b90340783739c82f"]]},{"id":"e921ceff2ed05761","type":"change","z":"881898b44ee6eb81","name":"1","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":550,"y":460,"wires":[["e00a291148e13b68"]]},{"id":"68230369115ebbb3","type":"change","z":"881898b44ee6eb81","name":"0","rules":[{"t":"set","p":"payload","pt":"msg","to":"0","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":550,"y":500,"wires":[["e00a291148e13b68"]]},{"id":"be846337e1b080d5","type":"comment","z":"881898b44ee6eb81","name":"Check if bathroom is empty using multiple conditions","info":"","x":190,"y":720,"wires":[]},{"id":"11e99b692d36dd6f","type":"comment","z":"881898b44ee6eb81","name":"Set payload to 1","info":"","x":540,"y":700,"wires":[]},{"id":"486e4e44fc47ef9b","type":"comment","z":"881898b44ee6eb81","name":"Set payload to 0","info":"","x":540,"y":820,"wires":[]},{"id":"2faeb6d246f87e69","type":"comment","z":"881898b44ee6eb81","name":"wait 5 minutes","info":"","x":770,"y":720,"wires":[]},{"id":"4ed1b3f13e1f7666","type":"comment","z":"881898b44ee6eb81","name":"(resets on payload = 0)","info":"","x":780,"y":800,"wires":[]},{"id":"63ed7065e90c3759","type":"comment","z":"881898b44ee6eb81","name":"Turn the lights off","info":"","x":1020,"y":720,"wires":[]},{"id":"5b9f41bf5bb52993","type":"comment","z":"881898b44ee6eb81","name":"Motion in bathroom and speaker off","info":"","x":200,"y":220,"wires":[]},{"id":"b690d3c56536fcd0","type":"comment","z":"881898b44ee6eb81","name":"Shuffle plex Muzak Library","info":"","x":490,"y":220,"wires":[]},{"id":"c0c076ef598dc692","type":"comment","z":"881898b44ee6eb81","name":"Check door state","info":"This will determine wich volume to set","x":760,"y":220,"wires":[]},{"id":"ae8d2eaf6737b656","type":"comment","z":"881898b44ee6eb81","name":"Set volume to 10% if door open","info":"This will determine wich volume to set","x":970,"y":160,"wires":[]},{"id":"d630bbf362b918ed","type":"comment","z":"881898b44ee6eb81","name":"Set volume to 30% if door closed","info":"This will determine wich volume to set","x":970,"y":360,"wires":[]},{"id":"d43d39fed9776b80","type":"comment","z":"881898b44ee6eb81","name":"wait 2 minutes","info":"","x":850,"y":440,"wires":[]},{"id":"2a7b69dbbb324c60","type":"comment","z":"881898b44ee6eb81","name":"(resets on payload = 0)","info":"","x":860,"y":520,"wires":[]},{"id":"9b0a35b03915e31d","type":"comment","z":"881898b44ee6eb81","name":"Confirm that home group is  not playing","info":"","x":1150,"y":440,"wires":[]},{"id":"806564fbd87d694f","type":"comment","z":"881898b44ee6eb81","name":"Stop the Bathroom speaker","info":"","x":1430,"y":440,"wires":[]},{"id":"d919924c879f0ff6","type":"comment","z":"881898b44ee6eb81","name":"Set payload to 1","info":"","x":560,"y":420,"wires":[]},{"id":"942b5609d3df03a0","type":"comment","z":"881898b44ee6eb81","name":"Set payload to 0","info":"","x":560,"y":540,"wires":[]},{"id":"8c5ecae5186f35af","type":"comment","z":"881898b44ee6eb81","name":"Check if bathroom is empty using multiple conditions","info":"","x":190,"y":440,"wires":[]},{"id":"3c2838394f50a39a","type":"api-call-service","z":"881898b44ee6eb81","name":"Bathroom Speaker","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_set","areaId":[],"deviceId":[],"entityId":["media_player.bathroom_speaker"],"data":"{\"volume_level\":\"0.0\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1070,"y":1280,"wires":[[]]},{"id":"4330840189d888ec","type":"api-call-service","z":"881898b44ee6eb81","name":"Bathroom Speaker","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_set","areaId":[],"deviceId":[],"entityId":["media_player.bathroom_speaker"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1910,"y":1140,"wires":[[]]},{"id":"cecc49282031c619","type":"server-state-changed","z":"881898b44ee6eb81","name":"Door Closes?","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.sensor_bathroom_door_contact","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":210,"y":1220,"wires":[["8ecacc3680df8a66"],["471b6b35d2f07b2f"]]},{"id":"c7d7869cf88446c1","type":"api-current-state","z":"881898b44ee6eb81","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.bathroom_fan","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":600,"y":1140,"wires":[["d26eadfb6228a626"],["695dbd47c25a51cc"]]},{"id":"ade0768cb997a2b3","type":"api-current-state","z":"881898b44ee6eb81","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"playing","halt_if_type":"str","halt_if_compare":"is","entity_id":"media_player.livingroom_chromecast","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":650,"y":1300,"wires":[["7fcd0180ea269945"],["340260f5e20a06a1"]]},{"id":"965baad3e9a7ca9b","type":"api-call-service","z":"881898b44ee6eb81","name":"Bathroom Speaker","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_set","areaId":[],"deviceId":[],"entityId":["media_player.bathroom_speaker"],"data":"{\"volume_level\":\"0.1\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1710,"y":1340,"wires":[[]]},{"id":"cf3f9442d8a57374","type":"api-current-state","z":"881898b44ee6eb81","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"playing","halt_if_type":"str","halt_if_compare":"is","entity_id":"media_player.group_home_speakers","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1290,"y":1320,"wires":[["73508ebeaf49e873"],["965baad3e9a7ca9b"]]},{"id":"40902a85fa0988ab","type":"function","z":"881898b44ee6eb81","name":"Volume Selector","func":"var d = new Date();\nvar h = d.getHours();\n\n\nif (h > 22){\n    var brightness = \"0.25\";\n}\nelse if (h >= 0 && h <= 2 ){\n    var brightness = \"0.20\";\n}\nelse if (h>2 && h<8){\n    var brightness = \"0.15\";\n}\nelse{\n    var brightness = \"0.30\";\n}\n\n\n\n\n\n\n\n\nvar newMsg = {\n    \"payload\": {\n            \"data\": {\n            \"volume_level\": brightness\n            }\n            }\n            \n   }\n\nreturn newMsg;\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1680,"y":1180,"wires":[["4330840189d888ec"]]},{"id":"2676640708d0f3db","type":"function","z":"881898b44ee6eb81","name":"Volume Selector","func":"var d = new Date();\nvar h = d.getHours();\n\n\nif (h > 22){\n    var brightness = \"0.4\";\n}\nelse if (h >= 0 && h <= 2 ){\n    var brightness = \"0.35\";\n}\nelse if (h>2 && h<7){\n    var brightness = \"0.3\";\n}\nelse{\n    var brightness = \"0.4\";\n}\n\n\n\n\n\n\n\n\nvar newMsg = {\n    \"payload\": {\n            \"data\": {\n            \"volume_level\": brightness\n            }\n            }\n            \n   }\n\nreturn newMsg;\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1680,"y":1100,"wires":[["4330840189d888ec"]]},{"id":"34a00fb595015780","type":"comment","z":"881898b44ee6eb81","name":"Is the nearby TV playing ?","info":"","x":650,"y":1260,"wires":[]},{"id":"141562d5a8ac39c9","type":"comment","z":"881898b44ee6eb81","name":"Door Closed?","info":"","x":210,"y":1180,"wires":[]},{"id":"0e570e07fd90d8a7","type":"comment","z":"881898b44ee6eb81","name":"Yes","info":"","x":370,"y":1180,"wires":[]},{"id":"f95a1288136cfdb1","type":"comment","z":"881898b44ee6eb81","name":"No","info":"","x":370,"y":1280,"wires":[]},{"id":"d9531c85373b51e8","type":"comment","z":"881898b44ee6eb81","name":"Is the bathroom fan on?","info":"","x":600,"y":1100,"wires":[]},{"id":"aba3ce96d79d9717","type":"comment","z":"881898b44ee6eb81","name":"Yes","info":"","x":830,"y":1120,"wires":[]},{"id":"2362a16cf52e522c","type":"comment","z":"881898b44ee6eb81","name":"No","info":"","x":830,"y":1160,"wires":[]},{"id":"2e212d74dcc00a3e","type":"comment","z":"881898b44ee6eb81","name":"Set volume depending on time","info":"","x":1660,"y":1140,"wires":[]},{"id":"2ac64f2e64f9c56e","type":"comment","z":"881898b44ee6eb81","name":"Call set_volume service","info":"","x":1920,"y":1100,"wires":[]},{"id":"a7b97a0090d21f1d","type":"comment","z":"881898b44ee6eb81","name":"Set Volume to 0%","info":"","x":1070,"y":1240,"wires":[]},{"id":"e121ef702275cf9c","type":"comment","z":"881898b44ee6eb81","name":"Is Home Group playing?","info":"","x":1290,"y":1280,"wires":[]},{"id":"d03d9553579bdd5c","type":"comment","z":"881898b44ee6eb81","name":"Set speaker volume to 10%","info":"","x":1720,"y":1300,"wires":[]},{"id":"36c17d265566d694","type":"comment","z":"881898b44ee6eb81","name":"Yes","info":"","x":1510,"y":1240,"wires":[]},{"id":"27d73f462b3c06e7","type":"comment","z":"881898b44ee6eb81","name":"No","info":"","x":1530,"y":1340,"wires":[]},{"id":"41bc22242e8b6353","type":"comment","z":"881898b44ee6eb81","name":"Yes","info":"","x":910,"y":1280,"wires":[]},{"id":"aa83552c8e86c590","type":"comment","z":"881898b44ee6eb81","name":"No","info":"","x":910,"y":1320,"wires":[]},{"id":"e2d076fca2183a33","type":"server-state-changed","z":"881898b44ee6eb81","name":"Shower Music speaker Playing?","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"media_player.bathroom_music_speaker","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is_not","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":270,"y":1580,"wires":[["b6b49543ca03433b"],["5391dd8b0174feca"]]},{"id":"9b337d8762637eaa","type":"api-call-service","z":"881898b44ee6eb81","name":"Mute bathroom speaker","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_mute","areaId":[],"deviceId":[],"entityId":["media_player.bathroom_speaker"],"data":"{\"is_volume_muted\":\"1\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":690,"y":1560,"wires":[["dbd6485bf75b90c2"]]},{"id":"0b8ee3f939557602","type":"api-call-service","z":"881898b44ee6eb81","name":"unMute bathroom speaker","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_mute","areaId":[],"deviceId":[],"entityId":["media_player.bathroom_speaker"],"data":"{\"is_volume_muted\":\"0\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":690,"y":1600,"wires":[[]]},{"id":"ed5811c87bcd2804","type":"api-call-service","z":"881898b44ee6eb81","name":"Stop bathroom speaker","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"turn_off","areaId":[],"deviceId":[],"entityId":["media_player.bathroom_music_speaker"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1530,"y":1560,"wires":[[]]},{"id":"4ce58926e7976eb0","type":"change","z":"881898b44ee6eb81","name":"Set value to 1","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1270,"y":1560,"wires":[["ed5811c87bcd2804"]]},{"id":"dbd6485bf75b90c2","type":"trigger","z":"881898b44ee6eb81","name":"40m","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"40","extend":false,"overrideDelay":false,"units":"min","reset":"on","bytopic":"all","topic":"topic","outputs":1,"x":1050,"y":1560,"wires":[["4ce58926e7976eb0"]]},{"id":"7ed30b7a5aeffa79","type":"server-state-changed","z":"881898b44ee6eb81","name":"door_open","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.sensor_bathroom_door_contact","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":880,"y":1520,"wires":[["dbd6485bf75b90c2","eb2007c7b6292a41"],[]]},{"id":"a78bc5e9643a7e13","type":"comment","z":"881898b44ee6eb81","name":"Is the shower speaker playing?","info":"","x":270,"y":1540,"wires":[]},{"id":"e7dedef2dd79771b","type":"comment","z":"881898b44ee6eb81","name":"Yes","info":"","x":510,"y":1560,"wires":[]},{"id":"46547f4052ae769d","type":"comment","z":"881898b44ee6eb81","name":"No","info":"","x":510,"y":1600,"wires":[]},{"id":"ff7531b46d7d9fa1","type":"comment","z":"881898b44ee6eb81","name":"Mute the bathroom speaker","info":"","x":680,"y":1520,"wires":[]},{"id":"d58ec3650bf91ab4","type":"comment","z":"881898b44ee6eb81","name":"Unmute the bathroom speaker","info":"","x":680,"y":1640,"wires":[]},{"id":"c8c832241b285a32","type":"comment","z":"881898b44ee6eb81","name":"Doors turns \"on\" (Opened)","info":"","x":890,"y":1480,"wires":[]},{"id":"76e8d92ef97c7ab4","type":"comment","z":"881898b44ee6eb81","name":"reset on \"on\"","info":"","x":1050,"y":1600,"wires":[]},{"id":"e6888a73c8e897af","type":"comment","z":"881898b44ee6eb81","name":"wait 40 minutes","info":"","x":1060,"y":1520,"wires":[]},{"id":"acd37fe93cc74038","type":"comment","z":"881898b44ee6eb81","name":"Reset the payload to 1","info":"","x":1260,"y":1520,"wires":[]},{"id":"bee9cc9f62cdb66e","type":"comment","z":"881898b44ee6eb81","name":"Stop Bathroom Speaker","info":"","x":1520,"y":1520,"wires":[]},{"id":"16350980bdaeb03d","type":"server-state-changed","z":"881898b44ee6eb81","name":"Humidity over 65","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.sensor_bathroom_temperature_humidity","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"65","halt_if_type":"num","halt_if_compare":"gt","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":220,"y":1920,"wires":[["7d0f5838de6d82b3"],["476a043cfcaf20f9"]]},{"id":"7d0f5838de6d82b3","type":"api-call-service","z":"881898b44ee6eb81","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.bathroom_fan"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":690,"y":1880,"wires":[[]]},{"id":"e035b4b481bedb26","type":"api-call-service","z":"881898b44ee6eb81","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.bathroom_fan"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":690,"y":1940,"wires":[[]]},{"id":"983cafc3d10300b1","type":"comment","z":"881898b44ee6eb81","name":"Is the humidity over 65%?","info":"","x":230,"y":1880,"wires":[]},{"id":"476a043cfcaf20f9","type":"switch","z":"881898b44ee6eb81","name":"Payload under 50%","property":"payload","propertyType":"msg","rules":[{"t":"lt","v":"50","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":470,"y":1940,"wires":[["e035b4b481bedb26"]]},{"id":"6f11500da7e99b21","type":"inject","z":"881898b44ee6eb81","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":460,"y":1800,"wires":[[]]},{"id":"f893d5d64f4338ba","type":"comment","z":"881898b44ee6eb81","name":"Is thehumidity under 50%?","info":"","x":470,"y":1980,"wires":[]},{"id":"f241683f39e10522","type":"comment","z":"881898b44ee6eb81","name":"Turn on the bathroom fan","info":"","x":690,"y":1840,"wires":[]},{"id":"6834fab31c07eae3","type":"comment","z":"881898b44ee6eb81","name":"Turn off the bathroom fan","info":"","x":710,"y":1980,"wires":[]},{"id":"35ae3b6cb2c9519a","type":"server-state-changed","z":"effe1ca3bbc31144","name":"Samsung S7 FE battery level","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.galaxy_tab_s7_fe_battery","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"num","halt_if_compare":"is","outputs":1,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":560,"y":700,"wires":[["26cce76adadd42af"]]},{"id":"26cce76adadd42af","type":"switch","z":"effe1ca3bbc31144","name":"","property":"payload","propertyType":"msg","rules":[{"t":"gt","v":"80","vt":"num"},{"t":"lt","v":"20","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":790,"y":700,"wires":[["da5e98c06e83f4e5"],["aa3d9a30fab50e93"]]},{"id":"da5e98c06e83f4e5","type":"api-call-service","z":"effe1ca3bbc31144","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.plug_entrance_tablet"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1090,"y":680,"wires":[[]]},{"id":"aa3d9a30fab50e93","type":"api-call-service","z":"effe1ca3bbc31144","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.plug_entrance_tablet"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1090,"y":720,"wires":[[]]},{"id":"36b65a18504e7a22","type":"server-state-changed","z":"effe1ca3bbc31144","name":"Samsung A7 lite battery level","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.galaxy_tab_a7_lite_battery_level","entityidfiltertype":"exact","outputinitially":true,"state_type":"str","haltifstate":"","halt_if_type":"num","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":560,"y":960,"wires":[["4cb6ad89f78061a4"]]},{"id":"4cb6ad89f78061a4","type":"switch","z":"effe1ca3bbc31144","name":"","property":"payload","propertyType":"msg","rules":[{"t":"gt","v":"95","vt":"num"},{"t":"lt","v":"20","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":790,"y":960,"wires":[["d0c7a34d3806e93e"],["b334e70bc7612de7"]]},{"id":"d0c7a34d3806e93e","type":"api-call-service","z":"effe1ca3bbc31144","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.plug_bedroom_tablet"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1070,"y":920,"wires":[["081a136360d3db5a"]]},{"id":"b334e70bc7612de7","type":"api-call-service","z":"effe1ca3bbc31144","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.plug_bedroom_tablet"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1070,"y":980,"wires":[[]]},{"id":"081a136360d3db5a","type":"trigger","z":"effe1ca3bbc31144","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"11","extend":false,"overrideDelay":false,"units":"hr","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1320,"y":920,"wires":[["44bb104f69f77c10"]]},{"id":"44bb104f69f77c10","type":"api-call-service","z":"effe1ca3bbc31144","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.plug_bedroom_tablet"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1530,"y":920,"wires":[[]]},{"id":"6f667247f0c161d7","type":"comment","z":"effe1ca3bbc31144","name":"Check Battery level","info":"","x":570,"y":660,"wires":[]},{"id":"7a5ed9de8409c23f","type":"comment","z":"effe1ca3bbc31144","name":"Split on battery level","info":"","x":790,"y":660,"wires":[]},{"id":"200a1925d7ba53cc","type":"comment","z":"effe1ca3bbc31144","name":"Turn off the smart plug","info":"","x":1080,"y":640,"wires":[]},{"id":"68f6222e9ff2f39d","type":"comment","z":"effe1ca3bbc31144","name":"Turn on the smart plug","info":"","x":1080,"y":760,"wires":[]},{"id":"abcaad46c688b6a8","type":"comment","z":"effe1ca3bbc31144","name":"Turn off the smart plug","info":"","x":1060,"y":880,"wires":[]},{"id":"ada4fe0ce94933d6","type":"comment","z":"effe1ca3bbc31144","name":"Turn on the smart plug","info":"","x":1060,"y":1020,"wires":[]},{"id":"0c0e22622bcfac7e","type":"comment","z":"effe1ca3bbc31144","name":"Turn on the smart plug","info":"","x":1520,"y":880,"wires":[]},{"id":"eb926832575164d5","type":"comment","z":"effe1ca3bbc31144","name":"wait 11 hours","info":"","x":1310,"y":880,"wires":[]},{"id":"bd235f8ada148ddd","type":"comment","z":"effe1ca3bbc31144","name":"Check Battery level","info":"","x":570,"y":920,"wires":[]},{"id":"9b17860705a857dd","type":"comment","z":"effe1ca3bbc31144","name":"Split on battery level","info":"","x":790,"y":920,"wires":[]},{"id":"4c92d172159985a9","type":"api-call-service","z":"cc94640ec8e547cb","name":"Door light on (100%)","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.front_door_light"],"data":"{\"color_name\":\"white\",\"brightness_pct\":\"100\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":940,"y":180,"wires":[[]]},{"id":"c38c98058767e278","type":"poll-state","z":"cc94640ec8e547cb","name":"","server":"7ab5c227.a3ce8c","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"updateinterval":"2","updateIntervalType":"num","updateIntervalUnits":"hours","outputinitially":false,"outputonchanged":true,"entity_id":"sun.sun","state_type":"str","halt_if":"below_horizon","halt_if_type":"str","halt_if_compare":"is","outputs":2,"x":130,"y":220,"wires":[["6dae17c627907e37"],["1b04206a65cea813"]]},{"id":"c573b0de84a33ed4","type":"api-call-service","z":"cc94640ec8e547cb","name":"Door light off","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.front_door_light"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":710,"y":260,"wires":[[]]},{"id":"ec38337bc4762c2a","type":"trigger","z":"cc94640ec8e547cb","name":"","op1":"","op2":"0","op1type":"pay","op2type":"str","duration":"-2","extend":false,"overrideDelay":false,"units":"hr","reset":"above_horizon","bytopic":"all","topic":"topic","outputs":1,"x":550,"y":180,"wires":[["4c92d172159985a9"]]},{"id":"0ac23590a7b82122","type":"trigger","z":"cc94640ec8e547cb","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"1","extend":false,"overrideDelay":false,"units":"hr","reset":"above_horizon","bytopic":"all","topic":"topic","outputs":1,"x":530,"y":260,"wires":[["c573b0de84a33ed4"]]},{"id":"5ad85c724fafa24c","type":"comment","z":"cc94640ec8e547cb","name":"Automation to turns on and off the front door light","info":"","x":180,"y":140,"wires":[]},{"id":"18d4ce4ab3396e68","type":"comment","z":"cc94640ec8e547cb","name":"Resend command every 2 hours until sun is Up","info":"","x":560,"y":140,"wires":[]},{"id":"108c06c5cf959146","type":"comment","z":"cc94640ec8e547cb","name":"Wait one hour","info":"","x":530,"y":300,"wires":[]},{"id":"9ebe76810287385f","type":"comment","z":"cc94640ec8e547cb","name":"Maximum brightness White Light","info":"","x":930,"y":140,"wires":[]},{"id":"64b624557a59f61e","type":"api-call-service","z":"cc94640ec8e547cb","name":"Front door 100% white","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.front_door_light"],"data":"{\"color_name\":\"white\",\"brightness_pct\":\"100\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1100,"y":520,"wires":[["202b7bbecbc5e1f4"]]},{"id":"87414222f452de4b","type":"server-state-changed","z":"cc94640ec8e547cb","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.front_persons","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"(0)","halt_if_type":"re","halt_if_compare":"is_not","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":180,"y":480,"wires":[["e6c8ccf88b4d5f28"],[]]},{"id":"0f9702216925a495","type":"api-call-service","z":"cc94640ec8e547cb","name":"Front door 65% white","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.front_door_light"],"data":"{\"color_name\":\"white\",\"brightness_pct\":\"65\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1100,"y":440,"wires":[["3cbebc894a46829c"]]},{"id":"6be3e38f22ceb49d","type":"api-current-state","z":"cc94640ec8e547cb","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.front_door_light","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"entity","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":680,"y":480,"wires":[["bf61178d1208f913"],["b2b40cd2583e9dcd"]]},{"id":"e6c8ccf88b4d5f28","type":"switch","z":"cc94640ec8e547cb","name":"!=0","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":430,"y":480,"wires":[["6be3e38f22ceb49d"]]},{"id":"c2bcaaa56e71fe39","type":"api-call-service","z":"cc94640ec8e547cb","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.front_door_light"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1710,"y":440,"wires":[[]]},{"id":"3cbebc894a46829c","type":"ha-wait-until","z":"cc94640ec8e547cb","name":"","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"sensor.front_persons","entityIdFilterType":"exact","property":"state","comparator":"is","value":"0","valueType":"str","timeout":"15","timeoutType":"num","timeoutUnits":"minutes","checkCurrentState":false,"blockInputOverrides":false,"outputProperties":[],"x":1320,"y":440,"wires":[["d2b6266995cb604e"],["d2b6266995cb604e"]]},{"id":"d2b6266995cb604e","type":"change","z":"cc94640ec8e547cb","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1520,"y":440,"wires":[["c2bcaaa56e71fe39"]]},{"id":"c92671e67851e1a5","type":"comment","z":"cc94640ec8e547cb","name":"Lights on when someone is detected in the front","info":"","x":180,"y":420,"wires":[]},{"id":"6c8720b8279e955d","type":"comment","z":"cc94640ec8e547cb","name":"Person is not 0","info":"","x":420,"y":520,"wires":[]},{"id":"8706f5c37c3505c9","type":"comment","z":"cc94640ec8e547cb","name":"Is the light already on?","info":"","x":680,"y":440,"wires":[]},{"id":"0c19972a2eeb20b8","type":"comment","z":"cc94640ec8e547cb","name":"Yes","info":"","x":910,"y":520,"wires":[]},{"id":"85e319c981aa9d18","type":"comment","z":"cc94640ec8e547cb","name":"No","info":"","x":910,"y":440,"wires":[]},{"id":"112abc97d210c7b4","type":"api-call-service","z":"cc94640ec8e547cb","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.front_door_light"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1730,"y":520,"wires":[[]]},{"id":"202b7bbecbc5e1f4","type":"ha-wait-until","z":"cc94640ec8e547cb","name":"","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"sensor.front_persons","entityIdFilterType":"exact","property":"state","comparator":"is","value":"0","valueType":"str","timeout":"2","timeoutType":"num","timeoutUnits":"minutes","checkCurrentState":false,"blockInputOverrides":false,"outputProperties":[],"x":1320,"y":520,"wires":[["17dd9d749a024ff0"],["17dd9d749a024ff0"]]},{"id":"17dd9d749a024ff0","type":"change","z":"cc94640ec8e547cb","name":"","rules":[{"t":"set","p":"payload.data.brightness","pt":"msg","to":"entity.attributes.brightness","tot":"msg","dc":true},{"t":"delete","p":"payload.data.brightness_pct","pt":"msg"},{"t":"delete","p":"payload.data.color_name","pt":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1520,"y":520,"wires":[["112abc97d210c7b4"]]},{"id":"f5dda07dd9794855","type":"comment","z":"cc94640ec8e547cb","name":"Apply color and brightness","info":"","x":1090,"y":480,"wires":[]},{"id":"44a08d552acbc93f","type":"comment","z":"cc94640ec8e547cb","name":"Wait until person = 0","info":"","x":1330,"y":480,"wires":[]},{"id":"068c88e9751c285a","type":"comment","z":"cc94640ec8e547cb","name":"Turn the light off","info":"","x":1700,"y":400,"wires":[]},{"id":"b1ef6342e8069d84","type":"comment","z":"cc94640ec8e547cb","name":"Return the light to its initial brightness","info":"","x":1810,"y":560,"wires":[]},{"id":"ca142425f61b0c2a","type":"comment","z":"cc94640ec8e547cb","name":"Extract initial brightness","info":"","x":1520,"y":560,"wires":[]},{"id":"e1a0bd430e45a45b","type":"comment","z":"cc94640ec8e547cb","name":"Reset payload","info":"","x":1510,"y":400,"wires":[]},{"id":"b26e10b7fb19d977","type":"api-call-service","z":"cc94640ec8e547cb","name":"Lock Door","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"lock","service":"lock","areaId":[],"deviceId":[],"entityId":["lock.lock_front_door"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":730,"y":740,"wires":[[]]},{"id":"a7d1ef5acf5d9982","type":"trigger-state","z":"cc94640ec8e547cb","name":"","server":"7ab5c227.a3ce8c","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"binary_sensor.sensor_front_outside_door_contact","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off","propertyValue":"new_state.state"}],"inputs":0,"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","enableInput":false,"x":270,"y":740,"wires":[["b26e10b7fb19d977"],[]]},{"id":"99fb4a0bebf4b554","type":"comment","z":"cc94640ec8e547cb","name":"Detect when front door gets closed","info":"","x":180,"y":700,"wires":[]},{"id":"a758a0c37b2d8097","type":"comment","z":"cc94640ec8e547cb","name":"Lock the door","info":"","x":730,"y":700,"wires":[]},{"id":"9be350595dc69bd8","type":"api-call-service","z":"cc94640ec8e547cb","name":"Lock Door","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"lock","service":"lock","areaId":[],"deviceId":[],"entityId":["lock.lock_front_door"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":830,"y":880,"wires":[[]]},{"id":"a58c332479ab66c1","type":"trigger-state","z":"cc94640ec8e547cb","name":"","server":"7ab5c227.a3ce8c","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"lock.lock_front_door","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"unlocked","propertyValue":"new_state.state"}],"inputs":0,"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","enableInput":false,"x":170,"y":880,"wires":[["9c3940704c57c37b"],[]]},{"id":"30a460e80cbb9298","type":"comment","z":"cc94640ec8e547cb","name":"Detect when door is unlocked","info":"","x":160,"y":840,"wires":[]},{"id":"b836f784462b57b8","type":"comment","z":"cc94640ec8e547cb","name":"Lock the door","info":"","x":830,"y":840,"wires":[]},{"id":"9c3940704c57c37b","type":"trigger","z":"cc94640ec8e547cb","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"5","extend":false,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":510,"y":880,"wires":[["9be350595dc69bd8"]]},{"id":"6e7de3c713429510","type":"comment","z":"cc94640ec8e547cb","name":"wait 5 minutes","info":"","x":490,"y":840,"wires":[]},{"id":"2b8f21d2930527fd","type":"server-state-changed","z":"7a1172b433a6cf9c","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.livingroom_ac","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"(on)","halt_if_type":"re","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":240,"y":160,"wires":[["de24400af7fb8682"],["b659f5b0b0949237"]]},{"id":"6ab2b0bf6efbdf06","type":"api-call-service","z":"7a1172b433a6cf9c","name":"Raise volume","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_up","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1140,"y":120,"wires":[[]]},{"id":"f5e830d6ddc96d84","type":"comment","z":"7a1172b433a6cf9c","name":"Adjust volume of players depending on AC state","info":"","x":280,"y":60,"wires":[]},{"id":"2dd272c9b019b4cb","type":"ha-get-entities","z":"7a1172b433a6cf9c","name":"Get Livingroom Media players","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"entity_id","logic":"is","value":"media_player\\.living.*[a-z]","valueType":"re"},{"property":"state","logic":"is","value":"playing","valueType":"str"},{"property":"attributes.is_volume_muted","logic":"is","value":"false","valueType":"bool"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":690,"y":120,"wires":[["b20d619270cc6150"]]},{"id":"b20d619270cc6150","type":"change","z":"7a1172b433a6cf9c","name":"","rules":[{"t":"delete","p":"parts","pt":"msg"},{"t":"move","p":"payload.entity_id","pt":"msg","to":"payload.data.entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":920,"y":120,"wires":[["6ab2b0bf6efbdf06"]]},{"id":"4af896f52385062c","type":"api-call-service","z":"7a1172b433a6cf9c","name":"Lower Volume","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_up","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1140,"y":200,"wires":[[]]},{"id":"8983f64fe67807ba","type":"change","z":"7a1172b433a6cf9c","name":"","rules":[{"t":"delete","p":"parts","pt":"msg"},{"t":"move","p":"payload.entity_id","pt":"msg","to":"payload.data.entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":920,"y":200,"wires":[["4af896f52385062c"]]},{"id":"194df1b5694d90f6","type":"comment","z":"7a1172b433a6cf9c","name":"AC ON?","info":"","x":240,"y":120,"wires":[]},{"id":"fdac127df5c14497","type":"comment","z":"7a1172b433a6cf9c","name":"AC ON?","info":"","x":480,"y":120,"wires":[]},{"id":"331ecc86cf62638c","type":"comment","z":"7a1172b433a6cf9c","name":"AC ON?","info":"","x":480,"y":200,"wires":[]},{"id":"6fa23a1db9f7c256","type":"comment","z":"7a1172b433a6cf9c","name":"Get Living room media players entities and output them one by one","info":"","x":700,"y":160,"wires":[]},{"id":"094384a7307219c9","type":"comment","z":"7a1172b433a6cf9c","name":"Place the entity_id properly","info":"","x":910,"y":80,"wires":[]},{"id":"129d6d45d0edfb1c","type":"comment","z":"7a1172b433a6cf9c","name":"Place the entity_id properly","info":"","x":910,"y":240,"wires":[]},{"id":"2fe6cbe753337547","type":"comment","z":"7a1172b433a6cf9c","name":"Sed volume command","info":"","x":1140,"y":160,"wires":[]},{"id":"b32a90c6168f15d7","type":"trigger-state","z":"7a1172b433a6cf9c","name":"Cover Closed and AC on","server":"7ab5c227.a3ce8c","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"switch.livingroom_ac","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"entity_id","targetValue":"cover.cover_livingroom_blinds","propertyType":"property","comparatorType":"<","comparatorValueDatatype":"num","comparatorValue":"26","propertyValue":"attributes.current_position"},{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on","propertyValue":"new_state.state"}],"inputs":0,"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","enableInput":false,"x":210,"y":600,"wires":[["f6f59f0656592eed"],[]]},{"id":"f6f59f0656592eed","type":"api-call-service","z":"7a1172b433a6cf9c","name":"Blinds at 26% ","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"cover","service":"set_cover_position","areaId":[],"deviceId":[],"entityId":["cover.cover_livingroom_blinds"],"data":"{\"position\": \"26\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":520,"y":600,"wires":[[]]},{"id":"5f22a5944ac11de5","type":"api-call-service","z":"7a1172b433a6cf9c","name":"CLose blinds","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"cover","service":"set_cover_position","areaId":[],"deviceId":[],"entityId":["cover.cover_livingroom_blinds"],"data":"{\"position\": \"0\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":510,"y":700,"wires":[[]]},{"id":"cb5984111331e6ed","type":"api-call-service","z":"7a1172b433a6cf9c","name":"Blinds at 26% ","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"cover","service":"set_cover_position","areaId":[],"deviceId":[],"entityId":["cover.cover_livingroom_blinds"],"data":"{\"position\": \"26\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":520,"y":520,"wires":[[]]},{"id":"c300aac55d064248","type":"trigger-state","z":"7a1172b433a6cf9c","name":"Cover Closed and AC Off","server":"7ab5c227.a3ce8c","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"switch.livingroom_ac","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"entity_id","targetValue":"cover.cover_livingroom_blinds","propertyType":"property","comparatorType":"<","comparatorValueDatatype":"num","comparatorValue":"27","propertyValue":"attributes.current_position"},{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off","propertyValue":"new_state.state"}],"inputs":0,"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","enableInput":false,"x":210,"y":700,"wires":[["5f22a5944ac11de5"],[]]},{"id":"3b1c32816a1299f8","type":"trigger-state","z":"7a1172b433a6cf9c","name":"Closed Cover and AC on","server":"7ab5c227.a3ce8c","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"cover.cover_livingroom_blinds","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"property","comparatorType":"<","comparatorValueDatatype":"num","comparatorValue":"26","propertyValue":"new_state.attributes.current_position"},{"targetType":"entity_id","targetValue":"switch.livingroom_ac","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on","propertyValue":"new_state.state"}],"inputs":0,"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","enableInput":false,"x":210,"y":520,"wires":[["cb5984111331e6ed"],[]]},{"id":"bd59751a77bcba60","type":"comment","z":"7a1172b433a6cf9c","name":"If cover is under 26% and AC is on","info":"","x":240,"y":560,"wires":[]},{"id":"3f4d478a4f7e7def","type":"comment","z":"7a1172b433a6cf9c","name":"Set cover to 26% open","info":"","x":540,"y":560,"wires":[]},{"id":"f552d4b46029cb7d","type":"comment","z":"7a1172b433a6cf9c","name":"If cover is under 26% and AC is off","info":"","x":240,"y":660,"wires":[]},{"id":"4c0a54eac3d0f0cb","type":"comment","z":"7a1172b433a6cf9c","name":"Close blinds","info":"","x":510,"y":660,"wires":[]},{"id":"ca28f711101bffcc","type":"comment","z":"7a1172b433a6cf9c","name":"Ikea blind button","info":"","x":120,"y":2120,"wires":[]},{"id":"e10059117be5de52","type":"comment","z":"7a1172b433a6cf9c","name":"Open or Close","info":"","x":310,"y":2120,"wires":[]},{"id":"f929d29e13821eeb","type":"comment","z":"7a1172b433a6cf9c","name":"Open cover","info":"","x":570,"y":2100,"wires":[]},{"id":"58aecdb12f173ad1","type":"comment","z":"7a1172b433a6cf9c","name":"Close cover","info":"","x":570,"y":2220,"wires":[]},{"id":"ddcea114278daa7d","type":"api-call-service","z":"7a1172b433a6cf9c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"cover","service":"open_cover","areaId":[],"deviceId":[],"entityId":["cover.cover_livingroom_blinds"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":560,"y":2140,"wires":[[]]},{"id":"874e0ddfe60e095c","type":"switch","z":"7a1172b433a6cf9c","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"open","vt":"str"},{"t":"eq","v":"close","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":310,"y":2160,"wires":[["ddcea114278daa7d"],["af99c9c9b796b673"]]},{"id":"78da9fa3d7731367","type":"server-state-changed","z":"7a1172b433a6cf9c","name":"Blind Button","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.remote_livingroom_blind_button_action","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"(open|close)","halt_if_type":"re","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":110,"y":2160,"wires":[["874e0ddfe60e095c"],[]]},{"id":"af99c9c9b796b673","type":"api-call-service","z":"7a1172b433a6cf9c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"cover","service":"close_cover","areaId":[],"deviceId":[],"entityId":["cover.cover_livingroom_blinds"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":560,"y":2180,"wires":[[]]},{"id":"70c42437dc758335","type":"ha-get-entities","z":"7a1172b433a6cf9c","name":"Get Livingroom Media players","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"entity_id","logic":"is","value":"media_player\\.living.*[a-z]","valueType":"re"},{"property":"state","logic":"is","value":"playing","valueType":"str"},{"property":"attributes.is_volume_muted","logic":"is","value":"false","valueType":"bool"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":690,"y":200,"wires":[["8983f64fe67807ba"]]},{"id":"12f92c1dbffead2b","type":"server-state-changed","z":"7a1172b433a6cf9c","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"media_player.livingroom_display","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"playing","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"x":720,"y":1960,"wires":[[],[]]},{"id":"5e5e74f45188c8c0","type":"api-call-service","z":"7a1172b433a6cf9c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"media_next_track","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2430,"y":1500,"wires":[[]]},{"id":"69ec8af0978c5dd5","type":"switch","z":"7a1172b433a6cf9c","name":"","property":"action","propertyType":"msg","rules":[{"t":"eq","v":"rotate_right","vt":"str"},{"t":"eq","v":"play_pause","vt":"str"},{"t":"eq","v":"rotate_left","vt":"str"},{"t":"eq","v":"skip_backward","vt":"str"},{"t":"eq","v":"skip_forward","vt":"str"}],"checkall":"false","repair":false,"outputs":5,"x":2140,"y":1480,"wires":[["4342fba42df25835"],["98a78230b6aa0a10"],["ca4b8563c478af01"],["5e5e74f45188c8c0"],["5a5442d1f23b7408"]]},{"id":"d3684aa0d6eaa2ca","type":"switch","z":"7a1172b433a6cf9c","name":"Action not empty","property":"action","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1830,"y":1480,"wires":[["69ec8af0978c5dd5"]]},{"id":"4342fba42df25835","type":"api-call-service","z":"7a1172b433a6cf9c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_up","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2410,"y":1380,"wires":[[]]},{"id":"98a78230b6aa0a10","type":"api-call-service","z":"7a1172b433a6cf9c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"media_play_pause","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2420,"y":1420,"wires":[[]]},{"id":"ca4b8563c478af01","type":"api-call-service","z":"7a1172b433a6cf9c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_down","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2410,"y":1460,"wires":[[]]},{"id":"5a5442d1f23b7408","type":"trigger","z":"7a1172b433a6cf9c","name":"","op1":"1","op2":"","op1type":"num","op2type":"nul","duration":"100","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2360,"y":1540,"wires":[["2abb54a8f58fc02a"]]},{"id":"eb0c203060adc4c1","type":"switch","z":"7a1172b433a6cf9c","name":"Muted?","property":"entity.attributes.is_volume_muted","propertyType":"msg","rules":[{"t":"cont","v":"false","vt":"str"},{"t":"cont","v":"true","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1260,"y":1480,"wires":[["b5fde2ec0dccab1b"],["13f083aa7fcdbbb3"]]},{"id":"90b3946ea1f5990a","type":"api-current-state","z":"7a1172b433a6cf9c","name":"chromecast","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is_not","entity_id":"media_player.livingroom_chromecast","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"entity","propertyType":"msg","value":"","valueType":"entity"},{"property":"payload.data.entity_id","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":1570,"y":1540,"wires":[["d3684aa0d6eaa2ca"],["3af98f6b32a696f8"]]},{"id":"8d18e180fa3f69b9","type":"switch","z":"7a1172b433a6cf9c","name":"","property":"action","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":2590,"y":1580,"wires":[["77a65992b0e1528c"]]},{"id":"0c930675da160858","type":"change","z":"7a1172b433a6cf9c","name":"set entity","rules":[{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"media_player.livingroom_center_speaker,media_player.livingroom_speaker,media_player.livingroom_window_speaker","tot":"str","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":1060,"y":1480,"wires":[["eb0c203060adc4c1"]]},{"id":"a95e03e72dfae714","type":"api-current-state","z":"7a1172b433a6cf9c","name":"speaker","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is_not","entity_id":"media_player.livingroom_center_speaker","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"entity","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":720,"y":1500,"wires":[["551085e979e7ad02"],["cd427e4cb5e4cc78"]]},{"id":"77a65992b0e1528c","type":"switch","z":"7a1172b433a6cf9c","name":"","property":"action","propertyType":"msg","rules":[{"t":"eq","v":"rotate_right","vt":"str"},{"t":"eq","v":"rotate_left","vt":"str"},{"t":"eq","v":"play_pause","vt":"str"},{"t":"eq","v":"skip_forward","vt":"str"},{"t":"eq","v":"skip_backward","vt":"str"}],"checkall":"true","repair":false,"outputs":5,"x":2770,"y":1580,"wires":[["0e3d419fcd54563c"],["34a6e2947c5ce81c"],[],[],[]]},{"id":"3f708bd927c4d678","type":"change","z":"7a1172b433a6cf9c","name":"Move action","rules":[{"t":"set","p":"action","pt":"msg","to":"payload.action","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":1500,"wires":[["a95e03e72dfae714"]]},{"id":"0e3d419fcd54563c","type":"api-call-service","z":"7a1172b433a6cf9c","name":"Brightnen light","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.group_livingroom_lights"],"data":"{\"brightness_step_pct\": 10}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3020,"y":1540,"wires":[[]]},{"id":"34a6e2947c5ce81c","type":"api-call-service","z":"7a1172b433a6cf9c","name":"Dim light","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.group_livingroom_lights"],"data":"{\"brightness_step_pct\": -10}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3000,"y":1580,"wires":[[]]},{"id":"a1327062e6efb9b5","type":"comment","z":"7a1172b433a6cf9c","name":"Yes","info":"","x":1430,"y":1500,"wires":[]},{"id":"a1f39e99cf318d9c","type":"comment","z":"7a1172b433a6cf9c","name":"No","info":"","x":1570,"y":1460,"wires":[]},{"id":"7876a5812bbe3f1a","type":"comment","z":"7a1172b433a6cf9c","name":"Is entity muted?","info":"","x":1260,"y":1440,"wires":[]},{"id":"2abd45ae5df2403e","type":"comment","z":"7a1172b433a6cf9c","name":"Set speakers entities","info":"","x":1070,"y":1440,"wires":[]},{"id":"558fccfefb741308","type":"comment","z":"7a1172b433a6cf9c","name":"Is speaker off?","info":"","x":720,"y":1460,"wires":[]},{"id":"76ad2bd28c3133ad","type":"comment","z":"7a1172b433a6cf9c","name":"No","info":"","x":890,"y":1480,"wires":[]},{"id":"5e61bb5e228825e8","type":"comment","z":"7a1172b433a6cf9c","name":"Yes","info":"","x":890,"y":1540,"wires":[]},{"id":"421778304f625902","type":"comment","z":"7a1172b433a6cf9c","name":"Move payload.action to action","info":"","x":480,"y":1460,"wires":[]},{"id":"0a80fc19420f5ed3","type":"comment","z":"7a1172b433a6cf9c","name":"Check that action is not empty","info":"","x":1820,"y":1440,"wires":[]},{"id":"f9b9bdcb9b4329f9","type":"comment","z":"7a1172b433a6cf9c","name":"Check that action is not empty","info":"","x":2600,"y":1540,"wires":[]},{"id":"eaf1c1f4ea0a8845","type":"server-state-changed","z":"7a1172b433a6cf9c","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.sleeper_in_livingroom","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":1210,"y":3020,"wires":[["b2a1574456ee77b3"],["9256791e63f40fbe"]]},{"id":"b2a1574456ee77b3","type":"ha-get-entities","z":"7a1172b433a6cf9c","name":"Get individual Hotbox lights","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"entity_id","logic":"is","value":"light\\.(?!.*?group.*?)(?!.*?lights.*?).*livingroom.*","valueType":"re"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":1560,"y":3000,"wires":[["cfe5e026b0d68c69"]]},{"id":"51e2b62bcf83fbb2","type":"api-call-service","z":"7a1172b433a6cf9c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2130,"y":3000,"wires":[[]]},{"id":"9256791e63f40fbe","type":"ha-get-entities","z":"7a1172b433a6cf9c","name":"Get individual Hotbox lights","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"entity_id","logic":"is","value":"light\\.(?!.*?group.*?)(?!.*?lights.*?).*livingroom.*","valueType":"re"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":1560,"y":3040,"wires":[["c1fdac440a2ebc24"]]},{"id":"01511e0acf840f79","type":"api-call-service","z":"7a1172b433a6cf9c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"{\"transition\":\"20\",\"color_name\": \"white\"}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2130,"y":3040,"wires":[[]]},{"id":"8acc727c3836cfa2","type":"comment","z":"7a1172b433a6cf9c","name":"Trigger on Sleeper boolean change","info":"","x":1200,"y":2980,"wires":[]},{"id":"0f850d015bb6c26a","type":"comment","z":"7a1172b433a6cf9c","name":"Get Livingroom light entities","info":"","x":1580,"y":2960,"wires":[]},{"id":"63e2d4d4f1dfa2f6","type":"comment","z":"7a1172b433a6cf9c","name":"Call light_off service","info":"","x":2130,"y":2960,"wires":[]},{"id":"084c6f07fef9b86f","type":"comment","z":"7a1172b433a6cf9c","name":"Toggle the Livingroom  lights when someone sleeps","info":"","x":1210,"y":2940,"wires":[]},{"id":"cfe5e026b0d68c69","type":"change","z":"7a1172b433a6cf9c","name":"","rules":[{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"payload.entity_id","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":1850,"y":3000,"wires":[["51e2b62bcf83fbb2"]]},{"id":"c1fdac440a2ebc24","type":"change","z":"7a1172b433a6cf9c","name":"","rules":[{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"payload.entity_id","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":1850,"y":3040,"wires":[["01511e0acf840f79"]]},{"id":"e3bd0ef17cbbe299","type":"server-state-changed","z":"7a1172b433a6cf9c","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.sleeper_in_livingroom","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":270,"y":3020,"wires":[["9639a1bb2bf5f1cf"],["9639a1bb2bf5f1cf"]]},{"id":"9639a1bb2bf5f1cf","type":"trigger","z":"7a1172b433a6cf9c","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"10","extend":false,"overrideDelay":false,"units":"hr","reset":"off","bytopic":"all","topic":"topic","outputs":1,"x":570,"y":3020,"wires":[["7bc2465a1ef1ef42"]]},{"id":"7bc2465a1ef1ef42","type":"api-call-service","z":"7a1172b433a6cf9c","name":"Turn off Sleeper in Hotbox bool","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.sleeper_in_livingroom"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":790,"y":3020,"wires":[[]]},{"id":"9bb315209fda59b9","type":"server-state-changed","z":"7a1172b433a6cf9c","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.sleeper_in_livingroom","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":270,"y":2840,"wires":[["1cb927e5ac697efa"],["98ea0d51a9464f77"]]},{"id":"527a4dfb9eb86e1e","type":"comment","z":"7a1172b433a6cf9c","name":"Trigger on Sleeper boolean change","info":"","x":260,"y":2800,"wires":[]},{"id":"1cb927e5ac697efa","type":"ha-get-entities","z":"7a1172b433a6cf9c","name":"Get active living room Media players","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"entity_id","logic":"is","value":"media_player\\.(?!.*?group.*?)(?!.*?top.*?).*livingroom.*","valueType":"re"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":710,"y":2800,"wires":[["8f24711d3c008c68"]]},{"id":"ee8e9edb5007f25e","type":"comment","z":"7a1172b433a6cf9c","name":"Pull livingroom media players that are playing","info":"","x":690,"y":2760,"wires":[]},{"id":"8f24711d3c008c68","type":"change","z":"7a1172b433a6cf9c","name":"","rules":[{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"payload.entity_id","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":1030,"y":2800,"wires":[["c96710a197cff30e"]]},{"id":"e1d9dd6a1dfe05b1","type":"comment","z":"7a1172b433a6cf9c","name":"Extract the entity id","info":"","x":1030,"y":2760,"wires":[]},{"id":"009189ab4426c30b","type":"comment","z":"7a1172b433a6cf9c","name":"Mute player's volume","info":"","x":1260,"y":2760,"wires":[]},{"id":"4326fcfd8496cfba","type":"comment","z":"7a1172b433a6cf9c","name":"Stop playback","info":"","x":1870,"y":2760,"wires":[]},{"id":"1b550ceb534e0cab","type":"api-call-service","z":"7a1172b433a6cf9c","name":"stop player","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"turn_off","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1870,"y":2800,"wires":[[]]},{"id":"c96710a197cff30e","type":"api-call-service","z":"7a1172b433a6cf9c","name":"mute player","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_mute","areaId":[],"deviceId":[],"entityId":[],"data":"{\"is_volume_muted\":\"true\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1270,"y":2800,"wires":[["2ab8f0b4d628e884"]]},{"id":"2ab8f0b4d628e884","type":"api-current-state","z":"7a1172b433a6cf9c","name":"Home_Group off","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"media_player.group_home_speakers","state_type":"str","blockInputOverrides":true,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":1540,"y":2800,"wires":[["1b550ceb534e0cab"],[]]},{"id":"7615b56747bef2b2","type":"comment","z":"7a1172b433a6cf9c","name":"MAke sure home_group is not playing","info":"","x":1550,"y":2760,"wires":[]},{"id":"98ea0d51a9464f77","type":"ha-get-entities","z":"7a1172b433a6cf9c","name":"Get active living room Media players","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"entity_id","logic":"is","value":"media_player\\.(?!.*?group.*?)(?!.*?top.*?).*livingroom.*","valueType":"re"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":710,"y":2880,"wires":[["fe102fb1b94e4385"]]},{"id":"5fe2a1d1f9bb1435","type":"comment","z":"7a1172b433a6cf9c","name":"Pull livingroom media players","info":"","x":640,"y":2840,"wires":[]},{"id":"fe102fb1b94e4385","type":"change","z":"7a1172b433a6cf9c","name":"","rules":[{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"payload.entity_id","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":1030,"y":2880,"wires":[["cb2a449d4b6f4060"]]},{"id":"51eadab95244344f","type":"comment","z":"7a1172b433a6cf9c","name":"Extract the entity id","info":"","x":1030,"y":2840,"wires":[]},{"id":"0ac943c319d49e4b","type":"comment","z":"7a1172b433a6cf9c","name":"unMute player's volume","info":"","x":1260,"y":2840,"wires":[]},{"id":"cb2a449d4b6f4060","type":"api-call-service","z":"7a1172b433a6cf9c","name":"unmute player","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_mute","areaId":[],"deviceId":[],"entityId":[],"data":"{\"is_volume_muted\":\"false\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1280,"y":2880,"wires":[[]]},{"id":"56b9cda6cd5f6c3f","type":"server-state-changed","z":"7a1172b433a6cf9c","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.sleeper_in_livingroom","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":310,"y":3160,"wires":[["a701eb41c2480220"],["59adec8248c94ab8"]]},{"id":"a701eb41c2480220","type":"api-call-service","z":"7a1172b433a6cf9c","name":"Close Blinds","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"cover","service":"close_cover","areaId":[],"deviceId":[],"entityId":["cover.cover_livingroom_blinds"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":670,"y":3160,"wires":[["b9cbf8db5e72a2aa"]]},{"id":"b9cbf8db5e72a2aa","type":"api-call-service","z":"7a1172b433a6cf9c","name":"Turn off TV","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"turn_off","areaId":[],"deviceId":[],"entityId":["media_player.livingroom_lg_webos_tv"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":930,"y":3160,"wires":[[]]},{"id":"59adec8248c94ab8","type":"api-call-service","z":"7a1172b433a6cf9c","name":"Turn on Tv","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"tts","service":"google_translate_say","areaId":[],"deviceId":[],"entityId":["media_player.livingroom_chromecast"],"data":"{    \"message\": \"Good morning\",    \"language\": \"en\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":670,"y":3200,"wires":[["2380227eec6c2976"]]},{"id":"0b503c4dd6888c87","type":"inject","z":"7a1172b433a6cf9c","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":420,"y":3220,"wires":[["59adec8248c94ab8"]]},{"id":"2380227eec6c2976","type":"api-call-service","z":"7a1172b433a6cf9c","name":"Turn off chromecast","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"turn_off","areaId":[],"deviceId":[],"entityId":["media_player.livingroom_chromecast"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":920,"y":3200,"wires":[[]]},{"id":"c6df906663bb8ece","type":"comment","z":"7a1172b433a6cf9c","name":"Mute player's volume","info":"","x":600,"y":3320,"wires":[]},{"id":"161d30db7812414c","type":"api-call-service","z":"7a1172b433a6cf9c","name":"mute player","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_mute","areaId":[],"deviceId":[],"entityId":["media_player.entrance_speaker"],"data":"{\"is_volume_muted\":\"true\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":610,"y":3360,"wires":[[]]},{"id":"345c7fdabd0c4763","type":"comment","z":"7a1172b433a6cf9c","name":"unMute player's volume","info":"","x":600,"y":3400,"wires":[]},{"id":"e393b3c3753017f4","type":"api-call-service","z":"7a1172b433a6cf9c","name":"unmute player","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_mute","areaId":[],"deviceId":[],"entityId":["media_player.entrance_speaker"],"data":"{\"is_volume_muted\":\"false\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":620,"y":3440,"wires":[[]]},{"id":"53f8e91df936a6f2","type":"server-state-changed","z":"7a1172b433a6cf9c","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.sleeper_in_livingroom","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":250,"y":3360,"wires":[["161d30db7812414c"],["e393b3c3753017f4"]]},{"id":"47c310b9a0506290","type":"mqtt in","z":"7a1172b433a6cf9c","name":"","topic":"zigbee2mqtt/remote_livingroom_dial","qos":"2","datatype":"json","broker":"21000c19b97da572","nl":false,"rap":true,"rh":0,"inputs":0,"x":200,"y":4020,"wires":[["87b6e543dfa9ccf3"]]},{"id":"e91dac9449887e29","type":"comment","z":"7a1172b433a6cf9c","name":"Monitor mqtt of living room dial","info":"","x":370,"y":3640,"wires":[]},{"id":"72971feb521eddec","type":"mqtt in","z":"7a1172b433a6cf9c","name":"","topic":"zigbee2mqtt/remote_living_room_dial","qos":"2","datatype":"json","broker":"21000c19b97da572","nl":false,"rap":true,"rh":0,"inputs":0,"x":330,"y":4400,"wires":[[]]},{"id":"833ab1cb8df9bd82","type":"comment","z":"7a1172b433a6cf9c","name":"Monitor mqtt of living room dial","info":"","x":330,"y":4360,"wires":[]},{"id":"014a7b93174a807c","type":"trigger","z":"7a1172b433a6cf9c","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"100","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2340,"y":4520,"wires":[["0fce605628cae6c5"]]},{"id":"c7328ff3b3210812","type":"switch","z":"7a1172b433a6cf9c","name":"","property":"action","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":2590,"y":4520,"wires":[["080af13c4686d501"]]},{"id":"562eea6d12260ef5","type":"change","z":"7a1172b433a6cf9c","name":"set entity","rules":[{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"media_player.livingroom_center_speaker,media_player.livingroom_speaker,media_player.livingroom_window_speaker","tot":"str","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":1180,"y":4380,"wires":[["d783423184d93224"]]},{"id":"11a57d5170b9f144","type":"api-current-state","z":"7a1172b433a6cf9c","name":"speaker","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is_not","entity_id":"media_player.livingroom_center_speaker","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"entity","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":840,"y":4400,"wires":[["39d5c9e4758c7fc9"],["c287b382e15e5f08"]]},{"id":"0659cca11a878c38","type":"switch","z":"7a1172b433a6cf9c","name":"","property":"action","propertyType":"msg","rules":[{"t":"eq","v":"rotate_right","vt":"str"},{"t":"eq","v":"rotate_left","vt":"str"},{"t":"eq","v":"play_pause","vt":"str"},{"t":"eq","v":"skip_forward","vt":"str"},{"t":"eq","v":"skip_backward","vt":"str"}],"checkall":"true","repair":false,"outputs":5,"x":3030,"y":4520,"wires":[["56da2ad19f2d7553","28ee81aa6e194015"],["d327b3a210191224"],["cb026e7c72172eb0"],["9e7d966a7e6debef"],[]]},{"id":"8ac096b2f8c8fc41","type":"change","z":"7a1172b433a6cf9c","name":"Move action","rules":[{"t":"set","p":"action","pt":"msg","to":"payload.action","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":4400,"wires":[["11a57d5170b9f144"]]},{"id":"9a3a452ee5221a27","type":"api-call-service","z":"7a1172b433a6cf9c","name":"Brightnen light","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"{\"brightness_step_pct\": 10}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4520,"y":4440,"wires":[[]]},{"id":"cb026e7c72172eb0","type":"api-call-service","z":"7a1172b433a6cf9c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"toggle","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3280,"y":4560,"wires":[[]]},{"id":"d327b3a210191224","type":"api-call-service","z":"7a1172b433a6cf9c","name":"Dim light","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"{\"brightness_step_pct\": -10}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3260,"y":4520,"wires":[[]]},{"id":"0ca02c3505240ba5","type":"comment","z":"7a1172b433a6cf9c","name":"Set speakers entities","info":"","x":1190,"y":4340,"wires":[]},{"id":"7228c06776fe402e","type":"comment","z":"7a1172b433a6cf9c","name":"Is speaker off?","info":"","x":880,"y":4360,"wires":[]},{"id":"e67c6714aa62314c","type":"comment","z":"7a1172b433a6cf9c","name":"No","info":"","x":1050,"y":4380,"wires":[]},{"id":"168063c43f2e44f2","type":"comment","z":"7a1172b433a6cf9c","name":"Yes","info":"","x":1030,"y":4520,"wires":[]},{"id":"71b10ec8cb392ba0","type":"comment","z":"7a1172b433a6cf9c","name":"Move payload.action to action","info":"","x":640,"y":4360,"wires":[]},{"id":"35db7f448155b9b0","type":"comment","z":"7a1172b433a6cf9c","name":"Check that action is not empty","info":"","x":2600,"y":4480,"wires":[]},{"id":"1adbf020674aa718","type":"switch","z":"7a1172b433a6cf9c","name":"","property":"action","propertyType":"msg","rules":[{"t":"eq","v":"rotate_right","vt":"str"},{"t":"eq","v":"play_pause","vt":"str"},{"t":"eq","v":"rotate_left","vt":"str"},{"t":"eq","v":"skip_forward","vt":"str"},{"t":"eq","v":"skip_backward","vt":"str"}],"checkall":"false","repair":false,"outputs":5,"x":2310,"y":4380,"wires":[["1e5b71308b72c39b"],["797df9026f489852"],["80ca59a9ef0faae1"],["39e8f6d636bb3d92"],["24593100353cc781"]]},{"id":"39e8f6d636bb3d92","type":"api-call-service","z":"7a1172b433a6cf9c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"media_next_track","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2610,"y":4340,"wires":[[]]},{"id":"1e5b71308b72c39b","type":"api-call-service","z":"7a1172b433a6cf9c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_up","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2650,"y":4220,"wires":[[]]},{"id":"797df9026f489852","type":"api-call-service","z":"7a1172b433a6cf9c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"media_play_pause","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2650,"y":4260,"wires":[[]]},{"id":"80ca59a9ef0faae1","type":"api-call-service","z":"7a1172b433a6cf9c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_down","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2610,"y":4300,"wires":[[]]},{"id":"080af13c4686d501","type":"change","z":"7a1172b433a6cf9c","name":"set entity","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"light.group_livingroom_lights","tot":"str","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":2820,"y":4520,"wires":[["0659cca11a878c38"]]},{"id":"3377ecf846b05adc","type":"comment","z":"7a1172b433a6cf9c","name":"Set Lights entities","info":"","x":2850,"y":4480,"wires":[]},{"id":"24593100353cc781","type":"change","z":"7a1172b433a6cf9c","name":"set flow light mode = 1","rules":[{"t":"set","p":"lightmode","pt":"flow","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":2540,"y":4420,"wires":[["0b9eb9314e120667"]]},{"id":"e38ef465578cfb56","type":"change","z":"7a1172b433a6cf9c","name":"set flow light mode = 0","rules":[{"t":"set","p":"lightmode","pt":"flow","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":2960,"y":4420,"wires":[[]]},{"id":"0b9eb9314e120667","type":"trigger","z":"7a1172b433a6cf9c","name":"","op1":"","op2":"0","op1type":"nul","op2type":"str","duration":"10","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2750,"y":4420,"wires":[["e38ef465578cfb56"]]},{"id":"6872a6693a2b074b","type":"switch","z":"7a1172b433a6cf9c","name":"Light mode off?","property":"lightmode","propertyType":"flow","rules":[{"t":"neq","v":"1","vt":"num"},{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":2100,"y":4380,"wires":[["e2b164490e261b2e"],["a859c56203270a9a"]]},{"id":"9e7d966a7e6debef","type":"api-call-service","z":"7a1172b433a6cf9c","name":"Max white brightness","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"{\"brightness_pct\": 100,\"color_name\": \"white\"}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3300,"y":4600,"wires":[[]]},{"id":"a5c7ec68c2d2d008","type":"comment","z":"7a1172b433a6cf9c","name":"These nodes set a flow variable \"lightmode\" to \"1\" for 10 seconds before setting it to \"0\"","info":"","x":2760,"y":4380,"wires":[]},{"id":"8937ccab710536ab","type":"comment","z":"7a1172b433a6cf9c","name":"Check if lightmode is on","info":"","x":2100,"y":4340,"wires":[]},{"id":"428acc7d03d3dd65","type":"switch","z":"7a1172b433a6cf9c","name":"Action not empty","property":"action","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1870,"y":4380,"wires":[["6872a6693a2b074b"]]},{"id":"d783423184d93224","type":"switch","z":"7a1172b433a6cf9c","name":"Muted?","property":"entity.attributes.is_volume_muted","propertyType":"msg","rules":[{"t":"cont","v":"false","vt":"str"},{"t":"cont","v":"true","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1360,"y":4380,"wires":[["0f1734c3bbff9470"],["8cf03937998b2895"]]},{"id":"fef3b8cf92956479","type":"api-current-state","z":"7a1172b433a6cf9c","name":"chromecast","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is_not","entity_id":"media_player.livingroom_chromecast","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"entity","propertyType":"msg","value":"","valueType":"entity"},{"property":"payload.data.entity_id","propertyType":"msg","value":"","valueType":"triggerId"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":1630,"y":4520,"wires":[["428acc7d03d3dd65"],["e87ed38d9ebaa6cc"]]},{"id":"1ece3038ad97e5f6","type":"comment","z":"7a1172b433a6cf9c","name":"Yes","info":"","x":1470,"y":4440,"wires":[]},{"id":"ac4a7cdc25cb4b4a","type":"comment","z":"7a1172b433a6cf9c","name":"No","info":"","x":1630,"y":4360,"wires":[]},{"id":"641aef37732a6c22","type":"comment","z":"7a1172b433a6cf9c","name":"Is entity muted?","info":"","x":1360,"y":4340,"wires":[]},{"id":"dcab6e7310fd3059","type":"comment","z":"7a1172b433a6cf9c","name":"Check that action is not empty","info":"","x":1860,"y":4340,"wires":[]},{"id":"6f99785e127ca33f","type":"mqtt in","z":"7a1172b433a6cf9c","name":"","topic":"zigbee2mqtt/remote_living_room_dial","qos":"2","datatype":"json","broker":"21000c19b97da572","nl":false,"rap":true,"rh":0,"inputs":0,"x":350,"y":4320,"wires":[[]]},{"id":"3d2ca1b978c9708f","type":"debug","z":"7a1172b433a6cf9c","name":"debug 36","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":680,"y":4320,"wires":[]},{"id":"20fde9b3b099504a","type":"ha-get-entities","z":"7a1172b433a6cf9c","name":"","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"","logic":"is","value":"","valueType":"str"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":3750,"y":4440,"wires":[["87a3ee2ba3e8fbfb","bee1dfe38c23fd56"]]},{"id":"56da2ad19f2d7553","type":"function","z":"7a1172b433a6cf9c","name":"Extract room from motion sensor entity an extract off lights to regex","func":"var group_light_entity_id = msg.payload.data.entity_id; // light group\nvar group_light_entity_id = group_light_entity_id.split(\".\");// split on the dot to separate domain and entity\n//var group_entity_split = group_light_entity_id[1].split(\"group\");\nvar room = group_light_entity_id[1].replace(\"_lights\", \"\").replace(\"group_\", \"\");\n\n\nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': \"light.\" + room ,  'valueType': 're' },{ 'property': 'state' ,  'logic': 'is' , 'value': \"on\" ,  'valueType': 'str' }];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object}\n\n}\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3360,"y":4440,"wires":[["8b7deb25d768bb0a","20fde9b3b099504a"]]},{"id":"87a3ee2ba3e8fbfb","type":"debug","z":"7a1172b433a6cf9c","name":"debug 42","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":3960,"y":4340,"wires":[]},{"id":"bee1dfe38c23fd56","type":"switch","z":"7a1172b433a6cf9c","name":"Brightness?","property":"payload.attributes.brightness","propertyType":"msg","rules":[{"t":"lt","v":"253","vt":"str"},{"t":"eq","v":"255","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":4030,"y":4440,"wires":[["e439522dd00400ad"],["e2bfd25dc1c34544","6d54c155140e3eb5","b087761a68d2859e"]]},{"id":"e439522dd00400ad","type":"change","z":"7a1172b433a6cf9c","name":"set entity","rules":[{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"payload.entity_id","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":4260,"y":4440,"wires":[["9a3a452ee5221a27"]]},{"id":"c9f8d661a1d1052f","type":"comment","z":"7a1172b433a6cf9c","name":"Check Brightness","info":"","x":4040,"y":4400,"wires":[]},{"id":"7e642fdc00e261b7","type":"comment","z":"7a1172b433a6cf9c","name":"Set entity id","info":"","x":4230,"y":4400,"wires":[]},{"id":"9da7d9447a4de731","type":"api-call-service","z":"7a1172b433a6cf9c","name":"Add white","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4640,"y":4560,"wires":[[]]},{"id":"e2bfd25dc1c34544","type":"debug","z":"7a1172b433a6cf9c","name":"debug 43","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":4300,"y":4300,"wires":[]},{"id":"6d54c155140e3eb5","type":"function","z":"7a1172b433a6cf9c","name":"White addist","func":"var saturation = msg.payload.attributes.hs_color[1];\nif(saturation > 10){\nvar saturationlesser = saturation - 10;\n} else {\nvar saturationlesser = saturation;}\nvar color = msg.payload.attributes.hs_color[0];\nvar entity_id = msg.payload.entity_id;\n\n\n\n\nvar newMsg = {\n    \"payload\": {\n            \"data\": {\n            \"hs_color\": [color, saturationlesser],\n            \"entity_id\": entity_id\n            }\n            }\n            \n   }\n\nreturn newMsg;\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4210,"y":4540,"wires":[["6dd0142d4e11fd9e","9da7d9447a4de731","c7273520c7ed4b55"]]},{"id":"6dd0142d4e11fd9e","type":"debug","z":"7a1172b433a6cf9c","name":"debug 44","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":4371.12109375,"y":4510.63525390625,"wires":[]},{"id":"28ee81aa6e194015","type":"debug","z":"7a1172b433a6cf9c","name":"debug 46","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":3220,"y":4480,"wires":[]},{"id":"8b7deb25d768bb0a","type":"debug","z":"7a1172b433a6cf9c","name":"debug 47","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":3660,"y":4500,"wires":[]},{"id":"b087761a68d2859e","type":"debug","z":"7a1172b433a6cf9c","name":"debug 48","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":4280,"y":4480,"wires":[]},{"id":"21b22586e46ec9d7","type":"debug","z":"7a1172b433a6cf9c","name":"debug 49","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":3920,"y":4540,"wires":[]},{"id":"c7273520c7ed4b55","type":"debug","z":"7a1172b433a6cf9c","name":"debug 50","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":4560,"y":4520,"wires":[]},{"id":"99ef751030301e5e","type":"function","z":"7a1172b433a6cf9c","name":"Extract room from motion sensor entity an extract off lights to regex","func":"var room = msg.room;\n\n\nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': \"light.\" + room ,  'valueType': 're' }];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object}\n\n}\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3680,"y":3960,"wires":[["a00d3240a57bce0e","2ec6016dcddffcc8"]]},{"id":"4fd69cee7ca815c9","type":"switch","z":"7a1172b433a6cf9c","name":"","property":"action","propertyType":"msg","rules":[{"t":"eq","v":"rotate_right","vt":"str"},{"t":"eq","v":"rotate_left","vt":"str"},{"t":"eq","v":"play_pause","vt":"str"},{"t":"eq","v":"skip_forward","vt":"str"},{"t":"eq","v":"skip_backward","vt":"str"}],"checkall":"true","repair":false,"outputs":5,"x":3350,"y":3920,"wires":[["99ef751030301e5e"],["e5c144932b410154"],["44472cf06b71affa"],["ef3f26f835c60c72"],[]]},{"id":"a00d3240a57bce0e","type":"debug","z":"7a1172b433a6cf9c","name":"debug 80","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":4080,"y":4000,"wires":[]},{"id":"2ec6016dcddffcc8","type":"ha-get-entities","z":"7a1172b433a6cf9c","name":"","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"","logic":"is","value":"","valueType":"str"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":4090,"y":3940,"wires":[["b6ace7b2390e8327","a89a48d9a9d6b78f"]]},{"id":"90ae91677229d8f3","type":"change","z":"7a1172b433a6cf9c","name":"set entity data","rules":[{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"payload.entity_id","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":3200,"y":3920,"wires":[["4fd69cee7ca815c9"]]},{"id":"e5c144932b410154","type":"api-call-service","z":"7a1172b433a6cf9c","name":"Dim light","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"{\"brightness_step_pct\": -10}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3500,"y":4000,"wires":[[]]},{"id":"44472cf06b71affa","type":"api-call-service","z":"7a1172b433a6cf9c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"toggle","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3520,"y":4040,"wires":[[]]},{"id":"ef3f26f835c60c72","type":"api-call-service","z":"7a1172b433a6cf9c","name":"Max white brightness","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"{\"brightness_pct\": 100,\"color_name\": \"white\"}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3540,"y":4080,"wires":[[]]},{"id":"b6ace7b2390e8327","type":"trigger","z":"7a1172b433a6cf9c","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"600","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"topic","topic":"payload.entity_id","outputs":1,"x":4320,"y":3960,"wires":[["1ce03b0a16ac1fdf"]]},{"id":"a89a48d9a9d6b78f","type":"debug","z":"7a1172b433a6cf9c","name":"debug 81","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":4320,"y":4000,"wires":[]},{"id":"7bece14ffc4d554d","type":"split","z":"7a1172b433a6cf9c","name":"Split entities","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":3010,"y":3920,"wires":[["90ae91677229d8f3"]]},{"id":"1ce03b0a16ac1fdf","type":"switch","z":"7a1172b433a6cf9c","name":"Brightness?","property":"payload.attributes.brightness","propertyType":"msg","rules":[{"t":"lt","v":"250","vt":"str"},{"t":"gte","v":"250","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":4510,"y":3960,"wires":[["f75dbebb42d6046b"],["d1069d6431a49b4f","999b595104d92ca8"]]},{"id":"fd8bf60240ecde0e","type":"ha-get-entities","z":"7a1172b433a6cf9c","name":"","server":"7ab5c227.a3ce8c","version":0,"rules":[],"output_type":"array","output_empty_results":true,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":2830,"y":3920,"wires":[["44e9b66f9cff85b7","7bece14ffc4d554d"]]},{"id":"f75dbebb42d6046b","type":"change","z":"7a1172b433a6cf9c","name":"set entity","rules":[{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"payload.entity_id","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":4680,"y":3960,"wires":[["0f82462d9817eedd"]]},{"id":"d1069d6431a49b4f","type":"debug","z":"7a1172b433a6cf9c","name":"debug 82","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":4680,"y":4000,"wires":[]},{"id":"999b595104d92ca8","type":"function","z":"7a1172b433a6cf9c","name":"White addist","func":"// Declare variation\nvar saturation = msg.payload.attributes.hs_color[1];\nvar colorfinal = msg.payload.attributes.hs_color[0];\nvar entity_id = msg.payload.entity_id;\n\n// If saturation is over 10\nif(saturation > 10){\nvar saturationlesser = saturation - 10;\n} else if(saturation < 10){// If saturation is under 10\nvar saturationlesser = 0;\nvar colorfinal = 0;\n}\n else {\nvar saturationlesser = saturation;}\n\n\n\n\n\n\nvar newMsg = {\n    \"payload\": {\n            \"data\": {\n            \"hs_color\": [colorfinal, saturationlesser],\n            \"entity_id\": entity_id\n            }\n            }\n            \n   }\n\nreturn newMsg;\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":4690,"y":4040,"wires":[["166bac47113f52fe","6aacae0a858d760a"]]},{"id":"712820f86afd0fd0","type":"function","z":"7a1172b433a6cf9c","name":"Extract room from dial mqtt name and set regex to find light groups","func":"\nvar room = msg.room;\nvar action = msg.action\n\nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': \"light.group_\" + room + \"_lights\" ,  'valueType': 're' }];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object},\n     \"action\": action,\n     \"room\": room\n\n}\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2480,"y":3920,"wires":[["fd8bf60240ecde0e"]]},{"id":"44e9b66f9cff85b7","type":"debug","z":"7a1172b433a6cf9c","name":"debug 83","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3000,"y":4140,"wires":[]},{"id":"0f82462d9817eedd","type":"api-call-service","z":"7a1172b433a6cf9c","name":"Brightnen light","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"{\"brightness_step_pct\": 10}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4920,"y":3960,"wires":[[]]},{"id":"166bac47113f52fe","type":"debug","z":"7a1172b433a6cf9c","name":"debug 84","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":4900,"y":4000,"wires":[]},{"id":"6aacae0a858d760a","type":"api-call-service","z":"7a1172b433a6cf9c","name":"Add white","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4900,"y":4040,"wires":[[]]},{"id":"5f9e6232beb084a5","type":"switch","z":"7a1172b433a6cf9c","name":"","property":"action","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":2170,"y":3920,"wires":[["712820f86afd0fd0"]]},{"id":"50d2465a2959808d","type":"trigger","z":"7a1172b433a6cf9c","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"100","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1980,"y":3920,"wires":[["5f9e6232beb084a5"]]},{"id":"a1fe56985ac99c02","type":"switch","z":"7a1172b433a6cf9c","name":"Light mode off?","property":"lightmode","propertyType":"flow","rules":[{"t":"neq","v":"1","vt":"num"},{"t":"null"},{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":3,"x":1740,"y":3820,"wires":[["82c6c7d0bf3c6b93"],["82c6c7d0bf3c6b93"],["50d2465a2959808d"]]},{"id":"a4ebfd74a7cb0bc6","type":"change","z":"7a1172b433a6cf9c","name":"set entity data","rules":[{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"payload.entity_id","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":1560,"y":3820,"wires":[["a1fe56985ac99c02"]]},{"id":"fb95e05dcaa04885","type":"switch","z":"7a1172b433a6cf9c","name":"","property":"payload","propertyType":"msg","rules":[{"t":"nempty"},{"t":"empty"}],"checkall":"true","repair":false,"outputs":2,"x":1190,"y":3880,"wires":[["f29c2705dcfaf7f1"],["32e9a8f85df1ac27"]]},{"id":"f29c2705dcfaf7f1","type":"split","z":"7a1172b433a6cf9c","name":"Split entities","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":1370,"y":3820,"wires":[["2c17169f3df3fcf9","a4ebfd74a7cb0bc6"]]},{"id":"9edf5b12d774a90a","type":"switch","z":"7a1172b433a6cf9c","name":"","property":"action","propertyType":"msg","rules":[{"t":"eq","v":"rotate_right","vt":"str"},{"t":"eq","v":"play_pause","vt":"str"},{"t":"eq","v":"rotate_left","vt":"str"},{"t":"eq","v":"skip_forward","vt":"str"},{"t":"eq","v":"skip_backward","vt":"str"}],"checkall":"false","repair":false,"outputs":5,"x":1990,"y":3820,"wires":[["57d5b5676d0a169a"],["40638ed96311518d"],["30ab8abf14a3151f"],["ab66b56ce8f27d7e"],["8024aa7d77a04f07"]]},{"id":"d54ea33b41bb5d58","type":"ha-get-entities","z":"7a1172b433a6cf9c","name":"","server":"7ab5c227.a3ce8c","version":0,"rules":[],"output_type":"array","output_empty_results":true,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":1030,"y":3880,"wires":[["fb95e05dcaa04885"]]},{"id":"c37acc4b6b0cfe67","type":"switch","z":"7a1172b433a6cf9c","name":"","property":"payload","propertyType":"msg","rules":[{"t":"nempty"},{"t":"empty"}],"checkall":"true","repair":false,"outputs":2,"x":1170,"y":3820,"wires":[["f29c2705dcfaf7f1"],["289110c689ce91ad"]]},{"id":"2c17169f3df3fcf9","type":"debug","z":"7a1172b433a6cf9c","name":"debug 85","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1560,"y":3600,"wires":[]},{"id":"57d5b5676d0a169a","type":"api-call-service","z":"7a1172b433a6cf9c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_up","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2250,"y":3700,"wires":[[]]},{"id":"40638ed96311518d","type":"api-call-service","z":"7a1172b433a6cf9c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"media_play_pause","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2270,"y":3740,"wires":[[]]},{"id":"30ab8abf14a3151f","type":"api-call-service","z":"7a1172b433a6cf9c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_down","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2250,"y":3780,"wires":[[]]},{"id":"ab66b56ce8f27d7e","type":"api-call-service","z":"7a1172b433a6cf9c","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"media_next_track","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2270,"y":3820,"wires":[[]]},{"id":"8024aa7d77a04f07","type":"change","z":"7a1172b433a6cf9c","name":"set flow light mode = 1","rules":[{"t":"set","p":"lightmode","pt":"flow","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":2220,"y":3860,"wires":[["3c06803d92849ce8"]]},{"id":"289110c689ce91ad","type":"function","z":"7a1172b433a6cf9c","name":"Extract room from dial mqtt name and set regex to find speaker playing","func":"\nvar room = msg.room\nvar action = msg.action\n\nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': \"media_player.\" + room + \".*_speaker\" ,  'valueType': 're' },{ 'property': 'state' ,  'logic': 'is' , 'value': \"playing\" ,  'valueType': 'str' }];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object},\n     \"action\": action,\n     \"room\": room\n\n}\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":650,"y":3880,"wires":[["d54ea33b41bb5d58"]]},{"id":"2d5babb206adb8c2","type":"ha-get-entities","z":"7a1172b433a6cf9c","name":"","server":"7ab5c227.a3ce8c","version":0,"rules":[],"output_type":"array","output_empty_results":true,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":1030,"y":3820,"wires":[["c37acc4b6b0cfe67"]]},{"id":"3c06803d92849ce8","type":"trigger","z":"7a1172b433a6cf9c","name":"","op1":"","op2":"0","op1type":"nul","op2type":"str","duration":"10","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2430,"y":3860,"wires":[["2224bc11cb3e6dbe"]]},{"id":"0820e91d30443bbf","type":"function","z":"7a1172b433a6cf9c","name":"Extract room from dial mqtt name and set regex to find chromecast playing","func":"var group_light_entity_id = msg.payload.device.friendlyName; // light group\nvar room = group_light_entity_id.replace(\"remote_\", \"\").replace(\"_dial\", \"\");\nvar action = msg.payload.action\n\nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': \"media_player.\" + room + \"_chromecast\" ,  'valueType': 're' },{ 'property': 'state' ,  'logic': 'is' , 'value': \"playing\" ,  'valueType': 'str' }];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object},\n     \"action\": action,\n     \"room\": room\n\n}\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":660,"y":3820,"wires":[["2d5babb206adb8c2"]]},{"id":"2224bc11cb3e6dbe","type":"change","z":"7a1172b433a6cf9c","name":"set flow light mode = 0","rules":[{"t":"set","p":"lightmode","pt":"flow","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":2640,"y":3860,"wires":[[]]},{"id":"eeb00c804a86bf1f","type":"change","z":"7a1172b433a6cf9c","name":"Move action","rules":[{"t":"set","p":"action","pt":"msg","to":"payload.action","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":450,"y":3440,"wires":[[]]},{"id":"87b6e543dfa9ccf3","type":"subflow:61f53235c712b2c2","z":"7a1172b433a6cf9c","name":"","x":510,"y":4020,"wires":[]},{"id":"c0843573bc3e1929","type":"server-state-changed","z":"ad8c570ec4ac394a","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.party_mode","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":260,"y":80,"wires":[["8c6136816c372915"],[]]},{"id":"8c6136816c372915","type":"trigger","z":"ad8c570ec4ac394a","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"15","extend":false,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":590,"y":80,"wires":[["02f7295b44608fe0"]]},{"id":"02f7295b44608fe0","type":"ha-get-entities","z":"ad8c570ec4ac394a","name":"Get ChromecastMedia players","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"entity_id","logic":"is","value":"media_player\\.(?!plex).*_chromecast","valueType":"re"},{"property":"state","logic":"is","value":"off","valueType":"str"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":910,"y":80,"wires":[["7b0bd74d9726336c"]]},{"id":"7b0bd74d9726336c","type":"delay","z":"ad8c570ec4ac394a","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"8","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1160,"y":80,"wires":[["1274d6c20ffd5f60"]]},{"id":"1274d6c20ffd5f60","type":"change","z":"ad8c570ec4ac394a","name":"","rules":[{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"payload.entity_id","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":1410,"y":80,"wires":[["36f9f8deb6267ebb"]]},{"id":"36f9f8deb6267ebb","type":"api-call-service","z":"ad8c570ec4ac394a","name":"play visuals","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"play_media","areaId":[],"deviceId":[],"entityId":[],"data":"{\"media_content_id\":\"plex://{ \\\"playlist_name\\\": \\\"All visuals\\\", \\\"shuffle\\\": 1 }\",\"media_content_type\":\"playlist\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1650,"y":80,"wires":[["002b81243c26acf0"]]},{"id":"002b81243c26acf0","type":"api-call-service","z":"ad8c570ec4ac394a","name":"Set volume to 0.1","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_set","areaId":[],"deviceId":[],"entityId":[],"data":"{\"volume_level\":\"0.1\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1850,"y":80,"wires":[["81a6bbceafeac20c"]]},{"id":"81a6bbceafeac20c","type":"api-call-service","z":"ad8c570ec4ac394a","name":"Mute Volume","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_mute","areaId":[],"deviceId":[],"entityId":[],"data":"{\"is_volume_muted\": \"true\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2050,"y":80,"wires":[[]]},{"id":"2f1afe0e5a874c4c","type":"comment","z":"ad8c570ec4ac394a","name":"Play soft visuals when party mode is triggered","info":"","x":270,"y":40,"wires":[]},{"id":"96b1cb45b06ea375","type":"comment","z":"ad8c570ec4ac394a","name":"15 minutes cooldown","info":"","x":580,"y":40,"wires":[]},{"id":"5ef1e991bb7d875a","type":"comment","z":"ad8c570ec4ac394a","name":"Pull all inactive Chromecasts entities","info":"","x":900,"y":40,"wires":[]},{"id":"ab53133d21bcf288","type":"comment","z":"ad8c570ec4ac394a","name":"rate limit at 1 per 8s","info":"","x":1150,"y":40,"wires":[]},{"id":"f6ec08d3069cc757","type":"comment","z":"ad8c570ec4ac394a","name":"Extract the entity id","info":"","x":1410,"y":40,"wires":[]},{"id":"a9f03579f152484b","type":"comment","z":"ad8c570ec4ac394a","name":"Start the visuals playlist","info":"","x":1640,"y":40,"wires":[]},{"id":"baac9591853a5457","type":"comment","z":"ad8c570ec4ac394a","name":"Set volume to 0.1","info":"","x":1860,"y":40,"wires":[]},{"id":"bae3917b891c9b90","type":"comment","z":"ad8c570ec4ac394a","name":"(bug mitigation)","info":"The Google chromecasts don't always give the right volume, this forces an update","x":1860,"y":120,"wires":[]},{"id":"7ff5b1c7a5f56df7","type":"comment","z":"ad8c570ec4ac394a","name":"Mute the Tv","info":"","x":2050,"y":40,"wires":[]},{"id":"6068ed8a2d16572e","type":"trigger","z":"ad8c570ec4ac394a","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"15","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":590,"y":1240,"wires":[["5f1ff2606221f3da"]]},{"id":"5f1ff2606221f3da","type":"ha-get-entities","z":"ad8c570ec4ac394a","name":"Get ChromecastMedia players","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"entity_id","logic":"is","value":"media_player\\.(?!plex).*_chromecast","valueType":"re"},{"property":"state","logic":"is","value":"off","valueType":"str"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":910,"y":1240,"wires":[["11b8508e77092b82"]]},{"id":"11b8508e77092b82","type":"delay","z":"ad8c570ec4ac394a","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"8","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1160,"y":1240,"wires":[["7b39877584962e4a"]]},{"id":"7b39877584962e4a","type":"change","z":"ad8c570ec4ac394a","name":"","rules":[{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"payload.entity_id","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":1410,"y":1240,"wires":[["a5c306f57feb5805"]]},{"id":"a5c306f57feb5805","type":"api-call-service","z":"ad8c570ec4ac394a","name":"play visuals","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"play_media","areaId":[],"deviceId":[],"entityId":[],"data":"{\"media_content_id\":\"plex://{ \\\"playlist_name\\\": \\\"All visuals\\\", \\\"shuffle\\\": 1 }\",\"media_content_type\":\"playlist\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1650,"y":1240,"wires":[["12fb54a46d00a846"]]},{"id":"12fb54a46d00a846","type":"api-call-service","z":"ad8c570ec4ac394a","name":"Set volume to 0.1","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_set","areaId":[],"deviceId":[],"entityId":[],"data":"{\"volume_level\":\"0.1\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1850,"y":1240,"wires":[["398f48e21a51b004"]]},{"id":"398f48e21a51b004","type":"api-call-service","z":"ad8c570ec4ac394a","name":"Mute Volume","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_mute","areaId":[],"deviceId":[],"entityId":[],"data":"{\"is_volume_muted\": \"true\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2050,"y":1240,"wires":[[]]},{"id":"3586d6b055cb9233","type":"comment","z":"ad8c570ec4ac394a","name":"15 seconds cooldown","info":"","x":580,"y":1200,"wires":[]},{"id":"fb7caec077a03aff","type":"comment","z":"ad8c570ec4ac394a","name":"Pull all inactive Chromecasts entities","info":"","x":900,"y":1200,"wires":[]},{"id":"ad9b491d1b77c5fa","type":"comment","z":"ad8c570ec4ac394a","name":"rate limit at 1 per 8s","info":"","x":1150,"y":1200,"wires":[]},{"id":"44479e23cca77b31","type":"comment","z":"ad8c570ec4ac394a","name":"Extract the entity id","info":"","x":1410,"y":1200,"wires":[]},{"id":"96aaa4ef19a0bee5","type":"comment","z":"ad8c570ec4ac394a","name":"Start the visuals playlist","info":"","x":1640,"y":1200,"wires":[]},{"id":"fa094f1bbbe3a0c1","type":"comment","z":"ad8c570ec4ac394a","name":"Set volume to 0.1","info":"","x":1860,"y":1200,"wires":[]},{"id":"a2874602f41eaf53","type":"comment","z":"ad8c570ec4ac394a","name":"(bug mitigation)","info":"The Google chromecasts don't always give the right volume, this forces an update","x":1860,"y":1280,"wires":[]},{"id":"34ce572432324952","type":"comment","z":"ad8c570ec4ac394a","name":"Mute the Tv","info":"","x":2050,"y":1200,"wires":[]},{"id":"a86e575a7e0d41c5","type":"server-state-changed","z":"ad8c570ec4ac394a","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.acid_time","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":260,"y":1240,"wires":[["6068ed8a2d16572e"],[]]},{"id":"6a1551121912b3c7","type":"comment","z":"ad8c570ec4ac394a","name":"Play trippy visuals when acid mode is triggered","info":"","x":260,"y":1200,"wires":[]},{"id":"917277eef2953310","type":"trigger","z":"ad8c570ec4ac394a","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"15","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":590,"y":220,"wires":[["89d0d1d918564386"]]},{"id":"22ffd9edca8397c0","type":"comment","z":"ad8c570ec4ac394a","name":"15 seconds cooldown","info":"","x":580,"y":180,"wires":[]},{"id":"89d0d1d918564386","type":"ha-get-entities","z":"ad8c570ec4ac394a","name":"Get  Light groups","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"entity_id","logic":"is","value":"light\\.(?!.*?all.*?)(?!.*?door.*?).*?_lights$","valueType":"re"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":810,"y":220,"wires":[["eadbb9bbbd90b04e"]]},{"id":"3feed2b2c6fdac36","type":"comment","z":"ad8c570ec4ac394a","name":"Pull all light groups","info":"","x":810,"y":180,"wires":[]},{"id":"4daa01cac8181277","type":"server-state-changed","z":"ad8c570ec4ac394a","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.kink_party","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":260,"y":1500,"wires":[["a4034e3426b2b90d"],[]]},{"id":"73896dfa4fb8d996","type":"server-state-changed","z":"ad8c570ec4ac394a","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.party_mode","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":260,"y":220,"wires":[["917277eef2953310"],[]]},{"id":"73ceade6131f58c4","type":"comment","z":"ad8c570ec4ac394a","name":"Change light groups to random colors on party mode","info":"","x":270,"y":180,"wires":[]},{"id":"eadbb9bbbd90b04e","type":"switch","z":"ad8c570ec4ac394a","name":"","property":"payload.attributes.supported_color_modes","propertyType":"msg","rules":[{"t":"regex","v":"(xy|hs)","vt":"str","case":false}],"checkall":"true","repair":false,"outputs":1,"x":1030,"y":220,"wires":[["295a50d373ea7d0b"]]},{"id":"9cf9611c81347b2e","type":"comment","z":"ad8c570ec4ac394a","name":"Check for color support","info":"","x":1020,"y":180,"wires":[]},{"id":"295a50d373ea7d0b","type":"function","z":"ad8c570ec4ac394a","name":"Generate Random saturated color","func":"var entity_id = msg.payload.entity_id;\n\n\nvar hue = Math.floor(Math.random() * 360); //generate a random number up to 360\n\nvar hs_color = hue + \",60\";\nvar hs_color_array = hs_color.split(\",\");\nvar newMsg = {\n    \"payload\": {\n        \"data\": {\n            \"hs_color\": hs_color_array,\n            \"entity_id\": entity_id,\n            \"brightness_pct\": 100\n            \n}\n        }\n    }\n;\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1300,"y":220,"wires":[["c0e0e1dede43580b"]]},{"id":"c0e0e1dede43580b","type":"api-call-service","z":"ad8c570ec4ac394a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1590,"y":220,"wires":[[]]},{"id":"920b0688b303f501","type":"comment","z":"ad8c570ec4ac394a","name":"Generated random HS 60% saturated color","info":"","x":1300,"y":180,"wires":[]},{"id":"9e48d08f2620c2fb","type":"comment","z":"ad8c570ec4ac394a","name":"also sets the entity_id","info":"","x":1280,"y":260,"wires":[]},{"id":"e0608cb33087d9bd","type":"comment","z":"ad8c570ec4ac394a","name":"Call light_on service","info":"","x":1590,"y":180,"wires":[]},{"id":"837d97adee6c9078","type":"trigger","z":"ad8c570ec4ac394a","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"15","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":590,"y":620,"wires":[["739f28daa568c871"]]},{"id":"6c3c41c2885cb18e","type":"comment","z":"ad8c570ec4ac394a","name":"15 seconds cooldown","info":"","x":580,"y":580,"wires":[]},{"id":"739f28daa568c871","type":"ha-get-entities","z":"ad8c570ec4ac394a","name":"Get  Light entities","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"entity_id","logic":"is","value":"light\\.(?!.*?group.*?)(?!.*?k95_rgb_2_led.*?)(?!.*?door.*?).*?_(?!.*?lights.*?).*","valueType":"re"},{"property":"state","logic":"is","value":"on","valueType":"str"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":830,"y":620,"wires":[["ae64cb72a1c38399"]]},{"id":"cc2adca2c4baf2d5","type":"comment","z":"ad8c570ec4ac394a","name":"Try to Pull all lit single lights","info":"","x":820,"y":580,"wires":[]},{"id":"5e9bf472a7d3c895","type":"server-state-changed","z":"ad8c570ec4ac394a","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.acid_time","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":260,"y":620,"wires":[["837d97adee6c9078"],[]]},{"id":"760cb0b08e7989ae","type":"comment","z":"ad8c570ec4ac394a","name":"Change light to random colors on acid mode","info":"","x":270,"y":580,"wires":[]},{"id":"ae64cb72a1c38399","type":"switch","z":"ad8c570ec4ac394a","name":"","property":"payload.attributes.supported_color_modes","propertyType":"msg","rules":[{"t":"regex","v":"(xy|hs)","vt":"str","case":false}],"checkall":"true","repair":false,"outputs":1,"x":1070,"y":620,"wires":[["2f13453376465f8b"]]},{"id":"7941ec1c14bdf74c","type":"comment","z":"ad8c570ec4ac394a","name":"Check for color support","info":"","x":1060,"y":580,"wires":[]},{"id":"4785df9fde6fcd4d","type":"function","z":"ad8c570ec4ac394a","name":"Generate Random saturated color","func":"var entity_id = msg.payload.entity_id;\n\n\nvar hue = Math.floor(Math.random() * 360); //generate a random number up to 360\n\nvar hs_color = hue + \",100\";\nvar hs_color_array = hs_color.split(\",\");\nvar newMsg = {\n    \"payload\": {\n        \"data\": {\n            \"hs_color\": hs_color_array,\n            \"entity_id\": entity_id,\n            \"brightness_pct\": 100\n            \n}\n        }\n    }\n;\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1600,"y":620,"wires":[["f42aed7de4812f9d"]]},{"id":"f42aed7de4812f9d","type":"api-call-service","z":"ad8c570ec4ac394a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1890,"y":620,"wires":[[]]},{"id":"5112ea4aa4f5c26d","type":"comment","z":"ad8c570ec4ac394a","name":"Generated random HS 100% saturated color","info":"","x":1610,"y":580,"wires":[]},{"id":"a74bc1ffd3fdd8f9","type":"comment","z":"ad8c570ec4ac394a","name":"Call light_on service","info":"","x":1890,"y":580,"wires":[]},{"id":"0070875ba8af1c52","type":"switch","z":"ad8c570ec4ac394a","name":"","property":"payload.attributes.supported_color_modes","propertyType":"msg","rules":[{"t":"regex","v":"(xy|hs)","vt":"str","case":false}],"checkall":"true","repair":false,"outputs":1,"x":1070,"y":1500,"wires":[["84d8286bfbe1661d"]]},{"id":"1fafb1100f03e73c","type":"comment","z":"ad8c570ec4ac394a","name":"Check for color support","info":"","x":1060,"y":1460,"wires":[]},{"id":"84d8286bfbe1661d","type":"function","z":"ad8c570ec4ac394a","name":"Generate semi-random saturated color","func":"var entity_id = msg.payload.entity_id;\nvar hue = 'test';\n\nvar hue_under_20 = Math.floor(Math.random() * 20); //generate a random number up to 20\nvar hue_over_260 = Math.floor(Math.random() * 100) + 260; //generate a random number up to 360\nvar random_selector = Math.floor(Math.random() * 2); //generate a random number up to 2 ( 0 index)\n\nswitch(random_selector) {\n  case 0:\n    var hue = hue_under_20;\n    break;\n  case 1:\n    var hue = hue_over_260;\n    // code block\n    break;\n  case 2:\n    var hue = hue_over_260;\n    // code block\n  default:\n}\n\nvar hs_color = hue + \",100\";\nvar hs_color_array = hs_color.split(\",\");\nvar newMsg = {\n    \"payload\": {\n        \"data\": {\n            \"hs_color\": hs_color_array,\n            \"entity_id\": entity_id,\n            \"brightness_pct\": 100\n            \n}\n        }\n    }\n;\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1410,"y":1500,"wires":[["ce569981d15e01f9"]]},{"id":"ce569981d15e01f9","type":"api-call-service","z":"ad8c570ec4ac394a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1750,"y":1500,"wires":[[]]},{"id":"8c788bb16d44c998","type":"comment","z":"ad8c570ec4ac394a","name":"Generated HS 100% saturated color between orange and purple","info":"","x":1410,"y":1460,"wires":[]},{"id":"82b870106ace9712","type":"comment","z":"ad8c570ec4ac394a","name":"Call light_on service","info":"","x":1750,"y":1460,"wires":[]},{"id":"a4034e3426b2b90d","type":"trigger","z":"ad8c570ec4ac394a","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"15","extend":false,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":590,"y":1500,"wires":[["57f236eb64968c51"]]},{"id":"57f236eb64968c51","type":"ha-get-entities","z":"ad8c570ec4ac394a","name":"Get  Light groups","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"entity_id","logic":"is","value":"light\\.(?!.*?all.*?)(?!.*?door.*?).*?_lights$","valueType":"re"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":850,"y":1500,"wires":[["0070875ba8af1c52"]]},{"id":"266772944b486c06","type":"comment","z":"ad8c570ec4ac394a","name":"Pull all light groups","info":"","x":850,"y":1460,"wires":[]},{"id":"0a48ce10e522d2be","type":"comment","z":"ad8c570ec4ac394a","name":"also sets the entity_id","info":"","x":1600,"y":660,"wires":[]},{"id":"d904d25bb9c212a0","type":"comment","z":"ad8c570ec4ac394a","name":"also sets the entity_id","info":"","x":1420,"y":1540,"wires":[]},{"id":"9e0d2a87c4862562","type":"comment","z":"ad8c570ec4ac394a","name":"15 minutes cooldown","info":"","x":580,"y":1460,"wires":[]},{"id":"d610007ced8096fb","type":"comment","z":"ad8c570ec4ac394a","name":"Change light to warmn colors on kink mode","info":"","x":260,"y":1460,"wires":[]},{"id":"1ed233c0367b3522","type":"random","z":"ad8c570ec4ac394a","name":"","low":"1","high":"11","inte":"true","property":"number","x":1340,"y":360,"wires":[["50f03fb059f6ea65"]]},{"id":"50f03fb059f6ea65","type":"function","z":"ad8c570ec4ac394a","name":"Playlist Selector","func":"var number = msg.number;\nvar entity_id = msg.payload.entity_id\nif (number == 1) {\n  var playlist = \"Automatic Alternative\";\n} else if (number == 2) {\n  var playlist = \"Automatic Classical\";\n} else if (number == 3) {\n  var playlist = \"Automatic Country\";\n} else if (number == 4) {\n  var playlist = \"Automatic Funk\";\n} else if (number == 5) {\n  var playlist = \"Automatic Pop\";\n} else if (number == 6) {\n  var playlist = \"Automatic Psychedelic\";\n} else if (number == 7) {\n  var playlist = \"Automatic Punk\";\n} else if (number == 8) {\n  var playlist = \"Automatic Quebecois\";\n} else if (number == 9) {\n  var playlist = \"Automatic Reggaeton\";\n} else if (number == 10) {\n  var playlist = \"Automatic Rock\";\n} else if (number == 11) {\n  var playlist = \"Automatic Synthwave\";\n} else {\n    \n}\n\n\nvar newMsg = {\n    \"payload\": { \n        \"data\": {\n              \"media_content_id\": 'plex://{ \"playlist_name\":'+ ' \"' + playlist + '\", \"shuffle\": 1 }',\n              \"media_content_type\": \"playlist\",\n              \"entity_id\": entity_id\n            \n        }\n}\n};\nreturn newMsg;\n\n\n// a switch can be used instead of a unch of else ifs","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1620,"y":360,"wires":[["d751ec94f35faa0d"]]},{"id":"d751ec94f35faa0d","type":"api-call-service","z":"ad8c570ec4ac394a","name":"play music","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"play_media","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1890,"y":360,"wires":[[]]},{"id":"a76efc4ab5b56f29","type":"ha-get-entities","z":"ad8c570ec4ac394a","name":"Get Google cast groups","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"entity_id","logic":"is","value":"media_player\\.group_.*_speakers","valueType":"re"},{"property":"state","logic":"is_not","value":"playing","valueType":"str"},{"property":"entity_id","logic":"is_not","value":"(media_player.group_hotbox_upper_speakers|media_player.group_hotbox_lower_speakers)","valueType":"re"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":830,"y":360,"wires":[["3ba0c3863600c878"]]},{"id":"3ba0c3863600c878","type":"delay","z":"ad8c570ec4ac394a","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"8","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1060,"y":360,"wires":[["1ed233c0367b3522"]]},{"id":"8d85249887f86d9d","type":"server-state-changed","z":"ad8c570ec4ac394a","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.party_mode","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":260,"y":360,"wires":[["3a47a2d796c18ff9"],[]]},{"id":"1aa7f611d51f17cf","type":"comment","z":"ad8c570ec4ac394a","name":"Start music in each room when party mode is on","info":"","x":260,"y":320,"wires":[]},{"id":"9633b560f8bfa29c","type":"comment","z":"ad8c570ec4ac394a","name":"rate limit at 1 per 8s","info":"","x":1050,"y":320,"wires":[]},{"id":"c363de697b9a97da","type":"comment","z":"ad8c570ec4ac394a","name":"Pull all speaker groups","info":"","x":840,"y":320,"wires":[]},{"id":"1bdf3bf4fbbe7434","type":"comment","z":"ad8c570ec4ac394a","name":"Generated number between 1 and 11","info":"","x":1330,"y":320,"wires":[]},{"id":"d75eb19853b4aa27","type":"comment","z":"ad8c570ec4ac394a","name":"Select playlist with number","info":"","x":1610,"y":320,"wires":[]},{"id":"7ded67246d82136e","type":"comment","z":"ad8c570ec4ac394a","name":"Send media_play service","info":"","x":1870,"y":320,"wires":[]},{"id":"9f398a5cb9a82e8d","type":"server-state-changed","z":"ad8c570ec4ac394a","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.acid_time","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":280,"y":1360,"wires":[["f48fe17557cf66de"],[]]},{"id":"9881a9f9ac028d1e","type":"comment","z":"ad8c570ec4ac394a","name":"Start music across the place when acid mode is on","info":"","x":290,"y":1320,"wires":[]},{"id":"f48fe17557cf66de","type":"api-current-state","z":"ad8c570ec4ac394a","name":"Home group","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"playing","halt_if_type":"str","halt_if_compare":"is_not","entity_id":"media_player.group_home_speakers","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"entity","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":650,"y":1360,"wires":[["dcbcfadfd0a359ad"],[]]},{"id":"dcbcfadfd0a359ad","type":"api-call-service","z":"ad8c570ec4ac394a","name":"play music","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"play_media","areaId":[],"deviceId":[],"entityId":["media_player.ytube_music_player"],"data":"{\"media_content_id\":\"RDCLAK5uy_mJl9Qy6PpXvT-JbR4DJbGxG6UqOiWqWSg\",\"media_content_type\":\"playlist\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1070,"y":1360,"wires":[[]]},{"id":"12c5ab640f39ceb6","type":"comment","z":"ad8c570ec4ac394a","name":"Make sure Home Group is not playing","info":"","x":650,"y":1320,"wires":[]},{"id":"dfa27ea023fafd5b","type":"comment","z":"ad8c570ec4ac394a","name":"Send media_play command","info":"","x":1080,"y":1320,"wires":[]},{"id":"3a47a2d796c18ff9","type":"api-current-state","z":"ad8c570ec4ac394a","name":"Home group","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"playing","halt_if_type":"str","halt_if_compare":"is_not","entity_id":"media_player.group_home_speakers","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":570,"y":360,"wires":[["a76efc4ab5b56f29"],[]]},{"id":"471935cb5043caf9","type":"comment","z":"ad8c570ec4ac394a","name":"Make sure the home group is off","info":"","x":590,"y":320,"wires":[]},{"id":"10b869bd689ae010","type":"inject","z":"ad8c570ec4ac394a","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1900,"y":2560,"wires":[["f7a24cb6dbf4c660"]]},{"id":"f7a24cb6dbf4c660","type":"ha-get-entities","z":"ad8c570ec4ac394a","name":"Get active hotbox Media players","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"entity_id","logic":"is","value":"media_player\\.(?!.*?group.*?)(?!.*?top.*?)(?!.*?plex.*?).*hotbox.*","valueType":"re"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":2110,"y":2560,"wires":[["07b3821af4b52692"]]},{"id":"07b3821af4b52692","type":"debug","z":"ad8c570ec4ac394a","name":"debug 5","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2400,"y":2560,"wires":[]},{"id":"fc6bf96773f2d1a4","type":"inject","z":"ad8c570ec4ac394a","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":580,"y":2900,"wires":[["45e38d814857d3fd"]]},{"id":"89fbf9146439bc53","type":"inject","z":"ad8c570ec4ac394a","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":560,"y":260,"wires":[["89d0d1d918564386"]]},{"id":"05eca86f288814a6","type":"inject","z":"ad8c570ec4ac394a","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":940,"y":680,"wires":[["739f28daa568c871"]]},{"id":"2f13453376465f8b","type":"switch","z":"ad8c570ec4ac394a","name":"Exclude groups","property":"payload.attributes.entity_id","propertyType":"msg","rules":[{"t":"null"}],"checkall":"true","repair":false,"outputs":1,"x":1300,"y":620,"wires":[["4785df9fde6fcd4d"]]},{"id":"c681bfada6313045","type":"comment","z":"ad8c570ec4ac394a","name":"Exclude groups","info":"","x":1260,"y":580,"wires":[]},{"id":"67d42729c9dfa729","type":"server-state-changed","z":"ad8c570ec4ac394a","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.acid_time","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":260,"y":1580,"wires":[["43c972f7629d8a1f"],[]]},{"id":"73d18616b2404059","type":"server-state-changed","z":"ad8c570ec4ac394a","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.kink_party","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":260,"y":1660,"wires":[["43c972f7629d8a1f"],[]]},{"id":"bbb1b673486b2a72","type":"comment","z":"ad8c570ec4ac394a","name":"Change light to warmn colors on kink mode","info":"","x":260,"y":1620,"wires":[]},{"id":"43c972f7629d8a1f","type":"ha-get-entities","z":"ad8c570ec4ac394a","name":"Get  Covers","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"entity_id","logic":"is","value":"^cover.*","valueType":"re"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":550,"y":1620,"wires":[["e9a2f694ad617051"]]},{"id":"934327820cd3b9db","type":"api-call-service","z":"ad8c570ec4ac394a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"cover","service":"set_cover_position","areaId":[],"deviceId":[],"entityId":[],"data":"{\"position\": 0 }","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1270,"y":1620,"wires":[[]]},{"id":"e9a2f694ad617051","type":"change","z":"ad8c570ec4ac394a","name":"","rules":[{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"payload.entity_id","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":850,"y":1620,"wires":[["934327820cd3b9db"]]},{"id":"3de0e38b3391fa0f","type":"comment","z":"ad8c570ec4ac394a","name":"Extract the entity id","info":"","x":850,"y":1580,"wires":[]},{"id":"e216d39e85bfde74","type":"trigger","z":"ad8c570ec4ac394a","name":"trigger","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"-27","extend":false,"overrideDelay":true,"units":"s","reset":"off","bytopic":"all","topic":"topic","outputs":1,"x":1270,"y":1860,"wires":[["c35f86c38b307e2a","48ff7c7b01ea4c37"]]},{"id":"60c802a803ab7630","type":"comment","z":"ad8c570ec4ac394a","name":"resend every minute","info":"","x":590,"y":1660,"wires":[]},{"id":"c35f86c38b307e2a","type":"ha-get-entities","z":"ad8c570ec4ac394a","name":"Get  on Light entities","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"entity_id","logic":"is","value":"light\\.(?!.*?group.*?)(?!.*?workstation.*?)(?!.*?door.*?).*?_(?!.*?lights.*?).*","valueType":"re"},{"property":"state","logic":"is","value":"on","valueType":"str"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":1500,"y":1860,"wires":[["d96013fcab1de88f"]]},{"id":"b8918acbc043e03b","type":"comment","z":"ad8c570ec4ac394a","name":"Try to Pull all single lights","info":"","x":1490,"y":1820,"wires":[]},{"id":"c3523ad88b296bc0","type":"server-state-changed","z":"ad8c570ec4ac394a","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.trippy_lights_effect","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":260,"y":1920,"wires":[["4427e8d39681e34b"],["6ab4316b4ec28a96"]]},{"id":"b9b72ca9a47fe8bb","type":"comment","z":"ad8c570ec4ac394a","name":"Output the transition speed","info":"","x":250,"y":1760,"wires":[]},{"id":"d96013fcab1de88f","type":"switch","z":"ad8c570ec4ac394a","name":"","property":"payload.attributes.supported_color_modes","propertyType":"msg","rules":[{"t":"regex","v":"(xy|hs)","vt":"str","case":false}],"checkall":"true","repair":false,"outputs":1,"x":1730,"y":1860,"wires":[["f373e604f393df36"]]},{"id":"ce2a7725a9b135eb","type":"comment","z":"ad8c570ec4ac394a","name":"Check for color support","info":"","x":1720,"y":1820,"wires":[]},{"id":"2c54900f0bdbbea5","type":"function","z":"ad8c570ec4ac394a","name":"Generate Random saturated color","func":"var entity_id = msg.payload.entity_id;\n\n\nvar hue = Math.floor(Math.random() * 360); //generate a random number up to 360\n\nvar hs_color = hue + \",100\";\nvar hs_color_array = hs_color.split(\",\");\nvar newMsg = {\n    \"payload\": {\n        \"data\": {\n            \"hs_color\": hs_color_array,\n            \"entity_id\": entity_id,\n            \"transition\": 30\n            \n}\n        }\n    }\n;\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2920,"y":1780,"wires":[["36aeeb784b9b67d3"]]},{"id":"9742776084a6cf49","type":"api-call-service","z":"ad8c570ec4ac394a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3690,"y":1780,"wires":[[]]},{"id":"c4aa529c3bfe0b04","type":"comment","z":"ad8c570ec4ac394a","name":"Generated random HS 100% saturated color","info":"Generates fully saturdated zolors without any white","x":2930,"y":1740,"wires":[]},{"id":"572c1dd0e1c64066","type":"comment","z":"ad8c570ec4ac394a","name":"Call light_on service","info":"","x":3690,"y":1740,"wires":[]},{"id":"f373e604f393df36","type":"switch","z":"ad8c570ec4ac394a","name":"Exclude groups","property":"payload.attributes.entity_id","propertyType":"msg","rules":[{"t":"null"}],"checkall":"true","repair":false,"outputs":1,"x":1940,"y":1860,"wires":[["301622d4f5b9283a"]]},{"id":"ffedbf625aa02554","type":"comment","z":"ad8c570ec4ac394a","name":"Exclude groups","info":"","x":1940,"y":1820,"wires":[]},{"id":"301622d4f5b9283a","type":"switch","z":"ad8c570ec4ac394a","name":"Exclude white lights","property":"payload.attributes.hs_color[1]","propertyType":"msg","rules":[{"t":"gt","v":"45","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":2250,"y":1860,"wires":[["266c35d39976b527"]]},{"id":"14e5b5fc211769db","type":"comment","z":"ad8c570ec4ac394a","name":"Exclude white lights","info":"","x":2250,"y":1820,"wires":[]},{"id":"0ab6f9152439d8af","type":"ha-get-entities","z":"ad8c570ec4ac394a","name":"Get on Light entities","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"entity_id","logic":"is","value":"light\\.(?!.*?all.*?)(?!.*?group.*?)(?!.*?door.*?)(?!.*?nate.*?).*?_(?!.*?lights.*?).*","valueType":"re"},{"property":"state","logic":"is","value":"on","valueType":"str"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":580,"y":2020,"wires":[["81946780c56f602e"]]},{"id":"b6bdfe2b7847f2b7","type":"comment","z":"ad8c570ec4ac394a","name":"Try to Pull all single lights","info":"","x":570,"y":1980,"wires":[]},{"id":"81946780c56f602e","type":"switch","z":"ad8c570ec4ac394a","name":"","property":"payload.attributes.supported_color_modes","propertyType":"msg","rules":[{"t":"regex","v":"(xy|hs)","vt":"str","case":false}],"checkall":"true","repair":false,"outputs":1,"x":810,"y":2020,"wires":[["39e0f12350ee7f1a"]]},{"id":"18201a36b62935e2","type":"comment","z":"ad8c570ec4ac394a","name":"Check for color support","info":"","x":800,"y":1980,"wires":[]},{"id":"37b4f8618d88a9f6","type":"api-call-service","z":"ad8c570ec4ac394a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"{\"color_name\": \"white\",\"transition\": 25}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1930,"y":2020,"wires":[[]]},{"id":"569a244b153689a5","type":"comment","z":"ad8c570ec4ac394a","name":"Call light_on service with 25s transition to white","info":"","x":1940,"y":1980,"wires":[]},{"id":"39e0f12350ee7f1a","type":"switch","z":"ad8c570ec4ac394a","name":"Exclude groups","property":"payload.attributes.entity_id","propertyType":"msg","rules":[{"t":"null"}],"checkall":"true","repair":false,"outputs":1,"x":1020,"y":2020,"wires":[["29b0e978a2e3726e"]]},{"id":"070d31bd4f074398","type":"comment","z":"ad8c570ec4ac394a","name":"Exclude groups","info":"","x":1020,"y":1980,"wires":[]},{"id":"29b0e978a2e3726e","type":"switch","z":"ad8c570ec4ac394a","name":"Exclude white lights","property":"payload.attributes.hs_color[1]","propertyType":"msg","rules":[{"t":"gt","v":"45","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1330,"y":2020,"wires":[["ba8f1f9ba7caa887"]]},{"id":"d3bbe811fd5706fe","type":"comment","z":"ad8c570ec4ac394a","name":"Exclude white lights","info":"","x":1330,"y":1980,"wires":[]},{"id":"71b5ac1ee70cb6db","type":"server-state-changed","z":"ad8c570ec4ac394a","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.trippy_lights_effect","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":260,"y":2020,"wires":[["0ab6f9152439d8af"],[]]},{"id":"f53e3ff032543575","type":"comment","z":"ad8c570ec4ac394a","name":"Returns lights to normality when trippy lights is off","info":"","x":260,"y":1980,"wires":[]},{"id":"ba8f1f9ba7caa887","type":"change","z":"ad8c570ec4ac394a","name":"","rules":[{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"payload.entity_id","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":1590,"y":2020,"wires":[["37b4f8618d88a9f6"]]},{"id":"b63722f5e8efecb9","type":"comment","z":"ad8c570ec4ac394a","name":"Extract the entity id","info":"","x":1590,"y":1980,"wires":[]},{"id":"266c35d39976b527","type":"api-current-state","z":"ad8c570ec4ac394a","name":"Acid mode on?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.acid_time","state_type":"str","blockInputOverrides":true,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":2460,"y":1860,"wires":[["9442e076db99a2e1"],["6376942863a60cd1"]]},{"id":"6376942863a60cd1","type":"api-current-state","z":"ad8c570ec4ac394a","name":"Party Mode off?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.party_mode","state_type":"str","blockInputOverrides":true,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":2660,"y":1880,"wires":[["2c54900f0bdbbea5"],["6df8b0ea967974ba"]]},{"id":"6df8b0ea967974ba","type":"function","z":"ad8c570ec4ac394a","name":"Generate Random whiteish color","func":"var entity_id = msg.payload.entity_id;\n\n\nvar hue = Math.floor(Math.random() * 360); //generate a random number up to 360\n\nvar hs_color = hue + \",60\";\nvar hs_color_array = hs_color.split(\",\");\nvar newMsg = {\n    \"payload\": {\n        \"data\": {\n            \"hs_color\": hs_color_array,\n            \"entity_id\": entity_id,\n            \"transition\": 30\n            \n}\n        }\n    }\n;\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2920,"y":1880,"wires":[["b1f69e31bd7b64d3"]]},{"id":"7c96df0988a1f2e8","type":"api-call-service","z":"ad8c570ec4ac394a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3690,"y":1880,"wires":[[]]},{"id":"2384cfdc8c9ff685","type":"comment","z":"ad8c570ec4ac394a","name":"Generated random HS 60% saturated color","info":"","x":2940,"y":1840,"wires":[]},{"id":"ffdac1079452e050","type":"comment","z":"ad8c570ec4ac394a","name":"Call light_on service","info":"","x":3690,"y":1840,"wires":[]},{"id":"8b33b34cd591cd12","type":"comment","z":"ad8c570ec4ac394a","name":"Is someone high?","info":"","x":2470,"y":1820,"wires":[]},{"id":"95a2f4f003b52cc2","type":"comment","z":"ad8c570ec4ac394a","name":"Is it party time?","info":"","x":2660,"y":1840,"wires":[]},{"id":"36aeeb784b9b67d3","type":"api-current-state","z":"ad8c570ec4ac394a","name":"TRansition?","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_number.trippy_lights_effect_speed","state_type":"str","blockInputOverrides":true,"outputProperties":[{"property":"payload.data.transition","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":3190,"y":1780,"wires":[["8638760da61933b1","87099afb4505603b"]]},{"id":"4427e8d39681e34b","type":"api-current-state","z":"ad8c570ec4ac394a","name":"TRansition?","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_number.trippy_lights_effect_speed","state_type":"str","blockInputOverrides":true,"outputProperties":[{"property":"delay","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":550,"y":1880,"wires":[["630088e66f7238a1"]]},{"id":"b1f69e31bd7b64d3","type":"api-current-state","z":"ad8c570ec4ac394a","name":"TRansition?","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_number.trippy_lights_effect_speed","state_type":"str","blockInputOverrides":true,"outputProperties":[{"property":"payload.data.transition","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":3190,"y":1880,"wires":[["986ec2990f7b1d2b"]]},{"id":"3ec9d48db7a29234","type":"server-state-changed","z":"ad8c570ec4ac394a","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_number.trippy_lights_effect_speed","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"delay","propertyType":"msg","value":"","valueType":"entityState"}],"x":290,"y":1800,"wires":[["630088e66f7238a1"]]},{"id":"0a7a7514d579949c","type":"function","z":"ad8c570ec4ac394a","name":"Convert MS to S","func":"var seconds = msg.delay * 1000;\n\nvar msg = {\n    \"delay\": seconds\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1080,"y":1860,"wires":[["e216d39e85bfde74","48ff7c7b01ea4c37"]]},{"id":"74b80452ecae5b16","type":"api-current-state","z":"ad8c570ec4ac394a","name":"Effect on?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.trippy_lights_effect","state_type":"str","blockInputOverrides":true,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":880,"y":1880,"wires":[["0a7a7514d579949c"],[]]},{"id":"b46bfc99d6f67018","type":"comment","z":"ad8c570ec4ac394a","name":"Output the transition speed","info":"","x":550,"y":1840,"wires":[]},{"id":"0e54e9dc17ebe8de","type":"comment","z":"ad8c570ec4ac394a","name":"Is the effect on?","info":"","x":880,"y":1840,"wires":[]},{"id":"37bd44f22fee717e","type":"comment","z":"ad8c570ec4ac394a","name":"Trigger on \"trippy lights effect\" toggle","info":"","x":260,"y":1880,"wires":[]},{"id":"42ddbc4a3d56b5b2","type":"comment","z":"ad8c570ec4ac394a","name":"Output the transition speed","info":"","x":3210,"y":1740,"wires":[]},{"id":"816cb8557c929c95","type":"comment","z":"ad8c570ec4ac394a","name":"Output the transition speed","info":"","x":3210,"y":1840,"wires":[]},{"id":"8638760da61933b1","type":"api-current-state","z":"ad8c570ec4ac394a","name":"Saturation?","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_number.trippy_lights_color_saturation","state_type":"str","blockInputOverrides":true,"outputProperties":[{"property":"payload.data.hs_color[1]","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":3430,"y":1780,"wires":[["9742776084a6cf49","7c6963761c4661a3"]]},{"id":"986ec2990f7b1d2b","type":"api-current-state","z":"ad8c570ec4ac394a","name":"Saturation","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_number.trippy_lights_color_saturation","state_type":"str","blockInputOverrides":true,"outputProperties":[{"property":"payload.data.hs_color[1]","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":3430,"y":1880,"wires":[["7c96df0988a1f2e8"]]},{"id":"c00687f46b6065e4","type":"comment","z":"ad8c570ec4ac394a","name":"Output the color saturation","info":"","x":3450,"y":1740,"wires":[]},{"id":"2fc677cffaf3712f","type":"comment","z":"ad8c570ec4ac394a","name":"Output the color saturation","info":"","x":3450,"y":1840,"wires":[]},{"id":"87099afb4505603b","type":"debug","z":"ad8c570ec4ac394a","name":"debug 12","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":3360,"y":1660,"wires":[]},{"id":"7c6963761c4661a3","type":"debug","z":"ad8c570ec4ac394a","name":"debug 13","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":3540,"y":1680,"wires":[]},{"id":"48ff7c7b01ea4c37","type":"debug","z":"ad8c570ec4ac394a","name":"debug 17","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1400,"y":1740,"wires":[]},{"id":"df7959a17666432e","type":"server-state-changed","z":"ad8c570ec4ac394a","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.show_lyrics","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":200,"y":3080,"wires":[["51ea5ee7a5dee235"],["3d2173d5d941fa22"]]},{"id":"45e38d814857d3fd","type":"ha-get-entities","z":"ad8c570ec4ac394a","name":"Get ChromecastMedia players","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"entity_id","logic":"is","value":"media_player\\.(?!plex).*_chromecast","valueType":"re"},{"property":"state","logic":"is","value":"off","valueType":"str"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":1190,"y":3080,"wires":[["f5f31a7289f1792a"]]},{"id":"f5f31a7289f1792a","type":"delay","z":"ad8c570ec4ac394a","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"2","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1440,"y":3080,"wires":[["55efad02a56cbde1"]]},{"id":"55efad02a56cbde1","type":"change","z":"ad8c570ec4ac394a","name":"","rules":[{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"payload.entity_id","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":1690,"y":3080,"wires":[["47c2c09a0f9b8bd0"]]},{"id":"47c2c09a0f9b8bd0","type":"api-call-service","z":"ad8c570ec4ac394a","name":"Cast lyrics","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"cast","service":"show_lovelace_view","areaId":[],"deviceId":[],"entityId":[],"data":"{\"dashboard_path\":\"lovelace-hub\",\"view_path\":\"karaoke\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1930,"y":3080,"wires":[["780929606df5a4fc"]]},{"id":"7c556ee0a47317f3","type":"comment","z":"ad8c570ec4ac394a","name":"Display lyrics on TVs when showlyrics mode is triggered","info":"","x":240,"y":3040,"wires":[]},{"id":"b274fab4affe458f","type":"comment","z":"ad8c570ec4ac394a","name":"Pull all inactive Chromecasts entities","info":"","x":1180,"y":3040,"wires":[]},{"id":"1c20b23ec241978b","type":"comment","z":"ad8c570ec4ac394a","name":"rate limit at 1 per 8s","info":"","x":1430,"y":3040,"wires":[]},{"id":"d6d5849a860e48f8","type":"comment","z":"ad8c570ec4ac394a","name":"Extract the entity id","info":"","x":1690,"y":3040,"wires":[]},{"id":"c895a095762bdb40","type":"comment","z":"ad8c570ec4ac394a","name":"Start the visuals playlist","info":"","x":1920,"y":3040,"wires":[]},{"id":"51ea5ee7a5dee235","type":"api-current-state","z":"ad8c570ec4ac394a","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is_not","entity_id":"media_player.group_home_speakers","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":670,"y":3080,"wires":[["45e38d814857d3fd"],[]]},{"id":"3d2173d5d941fa22","type":"ha-get-entities","z":"ad8c570ec4ac394a","name":"Get ChromecastMedia players","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"entity_id","logic":"is","value":"media_player\\.(?!plex).*_chromecast","valueType":"re"},{"property":"attributes.media_title","logic":"is","value":"lovelace-hub: Karaoke","valueType":"str"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":610,"y":3220,"wires":[["978e4a94ca1b50a1"]]},{"id":"978e4a94ca1b50a1","type":"change","z":"ad8c570ec4ac394a","name":"","rules":[{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"payload.entity_id","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":1110,"y":3220,"wires":[["1e4987d26149bf33"]]},{"id":"1e4987d26149bf33","type":"api-call-service","z":"ad8c570ec4ac394a","name":"Stop cast","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"turn_off","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1340,"y":3220,"wires":[[]]},{"id":"345108ed53660124","type":"comment","z":"ad8c570ec4ac394a","name":"Make sure Home group is playing","info":"","x":670,"y":3040,"wires":[]},{"id":"1c893d951d205976","type":"comment","z":"ad8c570ec4ac394a","name":"Extract the entity id","info":"","x":1090,"y":3180,"wires":[]},{"id":"8a1a8a7cadb580c7","type":"comment","z":"ad8c570ec4ac394a","name":"Stop the cast","info":"","x":1330,"y":3180,"wires":[]},{"id":"780929606df5a4fc","type":"api-call-service","z":"ad8c570ec4ac394a","name":"mute player","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_mute","areaId":[],"deviceId":[],"entityId":[],"data":"{\"is_volume_muted\":\"true\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2190,"y":3080,"wires":[[]]},{"id":"5595b6a9f9d700dc","type":"comment","z":"ad8c570ec4ac394a","name":"Mute player","info":"","x":2170,"y":3040,"wires":[]},{"id":"07cd581f9b3b5828","type":"comment","z":"ad8c570ec4ac394a","name":"Pull all lyrics casting Chromecasts entities","info":"","x":620,"y":3180,"wires":[]},{"id":"6ffdc8b6e02bfc69","type":"trigger-state","z":"ad8c570ec4ac394a","name":"","server":"7ab5c227.a3ce8c","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"binary_sensor.front_door_person_occupancy","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on","propertyValue":"new_state.state"},{"targetType":"entity_id","targetValue":"input_boolean.waiting_pakidge","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on","propertyValue":"new_state.state"}],"inputs":0,"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","enableInput":false,"x":270,"y":2540,"wires":[["7db0dc91253bee08"],[]]},{"id":"a3905471250639d1","type":"api-call-service","z":"ad8c570ec4ac394a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"mobile_app_galaxy_s10","areaId":[],"deviceId":[],"entityId":[],"data":"{\"message\":\"Someone is nearing the door\",\"title\":\"Pakidge Attempt?\",\"data\":{\"image\":\"https://hass.purgatoire.ca/local/pakidge.jpg\"}}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1060,"y":2540,"wires":[[]]},{"id":"7db0dc91253bee08","type":"api-call-service","z":"ad8c570ec4ac394a","name":"Save pakidge.jpg","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"camera","service":"snapshot","areaId":[],"deviceId":[],"entityId":["camera.front_door"],"data":"{\"filename\":\"/config/www/pakidge.jpg\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":650,"y":2540,"wires":[["a3905471250639d1"]]},{"id":"ba864598c9411636","type":"inject","z":"ad8c570ec4ac394a","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":420,"y":2480,"wires":[["7db0dc91253bee08"]]},{"id":"4f641d7174d8b63b","type":"inject","z":"ad8c570ec4ac394a","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":740,"y":1140,"wires":[["5f1ff2606221f3da"]]},{"id":"41b866c68f11b71c","type":"api-call-service","z":"ad8c570ec4ac394a","name":"play acid visuals","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"play_media","areaId":[],"deviceId":[],"entityId":[],"data":"{\"media_content_id\":\"plex://{ \\\"playlist_name\\\": \\\"Automatic Acid Visuals\\\", \\\"shuffle\\\": 1 }\",\"media_content_type\":\"playlist\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1660,"y":1280,"wires":[[]]},{"id":"9ebb3cde717d14a5","type":"api-call-service","z":"ad8c570ec4ac394a","name":"play party visuals","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"play_media","areaId":[],"deviceId":[],"entityId":[],"data":"{\"media_content_id\":\"plex://{ \\\"playlist_name\\\": \\\"Automatic Soft Visuals\\\", \\\"shuffle\\\": 1 }\",\"media_content_type\":\"playlist\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1650,"y":120,"wires":[[]]},{"id":"3c0539b0f3b00da5","type":"trigger","z":"ad8c570ec4ac394a","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"1","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":580,"y":760,"wires":[["73d7d43d57b2e30f"]]},{"id":"c37b606f5c9c2ae7","type":"comment","z":"ad8c570ec4ac394a","name":"15 seconds cooldown","info":"","x":580,"y":720,"wires":[]},{"id":"73d7d43d57b2e30f","type":"ha-get-entities","z":"ad8c570ec4ac394a","name":"Get  Light entities","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"entity_id","logic":"is","value":"light\\.(?!.*?group.*?)(?!.*?k95_rgb_2_led.*?)(?!.*?door.*?).*?_(?!.*?lights.*?).*","valueType":"re"},{"property":"state","logic":"is","value":"on","valueType":"str"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":830,"y":760,"wires":[["345651af8bf55493"]]},{"id":"bc07ec44273636ee","type":"comment","z":"ad8c570ec4ac394a","name":"Try to Pull all lit single lights","info":"","x":820,"y":720,"wires":[]},{"id":"f0105def6dddb0f9","type":"server-state-changed","z":"ad8c570ec4ac394a","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.random_colors","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":270,"y":760,"wires":[["3c0539b0f3b00da5"],[]]},{"id":"698c1c86b99cb219","type":"comment","z":"ad8c570ec4ac394a","name":"Change light to random colors on press","info":"","x":250,"y":720,"wires":[]},{"id":"345651af8bf55493","type":"switch","z":"ad8c570ec4ac394a","name":"","property":"payload.attributes.supported_color_modes","propertyType":"msg","rules":[{"t":"regex","v":"(xy|hs)","vt":"str","case":false}],"checkall":"true","repair":false,"outputs":1,"x":1070,"y":760,"wires":[["2566d728b2774429"]]},{"id":"97e7d322435425a6","type":"comment","z":"ad8c570ec4ac394a","name":"Check for color support","info":"","x":1060,"y":720,"wires":[]},{"id":"670a7e87eea13cda","type":"function","z":"ad8c570ec4ac394a","name":"Generate Random saturated color","func":"var entity_id = msg.payload.entity_id;\n\n\nvar hue = Math.floor(Math.random() * 360); //generate a random number up to 360\n\nvar hs_color = hue + \",100\";\nvar hs_color_array = hs_color.split(\",\");\nvar newMsg = {\n    \"payload\": {\n        \"data\": {\n            \"hs_color\": hs_color_array,\n            \"entity_id\": entity_id,\n            \"brightness_pct\": 100\n            \n}\n        }\n    }\n;\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1600,"y":760,"wires":[["3346af2c31e1d041"]]},{"id":"3346af2c31e1d041","type":"api-call-service","z":"ad8c570ec4ac394a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1890,"y":760,"wires":[["219fcd606607f1a5"]]},{"id":"20a6bc2656df7cd3","type":"comment","z":"ad8c570ec4ac394a","name":"Generated random HS 100% saturated color","info":"","x":1610,"y":720,"wires":[]},{"id":"4a9b7c8566e06d0e","type":"comment","z":"ad8c570ec4ac394a","name":"Call light_on service","info":"","x":1890,"y":720,"wires":[]},{"id":"8458c6541c1a983b","type":"comment","z":"ad8c570ec4ac394a","name":"also sets the entity_id","info":"","x":1600,"y":800,"wires":[]},{"id":"2566d728b2774429","type":"switch","z":"ad8c570ec4ac394a","name":"Exclude groups","property":"payload.attributes.entity_id","propertyType":"msg","rules":[{"t":"null"}],"checkall":"true","repair":false,"outputs":1,"x":1300,"y":760,"wires":[["670a7e87eea13cda"]]},{"id":"3beee483420df235","type":"comment","z":"ad8c570ec4ac394a","name":"Exclude groups","info":"","x":1260,"y":720,"wires":[]},{"id":"204355a813037618","type":"api-call-service","z":"ad8c570ec4ac394a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.random_colors"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2300,"y":760,"wires":[[]]},{"id":"7fc55e4a8583516a","type":"comment","z":"ad8c570ec4ac394a","name":"Turn off boolean input","info":"","x":2280,"y":720,"wires":[]},{"id":"219fcd606607f1a5","type":"trigger","z":"ad8c570ec4ac394a","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"1","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2080,"y":760,"wires":[["204355a813037618"]]},{"id":"3da9382f8b5fb7a1","type":"trigger","z":"ad8c570ec4ac394a","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"1","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":580,"y":900,"wires":[["5d0ddef411b27f47"]]},{"id":"262788e499c293fa","type":"comment","z":"ad8c570ec4ac394a","name":"15 seconds cooldown","info":"","x":580,"y":860,"wires":[]},{"id":"5d0ddef411b27f47","type":"ha-get-entities","z":"ad8c570ec4ac394a","name":"Get  Light entities","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"entity_id","logic":"is","value":"light\\.(?!.*?group.*?)(?!.*?k95_rgb_2_led.*?)(?!.*?door.*?).*?_(?!.*?lights.*?).*","valueType":"re"},{"property":"state","logic":"is","value":"on","valueType":"str"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":830,"y":900,"wires":[["97c76ddf1df579b3"]]},{"id":"66c314369e60a72d","type":"comment","z":"ad8c570ec4ac394a","name":"Try to Pull all lit single lights","info":"","x":820,"y":860,"wires":[]},{"id":"7983f47f3129f7f4","type":"server-state-changed","z":"ad8c570ec4ac394a","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.random_pastel_colors","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":290,"y":900,"wires":[["3da9382f8b5fb7a1"],[]]},{"id":"4eec48e8082a1681","type":"comment","z":"ad8c570ec4ac394a","name":"Change light to random colors on press","info":"","x":250,"y":860,"wires":[]},{"id":"97c76ddf1df579b3","type":"switch","z":"ad8c570ec4ac394a","name":"","property":"payload.attributes.supported_color_modes","propertyType":"msg","rules":[{"t":"regex","v":"(xy|hs)","vt":"str","case":false}],"checkall":"true","repair":false,"outputs":1,"x":1070,"y":900,"wires":[["289f7ecb38c37668"]]},{"id":"adaef3244b408911","type":"comment","z":"ad8c570ec4ac394a","name":"Check for color support","info":"","x":1060,"y":860,"wires":[]},{"id":"2a75e80c9ffc8381","type":"function","z":"ad8c570ec4ac394a","name":"Generate Random pastel color","func":"var entity_id = msg.payload.entity_id;\n\n\nvar hue = Math.floor(Math.random() * 360); //generate a random number up to 360\n\nvar hs_color = hue + \",45\";\nvar hs_color_array = hs_color.split(\",\");\nvar newMsg = {\n    \"payload\": {\n        \"data\": {\n            \"hs_color\": hs_color_array,\n            \"entity_id\": entity_id,\n            \"brightness_pct\": 100\n            \n}\n        }\n    }\n;\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1590,"y":900,"wires":[["450fecf41250af0e"]]},{"id":"450fecf41250af0e","type":"api-call-service","z":"ad8c570ec4ac394a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1890,"y":900,"wires":[["ddd33f2c5c20b48f"]]},{"id":"ee3668c3dd83cca1","type":"comment","z":"ad8c570ec4ac394a","name":"Generated random HS 55% saturated color","info":"","x":1600,"y":860,"wires":[]},{"id":"14c65687277f04db","type":"comment","z":"ad8c570ec4ac394a","name":"Call light_on service","info":"","x":1890,"y":860,"wires":[]},{"id":"35668b9eed9b225e","type":"comment","z":"ad8c570ec4ac394a","name":"also sets the entity_id","info":"","x":1600,"y":940,"wires":[]},{"id":"289f7ecb38c37668","type":"switch","z":"ad8c570ec4ac394a","name":"Exclude groups","property":"payload.attributes.entity_id","propertyType":"msg","rules":[{"t":"null"}],"checkall":"true","repair":false,"outputs":1,"x":1300,"y":900,"wires":[["2a75e80c9ffc8381"]]},{"id":"04cb1fa9cdb294b1","type":"comment","z":"ad8c570ec4ac394a","name":"Exclude groups","info":"","x":1260,"y":860,"wires":[]},{"id":"2fedca693f45ba39","type":"api-call-service","z":"ad8c570ec4ac394a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.random_pastel_colors"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2300,"y":900,"wires":[[]]},{"id":"d0b078b7d3db8067","type":"comment","z":"ad8c570ec4ac394a","name":"Turn off boolean input","info":"","x":2280,"y":860,"wires":[]},{"id":"ddd33f2c5c20b48f","type":"trigger","z":"ad8c570ec4ac394a","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"1","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2080,"y":900,"wires":[["2fedca693f45ba39"]]},{"id":"9ea5b4675a9552da","type":"inject","z":"ad8c570ec4ac394a","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":340,"y":960,"wires":[[]]},{"id":"1a3303ec40ac0553","type":"server-state-changed","z":"ad8c570ec4ac394a","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.bootminutes","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"4.0","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":240,"y":1060,"wires":[["93bd849e2a65db7c"],[]]},{"id":"e53f8e582441f86d","type":"comment","z":"ad8c570ec4ac394a","name":"Reload pages when HASS rebooted 4 minutes ago","info":"","x":290,"y":1020,"wires":[]},{"id":"93bd849e2a65db7c","type":"ha-get-entities","z":"ad8c570ec4ac394a","name":"Get  Load URL button entities","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"entity_id","logic":"is","value":"button\\..*load_start_url","valueType":"re"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":580,"y":1060,"wires":[["80fc6823ccb5d5ae"]]},{"id":"adec6b2878e1b2f4","type":"api-call-service","z":"ad8c570ec4ac394a","name":"press button","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"button","service":"press","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1270,"y":1060,"wires":[[]]},{"id":"80fc6823ccb5d5ae","type":"change","z":"ad8c570ec4ac394a","name":"","rules":[{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"payload.entity_id","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":930,"y":1060,"wires":[["adec6b2878e1b2f4"]]},{"id":"859e7d46c2fe7e54","type":"comment","z":"ad8c570ec4ac394a","name":"Extract the entity id","info":"","x":910,"y":1020,"wires":[]},{"id":"93b42f29dfa02678","type":"comment","z":"ad8c570ec4ac394a","name":"Get FKB reload butons","info":"","x":600,"y":1020,"wires":[]},{"id":"84f783a81b45f8cf","type":"comment","z":"ad8c570ec4ac394a","name":"Press Button","info":"","x":1250,"y":1020,"wires":[]},{"id":"29d792dddbf23293","type":"trigger","z":"ad8c570ec4ac394a","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"1","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":580,"y":440,"wires":[["f74f4229dd1ff813"]]},{"id":"981b8d49db044650","type":"comment","z":"ad8c570ec4ac394a","name":"15 seconds cooldown","info":"","x":580,"y":400,"wires":[]},{"id":"f74f4229dd1ff813","type":"ha-get-entities","z":"ad8c570ec4ac394a","name":"Get  Light entities","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"entity_id","logic":"is","value":"light\\.(?!.*?group.*?)(?!.*?k95_rgb_2_led.*?)(?!.*?door.*?).*?_(?!.*?lights.*?).*","valueType":"re"},{"property":"state","logic":"is","value":"on","valueType":"str"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":830,"y":440,"wires":[["8b52838755e2eff7"]]},{"id":"b391718b61e5d75b","type":"comment","z":"ad8c570ec4ac394a","name":"Try to Pull all lit single lights","info":"","x":820,"y":400,"wires":[]},{"id":"51e95d967df464aa","type":"server-state-changed","z":"ad8c570ec4ac394a","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_button.generate_warm_colors","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":290,"y":440,"wires":[["29d792dddbf23293"]]},{"id":"220c74292b512bb5","type":"comment","z":"ad8c570ec4ac394a","name":"Change light to warm saturated colors on press","info":"","x":280,"y":400,"wires":[]},{"id":"8b52838755e2eff7","type":"switch","z":"ad8c570ec4ac394a","name":"","property":"payload.attributes.supported_color_modes","propertyType":"msg","rules":[{"t":"regex","v":"(xy|hs)","vt":"str","case":false}],"checkall":"true","repair":false,"outputs":1,"x":1070,"y":440,"wires":[["85cd0f79967163cb"]]},{"id":"bf981747e6c1918a","type":"comment","z":"ad8c570ec4ac394a","name":"Check for color support","info":"","x":1060,"y":400,"wires":[]},{"id":"0612fa506e02a3d5","type":"function","z":"ad8c570ec4ac394a","name":"Generate warm saturated color ( to edit)","func":"var entity_id = msg.payload.entity_id;\n\nvar r = Math.round(Math.random() * 4)\nvar hue1 = (Math.round(Math.random() * 100) + 250); //generate a random number up to 150\nvar hue2 = Math.round(Math.random() * 40); //generate a random number up to 150\n//var huef = hue + 250;\nvar saturation = (Math.round(Math.random() * 20) + 80 )\nswitch(r) {\n  case 1:\n    var hue = hue1\n    break;\n  case 2:\n    var hue = hue1\n    break;\n  case 3:\n    var hue = hue1\n    break;\n  case 4:\n    var hue = hue2\n    break;\n}\n\nvar hs_color = hue + \",\" + saturation;\n\n\n\n\nvar hs_color_array = hs_color.split(\",\");\nvar newMsg = {\n    \"payload\": {\n        \"data\": {\n            \"hs_color\": hs_color_array,\n            \"entity_id\": entity_id,\n            \"brightness_pct\": 100,\n            \n            \n}\n        }\n    }\n;\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1580,"y":440,"wires":[["751677464ccc03dd"]]},{"id":"751677464ccc03dd","type":"api-call-service","z":"ad8c570ec4ac394a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1890,"y":440,"wires":[["10aa3a14e006ce9e"]]},{"id":"8bda6b787a1395f6","type":"comment","z":"ad8c570ec4ac394a","name":"Generated random HS 100% saturated color","info":"","x":1590,"y":400,"wires":[]},{"id":"99ad64fcaaeda74d","type":"comment","z":"ad8c570ec4ac394a","name":"Call light_on service","info":"","x":1890,"y":400,"wires":[]},{"id":"85cd0f79967163cb","type":"switch","z":"ad8c570ec4ac394a","name":"Exclude groups","property":"payload.attributes.entity_id","propertyType":"msg","rules":[{"t":"null"}],"checkall":"true","repair":false,"outputs":1,"x":1300,"y":440,"wires":[["0612fa506e02a3d5"]]},{"id":"1fcd6d42544866f3","type":"comment","z":"ad8c570ec4ac394a","name":"Exclude groups","info":"","x":1260,"y":400,"wires":[]},{"id":"10aa3a14e006ce9e","type":"trigger","z":"ad8c570ec4ac394a","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"1","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2080,"y":440,"wires":[["9fec3d7fae47d13f"]]},{"id":"9fec3d7fae47d13f","type":"api-call-service","z":"ad8c570ec4ac394a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.random_colors"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2300,"y":440,"wires":[[]]},{"id":"53876ef0816021a4","type":"comment","z":"ad8c570ec4ac394a","name":"Turn off boolean input","info":"","x":2280,"y":400,"wires":[]},{"id":"b753b69a69ca3b78","type":"trigger","z":"ad8c570ec4ac394a","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"1","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":620,"y":520,"wires":[["0ed3a88c554f5fa5"]]},{"id":"b9d979f327628d68","type":"comment","z":"ad8c570ec4ac394a","name":"15 seconds cooldown","info":"","x":580,"y":480,"wires":[]},{"id":"0ed3a88c554f5fa5","type":"ha-get-entities","z":"ad8c570ec4ac394a","name":"Get  Light entities","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"entity_id","logic":"is","value":"light\\.(?!.*?group.*?)(?!.*?k95_rgb_2_led.*?)(?!.*?door.*?).*?_(?!.*?lights.*?).*","valueType":"re"},{"property":"state","logic":"is","value":"on","valueType":"str"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":830,"y":520,"wires":[["39f1dad06948485b"]]},{"id":"5d9fd93a5a9ba944","type":"comment","z":"ad8c570ec4ac394a","name":"Try to Pull all lit single lights","info":"","x":820,"y":480,"wires":[]},{"id":"5a1b1f514bf0e0c6","type":"server-state-changed","z":"ad8c570ec4ac394a","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_button.generate_light_warm_colors","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":310,"y":520,"wires":[["b753b69a69ca3b78"]]},{"id":"74a39ee43a487dc8","type":"comment","z":"ad8c570ec4ac394a","name":"Change light to warm saturated colors on press","info":"","x":280,"y":480,"wires":[]},{"id":"39f1dad06948485b","type":"switch","z":"ad8c570ec4ac394a","name":"","property":"payload.attributes.supported_color_modes","propertyType":"msg","rules":[{"t":"regex","v":"(xy|hs)","vt":"str","case":false}],"checkall":"true","repair":false,"outputs":1,"x":1070,"y":520,"wires":[["2b24bf370ac1466a"]]},{"id":"fdb1f5ee72473536","type":"comment","z":"ad8c570ec4ac394a","name":"Check for color support","info":"","x":1060,"y":480,"wires":[]},{"id":"8c7ece9de0998cea","type":"function","z":"ad8c570ec4ac394a","name":"Generate warm pale  color ( to edit)","func":"var entity_id = msg.payload.entity_id;\n\nvar r = Math.round(Math.random() * 4)\nvar hue1 = (Math.round(Math.random() * 60) + 300); //generate a random number up to 300->360\nvar hue2 = Math.round(Math.random() * 30); //generate a random number up to 30\n//var huef = hue + 250;\nvar saturation = (Math.round(Math.random() * 20) + 40 ); // generate random saturation from 80 to 100\nswitch(r) {\n  case 1:\n    var hue = hue1\n    break;\n  case 2:\n    var hue = hue1\n    break;\n  case 3:\n    var hue = hue1\n    break;\n  case 4:\n    var hue = hue2\n    break;\n}\n\nvar hs_color = hue + \",\" + saturation;\n\n\n\n\nvar hs_color_array = hs_color.split(\",\");\nvar newMsg = {\n    \"payload\": {\n        \"data\": {\n            \"hs_color\": hs_color_array,\n            \"entity_id\": entity_id,\n            \"brightness_pct\": 100,\n            \n            \n}\n        }\n    }\n;\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1560,"y":520,"wires":[["8409535fc3549229"]]},{"id":"8409535fc3549229","type":"api-call-service","z":"ad8c570ec4ac394a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1890,"y":520,"wires":[["c19304865aab8aa4"]]},{"id":"26a522ed4fa01f58","type":"comment","z":"ad8c570ec4ac394a","name":"Generated random HS 100% saturated color","info":"","x":1590,"y":480,"wires":[]},{"id":"0664378320eb1efa","type":"comment","z":"ad8c570ec4ac394a","name":"Call light_on service","info":"","x":1890,"y":480,"wires":[]},{"id":"2b24bf370ac1466a","type":"switch","z":"ad8c570ec4ac394a","name":"Exclude groups","property":"payload.attributes.entity_id","propertyType":"msg","rules":[{"t":"null"}],"checkall":"true","repair":false,"outputs":1,"x":1300,"y":520,"wires":[["8c7ece9de0998cea"]]},{"id":"4d2276ac66bc5288","type":"comment","z":"ad8c570ec4ac394a","name":"Exclude groups","info":"","x":1260,"y":480,"wires":[]},{"id":"c19304865aab8aa4","type":"trigger","z":"ad8c570ec4ac394a","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"1","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2080,"y":520,"wires":[["f7c96e6c05323061"]]},{"id":"f7c96e6c05323061","type":"api-call-service","z":"ad8c570ec4ac394a","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.random_colors"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2300,"y":520,"wires":[[]]},{"id":"5f9f4c4ecb82917d","type":"comment","z":"ad8c570ec4ac394a","name":"Turn off boolean input","info":"","x":2280,"y":480,"wires":[]},{"id":"db856ada2b0e4640","type":"inject","z":"ad8c570ec4ac394a","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":400,"y":580,"wires":[["b753b69a69ca3b78"]]},{"id":"fbadb1bd0f9239ec","type":"server-state-changed","z":"ad8c570ec4ac394a","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_button.start_visuals","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":260,"y":120,"wires":[["e144693c18011801"]]},{"id":"e144693c18011801","type":"trigger","z":"ad8c570ec4ac394a","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"45","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":590,"y":120,"wires":[["02f7295b44608fe0"]]},{"id":"cacda7a9a81473d7","type":"server-state-changed","z":"ad8c570ec4ac394a","name":"office speaker","server":"209ff8ef.59a5d8","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"media_player.office_speaker","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"playing","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"","forType":"num","forUnits":"seconds","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":190,"y":2300,"wires":[["5cdf0ad8625565cf"],[]]},{"id":"5cdf0ad8625565cf","type":"function","z":"ad8c570ec4ac394a","name":"Extract artist adn set musicbrainz query","func":"var artist = msg.data.new_state.attributes.media_artist; // light group\n\nvar url = \"https://musicbrainz.org/ws/2/artist/?query=name:\" + artist;\n\n\nvar msg = {\n     \"url\": url\n\n}\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":560,"y":2300,"wires":[["9736e74e51f5418f"]]},{"id":"9736e74e51f5418f","type":"http request","z":"ad8c570ec4ac394a","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":850,"y":2300,"wires":[["e8a8887e387464a5"]]},{"id":"e8a8887e387464a5","type":"xml","z":"ad8c570ec4ac394a","name":"","property":"payload","attr":"","chr":"","x":1050,"y":2300,"wires":[["37604b826333d5fd"]]},{"id":"f4abb4a89abb3b79","type":"debug","z":"ad8c570ec4ac394a","name":"debug 182","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"msg","x":1750,"y":2300,"wires":[]},{"id":"37604b826333d5fd","type":"function","z":"ad8c570ec4ac394a","name":"Extract Artist for API call to Lidarr","func":"var id = msg.payload.metadata[\"artist-list\"][0].artist[0].$.id;\nvar url = \"http://192.168.0.20:8686/api/v1/artist\";\nvar name = msg.payload.metadata[\"artist-list\"][0].artist[0].name[0];\n\nvar msg = {\n     \"url\": url,\n     \"payload\": {\n          \"ArtistName\": name,\n          \"Path\": \"/media/Music/\" + name,\n          \"rootFolderPath\": \"/media/Music\",\n          \"ForeignArtistId\": id,\n          \"QualityProfileId\": \"1\",\n          \"MetadataProfileId\": \"1\",\n          \"Monitored\": true\n     }\n\n};\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1300,"y":2300,"wires":[["4538b6ad3f79553c"]]},{"id":"4538b6ad3f79553c","type":"http request","z":"ad8c570ec4ac394a","name":"","method":"POST","ret":"txt","paytoqs":"body","url":"","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"bearer","senderr":false,"headers":[],"x":1550,"y":2300,"wires":[["f4abb4a89abb3b79"]]},{"id":"7f0d446eb6ffe153","type":"comment","z":"ad8c570ec4ac394a","name":"Check Office Speaker for playback","info":"","x":220,"y":2260,"wires":[]},{"id":"2980e3c451118b65","type":"comment","z":"ad8c570ec4ac394a","name":"Extract Artist for musicbrainz Querry to get the ID","info":"","x":560,"y":2260,"wires":[]},{"id":"0420076dc7a48b5a","type":"comment","z":"ad8c570ec4ac394a","name":"Get musicbrainz ","info":"","x":860,"y":2260,"wires":[]},{"id":"234fee3f8cb73e95","type":"comment","z":"ad8c570ec4ac394a","name":"Convert to XML","info":"","x":1060,"y":2260,"wires":[]},{"id":"9f523d93671ce062","type":"comment","z":"ad8c570ec4ac394a","name":"Extract data for Lidarr callback","info":"","x":1300,"y":2260,"wires":[]},{"id":"e7e89501f6a98860","type":"comment","z":"ad8c570ec4ac394a","name":"Add to Lidarr","info":"","x":1550,"y":2260,"wires":[]},{"id":"f8f5bf9b0d30c346","type":"function","z":"ad8c570ec4ac394a","name":"Extract artist adn set musicbrainz query","func":"var artist = msg.data.new_state.attributes.media_artist; // light group\n\nvar url = \"https://musicbrainz.org/ws/2/artist/?query=name:\" + artist;\n\n\nvar msg = {\n     \"url\": url\n\n}\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":720,"y":2160,"wires":[["0d81f057bbe78e63"]]},{"id":"0d81f057bbe78e63","type":"http request","z":"ad8c570ec4ac394a","name":"","method":"GET","ret":"txt","paytoqs":"ignore","url":"","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":990,"y":2160,"wires":[["c9b13a0cb8d5fa9e"]]},{"id":"c9b13a0cb8d5fa9e","type":"xml","z":"ad8c570ec4ac394a","name":"","property":"payload","attr":"","chr":"","x":1190,"y":2160,"wires":[["883df9e4fec82592"]]},{"id":"11f7f07f06a3100b","type":"debug","z":"ad8c570ec4ac394a","name":"debug 187","active":true,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","targetType":"full","statusVal":"","statusType":"msg","x":1890,"y":2160,"wires":[]},{"id":"883df9e4fec82592","type":"function","z":"ad8c570ec4ac394a","name":"Extract Artist for API call to Lidarr","func":"var id = msg.payload.metadata[\"artist-list\"][0].artist[0].$.id;\nvar url = \"http://192.168.0.20:8686/api/v1/artist\";\nvar name = msg.payload.metadata[\"artist-list\"][0].artist[0].name[0];\n\nvar msg = {\n     \"url\": url,\n     \"payload\": {\n          \"ArtistName\": name,\n          \"Path\": \"/media/Music/\" + name,\n          \"rootFolderPath\": \"/media/Music\",\n          \"ForeignArtistId\": id,\n          \"QualityProfileId\": \"1\",\n          \"MetadataProfileId\": \"1\",\n          \"Monitored\": true\n     }\n\n};\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1440,"y":2160,"wires":[["52e7d05571c3a468"]]},{"id":"52e7d05571c3a468","type":"http request","z":"ad8c570ec4ac394a","name":"","method":"POST","ret":"txt","paytoqs":"body","url":"","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"bearer","senderr":false,"headers":[],"x":1690,"y":2160,"wires":[["11f7f07f06a3100b"]]},{"id":"6da15ed217dbdf18","type":"comment","z":"ad8c570ec4ac394a","name":"Check LV TV  for playback","info":"","x":110,"y":2120,"wires":[]},{"id":"e1becd8d910fb35e","type":"comment","z":"ad8c570ec4ac394a","name":"Extract Artist for musicbrainz Querry to get the ID","info":"","x":700,"y":2120,"wires":[]},{"id":"6f25be8013cce348","type":"comment","z":"ad8c570ec4ac394a","name":"Get musicbrainz ","info":"","x":980,"y":2120,"wires":[]},{"id":"ccdd79fcfecdcdbb","type":"comment","z":"ad8c570ec4ac394a","name":"Convert to XML","info":"","x":1200,"y":2120,"wires":[]},{"id":"61f7ccb6633e9168","type":"comment","z":"ad8c570ec4ac394a","name":"Extract data for Lidarr callback","info":"","x":1460,"y":2120,"wires":[]},{"id":"c5baf31ad785840e","type":"comment","z":"ad8c570ec4ac394a","name":"Add to Lidarr","info":"","x":1690,"y":2120,"wires":[]},{"id":"c0cf1ab032bfe32e","type":"delay","z":"ad8c570ec4ac394a","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"10","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"allowrate":false,"outputs":1,"x":440,"y":2160,"wires":[["f8f5bf9b0d30c346"]]},{"id":"0c7f235a22cad221","type":"server-state-changed","z":"ad8c570ec4ac394a","name":"Living Room TV","server":"209ff8ef.59a5d8","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"media_player.livingroom_chromecast","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"playing","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"10","forType":"num","forUnits":"seconds","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":80,"y":2160,"wires":[["124401ce5fc13749"],[]]},{"id":"124401ce5fc13749","type":"switch","z":"ad8c570ec4ac394a","name":"Music?","property":"data.new_state.attributes.media_content_type","propertyType":"msg","rules":[{"t":"eq","v":"music","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":260,"y":2160,"wires":[["c0cf1ab032bfe32e"]]},{"id":"e5080b410dc4f987","type":"comment","z":"ad8c570ec4ac394a","name":"Confirm music is playing","info":"","x":370,"y":2120,"wires":[]},{"id":"7b4efdf6248d3f12","type":"server-state-changed","z":"3ad1e0957e6ec22e","name":"Users home?","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.user_home","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":70,"y":140,"wires":[["c567a425829271f3"],["6372d64da4e99c42"]]},{"id":"581fd4c7ce035d72","type":"api-call-service","z":"3ad1e0957e6ec22e","name":"Set ACs to away preset","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"climate","service":"set_preset_mode","areaId":[],"deviceId":[],"entityId":["climate.bedroom_ac","climate.hotbox_ac","climate.living_room_ac"],"data":"{\"preset_mode\":\"away\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":490,"y":180,"wires":[[]]},{"id":"2f2e8679067c06af","type":"api-call-service","z":"3ad1e0957e6ec22e","name":"Set ACs to default preset","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"climate","service":"set_preset_mode","areaId":[],"deviceId":[],"entityId":["climate.bedroom_ac","climate.hotbox_ac","climate.living_room_ac"],"data":"{\"preset_mode\":\"none\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":490,"y":100,"wires":[[]]},{"id":"1d937417c8d9abd4","type":"comment","z":"3ad1e0957e6ec22e","name":"Users Present","info":"","x":270,"y":100,"wires":[]},{"id":"2d9503bf28e52235","type":"comment","z":"3ad1e0957e6ec22e","name":"Users Absent","info":"","x":270,"y":180,"wires":[]},{"id":"dc77e0dfbe02d815","type":"comment","z":"3ad1e0957e6ec22e","name":"Climate Control","info":"","x":80,"y":100,"wires":[]},{"id":"0875f44675896e1d","type":"server-state-changed","z":"3ad1e0957e6ec22e","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.user_home","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":180,"y":400,"wires":[["2acfef875f2fd481"],["2acfef875f2fd481"]]},{"id":"8ec001eb82986115","type":"api-call-service","z":"3ad1e0957e6ec22e","name":"Arm Alarm Away","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"alarm_control_panel","service":"alarm_arm_away","areaId":[],"deviceId":[],"entityId":["alarm_control_panel.home_alarm"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":680,"y":400,"wires":[[]]},{"id":"2acfef875f2fd481","type":"trigger","z":"3ad1e0957e6ec22e","name":"Trigger 10min","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"10","extend":false,"overrideDelay":false,"units":"min","reset":"on","bytopic":"all","topic":"topic","outputs":1,"x":460,"y":400,"wires":[["8ec001eb82986115"]]},{"id":"56cf47b1dc1aa315","type":"comment","z":"3ad1e0957e6ec22e","name":"Turning on the alarm system","info":"","x":120,"y":360,"wires":[]},{"id":"62547a2f44519122","type":"comment","z":"3ad1e0957e6ec22e","name":"Wait 10 minutes before arming","info":"","x":400,"y":360,"wires":[]},{"id":"6e924c7d8c6a9def","type":"comment","z":"3ad1e0957e6ec22e","name":"Cancel if Users are detected","info":"","x":640,"y":360,"wires":[]},{"id":"5d19ca682dd18d58","type":"function","z":"3ad1e0957e6ec22e","name":"Volume selector","func":"var d = new Date();\nvar h = d.getHours();\n\nif (h > 22){\n    var volume = \"0.25\";\n}\nelse if (h >= 0 && h <= 2 ){\n    var volume = \"0.20\";\n}\nelse if (h > 2 && h<8){\n    var volume = \"0.10\";\n}\nelse if (h >= 8 && h<9){\n    var volume = \"0.15\";\n}\nelse{\n    var volume = \"0.25\";\n}\nmsg=\n{\n    \"payload\":{\n        \"data\": {\n        \"entity_id\": msg.entity_id,\n        \"volume_level\": volume\n    }\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3020,"y":580,"wires":[["6805035056bd8cee","746db2d3a17c9283"]]},{"id":"2e0553a4becdcb11","type":"api-call-service","z":"3ad1e0957e6ec22e","name":"Set Volume","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_set","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":3490,"y":620,"wires":[["0b23c8da4d941767"]]},{"id":"76761c4f46f05454","type":"server-state-changed","z":"3ad1e0957e6ec22e","name":"Speaker turns to idle?","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"media_player.*[a-z]_speaker","entityidfiltertype":"regex","outputinitially":false,"state_type":"str","haltifstate":"(idle|buffering)","halt_if_type":"re","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"milliseconds","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":100,"y":740,"wires":[[],[]]},{"id":"7d44a2f1a57349f4","type":"api-current-state","z":"3ad1e0957e6ec22e","name":"Party mode is on?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.party_mode","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":2630,"y":620,"wires":[["e2670ef9a6f08eeb"],["1c819bd84e568a03"]]},{"id":"be293fd5728c4e6e","type":"function","z":"3ad1e0957e6ec22e","name":"Volume selector","func":"var d = new Date();\nvar h = d.getHours();\n\nif (h > 22){\n    var volume = \"0.30\";\n}\nelse if (h >= 0 && h <= 2 ){\n    var volume = \"0.25\";\n}\nelse if (h > 2 && h<8){\n    var volume = \"0.20\";\n}\nelse if (h >= 8 && h<9){\n    var volume = \"0.15\";\n}\nelse{\n    var volume = \"0.30\";\n}\nmsg=\n{\n    \"payload\":{\n        \"data\": {\n        \"entity_id\": msg.entity_id,\n        \"volume_level\": volume\n    }\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3020,"y":660,"wires":[["a8bbac8ba01b6fd2"]]},{"id":"7e1267bdebb2527b","type":"comment","z":"3ad1e0957e6ec22e","name":"Ajust speaker volume on playback","info":"","x":140,"y":580,"wires":[]},{"id":"bc31a5f6cf2212cb","type":"comment","z":"3ad1e0957e6ec22e","name":"Was the speaker off previously?","info":"","x":430,"y":660,"wires":[]},{"id":"03a149d630e77b4c","type":"comment","z":"3ad1e0957e6ec22e","name":"Ignore the bathroom speaker","info":"","x":660,"y":580,"wires":[]},{"id":"6d4cd6f1412c1764","type":"comment","z":"3ad1e0957e6ec22e","name":"Is there a party?","info":"","x":2640,"y":580,"wires":[]},{"id":"b2ce23e38d7103c9","type":"comment","z":"3ad1e0957e6ec22e","name":"No","info":"","x":2850,"y":580,"wires":[]},{"id":"fc5f8b361b9c6939","type":"comment","z":"3ad1e0957e6ec22e","name":"Yes","info":"","x":2850,"y":660,"wires":[]},{"id":"dc50f62af3da8b31","type":"comment","z":"3ad1e0957e6ec22e","name":"Softer volume at night","info":"","x":3220,"y":660,"wires":[]},{"id":"c6ba29f30891bd72","type":"comment","z":"3ad1e0957e6ec22e","name":"Higher volume at night","info":"","x":3220,"y":580,"wires":[]},{"id":"19c80bba7d0c9f80","type":"server-state-changed","z":"3ad1e0957e6ec22e","name":"Speaker turns to \"paused\"?","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"media_player.*[a-z]_speaker$","entityidfiltertype":"regex","outputinitially":false,"state_type":"str","haltifstate":"paused","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":170,"y":1180,"wires":[["5b05cae4ba55b8ee"],["6a044c93caf39482"]]},{"id":"396372437be8b774","type":"api-call-service","z":"3ad1e0957e6ec22e","name":"stop speaker","server":"7ab5c227.a3ce8c","version":5,"debugenabled":true,"domain":"media_player","service":"turn_off","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1290,"y":1180,"wires":[[]]},{"id":"adc9dfdbe4ca7285","type":"trigger","z":"3ad1e0957e6ec22e","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"10","extend":false,"overrideDelay":false,"units":"min","reset":"playing","bytopic":"topic","topic":"topic","outputs":1,"x":730,"y":1180,"wires":[["dc2f1a0b7c70824c"]]},{"id":"dc2f1a0b7c70824c","type":"function","z":"3ad1e0957e6ec22e","name":"Extract Entity ID","func":"msg=\n{\n    \"payload\":{\n        \"data\": {\n        \"entity_id\": msg.data.entity_id\n    }\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1080,"y":1180,"wires":[["396372437be8b774"]]},{"id":"a6fcdbbbdc0c3ada","type":"comment","z":"3ad1e0957e6ec22e","name":"Stop speaker playback after 10 minutes of pause","info":"","x":240,"y":1140,"wires":[]},{"id":"d45a1ecac538e304","type":"comment","z":"3ad1e0957e6ec22e","name":"Wait 10 minutes before continuing","info":"","x":740,"y":1140,"wires":[]},{"id":"2f3dc984afa8ff41","type":"comment","z":"3ad1e0957e6ec22e","name":"Cancel if playback is detected","info":"","x":720,"y":1220,"wires":[]},{"id":"6314b4028ff2f67d","type":"comment","z":"3ad1e0957e6ec22e","name":"Set the Entity ID for the stop service","info":"","x":1080,"y":1220,"wires":[]},{"id":"5086283593d40356","type":"server-state-changed","z":"3ad1e0957e6ec22e","name":"ready to pick up","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.seventeentrack_packages_ready_to_be_picked_up","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":120,"y":1020,"wires":[["3cd8c77c316c5c93"]]},{"id":"3cd8c77c316c5c93","type":"switch","z":"3ad1e0957e6ec22e","name":"Packages > 0?","property":"payload","propertyType":"msg","rules":[{"t":"gt","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":640,"y":1020,"wires":[["f98de588c39d7f10","cfb270cb9831f219"]]},{"id":"f98de588c39d7f10","type":"change","z":"3ad1e0957e6ec22e","name":"Set Alert","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"message","pt":"msg","to":"A package is out for delivery","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":860,"y":1020,"wires":[["9cb597036711d325"]]},{"id":"83017b417ed43ef0","type":"server-state-changed","z":"3ad1e0957e6ec22e","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.seventeentrack_packages_delivered","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":1480,"y":1020,"wires":[["63b187a23e477005"]]},{"id":"63b187a23e477005","type":"switch","z":"3ad1e0957e6ec22e","name":"Packages > 0?","property":"payload","propertyType":"msg","rules":[{"t":"gt","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":1860,"y":1020,"wires":[["a7cc57ac03e9a424","cd15b6f1ce2e732a"]]},{"id":"a7cc57ac03e9a424","type":"change","z":"3ad1e0957e6ec22e","name":"Set alert","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"message","pt":"msg","to":"A package has been delivered","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2080,"y":1020,"wires":[["b4f174eee8ca2dab"]]},{"id":"588375d3bad43210","type":"api-call-service","z":"3ad1e0957e6ec22e","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"notify","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2280,"y":980,"wires":[[]]},{"id":"cd15b6f1ce2e732a","type":"function","z":"3ad1e0957e6ec22e","name":"Javascript","func":"var newMsg = {\n    \"payload\": {\n        \"data\": {\n            \"message\": \"A Package has been delivered\",\n            \"title\": \"Package Alert\"\n}\n        }\n    }\n;\nreturn newMsg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2080,"y":980,"wires":[["588375d3bad43210"]]},{"id":"1c766c3e3dada870","type":"api-call-service","z":"3ad1e0957e6ec22e","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"notify","service":"notify","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1060,"y":980,"wires":[[]]},{"id":"cfb270cb9831f219","type":"function","z":"3ad1e0957e6ec22e","name":"Javascript","func":"var newMsg = {\n    \"payload\": {\n        \"data\": {\n            \"message\": \"A Package is out for delivery\",\n            \"title\": \"Package Alert\"\n}\n        }\n    }\n;\nreturn newMsg;","outputs":1,"noerr":0,"x":860,"y":980,"wires":[["1c766c3e3dada870"]]},{"id":"755615d7f2e33edf","type":"comment","z":"3ad1e0957e6ec22e","name":"Notify and Broadcast an alert about delivered packages","info":"","x":1460,"y":980,"wires":[]},{"id":"4ca0d0580ac05047","type":"comment","z":"3ad1e0957e6ec22e","name":"Amount of delivered packages?","info":"","x":1850,"y":1060,"wires":[]},{"id":"ff97fa9fb8de9652","type":"comment","z":"3ad1e0957e6ec22e","name":"Set Alert Data","info":"","x":2070,"y":1060,"wires":[]},{"id":"6031403bd7dbc730","type":"comment","z":"3ad1e0957e6ec22e","name":"Notify and Broadcast an alert about out ofr delivery packages","info":"","x":260,"y":980,"wires":[]},{"id":"6754f428c6e81354","type":"comment","z":"3ad1e0957e6ec22e","name":"Set Alert Data","info":"","x":850,"y":1060,"wires":[]},{"id":"092dd69960de583a","type":"comment","z":"3ad1e0957e6ec22e","name":"Amount of delivered packages?","info":"","x":630,"y":1060,"wires":[]},{"id":"e0b5c8fe82883f4b","type":"comment","z":"3ad1e0957e6ec22e","name":"Set Notification Data","info":"","x":2090,"y":940,"wires":[]},{"id":"871a14c154ef1678","type":"comment","z":"3ad1e0957e6ec22e","name":"Set Notification Data","info":"","x":870,"y":940,"wires":[]},{"id":"af0044ecc62ca32e","type":"comment","z":"3ad1e0957e6ec22e","name":"Send notification","info":"","x":2280,"y":940,"wires":[]},{"id":"32b45bba10657c70","type":"comment","z":"3ad1e0957e6ec22e","name":"Send notification","info":"","x":1060,"y":940,"wires":[]},{"id":"a2fc67ccfef493b7","type":"server-state-changed","z":"3ad1e0957e6ec22e","name":"Users home?","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.user_home","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":70,"y":280,"wires":[["fc518af82d06d8bc"],[]]},{"id":"5e73e5e7fc269891","type":"api-call-service","z":"3ad1e0957e6ec22e","name":"Turn off all lights","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.all_lights"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":260,"y":280,"wires":[[]]},{"id":"79fdce988cf0e215","type":"comment","z":"3ad1e0957e6ec22e","name":"Turn all lights off","info":"","x":260,"y":240,"wires":[]},{"id":"f237035cc1c80e4f","type":"comment","z":"3ad1e0957e6ec22e","name":"Auto lights off","info":"","x":70,"y":240,"wires":[]},{"id":"b37f6bb701ea2f7f","type":"server-state-changed","z":"3ad1e0957e6ec22e","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"media_player.*[a-z]_speaker","entityidfiltertype":"regex","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":170,"y":1640,"wires":[["de7dce105cf7f3a8"],["de7dce105cf7f3a8"]]},{"id":"de7dce105cf7f3a8","type":"trigger","z":"3ad1e0957e6ec22e","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"10","extend":false,"overrideDelay":false,"units":"min","reset":"playing","bytopic":"topic","topic":"topic","outputs":1,"x":490,"y":1640,"wires":[["5265d9ac70acf687"]]},{"id":"5265d9ac70acf687","type":"function","z":"3ad1e0957e6ec22e","name":"extractor","func":"msg=\n{\n    \"payload\":{\n        \"data\": {\n        \"entity_id\": msg.data.entity_id\n    }\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":720,"y":1640,"wires":[["0f3d41858db3388b"]]},{"id":"4e06dce71799c7c3","type":"comment","z":"3ad1e0957e6ec22e","name":"Detect all mini player ending with speaker","info":"","x":160,"y":1600,"wires":[]},{"id":"3721b5e09fcc952a","type":"comment","z":"3ad1e0957e6ec22e","name":"Wait 10 minutes before continuing","info":"","x":500,"y":1600,"wires":[]},{"id":"0f3d41858db3388b","type":"api-call-service","z":"3ad1e0957e6ec22e","name":"Set Volume to 20%","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_set","areaId":[],"deviceId":[],"entityId":[],"data":"{\"volume_level\":\"0.2\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":990,"y":1640,"wires":[[]]},{"id":"13f5e36603376bbf","type":"comment","z":"3ad1e0957e6ec22e","name":"Extract Entity","info":"","x":730,"y":1600,"wires":[]},{"id":"9077d68fcb4c76ea","type":"comment","z":"3ad1e0957e6ec22e","name":"Set volume to 20%","info":"","x":990,"y":1600,"wires":[]},{"id":"03eeba825e7db7c0","type":"server-state-changed","z":"3ad1e0957e6ec22e","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"media_player\\.plex_[a-z_]*_chromecast","entityidfiltertype":"regex","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":300,"y":1400,"wires":[["c6dc078aa2c91492"]]},{"id":"52b3870c20250d7e","type":"switch","z":"3ad1e0957e6ec22e","name":"Visuals?","property":"data.new_state.attributes.media_library_title","propertyType":"msg","rules":[{"t":"eq","v":"Visuals","vt":"str"},{"t":"neq","v":"Visuals","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":900,"y":1400,"wires":[["b1880ea06e93f832"],["2792555ece4458cd"]]},{"id":"cad47fe6566c23a7","type":"switch","z":"3ad1e0957e6ec22e","name":"playing?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"playing","vt":"str"},{"t":"neq","v":"playing","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1160,"y":1360,"wires":[["62cf47fb999346aa"],["bb71b092d9c74860"]]},{"id":"dfbcd81831907951","type":"function","z":"3ad1e0957e6ec22e","name":"Extract Player from Plex player","func":"var player = msg.data.new_state.entity_id;\nvar playersplit = player.replace(\"plex_\",\"\")\n\nmsg=\n{\n    \"payload\":{\n        \"data\": {\n        \"entity_id\": playersplit\n    }\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1570,"y":1320,"wires":[["8f3820173d5a9601"]]},{"id":"afec6aacb9655c5b","type":"api-call-service","z":"3ad1e0957e6ec22e","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_set","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1790,"y":1400,"wires":[[]]},{"id":"37b0a3e74ec0ba37","type":"switch","z":"3ad1e0957e6ec22e","name":"playing?","property":"payload","propertyType":"msg","rules":[{"t":"regex","v":"(playing|paused)","vt":"str","case":true}],"checkall":"true","repair":false,"outputs":1,"x":1320,"y":1440,"wires":[["46d3285b345e72df"]]},{"id":"a25d3f0c73d9050d","type":"function","z":"3ad1e0957e6ec22e","name":"Time + Entity","func":"var d = new Date();\nvar h = d.getHours();\nvar player = msg.data.new_state.entity_id;\nvar playersplit = player.replace(\"plex_\",\"\")\n\nif (h > 22){\n    var volume = \"0.85\";\n}\nelse if (h >= 0 && h <= 2 ){\n    var volume = \"0.50\";\n}\nelse if (h > 2 && h<8){\n    var volume = \"0.40\";\n}\nelse if (h >= 8 && h<9){\n    var volume = \"0.75\";\n}\nelse{\n    var volume = \"0.95\";\n}\nmsg=\n{\n    \"payload\":{\n        \"data\": {\n        \"entity_id\": playersplit,\n        \"volume_level\": volume\n    }\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1510,"y":1400,"wires":[["ac09ae6273c851a3"]]},{"id":"3996bd2645bd3ea2","type":"switch","z":"3ad1e0957e6ec22e","name":"was off?","property":"data.old_state.state","propertyType":"msg","rules":[{"t":"eq","v":"unavailable","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1180,"y":1440,"wires":[["37b0a3e74ec0ba37"]]},{"id":"33dbc80daf4a4318","type":"comment","z":"3ad1e0957e6ec22e","name":"Detect all plex player ending with chromecast","info":"","x":270,"y":1360,"wires":[]},{"id":"a4490797618f2afb","type":"comment","z":"3ad1e0957e6ec22e","name":"These two JS extract the Chromecast name from the plex name","info":"","x":1490,"y":1360,"wires":[]},{"id":"038270b1b4b56fdb","type":"comment","z":"3ad1e0957e6ec22e","name":"Is it playing or else?","info":"","x":1170,"y":1320,"wires":[]},{"id":"4b8ac747afd9a695","type":"comment","z":"3ad1e0957e6ec22e","name":"Was the previous state off?","info":"","x":1190,"y":1480,"wires":[]},{"id":"5faef84dcf6b6b7b","type":"comment","z":"3ad1e0957e6ec22e","name":"Is the content from the Visuals library?","info":"","x":890,"y":1360,"wires":[]},{"id":"d12627b175e4cba5","type":"comment","z":"3ad1e0957e6ec22e","name":"Is it playing or pause?","info":"","x":1280,"y":1400,"wires":[]},{"id":"c6dc078aa2c91492","type":"switch","z":"3ad1e0957e6ec22e","name":"Chromecast  is not muted","property":"data.new_state.attributes.is_volume_muted","propertyType":"msg","rules":[{"t":"neq","v":"true","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":650,"y":1400,"wires":[["52b3870c20250d7e"]]},{"id":"6887f624ce6cbd9c","type":"comment","z":"3ad1e0957e6ec22e","name":"Chromecast is not muted?","info":"","x":650,"y":1440,"wires":[]},{"id":"dd6d7ede80c7da5b","type":"change","z":"3ad1e0957e6ec22e","name":"Set reset","rules":[{"t":"set","p":"reset","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":500,"y":1200,"wires":[["adc9dfdbe4ca7285"]]},{"id":"6a044c93caf39482","type":"switch","z":"3ad1e0957e6ec22e","name":"Playing?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"playing","vt":"str"},{"t":"eq","v":"idle","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":360,"y":1200,"wires":[["dd6d7ede80c7da5b"],["dd6d7ede80c7da5b"]]},{"id":"80ca7e4e59dae561","type":"comment","z":"3ad1e0957e6ec22e","name":"Set reset to true if playing/idle","info":"","x":420,"y":1240,"wires":[]},{"id":"9cb597036711d325","type":"subflow:233ac7dcd801a802","z":"3ad1e0957e6ec22e","name":"","x":1070,"y":1020,"wires":[]},{"id":"b4f174eee8ca2dab","type":"subflow:233ac7dcd801a802","z":"3ad1e0957e6ec22e","name":"","x":2270,"y":1020,"wires":[]},{"id":"746db2d3a17c9283","type":"debug","z":"3ad1e0957e6ec22e","name":"debug 8","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3040,"y":460,"wires":[]},{"id":"4049d7ea688e5999","type":"trigger-state","z":"3ad1e0957e6ec22e","name":"","server":"7ab5c227.a3ce8c","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"^binary_sensor\\.(?!.*?bedroom.*?)(?!.*?closet.*?)(?!.*?office.*?)sensor_.*_occupancy$","entityidfiltertype":"regex","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on","propertyValue":"new_state.state"},{"targetType":"this_entity","targetValue":"","propertyType":"previous_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off","propertyValue":"old_state.state"}],"inputs":0,"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","enableInput":false,"x":360,"y":1920,"wires":[["ee9e766f8f53369d"],[]]},{"id":"ee9e766f8f53369d","type":"function","z":"3ad1e0957e6ec22e","name":"Extract room from motion sensor entity an extract off lights to regex","func":"var motion_entity_id = msg.data.event.new_state.entity_id; // binary_sensor.sensor_bedroom_motion_occupancy\nvar motion_entity_id_split = motion_entity_id.split(\".\");// split on the dot to separate domain and entity\nvar motion_entity_id_wihtout_binary = motion_entity_id_split[1].replace(\"sensor_\", \"\").replace(\"_motion\", \"\").replace(\"_fp1\", \"\").replace(\"_presence\", \"\").replace(\"_occupancy\", \"\").replace(\"_entry\", \"\").replace(\"_exit\", \"\");// remove sensor_ and more substrings\nvar regex = \"^light\\\\.(?!.*?group.*?)(?!.*?notification.*?)(?!.*?lights.*?).*\" + motion_entity_id_wihtout_binary + \".*\"; \nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': regex ,  'valueType': 're' },{ 'property': 'state' ,  'logic': 'is_not' , 'value': \"on\" ,  'valueType': 'str' }];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object},\"room\": motion_entity_id_wihtout_binary\n\n}\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":960,"y":1920,"wires":[["848b2a1d24e34dda"]]},{"id":"848b2a1d24e34dda","type":"ha-get-entities","z":"3ad1e0957e6ec22e","name":"Get entities","server":"7ab5c227.a3ce8c","version":0,"rules":[],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload.results","output_results_count":1,"x":1330,"y":1920,"wires":[["163ecddc5fc7bee3"]]},{"id":"e0970f0b1ecebfd3","type":"function","z":"3ad1e0957e6ec22e","name":"Brightness selector","func":"var d = new Date();\nvar h = d.getHours();\n\nif (h > 22){\n    var brightness_percentage = \"95\";\n}\nelse if (h >= 0 && h <= 2 ){\n    var brightness_percentage = \"85\";\n}\nelse if (h > 2 && h<8){\n    var brightness_percentage = \"60\";\n}\nelse if (h >= 8 && h<9){\n    var brightness_percentage = \"70\";\n}\nelse{\n    var brightness_percentage = \"100\";\n}\nmsg=\n{\n    \"payload\":{\n        \"data\": {\n        \"entity_id\": msg.payload.entity_id,\n        \"brightness_pct\": brightness_percentage,\n        \"color_name\":  \"white\"\n    }\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3850,"y":1900,"wires":[["386c9a340f0f46e2"]]},{"id":"386c9a340f0f46e2","type":"api-call-service","z":"3ad1e0957e6ec22e","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4170,"y":1900,"wires":[[]]},{"id":"275ed39b36b16c36","type":"function","z":"3ad1e0957e6ec22e","name":"Extract room from sleeper sensor entity","func":"var room = msg.room\nvar regex = \"sleeper_in_\" + room; \nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': regex ,  'valueType': 're' },{ 'property': 'state' ,  'logic': 'is' , 'value': \"on\" ,  'valueType': 'str' }];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object},\n    \"entity\": msg.entity\n\n}\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1900,"y":1920,"wires":[["b0b9957822ff494a"]]},{"id":"b0b9957822ff494a","type":"ha-get-entities","z":"3ad1e0957e6ec22e","name":"Get entities","server":"7ab5c227.a3ce8c","version":0,"rules":[],"output_type":"array","output_empty_results":true,"output_location_type":"msg","output_location":"payload.results","output_results_count":1,"x":2210,"y":1920,"wires":[["e6806ef89c5f75b0"]]},{"id":"163ecddc5fc7bee3","type":"change","z":"3ad1e0957e6ec22e","name":"rules","rules":[{"t":"move","p":"payload","pt":"msg","to":"entity","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1570,"y":1920,"wires":[["275ed39b36b16c36"]]},{"id":"e6806ef89c5f75b0","type":"switch","z":"3ad1e0957e6ec22e","name":"","property":"payload.results","propertyType":"msg","rules":[{"t":"empty"}],"checkall":"true","repair":false,"outputs":1,"x":2530,"y":1920,"wires":[["00c58bef414f89da","c371cf447e1111df"]]},{"id":"b5bf8a875890d348","type":"trigger-state","z":"3ad1e0957e6ec22e","name":"","server":"7ab5c227.a3ce8c","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"^binary_sensor\\.(?!.*?bedroom.*?)(?!.*?office.*?)(?!.*?patio.*?)(?!.*?bathroom.*?).*_occupancy$","entityidfiltertype":"regex","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off","propertyValue":"new_state.state"},{"targetType":"entity_id","targetValue":"input_boolean.party_mode","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off","propertyValue":"new_state.state"},{"targetType":"entity_id","targetValue":"input_boolean.acid_time","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off","propertyValue":"new_state.state"},{"targetType":"entity_id","targetValue":"input_boolean.kink_party","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off","propertyValue":"new_state.state"}],"inputs":0,"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","enableInput":false,"x":390,"y":2080,"wires":[["b8f6b67ac5adc19d"],[]]},{"id":"86ae82e8c0617477","type":"comment","z":"3ad1e0957e6ec22e","name":"Detect motion across ocupancy sensors","info":"","x":170,"y":1880,"wires":[]},{"id":"ae02c611ff97c852","type":"comment","z":"3ad1e0957e6ec22e","name":"(Ignores \"Nate\",\"Bedroom\" and \"Dungeon\" sensors)","info":"","x":530,"y":1880,"wires":[]},{"id":"8d371488af329946","type":"comment","z":"3ad1e0957e6ec22e","name":"Generate the regex for the get entity node","info":"","x":960,"y":1880,"wires":[]},{"id":"316ca0017b3279e9","type":"comment","z":"3ad1e0957e6ec22e","name":"Get off light entities","info":"","x":1330,"y":1880,"wires":[]},{"id":"be624019d7ea0248","type":"comment","z":"3ad1e0957e6ec22e","name":"Move payload to entity","info":"","x":1560,"y":1880,"wires":[]},{"id":"37dfb4c4bbc27b89","type":"comment","z":"3ad1e0957e6ec22e","name":"Prepare regex to check if someone is sleeping in the room","info":"","x":1910,"y":1880,"wires":[]},{"id":"259de9b9194d60a4","type":"comment","z":"3ad1e0957e6ec22e","name":"Get sleeper entities in an array","info":"","x":2250,"y":1880,"wires":[]},{"id":"a80f258083452dfa","type":"comment","z":"3ad1e0957e6ec22e","name":"Make sure the array is empty","info":"","x":2520,"y":1880,"wires":[]},{"id":"900758f64c63b16a","type":"comment","z":"3ad1e0957e6ec22e","name":"Select color, brightness and set entity_id","info":"","x":3860,"y":1860,"wires":[]},{"id":"912fe586bb874838","type":"comment","z":"3ad1e0957e6ec22e","name":"Turn the lights on","info":"","x":4140,"y":1860,"wires":[]},{"id":"84c65edb9ad601cf","type":"comment","z":"3ad1e0957e6ec22e","name":"Detect no motion across ocupancy sensors","info":"","x":180,"y":2040,"wires":[]},{"id":"94186347dfaff946","type":"comment","z":"3ad1e0957e6ec22e","name":"(Ignores \"Nate\",\"Bedroom\" and \"Dungeon\" sensors)","info":"","x":530,"y":2040,"wires":[]},{"id":"13b3d4ea5b221ea4","type":"trigger-state","z":"3ad1e0957e6ec22e","name":"","server":"7ab5c227.a3ce8c","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"^binary_sensor\\.(?!.*?bedroom.*?)(?!.*?office.*?)(?!.*?patio.*?)(?!.*?bathroom.*?).*_occupancy$","entityidfiltertype":"regex","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on","propertyValue":"new_state.state"}],"inputs":0,"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","enableInput":false,"x":390,"y":2180,"wires":[["b8f6b67ac5adc19d"],[]]},{"id":"5901200f87196293","type":"comment","z":"3ad1e0957e6ec22e","name":"Detect motion across ocupancy sensors","info":"","x":170,"y":2140,"wires":[]},{"id":"afa6e5fd359976e7","type":"comment","z":"3ad1e0957e6ec22e","name":"(Ignores \"Nate\",\"Bedroom\" and \"Dungeon\" sensors)","info":"","x":530,"y":2140,"wires":[]},{"id":"b8f6b67ac5adc19d","type":"trigger","z":"3ad1e0957e6ec22e","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"7","extend":false,"overrideDelay":false,"units":"min","reset":"on","bytopic":"topic","topic":"topic","outputs":1,"x":930,"y":2080,"wires":[["f6bd0e7c3db3ad74"]]},{"id":"193ae7634d476f6c","type":"comment","z":"3ad1e0957e6ec22e","name":"7 minutes trigger before continuing","info":"","x":880,"y":2040,"wires":[]},{"id":"e47712f83178e21d","type":"api-current-state","z":"3ad1e0957e6ec22e","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.all_present_sleeping","state_type":"str","blockInputOverrides":true,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":3510,"y":1900,"wires":[["e0970f0b1ecebfd3"],["e0565cdb0b796f1c"]]},{"id":"e0565cdb0b796f1c","type":"function","z":"3ad1e0957e6ec22e","name":"Brightness selector","func":"var d = new Date();\nvar h = d.getHours();\n\nif (h > 22){\n    var brightness_percentage = \"45\";\n}\nelse if (h >= 0 && h <= 2 ){\n    var brightness_percentage = \"40\";\n}\nelse if (h > 2 && h<8){\n    var brightness_percentage = \"25\";\n}\nelse if (h >= 8 && h<9){\n    var brightness_percentage = \"35\";\n}\nelse{\n    var brightness_percentage = \"50\";\n}\nmsg=\n{\n    \"payload\":{\n        \"data\": {\n        \"entity_id\": msg.payload.entity_id,\n        \"brightness_pct\": brightness_percentage,\n        \"color_name\":  \"white\"\n    }\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3850,"y":1940,"wires":[["386c9a340f0f46e2"]]},{"id":"7c2f441880266182","type":"comment","z":"3ad1e0957e6ec22e","name":"Check if all are sleeping","info":"","x":3480,"y":1860,"wires":[]},{"id":"323614ff6d81d35d","type":"delay","z":"3ad1e0957e6ec22e","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":".5","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":2370,"y":620,"wires":[["7d44a2f1a57349f4"]]},{"id":"0b23c8da4d941767","type":"debug","z":"3ad1e0957e6ec22e","name":"debug 11","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3600,"y":520,"wires":[]},{"id":"d6d2da265f8d3154","type":"trigger-state","z":"3ad1e0957e6ec22e","name":"","server":"7ab5c227.a3ce8c","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"^media_player\\.plex_.*_chromecast$","entityidfiltertype":"regex","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"playing","propertyValue":"new_state.state"},{"targetType":"this_entity","targetValue":"","propertyType":"property","comparatorType":"is","comparatorValueDatatype":"bool","comparatorValue":"false","propertyValue":"new_state.attributes.is_volume_muted"},{"targetType":"this_entity","targetValue":"","propertyType":"property","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"Movies","propertyValue":"new_state.attributes.media_library_title"}],"inputs":0,"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","enableInput":false,"x":230,"y":3120,"wires":[["95d9d94377012bd2"],[]]},{"id":"95d9d94377012bd2","type":"function","z":"3ad1e0957e6ec22e","name":"Extract room from plex player to change lights","func":"var player = msg.data.entity_id;\nvar playersplit = player.replace(\"media_player.plex_\",\"\").replace(\"_chromecast\", \"\")\nvar regex = \"^light\\\\.(?!.*?group.*?)(?!.*?notification.*?)(?!.*?lights.*?).*\" + playersplit + \".*\"; \nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': regex ,  'valueType': 're' },{ 'property': 'state' ,  'logic': 'is' , 'value': \"on\" ,  'valueType': 'str' }];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object},\n    \"room\": playersplit\n\n}\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":700,"y":3120,"wires":[["38ceb4f54d67f3af"]]},{"id":"919bb661879e6f4b","type":"function","z":"3ad1e0957e6ec22e","name":"Brightness selector","func":"msg=\n{\n    \"payload\":{\n        \"data\": {\n        \"entity_id\": msg.entity.entity_id,\n        \"brightness_pct\": 45,\n        \"color_name\":  \"purple\"\n    }\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1890,"y":3120,"wires":[["74bb11214582b1cb"]]},{"id":"74bb11214582b1cb","type":"api-call-service","z":"3ad1e0957e6ec22e","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2190,"y":3120,"wires":[[]]},{"id":"a3b0595af2b1b9cb","type":"change","z":"3ad1e0957e6ec22e","name":"rules","rules":[{"t":"move","p":"payload","pt":"msg","to":"entity","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1550,"y":3120,"wires":[["919bb661879e6f4b"]]},{"id":"707b84bf5a382390","type":"comment","z":"3ad1e0957e6ec22e","name":"Generate the regex for the get entity node","info":"","x":680,"y":3080,"wires":[]},{"id":"2d570380e256ac08","type":"comment","z":"3ad1e0957e6ec22e","name":"Move payload to entity","info":"","x":1560,"y":3080,"wires":[]},{"id":"7d7cb0316c13ad57","type":"comment","z":"3ad1e0957e6ec22e","name":"Select color, brightness and set entity_id","info":"","x":1900,"y":3080,"wires":[]},{"id":"df5a869d83b8c12c","type":"comment","z":"3ad1e0957e6ec22e","name":"Turn the lights to purple 45%","info":"","x":2200,"y":3080,"wires":[]},{"id":"4856340ad3c325bc","type":"comment","z":"3ad1e0957e6ec22e","name":"Detect all movie playing plex player ending with chromecast","info":"","x":230,"y":3080,"wires":[]},{"id":"38ceb4f54d67f3af","type":"ha-get-entities","z":"3ad1e0957e6ec22e","name":"Get entities","server":"7ab5c227.a3ce8c","version":0,"rules":[],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload.results","output_results_count":1,"x":1010,"y":3120,"wires":[["9607bbc9456c0ee6"]]},{"id":"9607bbc9456c0ee6","type":"switch","z":"3ad1e0957e6ec22e","name":"Individual lights?","property":"payload.attributes.entity_id","propertyType":"msg","rules":[{"t":"null"}],"checkall":"true","repair":false,"outputs":1,"x":1230,"y":3120,"wires":[["a3b0595af2b1b9cb"]]},{"id":"67a425b07536b5ce","type":"trigger-state","z":"3ad1e0957e6ec22e","name":"","server":"7ab5c227.a3ce8c","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"^media_player\\.plex_.*_chromecast$","entityidfiltertype":"regex","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"unavailable","propertyValue":"new_state.state"},{"targetType":"this_entity","targetValue":"","propertyType":"property","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"Movies","propertyValue":"old_state.attributes.media_library_title"}],"inputs":0,"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","enableInput":false,"x":230,"y":3420,"wires":[["5a165f257ae36251"],[]]},{"id":"5a165f257ae36251","type":"function","z":"3ad1e0957e6ec22e","name":"Extract room from plex player to change lights","func":"var player = msg.data.entity_id;\nvar playersplit = player.replace(\"media_player.plex_\",\"\").replace(\"_chromecast\", \"\")\nvar regex = \"^light\\\\.(?!.*?group.*?)(?!.*?notification.*?)(?!.*?lights.*?).*\" + playersplit + \".*\"; \nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': regex ,  'valueType': 're' },{ 'property': 'state' ,  'logic': 'is' , 'value': \"on\" ,  'valueType': 'str' }];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object}\n\n}\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":700,"y":3420,"wires":[["3968c7ad65e230c1"]]},{"id":"82a0398c29f50d7c","type":"function","z":"3ad1e0957e6ec22e","name":"Brightness selector","func":"msg=\n{\n    \"payload\":{\n        \"data\": {\n        \"entity_id\": msg.entity.entity_id,\n        \"brightness_pct\": 95,\n        \"color_name\":  \"white\",\n        \"transition\": 5\n    }\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1870,"y":3420,"wires":[["799858f321dfba0e"]]},{"id":"799858f321dfba0e","type":"api-call-service","z":"3ad1e0957e6ec22e","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2170,"y":3420,"wires":[[]]},{"id":"c58046c1e9b52415","type":"change","z":"3ad1e0957e6ec22e","name":"rules","rules":[{"t":"move","p":"payload","pt":"msg","to":"entity","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1550,"y":3420,"wires":[["82a0398c29f50d7c"]]},{"id":"4b216e883ec2be7f","type":"comment","z":"3ad1e0957e6ec22e","name":"Generate the regex for the get entity node","info":"","x":680,"y":3380,"wires":[]},{"id":"cf1a3437b5c43de1","type":"comment","z":"3ad1e0957e6ec22e","name":"Move payload to entity","info":"","x":1540,"y":3380,"wires":[]},{"id":"c2cd3e4cc9e9d001","type":"comment","z":"3ad1e0957e6ec22e","name":"Select color, brightness and set entity_id","info":"","x":1880,"y":3380,"wires":[]},{"id":"c39914167a65397b","type":"comment","z":"3ad1e0957e6ec22e","name":"Turnthe lights to white","info":"","x":2180,"y":3380,"wires":[]},{"id":"29edd6febb7fcab5","type":"comment","z":"3ad1e0957e6ec22e","name":"Detect all movie stopping plex player ending with chromecast","info":"","x":240,"y":3380,"wires":[]},{"id":"3968c7ad65e230c1","type":"ha-get-entities","z":"3ad1e0957e6ec22e","name":"Get entities","server":"7ab5c227.a3ce8c","version":0,"rules":[],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload.results","output_results_count":1,"x":1010,"y":3420,"wires":[["0a6879fb44a347ba"]]},{"id":"0a6879fb44a347ba","type":"switch","z":"3ad1e0957e6ec22e","name":"Individual lights?","property":"payload.attributes.entity_id","propertyType":"msg","rules":[{"t":"null"}],"checkall":"true","repair":false,"outputs":1,"x":1230,"y":3420,"wires":[["c58046c1e9b52415"]]},{"id":"308e19234d566940","type":"trigger-state","z":"3ad1e0957e6ec22e","name":"","server":"7ab5c227.a3ce8c","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"^media_player\\.plex_.*_chromecast$","entityidfiltertype":"regex","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"paused","propertyValue":"new_state.state"},{"targetType":"this_entity","targetValue":"","propertyType":"property","comparatorType":"is","comparatorValueDatatype":"bool","comparatorValue":"false","propertyValue":"new_state.attributes.is_volume_muted"},{"targetType":"this_entity","targetValue":"","propertyType":"property","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"Movies","propertyValue":"new_state.attributes.media_library_title"}],"inputs":0,"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","enableInput":false,"x":230,"y":3280,"wires":[["2cea68a62f282814"],[]]},{"id":"2cea68a62f282814","type":"function","z":"3ad1e0957e6ec22e","name":"Extract room from plex player to change lights","func":"var player = msg.data.entity_id;\nvar playersplit = player.replace(\"media_player.plex_\",\"\").replace(\"_chromecast\", \"\")\nvar regex = \"^light\\\\.(?!.*?group.*?)(?!.*?notification.*?)(?!.*?lights.*?).*\" + playersplit + \".*\"; \nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': regex ,  'valueType': 're' },{ 'property': 'state' ,  'logic': 'is' , 'value': \"on\" ,  'valueType': 'str' }];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object}\n\n}\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":700,"y":3280,"wires":[["e8b063abfb89d60d"]]},{"id":"bc443df7ca56b978","type":"function","z":"3ad1e0957e6ec22e","name":"Brightness selector","func":"msg=\n{\n    \"payload\":{\n        \"data\": {\n        \"entity_id\": msg.entity.entity_id,\n        \"brightness_pct\": 75,\n        \"color_name\":  \"purple\"\n    }\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1890,"y":3280,"wires":[["1f0a2ff364ce58b4"]]},{"id":"1f0a2ff364ce58b4","type":"api-call-service","z":"3ad1e0957e6ec22e","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2190,"y":3280,"wires":[[]]},{"id":"1424c881c8f090f0","type":"change","z":"3ad1e0957e6ec22e","name":"rules","rules":[{"t":"move","p":"payload","pt":"msg","to":"entity","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1550,"y":3280,"wires":[["bc443df7ca56b978"]]},{"id":"19631caadd94dacd","type":"comment","z":"3ad1e0957e6ec22e","name":"Generate the regex for the get entity node","info":"","x":680,"y":3240,"wires":[]},{"id":"f8766b221eec8c2b","type":"comment","z":"3ad1e0957e6ec22e","name":"Move payload to entity","info":"","x":1560,"y":3240,"wires":[]},{"id":"1c32bcefaac7e754","type":"comment","z":"3ad1e0957e6ec22e","name":"Select color, brightness and set entity_id","info":"","x":1900,"y":3240,"wires":[]},{"id":"8892f41f2ad5d24b","type":"comment","z":"3ad1e0957e6ec22e","name":"Turnthe lights to purple 75%","info":"","x":2220,"y":3240,"wires":[]},{"id":"f4a21b49bbb499e2","type":"comment","z":"3ad1e0957e6ec22e","name":"Detect all movie paused plex player ending with chromecast","info":"","x":240,"y":3240,"wires":[]},{"id":"e8b063abfb89d60d","type":"ha-get-entities","z":"3ad1e0957e6ec22e","name":"Get entities","server":"7ab5c227.a3ce8c","version":0,"rules":[],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload.results","output_results_count":1,"x":1010,"y":3280,"wires":[["d4c2e7a35ab15fdf"]]},{"id":"d4c2e7a35ab15fdf","type":"switch","z":"3ad1e0957e6ec22e","name":"Individual lights?","property":"payload.attributes.entity_id","propertyType":"msg","rules":[{"t":"null"}],"checkall":"true","repair":false,"outputs":1,"x":1230,"y":3280,"wires":[["1424c881c8f090f0"]]},{"id":"9f66ceec73d6773d","type":"comment","z":"3ad1e0957e6ec22e","name":"Weed out light groups","info":"","x":1240,"y":3080,"wires":[]},{"id":"a0bc08923079df2e","type":"comment","z":"3ad1e0957e6ec22e","name":"Get lights ","info":"","x":1000,"y":3080,"wires":[]},{"id":"94a04177b1e74e69","type":"trigger-state","z":"3ad1e0957e6ec22e","name":"","server":"7ab5c227.a3ce8c","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"^media_player\\.plex_.*_chromecast$","entityidfiltertype":"regex","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"playing","propertyValue":"new_state.state"},{"targetType":"this_entity","targetValue":"","propertyType":"property","comparatorType":"is","comparatorValueDatatype":"bool","comparatorValue":"false","propertyValue":"new_state.attributes.is_volume_muted"},{"targetType":"this_entity","targetValue":"","propertyType":"property","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"Movies","propertyValue":"new_state.attributes.media_library_title"}],"inputs":0,"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","enableInput":false,"x":230,"y":2980,"wires":[["86b50ac9317bb003","ac19ca3db853593f"],["ac19ca3db853593f"]]},{"id":"86b50ac9317bb003","type":"function","z":"3ad1e0957e6ec22e","name":"Extract room from plex player to close cover","func":"var player = msg.data.entity_id;\nvar playersplit = player.replace(\"media_player.plex_\",\"\").replace(\"_chromecast\", \"\")\nvar regex = \"cover.cover_\" + playersplit + \"_blinds\"; \nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': regex ,  'valueType': 're' },{\"property\": \"attributes.position\",\"logic\": \"gt\",\"value\": \"26\",\"valueType\": \"num\"}];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object},\n    \"topic\": msg.topic\n\n}\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":670,"y":2980,"wires":[["089e6ab34e6eb2bd"]]},{"id":"8a78d302e5c23a03","type":"function","z":"3ad1e0957e6ec22e","name":"Entity Setter","func":"msg=\n{\n    \"payload\":{\n        \"data\": {\n        \"entity_id\": msg.entity.entity_id\n    },\n        \"topic\": msg.topic\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1550,"y":2980,"wires":[["20e9bfc56ed01272"]]},{"id":"20e9bfc56ed01272","type":"api-call-service","z":"3ad1e0957e6ec22e","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"cover","service":"set_cover_position","areaId":[],"deviceId":[],"entityId":[],"data":"{\"position\": 30}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1930,"y":2980,"wires":[[]]},{"id":"c6d6e957e0b707ab","type":"change","z":"3ad1e0957e6ec22e","name":"rules","rules":[{"t":"move","p":"payload","pt":"msg","to":"entity","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1310,"y":2980,"wires":[["8a78d302e5c23a03"]]},{"id":"b46cb226baf76263","type":"comment","z":"3ad1e0957e6ec22e","name":"Move payload to entity","info":"","x":1300,"y":2940,"wires":[]},{"id":"296d25f7b785f0ce","type":"comment","z":"3ad1e0957e6ec22e","name":"Set entity","info":"","x":1560,"y":2940,"wires":[]},{"id":"83a28914f1809033","type":"comment","z":"3ad1e0957e6ec22e","name":"Close the cover","info":"","x":1920,"y":2940,"wires":[]},{"id":"6e79f01c175a3362","type":"comment","z":"3ad1e0957e6ec22e","name":"Detect all movie playing plex player ending with chromecast","info":"","x":230,"y":2940,"wires":[]},{"id":"089e6ab34e6eb2bd","type":"ha-get-entities","z":"3ad1e0957e6ec22e","name":"Get entities","server":"7ab5c227.a3ce8c","version":0,"rules":[],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload.results","output_results_count":1,"x":990,"y":2980,"wires":[["c6d6e957e0b707ab"]]},{"id":"709cc00006f7c753","type":"comment","z":"3ad1e0957e6ec22e","name":"Detect all covers in the room over 26%","info":"","x":1010,"y":2940,"wires":[]},{"id":"2222952d1735574d","type":"comment","z":"3ad1e0957e6ec22e","name":"Generate the regex for the get entity node","info":"","x":680,"y":2940,"wires":[]},{"id":"75998c0375899879","type":"comment","z":"3ad1e0957e6ec22e","name":"Weed out light groups","info":"","x":1240,"y":3240,"wires":[]},{"id":"8e4a3049a2aeba1a","type":"comment","z":"3ad1e0957e6ec22e","name":"Weed out light groups","info":"","x":1240,"y":3380,"wires":[]},{"id":"9fb5d3ddd5a53ed7","type":"comment","z":"3ad1e0957e6ec22e","name":"Get lights ","info":"","x":1000,"y":3240,"wires":[]},{"id":"1bde4567bbb03062","type":"comment","z":"3ad1e0957e6ec22e","name":"Get lights ","info":"","x":1000,"y":3380,"wires":[]},{"id":"b6ef341c55c7f02f","type":"trigger-state","z":"3ad1e0957e6ec22e","name":"Playing chromecasts","server":"7ab5c227.a3ce8c","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"^media_player\\..*_chromecast$","entityidfiltertype":"regex","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"playing","propertyValue":"new_state.state"},{"targetType":"this_entity","targetValue":"","propertyType":"property","comparatorType":">","comparatorValueDatatype":"num","comparatorValue":"0.1","propertyValue":"new_state.attributes.volume_level"},{"targetType":"this_entity","targetValue":"","propertyType":"previous_state","comparatorType":"is_not","comparatorValueDatatype":"str","comparatorValue":"playing","propertyValue":"old_state.state"},{"targetType":"this_entity","targetValue":"","propertyType":"property","comparatorType":"is","comparatorValueDatatype":"bool","comparatorValue":"false","propertyValue":"new_state.attributes.is_volume_muted"},{"targetType":"this_entity","targetValue":"","propertyType":"property","comparatorType":"is_not","comparatorValueDatatype":"str","comparatorValue":"Home Assistant Lovelace","propertyValue":"new_state.attributes.app_name"}],"inputs":0,"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","enableInput":false,"x":130,"y":2700,"wires":[["956180a631884471"],[]]},{"id":"956180a631884471","type":"function","z":"3ad1e0957e6ec22e","name":"Extract room from media player entity an extract off speakers to regex","func":"var motion_entity_id = msg.data.event.new_state.entity_id; // binary_sensor.sensor_bedroom_motion_occupancy\nvar motion_entity_id_split = motion_entity_id.split(\".\");// split on the dot to separate domain and entity\nvar motion_entity_id_wihtout_binary = motion_entity_id_split[1].replace(\"media_player_\", \"\").replace(\"_chromecast\", \"\");// remove sensor_ and more substrings\nvar regex = \"^media_player\\.(?!.*?speakers.*?).*\" + motion_entity_id_wihtout_binary + \".*_speaker\"; \nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': regex ,  'valueType': 're' },{ 'property': 'state' ,  'logic': 'is_not' , 'value': \"on\" ,  'valueType': 'str' }];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object},\"room\": motion_entity_id_wihtout_binary\n\n}\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":710,"y":2700,"wires":[["b5cd4c900adad971"]]},{"id":"b5cd4c900adad971","type":"ha-get-entities","z":"3ad1e0957e6ec22e","name":"Get entities","server":"7ab5c227.a3ce8c","version":0,"rules":[],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload.results","output_results_count":1,"x":1130,"y":2700,"wires":[["9aca0aafb17f20b2"]]},{"id":"bf142546177ce08a","type":"comment","z":"3ad1e0957e6ec22e","name":"Generate the regex for the get entity node","info":"","x":740,"y":2660,"wires":[]},{"id":"18c4256ce9e5dd3d","type":"comment","z":"3ad1e0957e6ec22e","name":"Get speakers entities","info":"","x":1140,"y":2660,"wires":[]},{"id":"7c989a7b3bc80a07","type":"comment","z":"3ad1e0957e6ec22e","name":"Detect all playing player ending with chromecast","info":"","x":200,"y":2660,"wires":[]},{"id":"14ab28a31cb6f947","type":"api-call-service","z":"3ad1e0957e6ec22e","name":"Mute speakers","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_mute","areaId":[],"deviceId":[],"entityId":[],"data":"{\"is_volume_muted\": \"true\"}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1640,"y":2700,"wires":[[]]},{"id":"9aca0aafb17f20b2","type":"change","z":"3ad1e0957e6ec22e","name":"rules","rules":[{"t":"move","p":"payload.entity_id","pt":"msg","to":"payload.data.entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1390,"y":2700,"wires":[["14ab28a31cb6f947"]]},{"id":"592f8f0c4a7e4be6","type":"comment","z":"3ad1e0957e6ec22e","name":"Move payload to payload.data","info":"","x":1400,"y":2660,"wires":[]},{"id":"1a2c2723d370a5c3","type":"comment","z":"3ad1e0957e6ec22e","name":"Mute speakers","info":"","x":1640,"y":2660,"wires":[]},{"id":"cf6e81f1162dfe6d","type":"trigger-state","z":"3ad1e0957e6ec22e","name":"Playing chromecasts","server":"7ab5c227.a3ce8c","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"^media_player\\..*_chromecast$","entityidfiltertype":"regex","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"re","comparatorValue":"(paused|off)","propertyValue":"new_state.state"},{"targetType":"this_entity","targetValue":"","propertyType":"property","comparatorType":">","comparatorValueDatatype":"num","comparatorValue":"0.1","propertyValue":"new_state.attributes.volume_level"},{"targetType":"this_entity","targetValue":"","propertyType":"previous_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"playing","propertyValue":"old_state.state"},{"targetType":"this_entity","targetValue":"","propertyType":"property","comparatorType":"is_not","comparatorValueDatatype":"str","comparatorValue":"Home Assistant Lovelace","propertyValue":"new_state.attributes.app_name"}],"inputs":0,"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","enableInput":false,"x":130,"y":2820,"wires":[["0148a0d7b5b1af6b"],[]]},{"id":"0148a0d7b5b1af6b","type":"function","z":"3ad1e0957e6ec22e","name":"Extract room from media player entity an extract off speakers to regex","func":"var motion_entity_id = msg.data.event.new_state.entity_id; // binary_sensor.sensor_bedroom_motion_occupancy\nvar motion_entity_id_split = motion_entity_id.split(\".\");// split on the dot to separate domain and entity\nvar motion_entity_id_wihtout_binary = motion_entity_id_split[1].replace(\"media_player_\", \"\").replace(\"_chromecast\", \"\");// remove sensor_ and more substrings\nvar regex = \"^media_player\\.(?!.*?speakers.*?).*\" + motion_entity_id_wihtout_binary + \".*_speaker\"; \nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': regex ,  'valueType': 're' },{ 'property': 'state' ,  'logic': 'is_not' , 'value': \"on\" ,  'valueType': 'str' }];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object},\"room\": motion_entity_id_wihtout_binary\n\n}\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":710,"y":2820,"wires":[["0feb81ecfb724761"]]},{"id":"0feb81ecfb724761","type":"ha-get-entities","z":"3ad1e0957e6ec22e","name":"Get entities","server":"7ab5c227.a3ce8c","version":0,"rules":[],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload.results","output_results_count":1,"x":1130,"y":2820,"wires":[["df8645a894391e8b"]]},{"id":"0598a0acb4cfb13a","type":"comment","z":"3ad1e0957e6ec22e","name":"Generate the regex for the get entity node","info":"","x":740,"y":2780,"wires":[]},{"id":"e8ebe00ff14b8839","type":"comment","z":"3ad1e0957e6ec22e","name":"Get speakers entities","info":"","x":1140,"y":2780,"wires":[]},{"id":"2c2cbe2dfa5b5284","type":"comment","z":"3ad1e0957e6ec22e","name":"Detect all paused player ending with chromecast","info":"","x":200,"y":2780,"wires":[]},{"id":"945d874e4f0e81c5","type":"api-call-service","z":"3ad1e0957e6ec22e","name":"Unmute speakers","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_mute","areaId":[],"deviceId":[],"entityId":[],"data":"{\"is_volume_muted\": \"false\"}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1650,"y":2820,"wires":[[]]},{"id":"df8645a894391e8b","type":"change","z":"3ad1e0957e6ec22e","name":"rules","rules":[{"t":"move","p":"payload.entity_id","pt":"msg","to":"payload.data.entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1390,"y":2820,"wires":[["945d874e4f0e81c5"]]},{"id":"5cf4d8712339894d","type":"comment","z":"3ad1e0957e6ec22e","name":"Move payload to payload.data","info":"","x":1400,"y":2780,"wires":[]},{"id":"ec52ad15c2364196","type":"comment","z":"3ad1e0957e6ec22e","name":"unMute speakers","info":"","x":1640,"y":2780,"wires":[]},{"id":"ac19ca3db853593f","type":"debug","z":"3ad1e0957e6ec22e","name":"debug 21","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":440,"y":3040,"wires":[]},{"id":"25dfe89de5062e26","type":"trigger-state","z":"3ad1e0957e6ec22e","name":"All sleeping turns on","server":"7ab5c227.a3ce8c","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"binary_sensor.all_present_sleeping","entityidfiltertype":"regex","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on","propertyValue":"new_state.state"}],"inputs":0,"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","enableInput":false,"x":110,"y":3680,"wires":[["1d99a0ebad5ba436"],[]]},{"id":"22fca18a122a02d5","type":"comment","z":"3ad1e0957e6ec22e","name":"Closet blinds on all sleep","info":"","x":130,"y":3640,"wires":[]},{"id":"1d99a0ebad5ba436","type":"api-call-service","z":"3ad1e0957e6ec22e","name":"Close living room cover","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"cover","service":"set_cover_position","areaId":[],"deviceId":[],"entityId":["cover.cover_livingroom_blinds"],"data":"{\"position\":0}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":390,"y":3680,"wires":[[]]},{"id":"baa40cf3b02103d9","type":"comment","z":"3ad1e0957e6ec22e","name":"Close living room cover","info":"","x":380,"y":3640,"wires":[]},{"id":"5bc4cb362c71d1a7","type":"trigger-state","z":"3ad1e0957e6ec22e","name":"","server":"7ab5c227.a3ce8c","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"binary_sensor.all_present_sleeping","entityidfiltertype":"regex","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off","propertyValue":"new_state.state"}],"inputs":0,"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","enableInput":false,"x":220,"y":3800,"wires":[["fa5c0b45b91d9b2a"],[]]},{"id":"a1714c89c89e10c1","type":"comment","z":"3ad1e0957e6ec22e","name":"Open blinds on someone waking","info":"","x":170,"y":3760,"wires":[]},{"id":"aad9f82ac2bb5718","type":"api-call-service","z":"3ad1e0957e6ec22e","name":"Open the cover by 10 %","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"cover","service":"set_cover_position","areaId":[],"deviceId":[],"entityId":["cover.cover_livingroom_blinds"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1830,"y":3800,"wires":[[]]},{"id":"fa5c0b45b91d9b2a","type":"api-current-state","z":"3ad1e0957e6ec22e","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"cover.cover_livingroom_blinds","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"entity","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":630,"y":3800,"wires":[["7b464d64a1a6a7f1","12df4c1c0bffa4af"]]},{"id":"a4f4cf39603e26ed","type":"inject","z":"3ad1e0957e6ec22e","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":580,"y":3720,"wires":[["fa5c0b45b91d9b2a"]]},{"id":"7b464d64a1a6a7f1","type":"debug","z":"3ad1e0957e6ec22e","name":"debug 22","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":880,"y":3720,"wires":[]},{"id":"12df4c1c0bffa4af","type":"function","z":"3ad1e0957e6ec22e","name":"Set position","func":"var current_position = msg.entity.attributes.position;\nvar position = current_position + 5;\nvar msg = {\n    \"payload\":{\n        \"data\": {\"position\": position\n            \n        }\n        \n    }\n    \n}\n\n;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":930,"y":3800,"wires":[["19989d4ae9b975fd","90dd741ad1b09482"]]},{"id":"19989d4ae9b975fd","type":"switch","z":"3ad1e0957e6ec22e","name":"","property":"payload.data.position","propertyType":"msg","rules":[{"t":"gt","v":"100","vt":"str"},{"t":"lt","v":"100","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1090,"y":3800,"wires":[["d3b3815d4b23e5d8"],["e968bcc4b1e19f07"]]},{"id":"90dd741ad1b09482","type":"debug","z":"3ad1e0957e6ec22e","name":"debug 23","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1080,"y":3700,"wires":[]},{"id":"ad69111471edb2d4","type":"debug","z":"3ad1e0957e6ec22e","name":"debug 24","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1260,"y":3680,"wires":[]},{"id":"70a6e7c8a629e5bd","type":"change","z":"3ad1e0957e6ec22e","name":"","rules":[{"t":"set","p":"payload.data.position","pt":"msg","to":"100","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1490,"y":3740,"wires":[["4e5d3d8a6660d120"]]},{"id":"4366061e3225ad93","type":"trigger","z":"3ad1e0957e6ec22e","name":"","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"2","extend":false,"overrideDelay":false,"units":"min","reset":"100","bytopic":"topic","topic":"topic","outputs":1,"x":1270,"y":3840,"wires":[["2627ce3651ca571c"]]},{"id":"c0a27d7172a776b7","type":"debug","z":"3ad1e0957e6ec22e","name":"debug 25","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2320,"y":4800,"wires":[]},{"id":"40f408ee23514114","type":"comment","z":"3ad1e0957e6ec22e","name":"Is the house empty?","info":"","x":110,"y":2300,"wires":[]},{"id":"0a28286f804cb5f5","type":"trigger-state","z":"3ad1e0957e6ec22e","name":"","server":"7ab5c227.a3ce8c","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"binary_sensor.user_home","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off","propertyValue":"new_state.state"},{"targetType":"entity_id","targetValue":"input_boolean.kink_party","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off","propertyValue":"new_state.state"},{"targetType":"entity_id","targetValue":"input_boolean.party_mode","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off","propertyValue":"new_state.state"},{"targetType":"entity_id","targetValue":"input_boolean.acid_time","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off","propertyValue":"new_state.state"}],"inputs":0,"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","enableInput":false,"x":170,"y":2340,"wires":[["79390bc2d69f0c01"],[]]},{"id":"79390bc2d69f0c01","type":"api-call-service","z":"3ad1e0957e6ec22e","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["all"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":510,"y":2340,"wires":[[]]},{"id":"9252fe66ebb5980e","type":"comment","z":"3ad1e0957e6ec22e","name":"Turn off t he lights","info":"","x":510,"y":2300,"wires":[]},{"id":"8f3820173d5a9601","type":"api-call-service","z":"3ad1e0957e6ec22e","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_mute","areaId":[],"deviceId":[],"entityId":[],"data":"{\"is_volume_muted\": true}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1870,"y":1320,"wires":[[]]},{"id":"9ebdae039088d22b","type":"server-state-changed","z":"3ad1e0957e6ec22e","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.user_home","entityidfiltertype":"regex","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":180,"y":480,"wires":[["4be0016c8eafecbb"],[]]},{"id":"4be0016c8eafecbb","type":"api-call-service","z":"3ad1e0957e6ec22e","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"alarm_control_panel","service":"alarm_disarm","areaId":[],"deviceId":[],"entityId":["alarm_control_panel.home_alarm"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":540,"y":480,"wires":[[]]},{"id":"76d981c6efbdf599","type":"api-current-state","z":"3ad1e0957e6ec22e","name":"Acid time","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.acid_time","state_type":"str","blockInputOverrides":true,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":3100,"y":1920,"wires":[["e47712f83178e21d"],["0532ec8d34489382"]]},{"id":"f6bd0e7c3db3ad74","type":"subflow:9e515b8aa75a9cdd","z":"3ad1e0957e6ec22e","name":"","x":1110,"y":2080,"wires":[]},{"id":"f35577722d2e5e51","type":"function","z":"3ad1e0957e6ec22e","name":"Extract room from motion sensor entity an extract on lights to regex","func":"var motion_entity_id = msg.data.event.new_state.entity_id; // binary_sensor.sensor_bedroom_motion_occupancy\nvar motion_entity_id_split = motion_entity_id.split(\".\");// split on the dot to separate domain and entity\nvar motion_entity_id_wihtout_binary = motion_entity_id_split[1].replace(\"sensor_\", \"\").replace(\"_motion\", \"\").replace(\"_fp1\", \"\").replace(\"_presence\", \"\").replace(\"_occupancy\", \"\").replace(\"_entry\", \"\").replace(\"_exit\", \"\");// remove sensor_ and more substrings\nvar regex = \"^light\\\\.(?!.*?group.*?)(?!.*?tree.*?)(?!.*?lights.*?).*\" + motion_entity_id_wihtout_binary + \".*\"; \nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': regex ,  'valueType': 're' },{ 'property': 'state' ,  'logic': 'is' , 'value': \"on\" ,  'valueType': 'str' }];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object},\"room\": motion_entity_id_wihtout_binary\n\n}\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1480,"y":2080,"wires":[["3deca3038f0ee2fd"]]},{"id":"3deca3038f0ee2fd","type":"ha-get-entities","z":"3ad1e0957e6ec22e","name":"Get entities","server":"7ab5c227.a3ce8c","version":0,"rules":[],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload.results","output_results_count":1,"x":1870,"y":2080,"wires":[["7ba8f61dbf2a8e0e"]]},{"id":"7ba8f61dbf2a8e0e","type":"change","z":"3ad1e0957e6ec22e","name":"rules","rules":[{"t":"move","p":"payload","pt":"msg","to":"lights","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2090,"y":2080,"wires":[["6c095a9f8aab4bab"]]},{"id":"f57e09b77107a479","type":"function","z":"3ad1e0957e6ec22e","name":"prepare Regex to check other motion sensors","func":"var room = msg.room\nvar regex = \"binary_sensor\\.*\" + room + \".*_occupancy$\"; \nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': regex ,  'valueType': 're' },{ 'property': 'state' ,  'logic': 'is' , 'value': \"on\" ,  'valueType': 'str' }];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object},\n    \"entity\": msg.entity,\n    \"room\": room,\n    \"lights\": msg.lights\n\n}\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2690,"y":2080,"wires":[["bfbb0b4f286793a7"]]},{"id":"bfbb0b4f286793a7","type":"ha-get-entities","z":"3ad1e0957e6ec22e","name":"Get entities","server":"7ab5c227.a3ce8c","version":0,"rules":[],"output_type":"array","output_empty_results":true,"output_location_type":"msg","output_location":"payload.results","output_results_count":1,"x":3110,"y":2080,"wires":[["920d5347d18462cb"]]},{"id":"920d5347d18462cb","type":"switch","z":"3ad1e0957e6ec22e","name":"","property":"payload.results","propertyType":"msg","rules":[{"t":"empty"}],"checkall":"true","repair":false,"outputs":1,"x":3390,"y":2080,"wires":[["e3a0ea2f874902d9"]]},{"id":"e3a0ea2f874902d9","type":"change","z":"3ad1e0957e6ec22e","name":"rules","rules":[{"t":"move","p":"lights.entity_id","pt":"msg","to":"payload.data.entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":3610,"y":2080,"wires":[["bf2adea4a4cd3254","47db7d1429c904e3"]]},{"id":"bf2adea4a4cd3254","type":"api-call-service","z":"3ad1e0957e6ec22e","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":[],"data":"{\"transition\": 30}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3830,"y":2080,"wires":[[]]},{"id":"35b0bdcc2cd225b0","type":"comment","z":"3ad1e0957e6ec22e","name":"Generate the regex for the get entity node","info":"","x":1520,"y":2040,"wires":[]},{"id":"d9bec240ada2124c","type":"comment","z":"3ad1e0957e6ec22e","name":"Get on light entities","info":"","x":1870,"y":2040,"wires":[]},{"id":"faa3381ca471214b","type":"comment","z":"3ad1e0957e6ec22e","name":"Move payload to lights","info":"","x":2100,"y":2040,"wires":[]},{"id":"b7855bbdd1705208","type":"comment","z":"3ad1e0957e6ec22e","name":"Prepare regex to check if another motion sensor is on in the room","info":"","x":2750,"y":2040,"wires":[]},{"id":"09343a352b60af76","type":"comment","z":"3ad1e0957e6ec22e","name":"Get motion on entities in an array","info":"","x":3130,"y":2040,"wires":[]},{"id":"c86cbeead2789710","type":"comment","z":"3ad1e0957e6ec22e","name":"Make sure the array is empty","info":"","x":3400,"y":2040,"wires":[]},{"id":"2da543eecfc66a02","type":"comment","z":"3ad1e0957e6ec22e","name":"Set entity","info":"","x":3620,"y":2040,"wires":[]},{"id":"fb147dd063cb0cf0","type":"comment","z":"3ad1e0957e6ec22e","name":"Turn the lights off","info":"","x":3820,"y":2040,"wires":[]},{"id":"6c095a9f8aab4bab","type":"switch","z":"3ad1e0957e6ec22e","name":"","property":"lights.attributes.hs_color[1]","propertyType":"msg","rules":[{"t":"lt","v":"35","vt":"num"},{"t":"gt","v":"35","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":2350,"y":2080,"wires":[["dd035c8734eac537"],["e54b3fc56024cd1a"]]},{"id":"a7f141037e95effd","type":"comment","z":"3ad1e0957e6ec22e","name":"Send white light up","info":"","x":2350,"y":2040,"wires":[]},{"id":"9dec79dcb9837d75","type":"comment","z":"3ad1e0957e6ec22e","name":"Send colored light down","info":"","x":2360,"y":2120,"wires":[]},{"id":"bb615a15aadc7a73","type":"function","z":"3ad1e0957e6ec22e","name":"prepare Regex to check other motion sensors","func":"var room = msg.room\nvar regex = \"binary_sensor\\.*\" + room + \".*_occupancy$\"; \nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': regex ,  'valueType': 're' },{ 'property': 'state' ,  'logic': 'is' , 'value': \"on\" ,  'valueType': 'str' }];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object},\n    \"entity\": msg.entity,\n    \"room\": room,\n    \"lights\": msg.lights\n\n}\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":2870,"y":2180,"wires":[["020a0af9aa797ac6"]]},{"id":"020a0af9aa797ac6","type":"ha-get-entities","z":"3ad1e0957e6ec22e","name":"Get entities","server":"7ab5c227.a3ce8c","version":0,"rules":[],"output_type":"array","output_empty_results":true,"output_location_type":"msg","output_location":"payload.results","output_results_count":1,"x":3330,"y":2180,"wires":[["0ff466039cc1b783"]]},{"id":"0ff466039cc1b783","type":"switch","z":"3ad1e0957e6ec22e","name":"","property":"payload.results","propertyType":"msg","rules":[{"t":"empty"}],"checkall":"true","repair":false,"outputs":1,"x":3610,"y":2180,"wires":[["8238b87283ea2c3f"]]},{"id":"8238b87283ea2c3f","type":"change","z":"3ad1e0957e6ec22e","name":"rules","rules":[{"t":"move","p":"lights.entity_id","pt":"msg","to":"payload.data.entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":3830,"y":2180,"wires":[["d74566d185886299"]]},{"id":"d74566d185886299","type":"api-call-service","z":"3ad1e0957e6ec22e","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":[],"data":"{\"transition\": 30}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4050,"y":2180,"wires":[[]]},{"id":"947922dfd2abca9d","type":"comment","z":"3ad1e0957e6ec22e","name":"Prepare regex to check if another motion sensor is on in the room","info":"","x":2930,"y":2140,"wires":[]},{"id":"2cbedcb0d1aed74c","type":"comment","z":"3ad1e0957e6ec22e","name":"Get motion on entities in an array","info":"","x":3350,"y":2140,"wires":[]},{"id":"95a7c2a0be5eeb96","type":"comment","z":"3ad1e0957e6ec22e","name":"Make sure the array is empty","info":"","x":3620,"y":2140,"wires":[]},{"id":"aacfc953673352fc","type":"comment","z":"3ad1e0957e6ec22e","name":"Set entity","info":"","x":3840,"y":2140,"wires":[]},{"id":"94a25ac5cbd9cde0","type":"comment","z":"3ad1e0957e6ec22e","name":"Turn the lights off","info":"","x":4040,"y":2140,"wires":[]},{"id":"23b7b5e9abb68123","type":"ha-wait-until","z":"3ad1e0957e6ec22e","name":"","server":"7ab5c227.a3ce8c","version":2,"outputs":1,"entityId":"binary_sensor.all_present_sleeping","entityIdFilterType":"exact","property":"state","comparator":"is","value":"on","valueType":"str","timeout":0,"timeoutType":"num","timeoutUnits":"seconds","checkCurrentState":true,"blockInputOverrides":true,"outputProperties":[],"x":2580,"y":2180,"wires":[["bb615a15aadc7a73"]]},{"id":"cd73d4eb269bb7eb","type":"comment","z":"3ad1e0957e6ec22e","name":"Wait until all asleep","info":"","x":2570,"y":2140,"wires":[]},{"id":"47db7d1429c904e3","type":"debug","z":"3ad1e0957e6ec22e","name":"debug 135","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3750,"y":2000,"wires":[]},{"id":"72d68f55f36be0b5","type":"api-call-service","z":"3ad1e0957e6ec22e","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3110,"y":1860,"wires":[[]]},{"id":"dd686607678770f7","type":"comment","z":"3ad1e0957e6ec22e","name":"TEST FOR ADAPTATIVE LIGTHING","info":"","x":3100,"y":1820,"wires":[]},{"id":"00c58bef414f89da","type":"change","z":"3ad1e0957e6ec22e","name":"rules","rules":[{"t":"move","p":"entity.entity_id","pt":"msg","to":"payload.data.entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2790,"y":1840,"wires":[[]]},{"id":"c371cf447e1111df","type":"change","z":"3ad1e0957e6ec22e","name":"rules","rules":[{"t":"move","p":"entity","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2790,"y":1940,"wires":[["76d981c6efbdf599"]]},{"id":"669ce1ec86d62658","type":"comment","z":"3ad1e0957e6ec22e","name":"Move entity to payload","info":"","x":2780,"y":1900,"wires":[]},{"id":"63296832882fbb5f","type":"function","z":"3ad1e0957e6ec22e","name":"Extract room from sleeper sensor entity","func":"var room = msg.room\nvar regex = \"sleeper_in_\" + room; \nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': regex ,  'valueType': 're' },{ 'property': 'state' ,  'logic': 'is' , 'value': \"on\" ,  'valueType': 'str' }];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object},\n    \"entity_id\": msg.entity_id\n\n}\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1520,"y":620,"wires":[["3ce9f8d6877b7722","b0f8e46abb401459"]]},{"id":"3ce9f8d6877b7722","type":"ha-get-entities","z":"3ad1e0957e6ec22e","name":"Get entities","server":"7ab5c227.a3ce8c","version":0,"rules":[],"output_type":"array","output_empty_results":true,"output_location_type":"msg","output_location":"payload.results","output_results_count":1,"x":1870,"y":620,"wires":[["6432dd722d6c7011","dddb35c43dc90bfd"]]},{"id":"dddb35c43dc90bfd","type":"switch","z":"3ad1e0957e6ec22e","name":"","property":"payload.results","propertyType":"msg","rules":[{"t":"empty"},{"t":"nempty"}],"checkall":"false","repair":false,"outputs":2,"x":2130,"y":620,"wires":[["323614ff6d81d35d"],["6c6b54f0dfaad3fc"]]},{"id":"cd96f0ceb78eee5d","type":"comment","z":"3ad1e0957e6ec22e","name":"Prepare regex to check if someone is sleeping in the room","info":"","x":1490,"y":580,"wires":[]},{"id":"9484d3c039ac9e6b","type":"comment","z":"3ad1e0957e6ec22e","name":"Get sleeper entities in an array","info":"","x":1850,"y":580,"wires":[]},{"id":"c1d461b9f98e71bf","type":"comment","z":"3ad1e0957e6ec22e","name":"Make sure the array is empty","info":"","x":2120,"y":580,"wires":[]},{"id":"3b03a71f74ea2752","type":"debug","z":"3ad1e0957e6ec22e","name":"debug 142","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":490,"y":560,"wires":[]},{"id":"6728c9fcb85f2925","type":"comment","z":"3ad1e0957e6ec22e","name":"Speaker is not muted?","info":"","x":880,"y":580,"wires":[]},{"id":"1a1b9e0c796c591e","type":"function","z":"3ad1e0957e6ec22e","name":"Extract room from media player name","func":"var media_entity_id = msg.data.entity_id; // binary_sensor.sensor_bedroom_motion_occupancy\nvar media_entity_id_split = media_entity_id.split(\".\");// split on the dot to separate domain and entity\nvar room = media_entity_id_split[1].split(\"_\");// remove sensor_ and more substrings\n\nvar msg = {\n    \"room\": room[0],\n    \"entity_id\": media_entity_id\n\n}\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1150,"y":620,"wires":[["34e3d1878e561672","63296832882fbb5f"]]},{"id":"5c4f10c50063aa88","type":"comment","z":"3ad1e0957e6ec22e","name":"Generate the regex for the get entity node","info":"","x":1060,"y":440,"wires":[]},{"id":"34e3d1878e561672","type":"debug","z":"3ad1e0957e6ec22e","name":"debug 143","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1290,"y":760,"wires":[]},{"id":"961ad875493d53be","type":"inject","z":"3ad1e0957e6ec22e","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"},{"p":"data","v":"{\"entity_id\":\"media_player.livingroom_center_speaker\",\"old_state\":{\"entity_id\":\"media_player.livingroom_center_speaker\",\"state\":\"off\",\"attributes\":{\"device_class\":\"speaker\",\"friendly_name\":\"Living Room Center\",\"supported_features\":152461},\"last_changed\":\"2023-01-12T14:20:58.917426+00:00\",\"last_updated\":\"2023-01-12T14:20:58.917426+00:00\",\"context\":{\"id\":\"01GPK5NZ55A2SFRB8EDV9BDWWJ\",\"parent_id\":null,\"user_id\":null},\"original_state\":\"off\"},\"new_state\":{\"entity_id\":\"media_player.livingroom_center_speaker\",\"state\":\"idle\",\"attributes\":{\"volume_level\":0.44999998807907104,\"is_volume_muted\":false,\"media_position_updated_at\":\"2023-01-12T14:20:58.917088+00:00\",\"app_id\":\"705D30C6\",\"app_name\":\"Default Media Receiver\",\"entity_picture_local\":null,\"device_class\":\"speaker\",\"friendly_name\":\"Living Room Center\",\"supported_features\":152461},\"last_changed\":\"2023-01-12T14:21:00.824073+00:00\",\"last_updated\":\"2023-01-12T14:21:00.824073+00:00\",\"context\":{\"id\":\"01GPK5P10R6FH3EZW0K11BCQ2H\",\"parent_id\":null,\"user_id\":null},\"original_state\":\"idle\",\"timeSinceChangedMs\":2}}","vt":"json"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"media_player.livingroom_center_speaker","payload":"idle","payloadType":"str","x":1790,"y":700,"wires":[[]]},{"id":"f49208e778f0be8b","type":"comment","z":"3ad1e0957e6ec22e","name":"Extract room","info":"","x":1150,"y":580,"wires":[]},{"id":"b0f8e46abb401459","type":"debug","z":"3ad1e0957e6ec22e","name":"debug 145","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1570,"y":460,"wires":[]},{"id":"8e4304a0b3903d05","type":"delay","z":"3ad1e0957e6ec22e","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"0.7","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":2390,"y":740,"wires":[["76b983255b2d893e"]]},{"id":"76b983255b2d893e","type":"api-call-service","z":"3ad1e0957e6ec22e","name":"Mute speaker","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_mute","areaId":[],"deviceId":[],"entityId":[],"data":"{\"is_volume_muted\": \"true\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":2580,"y":740,"wires":[["197996ebf07ba045"]]},{"id":"4ea268995019b87f","type":"comment","z":"3ad1e0957e6ec22e","name":"Mute speakers if someone is sleeping","info":"","x":2510,"y":700,"wires":[]},{"id":"6c6b54f0dfaad3fc","type":"change","z":"3ad1e0957e6ec22e","name":"Set entity_id","rules":[{"t":"move","p":"entity_id","pt":"msg","to":"payload.data.entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2250,"y":700,"wires":[["8e4304a0b3903d05","e9b2c71d4c7772d3"]]},{"id":"e9b2c71d4c7772d3","type":"debug","z":"3ad1e0957e6ec22e","name":"debug 147","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2410,"y":840,"wires":[]},{"id":"197996ebf07ba045","type":"debug","z":"3ad1e0957e6ec22e","name":"debug 148","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2790,"y":720,"wires":[]},{"id":"444618be070d2767","type":"debug","z":"3ad1e0957e6ec22e","name":"debug 149","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2510,"y":520,"wires":[]},{"id":"6432dd722d6c7011","type":"debug","z":"3ad1e0957e6ec22e","name":"debug 151","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2010,"y":740,"wires":[]},{"id":"d25cf718657e59c8","type":"trigger-state","z":"3ad1e0957e6ec22e","name":"","server":"7ab5c227.a3ce8c","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"media_player.*[a-z]_speaker","entityidfiltertype":"regex","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"re","comparatorValue":"(buffering|idle)","propertyValue":"new_state.state"},{"targetType":"this_entity","targetValue":"","propertyType":"property","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off","propertyValue":"old_state.state"},{"targetType":"this_entity","targetValue":"","propertyType":"property","comparatorType":"is_not","comparatorValueDatatype":"str","comparatorValue":"true","propertyValue":"new_state.attributes.is_volume_muted"}],"inputs":0,"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","enableInput":false,"x":160,"y":620,"wires":[["abc2966ea146bf03","3b03a71f74ea2752"],[]]},{"id":"94a005fca97089ff","type":"switch","z":"3ad1e0957e6ec22e","name":"was off?","property":"data.old_state.state","propertyType":"msg","rules":[{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":420,"y":700,"wires":[[]]},{"id":"f59af640c5f71144","type":"switch","z":"3ad1e0957e6ec22e","name":"Speaker is not muted","property":"data.new_state.attributes.is_volume_muted","propertyType":"msg","rules":[{"t":"neq","v":"true","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":880,"y":620,"wires":[["1a1b9e0c796c591e"]]},{"id":"abc2966ea146bf03","type":"switch","z":"3ad1e0957e6ec22e","name":"Speaker is not bathroom","property":"topic","propertyType":"msg","rules":[{"t":"neq","v":"media_player.bathroom_speaker","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":650,"y":620,"wires":[["f59af640c5f71144"]]},{"id":"d7f721bf55ba2ae4","type":"server-state-changed","z":"3ad1e0957e6ec22e","name":"Speaker turns to idle?","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"media_player.*[a-z]_speaker","entityidfiltertype":"regex","outputinitially":false,"state_type":"str","haltifstate":"(idle|buffering)","halt_if_type":"re","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"milliseconds","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":100,"y":700,"wires":[[],[]]},{"id":"a1389c5da89d1a3f","type":"mqtt in","z":"f8abdd9653af834e","name":"","topic":"zigbee2mqtt/remote_chillingroom_dial","qos":"2","datatype":"json","broker":"21000c19b97da572","nl":false,"rap":true,"rh":0,"inputs":0,"x":450,"y":440,"wires":[["7424c9541dd2882a"]]},{"id":"7424c9541dd2882a","type":"subflow:61f53235c712b2c2","z":"f8abdd9653af834e","name":"","x":750,"y":440,"wires":[]},{"id":"adf3d5e1856c236a","type":"api-call-service","z":"f8abdd9653af834e","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1230,"y":740,"wires":[[]]},{"id":"09d4d190f43c37b5","type":"comment","z":"f8abdd9653af834e","name":"Select color, brightness and set entity_id","info":"","x":800,"y":700,"wires":[]},{"id":"1ef15165eb3f949b","type":"comment","z":"f8abdd9653af834e","name":"Turn the lights on","info":"","x":1220,"y":700,"wires":[]},{"id":"4ff95a5111ec8084","type":"function","z":"f8abdd9653af834e","name":"effect selector new","func":"var d = new Date();\nvar h = d.getHours();\nvar effects_list = msg.data.new_state.attributes.effect_list\nvar effect = \"test\"\n\nvar r = Math.floor(Math.random() * effects_list.length );\nvar effect = effects_list[r];\n\n\n\n\n\n\n\nif (h > 22){\n    var brightness_percentage = \"45\";\n}\nelse if (h >= 0 && h <= 2 ){\n    var brightness_percentage = \"35\";\n}\nelse if (h > 2 && h<8){\n    var brightness_percentage = \"20\";\n}\nelse if (h >= 8 && h<9){\n    var brightness_percentage = \"30\";\n}\nelse{\n    var brightness_percentage = \"100\";\n}\nmsg=\n{\n    \"payload\":{\n        \"data\": {\n        \"entity_id\": msg.data.entity_id,\n        \"brightness_pct\": brightness_percentage,\n        \"effect\":  effect\n    }\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":790,"y":740,"wires":[["bf81e69c2972b1f4"]]},{"id":"838ee8d8726cafa1","type":"inject","z":"f8abdd9653af834e","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":500,"y":680,"wires":[["9b28eff28ebee678"]]},{"id":"96edde8d3ac4b121","type":"server-state-changed","z":"f8abdd9653af834e","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"light.chillingroom_christmas_tree_light","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":380,"y":740,"wires":[["9b28eff28ebee678"],[]]},{"id":"ad58ae9a58134317","type":"debug","z":"f8abdd9653af834e","name":"debug 138","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":730,"y":620,"wires":[]},{"id":"9a82ab90b85d2bb3","type":"debug","z":"f8abdd9653af834e","name":"debug 139","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload.data.effect","targetType":"msg","statusVal":"","statusType":"auto","x":990,"y":600,"wires":[]},{"id":"f6253fda7e1d5916","type":"function","z":"f8abdd9653af834e","name":"effect selector","func":"var d = new Date();\nvar h = d.getHours();\nvar effects_list = msg.data.new_state.attributes.effect_list\nvar effect = \"test\"\n\nvar r = Math.floor(Math.random() * effects_list.length );\nswitch (r) {\n  case 1:\n    effect = effects_list[0];\n    break;\n  case 2:\n    effect = effects_list[1];\n    break;\n  case 3:\n     effect = effects_list[2];\n    break;\n  case 4:\n    effect = effects_list[3];\n    break;\n  case 5:\n    effect = effects_list[4];\n    break;\n  case 6:\n    effect = effects_list[5];\n    break;\n  case 7:\n    effect = effects_list[6];\n    break;\n  case 8:\n    effect = effects_list[7];\n    break;\n  case 9:\n    effect = effects_list[8];\n    break;\n  case 10:\n    effect = effects_list[9];\n    break;\n  case 11:\n    effect = effects_list[10];\n    break;\n  case 12:\n    effect = effects_list[11];\n    break;\n  case 13:\n    effect = effects_list[12];\n    break;\n  case 14:\n    effect = effects_list[13];\n    break;\n  case 15:\n    effect = effects_list[14];\n}\n\n\n\n\n\n\nif (h > 22){\n    var brightness_percentage = \"45\";\n}\nelse if (h >= 0 && h <= 2 ){\n    var brightness_percentage = \"35\";\n}\nelse if (h > 2 && h<8){\n    var brightness_percentage = \"20\";\n}\nelse if (h >= 8 && h<9){\n    var brightness_percentage = \"30\";\n}\nelse{\n    var brightness_percentage = \"100\";\n}\nmsg=\n{\n    \"payload\":{\n        \"data\": {\n        \"entity_id\": msg.data.entity_id,\n        \"brightness_pct\": brightness_percentage,\n        \"effect\":  effect\n    }\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":780,"y":800,"wires":[[]]},{"id":"490b9a310e45b569","type":"api-call-service","z":"f8abdd9653af834e","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1210,"y":920,"wires":[[]]},{"id":"2cb09ae75c3df873","type":"comment","z":"f8abdd9653af834e","name":"Select color, brightness and set entity_id","info":"","x":780,"y":880,"wires":[]},{"id":"9bcdac6cb2f99ce0","type":"comment","z":"f8abdd9653af834e","name":"Turn the lights on","info":"","x":1200,"y":880,"wires":[]},{"id":"8abcf914f5cd4f9f","type":"function","z":"f8abdd9653af834e","name":"effect selector new","func":"var d = new Date();\nvar h = d.getHours();\nvar effects_list = msg.data.new_state.attributes.effect_list\nvar effect = \"test\"\n\nvar r = Math.floor(Math.random() * effects_list.length );\nvar effect = effects_list[r];\n\n\n\n\n\n\n\nif (h > 22){\n    var brightness_percentage = \"45\";\n}\nelse if (h >= 0 && h <= 2 ){\n    var brightness_percentage = \"35\";\n}\nelse if (h > 2 && h<8){\n    var brightness_percentage = \"20\";\n}\nelse if (h >= 8 && h<9){\n    var brightness_percentage = \"30\";\n}\nelse{\n    var brightness_percentage = \"100\";\n}\nmsg=\n{\n    \"payload\":{\n        \"data\": {\n        \"entity_id\": msg.data.entity_id,\n        \"brightness_pct\": brightness_percentage,\n        \"effect\":  effect\n    }\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":770,"y":920,"wires":[["71fabfca7b4822f8"]]},{"id":"2cece51dd3ae642a","type":"server-state-changed","z":"f8abdd9653af834e","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"light.chillingroom_colo_light","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":330,"y":920,"wires":[["d94be274450d8367"],[]]},{"id":"a8c730e5ef8e5bc5","type":"server-state-changed","z":"3d9405faee8bc840","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"media_player.*[a-z]_group","entityidfiltertype":"regex","outputinitially":false,"state_type":"str","haltifstate":"paused","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":160,"y":140,"wires":[["3011b8e5bbb8ca94"],[]]},{"id":"88c2035b5bce7b14","type":"comment","z":"3d9405faee8bc840","name":"Detect all mini groups ending with group","info":"","x":150,"y":100,"wires":[]},{"id":"7b625c87674317f2","type":"comment","z":"3d9405faee8bc840","name":"Is there someone sleeping in the closet?","info":"","x":540,"y":100,"wires":[]},{"id":"6203f31a27325250","type":"comment","z":"3d9405faee8bc840","name":"Mute The entrance speaker","info":"","x":1000,"y":100,"wires":[]},{"id":"3011b8e5bbb8ca94","type":"api-current-state","z":"3d9405faee8bc840","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.sleeper_in_closet","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":540,"y":140,"wires":[["dbb26ca41732a6d3"],[]]},{"id":"dbb26ca41732a6d3","type":"api-call-service","z":"3d9405faee8bc840","name":"Mute entrance speaker","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_mute","areaId":[],"deviceId":[],"entityId":["media_player.hallway_speaker"],"data":"{\"is_volume_muted\": \"true\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":1000,"y":140,"wires":[[]]},{"id":"d37ce3377d3fbe8f","type":"comment","z":"3d9405faee8bc840","name":"No","info":"","x":810,"y":140,"wires":[]},{"id":"0676f6d81c29e5b1","type":"server-state-changed","z":"3d9405faee8bc840","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.sleeper_in_closet","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":180,"y":300,"wires":[["09d802e99fa2aa71"],["8862a8da4df11a00"]]},{"id":"09d802e99fa2aa71","type":"api-call-service","z":"3d9405faee8bc840","name":"Mute entrance speaker","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_mute","areaId":[],"deviceId":[],"entityId":["media_player.hallway_speaker"],"data":"{\"is_volume_muted\": \"true\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":480,"y":280,"wires":[[]]},{"id":"8862a8da4df11a00","type":"api-call-service","z":"3d9405faee8bc840","name":"Unmute entrance speaker","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_mute","areaId":[],"deviceId":[],"entityId":["media_player.hallway_speaker"],"data":"{\"is_volume_muted\": \"false\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":490,"y":340,"wires":[[]]},{"id":"b8e98da7ad594a68","type":"comment","z":"3d9405faee8bc840","name":"Detect \"Sleeper in hotbox\" on","info":"","x":160,"y":260,"wires":[]},{"id":"a072d7c0b19839be","type":"comment","z":"3d9405faee8bc840","name":"Mute the entrance speaker","info":"","x":490,"y":240,"wires":[]},{"id":"4ac047c19ff2fdca","type":"comment","z":"3d9405faee8bc840","name":"Unmute the entrance speaker","info":"","x":500,"y":380,"wires":[]},{"id":"3bc1b8775cea8df8","type":"server-state-changed","z":"3d9405faee8bc840","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.closet_lights_brightness","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":false,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":true,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":180,"y":540,"wires":[["a652a939020fa3c2"]]},{"id":"c78ca07112fd4998","type":"api-call-service","z":"3d9405faee8bc840","name":"change brightness","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"number","service":"set_value","areaId":[],"deviceId":[],"entityId":["number.samsung_galaxy_tab_e_8_0_screen_brightness"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"sentdata","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":990,"y":540,"wires":[[]]},{"id":"9f08746fa7b0c18b","type":"comment","z":"3d9405faee8bc840","name":"Set tablet brightness at the same level as the lights","info":"","x":190,"y":500,"wires":[]},{"id":"0411f7995d31f5b4","type":"comment","z":"3d9405faee8bc840","name":"set brightness as payload","info":"","x":550,"y":500,"wires":[]},{"id":"33d95ec89c0d12e6","type":"comment","z":"3d9405faee8bc840","name":"Apply brightness","info":"","x":960,"y":500,"wires":[]},{"id":"194342836ab18f0c","type":"trigger-state","z":"3d9405faee8bc840","name":"","server":"7ab5c227.a3ce8c","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"binary_sensor.sensor_closet_motion_occupancy","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on","propertyValue":"new_state.state"},{"targetType":"this_entity","targetValue":"","propertyType":"previous_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off","propertyValue":"old_state.state"}],"inputs":0,"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","enableInput":false,"x":220,"y":840,"wires":[["242034864f3fa677"],[]]},{"id":"242034864f3fa677","type":"function","z":"3d9405faee8bc840","name":"Extract room from motion sensor entity an extract off lights to regex","func":"var motion_entity_id = msg.data.event.new_state.entity_id; // binary_sensor.sensor_bedroom_motion_occupancy\nvar motion_entity_id_split = motion_entity_id.split(\".\");// split on the dot to separate domain and entity\nvar motion_entity_id_wihtout_binary = motion_entity_id_split[1].replace(\"sensor_\", \"\").replace(\"_motion\", \"\").replace(\"_fp1\", \"\").replace(\"_presence\", \"\").replace(\"_occupancy\", \"\").replace(\"_entry\", \"\").replace(\"_exit\", \"\");// remove sensor_ and more substrings\nvar regex = \"^light\\\\.(?!.*?group.*?)(?!.*?notification.*?)(?!.*?lights.*?).*\" + motion_entity_id_wihtout_binary + \".*\"; \nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': regex ,  'valueType': 're' },{ 'property': 'state' ,  'logic': 'is_not' , 'value': \"on\" ,  'valueType': 'str' }];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object},\"room\": motion_entity_id_wihtout_binary\n\n}\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":940,"y":840,"wires":[["387d5cf72abc7616"]]},{"id":"387d5cf72abc7616","type":"ha-get-entities","z":"3d9405faee8bc840","name":"Get entities","server":"7ab5c227.a3ce8c","version":0,"rules":[],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload.results","output_results_count":1,"x":1310,"y":840,"wires":[["a54a34b2d5120c63"]]},{"id":"71ce584f1ad003e3","type":"function","z":"3d9405faee8bc840","name":"Brightness selector","func":"var d = new Date();\nvar h = d.getHours();\n\n\n\n\nif (h > 22){\n    var brightness_percentage = \"85\";\n}\nelse if (h >= 0 && h <= 2 ){\n    var brightness_percentage = \"75\";\n}\nelse if (h > 2 && h<8){\n    var brightness_percentage = \"50\";\n}\nelse if (h >= 8 && h<9){\n    var brightness_percentage = \"60\";\n}\nelse{\n    var brightness_percentage = \"100\";\n}\nmsg=\n{\n    \"payload\":{\n        \"data\": {\n        \"entity_id\": msg.payload.entity_id,\n        \"brightness_pct\": brightness_percentage,\n        \"color_name\":  \"white\"\n    }\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3830,"y":820,"wires":[["af4dc432adbed8da"]]},{"id":"547bf6bc39892b92","type":"api-call-service","z":"3d9405faee8bc840","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":4270,"y":840,"wires":[[]]},{"id":"976d5c79c6aaeca6","type":"function","z":"3d9405faee8bc840","name":"Extract room from sleeper sensor entity","func":"var room = msg.room\nvar regex = \"sleeper_in_\" + room; \nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': regex ,  'valueType': 're' },{ 'property': 'state' ,  'logic': 'is' , 'value': \"on\" ,  'valueType': 'str' }];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object},\n    \"entity\": msg.entity\n\n}\nreturn msg;\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1880,"y":840,"wires":[["9f789162b55a5bbd"]]},{"id":"9f789162b55a5bbd","type":"ha-get-entities","z":"3d9405faee8bc840","name":"Get entities","server":"7ab5c227.a3ce8c","version":0,"rules":[],"output_type":"array","output_empty_results":true,"output_location_type":"msg","output_location":"payload.results","output_results_count":1,"x":2190,"y":840,"wires":[["ddc5284729d5f633"]]},{"id":"0c4ec6655b004e56","type":"change","z":"3d9405faee8bc840","name":"rules","rules":[{"t":"move","p":"entity","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2750,"y":840,"wires":[["b2bb79c1df073524","62a14972f3a4261c"]]},{"id":"a54a34b2d5120c63","type":"change","z":"3d9405faee8bc840","name":"rules","rules":[{"t":"move","p":"payload","pt":"msg","to":"entity","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1550,"y":840,"wires":[["976d5c79c6aaeca6"]]},{"id":"ddc5284729d5f633","type":"switch","z":"3d9405faee8bc840","name":"","property":"payload.results","propertyType":"msg","rules":[{"t":"empty"}],"checkall":"true","repair":false,"outputs":1,"x":2510,"y":840,"wires":[["0c4ec6655b004e56"]]},{"id":"ab02395bbec4c84b","type":"comment","z":"3d9405faee8bc840","name":"Detect motion across ocupancy sensors","info":"","x":150,"y":800,"wires":[]},{"id":"8cd9ef46ef8640ea","type":"comment","z":"3d9405faee8bc840","name":"Generate the regex for the get entity node","info":"","x":940,"y":800,"wires":[]},{"id":"51622d48d991b4f6","type":"comment","z":"3d9405faee8bc840","name":"Get off light entities","info":"","x":1310,"y":800,"wires":[]},{"id":"fc83ac4d46ad597e","type":"comment","z":"3d9405faee8bc840","name":"Move payload to entity","info":"","x":1540,"y":800,"wires":[]},{"id":"da68cc33fb7337a2","type":"comment","z":"3d9405faee8bc840","name":"Prepare regex to check if someone is sleeping in the room","info":"","x":1890,"y":800,"wires":[]},{"id":"4946c865957fc197","type":"comment","z":"3d9405faee8bc840","name":"Get sleeper entities in an array","info":"","x":2230,"y":800,"wires":[]},{"id":"3a22c83077ade45b","type":"comment","z":"3d9405faee8bc840","name":"Make sure the array is empty","info":"","x":2500,"y":800,"wires":[]},{"id":"c58adc26e2efb62c","type":"comment","z":"3d9405faee8bc840","name":"Move entity to payload","info":"","x":2740,"y":800,"wires":[]},{"id":"e37f24c14d5a3b47","type":"comment","z":"3d9405faee8bc840","name":"Select color, brightness and set entity_id","info":"","x":3840,"y":780,"wires":[]},{"id":"753c540cbfb70f4a","type":"comment","z":"3d9405faee8bc840","name":"Turn the lights on","info":"","x":4260,"y":800,"wires":[]},{"id":"f4d65341622a388b","type":"api-current-state","z":"3d9405faee8bc840","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.all_present_sleeping","state_type":"str","blockInputOverrides":true,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":3510,"y":820,"wires":[["71ce584f1ad003e3","71e14ad7b7397085"],["04283bce1b3f9360"]]},{"id":"3c26495151dca113","type":"function","z":"3d9405faee8bc840","name":"Effect selector","func":"var d = new Date();\nvar h = d.getHours();\nvar effects_list = msg.payload.attributes.effect_list\n\nvar r = Math.floor(Math.random() * effects_list.length );\nvar effect = effects_list[r];\n\n\n\n\n\n\nif (h > 22){\n    var brightness_percentage = \"45\";\n}\nelse if (h >= 0 && h <= 2 ){\n    var brightness_percentage = \"35\";\n}\nelse if (h > 2 && h<8){\n    var brightness_percentage = \"20\";\n}\nelse if (h >= 8 && h<9){\n    var brightness_percentage = \"30\";\n}\nelse{\n    var brightness_percentage = \"100\";\n}\nmsg=\n{\n    \"payload\":{\n        \"data\": {\n        \"entity_id\": msg.payload.entity_id,\n        \"brightness_pct\": brightness_percentage,\n        \"effect\":  effect\n    }\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3820,"y":900,"wires":[["af4dc432adbed8da"]]},{"id":"c5879f0c1d4ffc02","type":"comment","z":"3d9405faee8bc840","name":"Check if all are sleeping","info":"","x":3460,"y":780,"wires":[]},{"id":"b2bb79c1df073524","type":"api-current-state","z":"3d9405faee8bc840","name":"Acid time","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.acid_time","state_type":"str","blockInputOverrides":true,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":3060,"y":840,"wires":[["1070c7f5459776b0"],["54cb7c6c4d239427"]]},{"id":"71e14ad7b7397085","type":"debug","z":"3d9405faee8bc840","name":"debug 136","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3810,"y":640,"wires":[]},{"id":"62a14972f3a4261c","type":"debug","z":"3d9405faee8bc840","name":"debug 137","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2970,"y":760,"wires":[]},{"id":"1070c7f5459776b0","type":"api-current-state","z":"3d9405faee8bc840","name":"Party time","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.acid_time","state_type":"str","blockInputOverrides":true,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":3220,"y":820,"wires":[["f4d65341622a388b"],["d736b69a3bfefc64"]]},{"id":"04283bce1b3f9360","type":"function","z":"3d9405faee8bc840","name":"Brightness selector","func":"var d = new Date();\nvar h = d.getHours();\n\n\n\n\nif (h > 22){\n    var brightness_percentage = \"45\";\n}\nelse if (h >= 0 && h <= 2 ){\n    var brightness_percentage = \"35\";\n}\nelse if (h > 2 && h<8){\n    var brightness_percentage = \"20\";\n}\nelse if (h >= 8 && h<9){\n    var brightness_percentage = \"30\";\n}\nelse{\n    var brightness_percentage = \"100\";\n}\nmsg=\n{\n    \"payload\":{\n        \"data\": {\n        \"entity_id\": msg.payload.entity_id,\n        \"brightness_pct\": brightness_percentage,\n        \"color_name\":  \"white\"\n    }\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3830,"y":860,"wires":[[]]},{"id":"1371fed05531edbb","type":"function","z":"3d9405faee8bc840","name":"Effect selector ncase use","func":"var d = new Date();\nvar h = d.getHours();\nvar effects_list = msg.payload.attributes.effect_list\n\nvar r = Math.floor(Math.random() * effects_list.length );\nswitch (r) {\n  case 1:\n    effect = effects_list[0];\n    break;\n  case 2:\n    effect = effects_list[1];\n    break;\n  case 3:\n     effect = effects_list[2];\n    break;\n  case 4:\n    effect = effects_list[3];\n    break;\n  case 5:\n    effect = effects_list[4];\n    break;\n  case 6:\n    effect = effects_list[5];\n    break;\n  case 7:\n    effect = effects_list[6];\n    break;\n  case 8:\n    effect = effects_list[7];\n    break;\n  case 9:\n    effect = effects_list[8];\n    break;\n  case 10:\n    effect = effects_list[9];\n    break;\n  case 11:\n    effect = effects_list[10];\n    break;\n  case 12:\n    effect = effects_list[11];\n    break;\n  case 13:\n    effect = effects_list[12];\n    break;\n  case 14:\n    effect = effects_list[13];\n    break;\n  case 15:\n    effect = effects_list[14];\n}\n\n\n\n\n\n\nif (h > 22){\n    var brightness_percentage = \"45\";\n}\nelse if (h >= 0 && h <= 2 ){\n    var brightness_percentage = \"35\";\n}\nelse if (h > 2 && h<8){\n    var brightness_percentage = \"20\";\n}\nelse if (h >= 8 && h<9){\n    var brightness_percentage = \"30\";\n}\nelse{\n    var brightness_percentage = \"100\";\n}\nmsg=\n{\n    \"payload\":{\n        \"data\": {\n        \"entity_id\": msg.payload.entity_id,\n        \"brightness_pct\": brightness_percentage,\n        \"effect\":  effect\n    }\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":3850,"y":960,"wires":[[]]},{"id":"5b7b6e2d628b9694","type":"function","z":"3d9405faee8bc840","name":"JS","func":"var old_color = msg.data.old_state.attributes.rgb_color;\nvar new_color = msg.data.new_state.attributes.rgb_color;\nvar old_brightness = msg.data.old_state.attributes.brightness;\nvar new_brightness = msg.data.new_state.attributes.brightness;\n\nif (old_color[0] != new_color[0] && old_color[1] != new_color[1] && old_color[2] != new_color[2] && old_brightness < new_brightness){\nvar newMsg = {\n    \"payload\": {\n        \"data\": {\n            \"brightness\": old_brightness\n        }\n    }\n};\n} else if ((old_color[0]+old_color[1]+old_color[2]) != (new_color[0] + new_color[1] + new_color[2]) && old_brightness < new_brightness){\nvar newMsg = {\n    \"payload\": {\n        \"data\": {\n            \"brightness\": old_brightness\n        }\n    }\n};\n} else {\nvar newMsg = {\n    \"payload\": {\n        \"bugged\": { }\n    }\n};\n}\n\nreturn newMsg;\n\n\n//Current bug:\n// If a similar color is used, it does not work\n//\n//","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":890,"y":700,"wires":[[]]},{"id":"43aed1fa0aa5e5d2","type":"comment","z":"3d9405faee8bc840","name":"JS Magic to detect a color change and extract previous brightness","info":"","x":890,"y":660,"wires":[]},{"id":"a652a939020fa3c2","type":"change","z":"3d9405faee8bc840","name":"","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.data.value","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":550,"y":540,"wires":[["c9e3337b5f8392d1"]]},{"id":"c9e3337b5f8392d1","type":"trigger","z":"3d9405faee8bc840","name":"","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"100","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":780,"y":540,"wires":[["c78ca07112fd4998"]]},{"id":"38a5173254722358","type":"server-state-changed","z":"3d9405faee8bc840","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.sleeper_in_closet","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"5","forType":"num","forUnits":"seconds","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":200,"y":1460,"wires":[["eb60e59cc97b9d33"],["af9093070658dfb7"]]},{"id":"eb60e59cc97b9d33","type":"api-call-service","z":"3d9405faee8bc840","name":"Turn off tablet screen","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.samsung_galaxy_tab_e_8_0_screen"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":540,"y":1440,"wires":[[]]},{"id":"af9093070658dfb7","type":"api-call-service","z":"3d9405faee8bc840","name":"Turn on tablet screen","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.samsung_galaxy_tab_e_8_0_screen"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"data"}],"queue":"none","x":540,"y":1500,"wires":[[]]},{"id":"d4471a003bb5319b","type":"comment","z":"3d9405faee8bc840","name":"Detect \"Sleeper in closet\" on","info":"","x":180,"y":1420,"wires":[]},{"id":"80af6d7cbd7c967c","type":"comment","z":"3d9405faee8bc840","name":"Turn off tablet screen","info":"","x":550,"y":1400,"wires":[]},{"id":"877d59b8bc2f8ee6","type":"comment","z":"3d9405faee8bc840","name":"Turn on tablet screen","info":"","x":540,"y":1540,"wires":[]},{"id":"c2878a9bae6e1f8e","type":"server-state-changed","z":"5d4e860e6cd2bc1e","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.sensor_stove_temperature_humidity","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"75","halt_if_type":"num","halt_if_compare":"gt","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":240,"y":200,"wires":[["693dc3a435eb60fe"],[]]},{"id":"92f70a09c5c89b9a","type":"api-current-state","z":"5d4e860e6cd2bc1e","name":"Is the kitchen occupied?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.sensor_kitchen_motion_occupancy","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1130,"y":200,"wires":[["72a594d88c84876d"],[]]},{"id":"72a594d88c84876d","type":"trigger","z":"5d4e860e6cd2bc1e","name":"","op1":"1","op2":"1","op1type":"num","op2type":"str","duration":"-4","extend":false,"overrideDelay":false,"units":"min","reset":"on","bytopic":"all","topic":"topic","outputs":1,"x":1510,"y":200,"wires":[["49537f41c5b2b367"]]},{"id":"92c99f0b98c7f597","type":"server-state-changed","z":"5d4e860e6cd2bc1e","name":"Motion in kitchen","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.sensor_kitchen_motion_occupancy","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":1160,"y":260,"wires":[["6c667b04c18e0b33"],[]]},{"id":"49537f41c5b2b367","type":"change","z":"5d4e860e6cd2bc1e","name":"Set Message and color","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"message","pt":"msg","to":"The Water is Boiling","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1780,"y":200,"wires":[["d7d0ad481cee7d90"]]},{"id":"693dc3a435eb60fe","type":"change","z":"5d4e860e6cd2bc1e","name":"On","rules":[{"t":"set","p":"payload","pt":"msg","to":"on","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":670,"y":200,"wires":[["1bb2647d50b338de"]]},{"id":"1bb2647d50b338de","type":"trigger","z":"5d4e860e6cd2bc1e","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"20","extend":false,"overrideDelay":false,"units":"min","reset":"0","bytopic":"all","topic":"topic","outputs":1,"x":890,"y":200,"wires":[["92f70a09c5c89b9a"]]},{"id":"d7d0ad481cee7d90","type":"subflow:233ac7dcd801a802","z":"5d4e860e6cd2bc1e","name":"","x":2020,"y":200,"wires":[]},{"id":"18816de5322a0ad2","type":"comment","z":"5d4e860e6cd2bc1e","name":"Is the humidity over 75% ?","info":"","x":230,"y":160,"wires":[]},{"id":"87d1696962c7913a","type":"comment","z":"5d4e860e6cd2bc1e","name":"Alert house-wide when the pasta water is boiling","info":"","x":200,"y":100,"wires":[]},{"id":"970ea7422c84dd0a","type":"comment","z":"5d4e860e6cd2bc1e","name":"yes","info":"","x":530,"y":200,"wires":[]},{"id":"e0ddeb04c9a2725a","type":"comment","z":"5d4e860e6cd2bc1e","name":"Set Payload to \"On\"","info":"","x":670,"y":160,"wires":[]},{"id":"cfa5c1d77626f30c","type":"comment","z":"5d4e860e6cd2bc1e","name":"20 minutes anti-spam","info":"","x":900,"y":160,"wires":[]},{"id":"65a2fc28ec608be4","type":"comment","z":"5d4e860e6cd2bc1e","name":"No","info":"","x":1310,"y":200,"wires":[]},{"id":"2869586af4e1f9a6","type":"comment","z":"5d4e860e6cd2bc1e","name":"Is the kitchen occupied?","info":"","x":1120,"y":160,"wires":[]},{"id":"ec3acf776197f090","type":"comment","z":"5d4e860e6cd2bc1e","name":"Resend the alert every 5 minutes","info":"","x":1510,"y":160,"wires":[]},{"id":"5b0404e1dfab2f6b","type":"comment","z":"5d4e860e6cd2bc1e","name":"Stop when the kitchen has motion","info":"","x":1510,"y":240,"wires":[]},{"id":"ca7b129922fab83c","type":"comment","z":"5d4e860e6cd2bc1e","name":"Set alert Message","info":"","x":1790,"y":160,"wires":[]},{"id":"0185f27e6267c862","type":"comment","z":"5d4e860e6cd2bc1e","name":"Broadcast Alert","info":"","x":2000,"y":160,"wires":[]},{"id":"fb2e5e49c0598f0f","type":"api-current-state","z":"5d4e860e6cd2bc1e","name":"Is the kitchen occupied?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.sensor_kitchen_motion_occupancy","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1770,"y":2800,"wires":[["8628ef491109f67c"],["a4165723d67e441d"]]},{"id":"8628ef491109f67c","type":"trigger","z":"5d4e860e6cd2bc1e","name":"","op1":"1","op2":"1","op1type":"num","op2type":"str","duration":"-5","extend":false,"overrideDelay":false,"units":"min","reset":"on","bytopic":"all","topic":"topic","outputs":1,"x":2230,"y":2800,"wires":[["4a6452f20f6df5de"]]},{"id":"be8daa080b81890a","type":"server-state-changed","z":"5d4e860e6cd2bc1e","name":"Motion in kitchen","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.sensor_kitchen_motion_occupancy","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":1940,"y":2760,"wires":[["fba35d3bdbb3a641"],[]]},{"id":"4a6452f20f6df5de","type":"change","z":"5d4e860e6cd2bc1e","name":"Set Message and color","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"message","pt":"msg","to":"Microwave Finished","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2500,"y":2800,"wires":[["1f85692114ea2aff"]]},{"id":"68d15eb5cc5a2ef8","type":"change","z":"5d4e860e6cd2bc1e","name":"On","rules":[{"t":"set","p":"payload","pt":"msg","to":"on","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1370,"y":2800,"wires":[["8d02ea742866f780"]]},{"id":"1f85692114ea2aff","type":"subflow:233ac7dcd801a802","z":"5d4e860e6cd2bc1e","name":"","x":2730,"y":2840,"wires":[]},{"id":"a6bc04588b3bf5b0","type":"comment","z":"5d4e860e6cd2bc1e","name":"Power usage over 100W?","info":"","x":790,"y":2760,"wires":[]},{"id":"8a53e3def40eb30f","type":"comment","z":"5d4e860e6cd2bc1e","name":"Alert house-wide when the microwave has finished","info":"","x":770,"y":2700,"wires":[]},{"id":"774c4a840ea52320","type":"comment","z":"5d4e860e6cd2bc1e","name":"Set Payload to \"On\"","info":"","x":1370,"y":2760,"wires":[]},{"id":"0ac8f4593c4fb39b","type":"comment","z":"5d4e860e6cd2bc1e","name":"No","info":"","x":2030,"y":2800,"wires":[]},{"id":"4bc8a677824561c9","type":"comment","z":"5d4e860e6cd2bc1e","name":"Is the kitchen occupied?","info":"","x":1780,"y":2880,"wires":[]},{"id":"ac27af1f4f15f03a","type":"comment","z":"5d4e860e6cd2bc1e","name":"Resend the alert every 5 minutes","info":"","x":2230,"y":2720,"wires":[]},{"id":"c0d41de7d389c9e0","type":"comment","z":"5d4e860e6cd2bc1e","name":"Stop when the kitchen has motion","info":"","x":2230,"y":2760,"wires":[]},{"id":"e2b1eea66fa2f8cc","type":"comment","z":"5d4e860e6cd2bc1e","name":"Set alert Message","info":"","x":2510,"y":2760,"wires":[]},{"id":"bd2ab23da4d5b7d7","type":"comment","z":"5d4e860e6cd2bc1e","name":"Broadcast Alert","info":"","x":2720,"y":2800,"wires":[]},{"id":"1bf56e1e4e3c69eb","type":"server-state-changed","z":"5d4e860e6cd2bc1e","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.microwave_plug_electric_consumption_w_3","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"100","halt_if_type":"num","halt_if_compare":"gt","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":820,"y":2800,"wires":[["ac71b831c151155b"],[]]},{"id":"ac71b831c151155b","type":"ha-wait-until","z":"5d4e860e6cd2bc1e","name":"","server":"7ab5c227.a3ce8c","version":2,"outputs":1,"entityId":"sensor.microwave_plug_electric_consumption_w_3","entityIdFilterType":"exact","property":"state","comparator":"lt","value":"28","valueType":"num","timeout":"0","timeoutType":"num","timeoutUnits":"minutes","checkCurrentState":true,"blockInputOverrides":true,"outputProperties":[],"x":1160,"y":2800,"wires":[["68d15eb5cc5a2ef8"]]},{"id":"37aaf6e4941c4eb8","type":"comment","z":"5d4e860e6cd2bc1e","name":"Wait until Power goes under 28W","info":"","x":1130,"y":2760,"wires":[]},{"id":"a37355ef9606ec1f","type":"change","z":"5d4e860e6cd2bc1e","name":"Set Message and color","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"message","pt":"msg","to":"Microwave Finished","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":2240,"y":2900,"wires":[["f4694759a1bfdc7c"]]},{"id":"07982c2baf15ce0e","type":"comment","z":"5d4e860e6cd2bc1e","name":"Yes","info":"","x":2030,"y":2900,"wires":[]},{"id":"4d4b4d8073447a05","type":"comment","z":"5d4e860e6cd2bc1e","name":"Set alert Message","info":"","x":2230,"y":2860,"wires":[]},{"id":"59966572675a679d","type":"trigger","z":"5d4e860e6cd2bc1e","name":"","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"2","extend":false,"overrideDelay":false,"units":"min","reset":"off","bytopic":"all","topic":"topic","outputs":1,"x":570,"y":680,"wires":[["3c33ddb343c03adf"]]},{"id":"3b1c05e1f3e66d81","type":"change","z":"5d4e860e6cd2bc1e","name":"Set Message and color","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"message","pt":"msg","to":"Fridge door open","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1060,"y":680,"wires":[["a125d87ae63ed166"]]},{"id":"3c33ddb343c03adf","type":"trigger","z":"5d4e860e6cd2bc1e","name":"","op1":"","op2":"1","op1type":"num","op2type":"str","duration":"-5","extend":false,"overrideDelay":false,"units":"min","reset":"off","bytopic":"all","topic":"topic","outputs":1,"x":830,"y":680,"wires":[["3b1c05e1f3e66d81"]]},{"id":"ff4e95e03c3d9cb7","type":"server-state-changed","z":"5d4e860e6cd2bc1e","name":"Door Fridge Open","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.sensor_fridge_door_contact","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"(on|off)","halt_if_type":"re","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":190,"y":680,"wires":[["59966572675a679d","621e6f171475a47b"],[]]},{"id":"621e6f171475a47b","type":"switch","z":"5d4e860e6cd2bc1e","name":"Off?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":570,"y":640,"wires":[["3c33ddb343c03adf"]]},{"id":"a125d87ae63ed166","type":"subflow:233ac7dcd801a802","z":"5d4e860e6cd2bc1e","name":"","x":1270,"y":680,"wires":[]},{"id":"46cf96af3acdcfa4","type":"comment","z":"5d4e860e6cd2bc1e","name":"Is the door fridge open?","info":"","x":200,"y":640,"wires":[]},{"id":"1edc30f93a3b97a0","type":"comment","z":"5d4e860e6cd2bc1e","name":"Set alert Message","info":"","x":1050,"y":640,"wires":[]},{"id":"8a350d14821742b1","type":"comment","z":"5d4e860e6cd2bc1e","name":"Broadcast Alert","info":"","x":1260,"y":640,"wires":[]},{"id":"d53f733953c8bd2c","type":"comment","z":"5d4e860e6cd2bc1e","name":"Resend the alert every 5 minutes","info":"","x":830,"y":600,"wires":[]},{"id":"c57bb80177cd0d73","type":"comment","z":"5d4e860e6cd2bc1e","name":"Stop when the door is closed","info":"","x":820,"y":640,"wires":[]},{"id":"593cf1b8ba43aee4","type":"comment","z":"5d4e860e6cd2bc1e","name":"Wait 2 minutes","info":"","x":560,"y":720,"wires":[]},{"id":"a850af78c5e7caf7","type":"comment","z":"5d4e860e6cd2bc1e","name":"Only let \"Off\" through","info":"","x":580,"y":600,"wires":[]},{"id":"1f47893dddc7b288","type":"comment","z":"5d4e860e6cd2bc1e","name":"Alert house-wide when the fridge door is open for 2 minutes","info":"","x":230,"y":600,"wires":[]},{"id":"36692173862c7642","type":"trigger","z":"5d4e860e6cd2bc1e","name":"","op1":"","op2":"","op1type":"nul","op2type":"payl","duration":"2","extend":false,"overrideDelay":false,"units":"min","reset":"off","bytopic":"all","topic":"topic","outputs":1,"x":550,"y":940,"wires":[["09e7cca47eae8649"]]},{"id":"09e7cca47eae8649","type":"trigger","z":"5d4e860e6cd2bc1e","name":"","op1":"","op2":"1","op1type":"num","op2type":"str","duration":"-5","extend":false,"overrideDelay":false,"units":"min","reset":"off","bytopic":"all","topic":"topic","outputs":1,"x":810,"y":940,"wires":[["dc09bd93d48b0d66"]]},{"id":"e85fda07ac5fc5de","type":"switch","z":"5d4e860e6cd2bc1e","name":"Off?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":550,"y":900,"wires":[["09e7cca47eae8649"]]},{"id":"da6ed73d93e429b1","type":"subflow:233ac7dcd801a802","z":"5d4e860e6cd2bc1e","name":"","x":1250,"y":940,"wires":[]},{"id":"7add5c1496d7adc1","type":"comment","z":"5d4e860e6cd2bc1e","name":"Water Damage In The Kitchen?","info":"","x":190,"y":900,"wires":[]},{"id":"772930d0d3164297","type":"comment","z":"5d4e860e6cd2bc1e","name":"Set alert Message","info":"","x":1030,"y":900,"wires":[]},{"id":"87ef7d08e6be66f8","type":"comment","z":"5d4e860e6cd2bc1e","name":"Broadcast Alert","info":"","x":1240,"y":900,"wires":[]},{"id":"d5499bd4cba9cbe1","type":"comment","z":"5d4e860e6cd2bc1e","name":"Resend the alert every 5 minutes","info":"","x":810,"y":860,"wires":[]},{"id":"2f279374a67994b2","type":"comment","z":"5d4e860e6cd2bc1e","name":"Stop when the water is cleaned","info":"","x":810,"y":900,"wires":[]},{"id":"f22081f22920457b","type":"comment","z":"5d4e860e6cd2bc1e","name":"Wait 2 minutes","info":"","x":540,"y":980,"wires":[]},{"id":"d5b16ea540e7b8f2","type":"comment","z":"5d4e860e6cd2bc1e","name":"Only let \"Off\" through","info":"","x":560,"y":860,"wires":[]},{"id":"2f28b254f40de6ed","type":"comment","z":"5d4e860e6cd2bc1e","name":"Alert house-wide when there is water on the kitchen floor","info":"","x":210,"y":860,"wires":[]},{"id":"dc09bd93d48b0d66","type":"change","z":"5d4e860e6cd2bc1e","name":"Set Message and color","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"message","pt":"msg","to":"Water Damage Detected In The Kitchen","tot":"str"},{"t":"set","p":"color_value","pt":"msg","to":"[0,255,255]","tot":"json"},{"t":"set","p":"dbrightness","pt":"msg","to":"100","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1040,"y":940,"wires":[["da6ed73d93e429b1"]]},{"id":"d7e21d1d7930e137","type":"server-state-changed","z":"5d4e860e6cd2bc1e","name":"Water Damage Detected In The Kitchen","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.sensor_kitchen_water_detector_water_leak","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"(on|off)","halt_if_type":"re","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":170,"y":940,"wires":[["36692173862c7642","e85fda07ac5fc5de"],[]]},{"id":"725525ea5d669d22","type":"inject","z":"5d4e860e6cd2bc1e","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1160,"y":100,"wires":[[]]},{"id":"e67efe0407b56eec","type":"mqtt in","z":"5d4e860e6cd2bc1e","name":"","topic":"zigbee2mqtt/remote_kitchen_dial","qos":"2","datatype":"json","broker":"21000c19b97da572","nl":false,"rap":true,"rh":0,"inputs":0,"x":190,"y":1860,"wires":[["153588ecdd69813f"]]},{"id":"153588ecdd69813f","type":"subflow:61f53235c712b2c2","z":"5d4e860e6cd2bc1e","name":"","x":490,"y":1860,"wires":[]},{"id":"8d02ea742866f780","type":"api-current-state","z":"5d4e860e6cd2bc1e","name":"Is someone cooking?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.cooking_mode","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1540,"y":2800,"wires":[["fb2e5e49c0598f0f"],[]]},{"id":"3553314689856aaa","type":"server-state-changed","z":"5d4e860e6cd2bc1e","name":"Cooking mode turned on","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.cooking_mode","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"re","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":130,"y":1180,"wires":[["a39c3990b18a3dc1"],["a39c3990b18a3dc1"]]},{"id":"4cd37a1089b76a25","type":"comment","z":"5d4e860e6cd2bc1e","name":"Auto cooking condition reset","info":"","x":120,"y":1140,"wires":[]},{"id":"a39c3990b18a3dc1","type":"trigger","z":"5d4e860e6cd2bc1e","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"45","extend":false,"overrideDelay":false,"units":"min","reset":"off","bytopic":"all","topic":"topic","outputs":1,"x":390,"y":1180,"wires":[["398d31f8ad89bf85"]]},{"id":"398d31f8ad89bf85","type":"ha-wait-until","z":"5d4e860e6cd2bc1e","name":"Wait until oven temparature goes under 26","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"sensor.sensor_stove_temperature_temperature","entityIdFilterType":"exact","property":"state","comparator":"lt","value":"27","valueType":"num","timeout":"60","timeoutType":"num","timeoutUnits":"minutes","checkCurrentState":true,"blockInputOverrides":true,"outputProperties":[],"x":690,"y":1180,"wires":[["3ddd1003b0f3c2f7"],["3ddd1003b0f3c2f7"]]},{"id":"3ddd1003b0f3c2f7","type":"ha-wait-until","z":"5d4e860e6cd2bc1e","name":"Wait until kitchen is empty","server":"7ab5c227.a3ce8c","version":2,"outputs":1,"entityId":"binary_sensor.sensor_kitchen_motion_occupancy","entityIdFilterType":"exact","property":"state","comparator":"is","value":"off","valueType":"num","timeout":"0","timeoutType":"num","timeoutUnits":"minutes","checkCurrentState":true,"blockInputOverrides":true,"outputProperties":[],"x":1070,"y":1180,"wires":[["22b6005c77099aa9"]]},{"id":"22b6005c77099aa9","type":"api-call-service","z":"5d4e860e6cd2bc1e","name":"Turn off cooking mode","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.cooking_mode"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1340,"y":1180,"wires":[[]]},{"id":"ccfc450e608bcfb5","type":"inject","z":"5d4e860e6cd2bc1e","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":620,"y":1120,"wires":[["398d31f8ad89bf85"]]},{"id":"1f8c38697d7c19bd","type":"server-state-changed","z":"5d4e860e6cd2bc1e","name":"Cooking mode turned on","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.cooking_mode","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"re","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":130,"y":1300,"wires":[[],[]]},{"id":"ee8ce8674a6b6ef1","type":"comment","z":"5d4e860e6cd2bc1e","name":"Turns lights white on cooking mode","info":"","x":140,"y":1260,"wires":[]},{"id":"093f80f9b2b1e66a","type":"trigger","z":"f9b109c0bb255002","name":"","op1":"1","op2":"","op1type":"num","op2type":"nul","duration":"100","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":1700,"y":400,"wires":[["dfbabf05fa5cf92e"]]},{"id":"9a3f87263f09b0b2","type":"switch","z":"f9b109c0bb255002","name":"","property":"action","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1950,"y":400,"wires":[["7a74a930a1141d90"]]},{"id":"46f8eec09a9ff3aa","type":"change","z":"f9b109c0bb255002","name":"set entity","rules":[{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"media_player.entrance_speaker","tot":"str","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":1240,"y":260,"wires":[["6a8f1ee04c484aa4"]]},{"id":"cc79564b75209d90","type":"api-current-state","z":"f9b109c0bb255002","name":"speaker","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is_not","entity_id":"media_player.entrance_speaker","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"entity","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":900,"y":280,"wires":[["820f24cc65413b0e"],["b3185c68d8b2faf4"]]},{"id":"bb9b700f9927c79b","type":"switch","z":"f9b109c0bb255002","name":"","property":"action","propertyType":"msg","rules":[{"t":"eq","v":"rotate_right","vt":"str"},{"t":"eq","v":"rotate_left","vt":"str"},{"t":"eq","v":"play_pause","vt":"str"},{"t":"eq","v":"skip_forward","vt":"str"},{"t":"eq","v":"skip_backward","vt":"str"}],"checkall":"true","repair":false,"outputs":5,"x":2390,"y":400,"wires":[["f6f236513913ff05"],["6fb4a916c92f88d7"],["3869e28f91f4e7bd"],["648b1f388f4379b9"],[]]},{"id":"eae8387612d1efe2","type":"change","z":"f9b109c0bb255002","name":"Move action","rules":[{"t":"set","p":"action","pt":"msg","to":"payload.action","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":670,"y":280,"wires":[["cc79564b75209d90"]]},{"id":"f6f236513913ff05","type":"api-call-service","z":"f9b109c0bb255002","name":"Brightnen light","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"{\"brightness_step_pct\": 10}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2640,"y":360,"wires":[[]]},{"id":"3869e28f91f4e7bd","type":"api-call-service","z":"f9b109c0bb255002","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"toggle","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2640,"y":440,"wires":[[]]},{"id":"6fb4a916c92f88d7","type":"api-call-service","z":"f9b109c0bb255002","name":"Dim light","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"{\"brightness_step_pct\": -10}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2620,"y":400,"wires":[[]]},{"id":"ad7397637c4b8993","type":"comment","z":"f9b109c0bb255002","name":"Set speakers entities","info":"","x":1250,"y":220,"wires":[]},{"id":"c30e143fb16dede9","type":"comment","z":"f9b109c0bb255002","name":"Is speaker off?","info":"","x":900,"y":240,"wires":[]},{"id":"fe3264d96714d793","type":"comment","z":"f9b109c0bb255002","name":"No","info":"","x":1070,"y":260,"wires":[]},{"id":"105bbcb8eb8b078e","type":"comment","z":"f9b109c0bb255002","name":"Yes","info":"","x":1070,"y":400,"wires":[]},{"id":"71f2fe12b5131671","type":"comment","z":"f9b109c0bb255002","name":"Move payload.action to action","info":"","x":660,"y":240,"wires":[]},{"id":"ddefa3da37bcda3f","type":"comment","z":"f9b109c0bb255002","name":"Monitor mqtt of living room dial","info":"","x":370,"y":240,"wires":[]},{"id":"7bbb03b8dde6fd17","type":"comment","z":"f9b109c0bb255002","name":"Check that action is not empty","info":"","x":1960,"y":360,"wires":[]},{"id":"ec295a52cb3eda1e","type":"switch","z":"f9b109c0bb255002","name":"","property":"action","propertyType":"msg","rules":[{"t":"eq","v":"rotate_right","vt":"str"},{"t":"eq","v":"play_pause","vt":"str"},{"t":"eq","v":"rotate_left","vt":"str"},{"t":"eq","v":"skip_forward","vt":"str"},{"t":"eq","v":"skip_backward","vt":"str"}],"checkall":"false","repair":false,"outputs":5,"x":1670,"y":260,"wires":[["fc36a5b7928a6db1"],["f5317d731f3f6572"],["944d4e4d788468b7"],["eeb12bfb7b658f63"],["d7e1143460b37f67"]]},{"id":"eeb12bfb7b658f63","type":"api-call-service","z":"f9b109c0bb255002","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"media_next_track","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1970,"y":160,"wires":[[]]},{"id":"fc36a5b7928a6db1","type":"api-call-service","z":"f9b109c0bb255002","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_up","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2010,"y":40,"wires":[[]]},{"id":"f5317d731f3f6572","type":"api-call-service","z":"f9b109c0bb255002","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"media_play_pause","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2010,"y":80,"wires":[[]]},{"id":"944d4e4d788468b7","type":"api-call-service","z":"f9b109c0bb255002","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_down","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1970,"y":120,"wires":[[]]},{"id":"7a74a930a1141d90","type":"change","z":"f9b109c0bb255002","name":"set entity","rules":[{"t":"delete","p":"payload","pt":"msg"},{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"light.group_entrance_main_lights","tot":"str","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":2180,"y":400,"wires":[["bb4edcf14931996e","bb9b700f9927c79b"]]},{"id":"f6ec7c45c1099efa","type":"comment","z":"f9b109c0bb255002","name":"Set Lights entities","info":"","x":2210,"y":360,"wires":[]},{"id":"bb4edcf14931996e","type":"debug","z":"f9b109c0bb255002","name":"debug 32","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":2360,"y":480,"wires":[]},{"id":"d7e1143460b37f67","type":"change","z":"f9b109c0bb255002","name":"set flow light mode = 1","rules":[{"t":"set","p":"lightmode","pt":"flow","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1900,"y":300,"wires":[["1ffa0a3b1b1cef2f"]]},{"id":"181034a28952456e","type":"change","z":"f9b109c0bb255002","name":"set flow light mode = 0","rules":[{"t":"set","p":"lightmode","pt":"flow","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":2320,"y":300,"wires":[[]]},{"id":"1ffa0a3b1b1cef2f","type":"trigger","z":"f9b109c0bb255002","name":"","op1":"","op2":"0","op1type":"nul","op2type":"str","duration":"10","extend":false,"overrideDelay":false,"units":"s","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":2110,"y":300,"wires":[["181034a28952456e"]]},{"id":"6a8f1ee04c484aa4","type":"switch","z":"f9b109c0bb255002","name":"Light mode off?","property":"lightmode","propertyType":"flow","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"eq","v":"1","vt":"num"},{"t":"null"}],"checkall":"true","repair":false,"outputs":3,"x":1440,"y":260,"wires":[["e0cf5c45b188f5cf"],["4a33f81d6476ee85"],["e0cf5c45b188f5cf"]]},{"id":"648b1f388f4379b9","type":"api-call-service","z":"f9b109c0bb255002","name":"Max white brightness","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"{\"brightness_pct\": 100,\"color_name\": \"white\"}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2660,"y":500,"wires":[[]]},{"id":"533c03f8e53b7c19","type":"comment","z":"f9b109c0bb255002","name":"These nodes set a flow variable to \"1\" for 10 seconds before setting it to \"0\"","info":"","x":2120,"y":260,"wires":[]},{"id":"5f8099e6e14d3821","type":"mqtt in","z":"f9b109c0bb255002","name":"","topic":"zigbee2mqtt/remote_entrance_dial","qos":"2","datatype":"json","broker":"21000c19b97da572","nl":false,"rap":true,"rh":0,"inputs":0,"x":360,"y":280,"wires":[[]]},{"id":"dcad8298db9f6e05","type":"comment","z":"f9b109c0bb255002","name":"Monitor mqtt of living room dial","info":"","x":510,"y":540,"wires":[]},{"id":"cf09066407f160f4","type":"debug","z":"f9b109c0bb255002","name":"mqtt","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":910,"y":580,"wires":[]},{"id":"afecf1399e86a3be","type":"debug","z":"f9b109c0bb255002","name":"debug 35","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1140,"y":140,"wires":[]},{"id":"7678b774f14479c5","type":"trigger-state","z":"f9b109c0bb255002","name":"","server":"7ab5c227.a3ce8c","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"lock.lock_front_door","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"unlocked","propertyValue":"new_state.state"},{"targetType":"this_entity","targetValue":"","propertyType":"property","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"","propertyValue":""}],"inputs":0,"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","enableInput":false,"x":270,"y":1140,"wires":[[],[]]},{"id":"78faea2e6e741bc1","type":"api-call-service","z":"f9b109c0bb255002","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"automation","service":"trigger","areaId":[],"deviceId":[],"entityId":["automation.clean_the_hallway"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2000,"y":860,"wires":[["dabb203a4c466783"]]},{"id":"88cac6cd93921dd9","type":"api-call-service","z":"f9b109c0bb255002","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"vacuum","service":"set_fan_speed","areaId":[],"deviceId":[],"entityId":["vacuum.xiaomi_vacuum_cleaner"],"data":"{\"fan_speed\": \"Turbo\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2520,"y":860,"wires":[[]]},{"id":"aa233de06fdaee3e","type":"ha-wait-until","z":"f9b109c0bb255002","name":"","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"vacuum.xiaomi_vacuum_cleaner","entityIdFilterType":"exact","property":"state","comparator":"is","value":"docked","valueType":"str","timeout":"15","timeoutType":"num","timeoutUnits":"minutes","checkCurrentState":false,"blockInputOverrides":true,"outputProperties":[],"x":2320,"y":860,"wires":[["88cac6cd93921dd9"],[]]},{"id":"dabb203a4c466783","type":"delay","z":"f9b109c0bb255002","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":2180,"y":860,"wires":[["aa233de06fdaee3e"]]},{"id":"f837081db80fd1c8","type":"api-call-service","z":"f9b109c0bb255002","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"automation","service":"trigger","areaId":[],"deviceId":[],"entityId":["automation.clean_the_hallway"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1720,"y":820,"wires":[["1c765a9b48b7a846"]]},{"id":"1381f587bd5f9237","type":"api-call-service","z":"f9b109c0bb255002","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"vacuum","service":"set_fan_speed","areaId":[],"deviceId":[],"entityId":["vacuum.xiaomi_vacuum_cleaner"],"data":"{\"fan_speed\": \"Turbo\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2260,"y":820,"wires":[[]]},{"id":"e0dcd8a5a87d76d2","type":"ha-wait-until","z":"f9b109c0bb255002","name":"","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"vacuum.xiaomi_vacuum_cleaner","entityIdFilterType":"exact","property":"state","comparator":"is","value":"docked","valueType":"str","timeout":"15","timeoutType":"num","timeoutUnits":"minutes","checkCurrentState":false,"blockInputOverrides":true,"outputProperties":[],"x":2060,"y":820,"wires":[["1381f587bd5f9237"],[]]},{"id":"1c765a9b48b7a846","type":"delay","z":"f9b109c0bb255002","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":1920,"y":820,"wires":[["e0dcd8a5a87d76d2"]]},{"id":"f87f02c87a9e4e9d","type":"api-call-service","z":"f9b109c0bb255002","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"vacuum","service":"set_fan_speed","areaId":[],"deviceId":[],"entityId":["vacuum.xiaomi_vacuum_cleaner"],"data":"{\"fan_speed\":\"Silent\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1740,"y":860,"wires":[["78faea2e6e741bc1"]]},{"id":"3812c5eea22d49a1","type":"server-state-changed","z":"f9b109c0bb255002","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"lock.lock_front_door","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","outputs":1,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":220,"y":1060,"wires":[[]]},{"id":"476dcf67fa5d0e9a","type":"debug","z":"f9b109c0bb255002","name":"entity","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":490,"y":1080,"wires":[]},{"id":"49bcf5b247e8b3fd","type":"mqtt in","z":"f9b109c0bb255002","name":"","topic":"zigbee2mqtt/lock_front_door","qos":"2","datatype":"json","broker":"21000c19b97da572","nl":false,"rap":true,"rh":0,"inputs":0,"x":160,"y":820,"wires":[["dbb93a94a8407a0f"]]},{"id":"dbb93a94a8407a0f","type":"switch","z":"f9b109c0bb255002","name":"Unlock action?","property":"payload.action","propertyType":"msg","rules":[{"t":"eq","v":"unlock","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":440,"y":820,"wires":[["3cd5e02d21e9729b"]]},{"id":"9745133222d64b87","type":"api-current-state","z":"f9b109c0bb255002","name":"Livingroom Chromecast playing?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"playing","halt_if_type":"str","halt_if_compare":"is_not","entity_id":"media_player.livingroom_chromecast","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":1440,"y":820,"wires":[["f837081db80fd1c8"],["f87f02c87a9e4e9d"]]},{"id":"3cd5e02d21e9729b","type":"delay","z":"f9b109c0bb255002","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":740,"y":820,"wires":[["119e501a9a3a3f43"]]},{"id":"119e501a9a3a3f43","type":"api-current-state","z":"f9b109c0bb255002","name":"Livingroom Chromecast playing?","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"docked","halt_if_type":"str","halt_if_compare":"is","entity_id":"vacuum.xiaomi_vacuum_cleaner","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":1000,"y":820,"wires":[[],[]]},{"id":"1d53e0436b4d96b7","type":"mqtt in","z":"f9b109c0bb255002","name":"","topic":"zigbee2mqtt/remote_hallway_dial","qos":"2","datatype":"json","broker":"21000c19b97da572","nl":false,"rap":true,"rh":0,"inputs":0,"x":190,"y":1620,"wires":[["348f076b5a914b56"]]},{"id":"348f076b5a914b56","type":"subflow:61f53235c712b2c2","z":"f9b109c0bb255002","name":"","x":450,"y":1620,"wires":[]},{"id":"5c34340a6b57d5cc","type":"mqtt in","z":"45ec21e855a2c144","name":"","topic":"zigbee2mqtt/remote_hotbox_top_dial","qos":"2","datatype":"json","broker":"21000c19b97da572","nl":false,"rap":true,"rh":0,"inputs":0,"x":160,"y":800,"wires":[["7e46f5ac55d59601"]]},{"id":"50957135e3ab67f7","type":"server-state-changed","z":"45ec21e855a2c144","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.sleeper_in_hotbox_down","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":200,"y":1620,"wires":[["d69f1bece257855c"],[]]},{"id":"aab499590f5db012","type":"ha-get-entities","z":"45ec21e855a2c144","name":"Get active hotbox top Media players","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"entity_id","logic":"is","value":"media_player\\.(?!.*?group.*?)(?!.*?down.*?).*hotbox.*","valueType":"re"},{"property":"state","logic":"is","value":"playing","valueType":"str"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":800,"y":1560,"wires":[["6c8cfb64761ae819"]]},{"id":"6c8cfb64761ae819","type":"change","z":"45ec21e855a2c144","name":"","rules":[{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"payload.entity_id","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":1510,"y":1560,"wires":[["6825f929f1cd797c"]]},{"id":"f9759cd1a4672059","type":"comment","z":"45ec21e855a2c144","name":"Extract the entity id","info":"","x":1510,"y":1520,"wires":[]},{"id":"10b7e8785085c443","type":"comment","z":"45ec21e855a2c144","name":"Set 20% volume","info":"","x":1760,"y":1580,"wires":[]},{"id":"af87da9ee5ee6de9","type":"comment","z":"45ec21e855a2c144","name":"Extract the entity id","info":"","x":1130,"y":1740,"wires":[]},{"id":"6825f929f1cd797c","type":"api-call-service","z":"45ec21e855a2c144","name":"Volume 20%","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_set","areaId":[],"deviceId":[],"entityId":[],"data":"{\"volume_level\": \"0.2\"}","dataType":"json","mergeContext":"","mustacheAltTags":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"payload.entity_id","valueType":"msg"}],"queue":"none","x":1750,"y":1620,"wires":[["03f0e80e82abaa7a"]]},{"id":"52d1054ff0d8a495","type":"api-call-service","z":"45ec21e855a2c144","name":"mute player","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_mute","areaId":[],"deviceId":[],"entityId":[],"data":"{\"is_volume_muted\":\"true\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3010,"y":1620,"wires":[["cc92a79f8ac80835"]]},{"id":"03f0e80e82abaa7a","type":"ha-wait-until","z":"45ec21e855a2c144","name":"","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"{{ payload}}","entityIdFilterType":"exact","property":"state","comparator":"is","value":"off","valueType":"str","timeout":"90","timeoutType":"num","timeoutUnits":"minutes","checkCurrentState":true,"blockInputOverrides":true,"outputProperties":[],"x":1960,"y":1620,"wires":[["dbdd72f70d06fcf5","033fd366944c5670"],["dbdd72f70d06fcf5","033fd366944c5670"]]},{"id":"a78a366897c6c3a4","type":"comment","z":"45ec21e855a2c144","name":"Move entity_id to data","info":"","x":2180,"y":1580,"wires":[]},{"id":"c6ac14de03348bd6","type":"comment","z":"45ec21e855a2c144","name":"Wait till media ends","info":"","x":1970,"y":1580,"wires":[]},{"id":"dbdd72f70d06fcf5","type":"change","z":"45ec21e855a2c144","name":"","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.data.entity_id","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":2170,"y":1620,"wires":[["c03301b003ce3a9c"]]},{"id":"c03301b003ce3a9c","type":"api-call-service","z":"45ec21e855a2c144","name":"turn on for mute","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2520,"y":1620,"wires":[["525ea20afe938830"]]},{"id":"d266250440de4bea","type":"api-call-service","z":"45ec21e855a2c144","name":"turn off post mute","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"turn_off","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":3630,"y":1620,"wires":[[]]},{"id":"cc92a79f8ac80835","type":"delay","z":"45ec21e855a2c144","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":3200,"y":1620,"wires":[["22ecd73be25b1f1c"]]},{"id":"525ea20afe938830","type":"delay","z":"45ec21e855a2c144","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":2820,"y":1620,"wires":[["52d1054ff0d8a495"]]},{"id":"1f7bb88f84d15b15","type":"comment","z":"45ec21e855a2c144","name":"Pull hotbox top media players that are playing","info":"","x":830,"y":1520,"wires":[]},{"id":"2c9fe7dcab8d2ad6","type":"comment","z":"45ec21e855a2c144","name":"Turn on the media_player so we can set it's volume","info":"","x":2490,"y":1580,"wires":[]},{"id":"d50154c5ff7abc86","type":"comment","z":"45ec21e855a2c144","name":"Mute player","info":"","x":3010,"y":1580,"wires":[]},{"id":"574b860ccac28c53","type":"comment","z":"45ec21e855a2c144","name":"Turn player back off","info":"","x":3630,"y":1580,"wires":[]},{"id":"d69f1bece257855c","type":"api-current-state","z":"45ec21e855a2c144","name":"Hotbox top occupancy","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.sensor_hotbox_top_motion_occupancy","state_type":"str","blockInputOverrides":false,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":540,"y":1620,"wires":[["aab499590f5db012","58315d58d7ea44dd"],["31257fc2008bfb16","d8c423e20df2d58d"]]},{"id":"31257fc2008bfb16","type":"ha-get-entities","z":"45ec21e855a2c144","name":"Get active hotbox top Media players","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"entity_id","logic":"is","value":"media_player\\.(?!.*?group.*?)(?!.*?plex.*?)(?!.*?down.*?).*hotbox.*","valueType":"re"},{"property":"state","logic":"is","value":"playing","valueType":"str"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":800,"y":1700,"wires":[["a2632d156a2d8c74"]]},{"id":"a2632d156a2d8c74","type":"change","z":"45ec21e855a2c144","name":"","rules":[{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"payload.entity_id","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":1110,"y":1700,"wires":[["462a40c733a907f2"]]},{"id":"462a40c733a907f2","type":"api-call-service","z":"45ec21e855a2c144","name":"mute player","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_mute","areaId":[],"deviceId":[],"entityId":[],"data":"{\"is_volume_muted\":\"true\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1350,"y":1700,"wires":[["13d226cd1bb6cef9"]]},{"id":"17bfa413e8373695","type":"api-call-service","z":"45ec21e855a2c144","name":"turn off post mute","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"turn_off","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2050,"y":1700,"wires":[[]]},{"id":"13d226cd1bb6cef9","type":"delay","z":"45ec21e855a2c144","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1540,"y":1700,"wires":[["c2ce2a97e3a41055"]]},{"id":"879f0fef37a4db6e","type":"comment","z":"45ec21e855a2c144","name":"Mute player","info":"","x":1350,"y":1740,"wires":[]},{"id":"89b1fc0dd9aef127","type":"comment","z":"45ec21e855a2c144","name":"Turn player back off","info":"","x":2050,"y":1740,"wires":[]},{"id":"15109df6877c80df","type":"comment","z":"45ec21e855a2c144","name":"Pull hotbox top media players that are playing","info":"","x":790,"y":1740,"wires":[]},{"id":"e4e3cf888494e014","type":"comment","z":"45ec21e855a2c144","name":"Change hotbox top media volumes upon sleep","info":"","x":190,"y":1580,"wires":[]},{"id":"22ecd73be25b1f1c","type":"api-current-state","z":"45ec21e855a2c144","name":"Home_Group off","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"media_player.group_home_speakers","state_type":"str","blockInputOverrides":true,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":3400,"y":1620,"wires":[["d266250440de4bea"],[]]},{"id":"c2ce2a97e3a41055","type":"api-current-state","z":"45ec21e855a2c144","name":"Home_Group off","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"media_player.group_home_speakers","state_type":"str","blockInputOverrides":true,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":1760,"y":1700,"wires":[["17bfa413e8373695"],[]]},{"id":"afd9babff9388871","type":"comment","z":"45ec21e855a2c144","name":"MAke sure home_group is not playing","info":"","x":3410,"y":1580,"wires":[]},{"id":"32a93bf221600c51","type":"comment","z":"45ec21e855a2c144","name":"MAke sure home_group is not playing","info":"","x":1770,"y":1740,"wires":[]},{"id":"d8c423e20df2d58d","type":"api-call-service","z":"45ec21e855a2c144","name":"turn off hotbox top roku","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"remote","service":"turn_off","areaId":[],"deviceId":[],"entityId":["remote.hotbox_top_roku"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":770,"y":1660,"wires":[["f6b5f9d9b4860a5e"]]},{"id":"033fd366944c5670","type":"api-call-service","z":"45ec21e855a2c144","name":"turn off hotbox top roku","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"remote","service":"turn_off","areaId":[],"deviceId":[],"entityId":["remote.hotbox_top_roku"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2190,"y":1660,"wires":[[]]},{"id":"0b69150b7a9a95c6","type":"api-call-service","z":"45ec21e855a2c144","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"turn_off","areaId":[],"deviceId":[],"entityId":["media_player.hotbox_top_display"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1160,"y":2160,"wires":[["66c9a14d7fa22181"]]},{"id":"206d2782d0dbd7a9","type":"inject","z":"45ec21e855a2c144","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":1190,"y":2100,"wires":[["0b69150b7a9a95c6","66c9a14d7fa22181"]]},{"id":"41272be233163915","type":"trigger","z":"45ec21e855a2c144","name":"","op1":"","op2":"","op1type":"pay","op2type":"nul","duration":"1","extend":false,"overrideDelay":false,"units":"min","reset":"seT","bytopic":"all","topic":"topic","outputs":1,"x":810,"y":2060,"wires":[["a480bb278e16f60d"]]},{"id":"66c9a14d7fa22181","type":"trigger","z":"45ec21e855a2c144","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"2","extend":false,"overrideDelay":false,"units":"s","reset":"seT","bytopic":"all","topic":"topic","outputs":1,"x":1400,"y":2160,"wires":[["e571c28a1b931d5f"]]},{"id":"2c6fdf2c45f16827","type":"server-state-changed","z":"45ec21e855a2c144","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"media_player.hotbox_top_display","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"playing","halt_if_type":"str","halt_if_compare":"is_not","outputs":2,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":520,"y":2060,"wires":[["41272be233163915","d1145ba3e3471a38"],["d1145ba3e3471a38"]]},{"id":"e214de35cf5e1e55","type":"api-call-service","z":"45ec21e855a2c144","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"cast","service":"show_lovelace_view","areaId":[],"deviceId":[],"entityId":["media_player.hotbox_top_display"],"data":"{\"dashboard_path\":\"lovelace-hub\",\"view_path\":\"hotbox_top_hub\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2110,"y":2160,"wires":[[]]},{"id":"d1145ba3e3471a38","type":"debug","z":"45ec21e855a2c144","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":830,"y":1980,"wires":[]},{"id":"7e46f5ac55d59601","type":"subflow:61f53235c712b2c2","z":"45ec21e855a2c144","name":"","x":430,"y":800,"wires":[]},{"id":"1b50ae8c02c1095d","type":"server-state-changed","z":"45ec21e855a2c144","name":"Trigger on hotbox top occupancy","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.sensor_hotbox_top_motion_occupancy","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":150,"y":1340,"wires":[[],[]]},{"id":"9b624ca440220d43","type":"api-call-service","z":"45ec21e855a2c144","name":"Turn on Xbox","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"remote","service":"turn_on","areaId":[],"deviceId":[],"entityId":["remote.xboxone_remote"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":490,"y":1280,"wires":[[]]},{"id":"8d12baa1b69f5dcb","type":"api-call-service","z":"45ec21e855a2c144","name":"Turn on Top Roku on Chromecast","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"select_source","areaId":[],"deviceId":[],"entityId":["media_player.hotbox_top_roku"],"data":"{\"source\": \"Chromecast\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":780,"y":1440,"wires":[[]]},{"id":"21932aa4a41aa598","type":"api-call-service","z":"45ec21e855a2c144","name":"turn off hotbox top roku","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"remote","service":"turn_off","areaId":[],"deviceId":[],"entityId":["remote.hotbox_top_roku"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1210,"y":1620,"wires":[[]]},{"id":"9afc64173e76277d","type":"ha-wait-until","z":"45ec21e855a2c144","name":"","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"binary_sensor.sensor_hotbox_top_motion_occupancy","entityIdFilterType":"exact","property":"state","comparator":"is","value":"off","valueType":"str","timeout":"4","timeoutType":"num","timeoutUnits":"hours","checkCurrentState":true,"blockInputOverrides":true,"outputProperties":[],"x":960,"y":1620,"wires":[["21932aa4a41aa598"],[]]},{"id":"830a27868cd981ed","type":"trigger-state","z":"45ec21e855a2c144","name":"","server":"7ab5c227.a3ce8c","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"sensor.hotbox_top_roku_active_app","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"Xbox One","propertyValue":"new_state.state"}],"inputs":0,"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","enableInput":false,"x":200,"y":1280,"wires":[["9b624ca440220d43"],[]]},{"id":"120355545cc415e1","type":"trigger-state","z":"45ec21e855a2c144","name":"","server":"7ab5c227.a3ce8c","version":2,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityid":"binary_sensor.sensor_hotbox_top_motion_occupancy","entityidfiltertype":"exact","debugenabled":false,"constraints":[{"targetType":"entity_id","targetValue":"remote.hotbox_top_roku","propertyType":"property","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"off","propertyValue":"state"},{"targetType":"this_entity","targetValue":"","propertyType":"current_state","comparatorType":"is","comparatorValueDatatype":"str","comparatorValue":"on","propertyValue":"new_state.state"}],"inputs":0,"outputs":2,"customoutputs":[],"outputinitially":false,"state_type":"str","enableInput":false,"x":260,"y":1440,"wires":[["8d12baa1b69f5dcb"],[]]},{"id":"d79e75e150c9a68e","type":"comment","z":"45ec21e855a2c144","name":"Change hotbox top media volumes upon sleep","info":"","x":190,"y":1400,"wires":[]},{"id":"e571c28a1b931d5f","type":"api-current-state","z":"45ec21e855a2c144","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.sleeper_in_hotbox_down","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":1720,"y":2160,"wires":[["e214de35cf5e1e55"],[]]},{"id":"58315d58d7ea44dd","type":"delay","z":"45ec21e855a2c144","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":780,"y":1620,"wires":[["9afc64173e76277d"]]},{"id":"f6b5f9d9b4860a5e","type":"api-call-service","z":"45ec21e855a2c144","name":"turn off hotbox top roku","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"remote","service":"turn_off","areaId":[],"deviceId":[],"entityId":["remote.hotbox_top_roku"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1010,"y":1660,"wires":[["61255fa28173321a"]]},{"id":"61255fa28173321a","type":"api-call-service","z":"45ec21e855a2c144","name":"turn off hotbox top roku","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"remote","service":"turn_off","areaId":[],"deviceId":[],"entityId":["remote.hotbox_top_roku"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1250,"y":1660,"wires":[[]]},{"id":"42118864ce9e481b","type":"inject","z":"45ec21e855a2c144","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"on","payloadType":"str","x":1950,"y":2080,"wires":[["e214de35cf5e1e55"]]},{"id":"a480bb278e16f60d","type":"trigger","z":"45ec21e855a2c144","name":"","op1":"","op2":"0","op1type":"pay","op2type":"str","duration":"-15","extend":false,"overrideDelay":false,"units":"min","reset":"seT","bytopic":"all","topic":"topic","outputs":1,"x":950,"y":2100,"wires":[["0b69150b7a9a95c6"]]},{"id":"1bbe98d3c44251b1","type":"server-state-changed","z":"a17f73eee8c0a729","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.sleeper_in_hotbox_down","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":1240,"y":1000,"wires":[["14ebb333aa8a918b"],["59cb3f8a14aeb306"]]},{"id":"d884f13121a2a86b","type":"api-call-service","z":"a17f73eee8c0a729","name":"Toggle Sleeper in Hotbox bool","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"toggle","areaId":[],"deviceId":[],"entityId":["input_boolean.sleeper_in_hotbox_down"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":630,"y":960,"wires":[[]]},{"id":"35988e1bac6627e9","type":"server-state-changed","z":"a17f73eee8c0a729","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.remote_hotbox_sleeper_button_action","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":220,"y":960,"wires":[["d884f13121a2a86b"],[]]},{"id":"7be5556007b48f42","type":"comment","z":"a17f73eee8c0a729","name":"Toggle the \"sleeper in hotbox\" boolean","info":"","x":630,"y":920,"wires":[]},{"id":"14ebb333aa8a918b","type":"ha-get-entities","z":"a17f73eee8c0a729","name":"Get individual Hotbox lights","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"entity_id","logic":"is","value":"light\\.(?!.*?group.*?)(?!.*?lights.*?).*hotbox.*","valueType":"re"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":1600,"y":980,"wires":[["0589a32b791104e0"]]},{"id":"af0dd82fa94b457f","type":"api-call-service","z":"a17f73eee8c0a729","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2170,"y":980,"wires":[[]]},{"id":"59cb3f8a14aeb306","type":"ha-get-entities","z":"a17f73eee8c0a729","name":"Get individual Hotbox down lights","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"entity_id","logic":"is","value":"light\\.(?!.*?group.*?)(?!.*?lights.*?).*hotbox_down.*","valueType":"re"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":1620,"y":1020,"wires":[["9fdb22ec471ede35"]]},{"id":"d89f42e5f95976ed","type":"api-call-service","z":"a17f73eee8c0a729","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"{\"transition\":\"40\",\"color_name\": \"white\"}","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2170,"y":1020,"wires":[[]]},{"id":"49cb2f44d12b6ce0","type":"comment","z":"a17f73eee8c0a729","name":"Trigger on Sleeper boolean change","info":"","x":1240,"y":960,"wires":[]},{"id":"d73faf6663c874a9","type":"comment","z":"a17f73eee8c0a729","name":"Get hotbox light entities","info":"","x":1600,"y":940,"wires":[]},{"id":"93cf89b029fc719d","type":"comment","z":"a17f73eee8c0a729","name":"Call light_off service","info":"","x":2170,"y":940,"wires":[]},{"id":"310a83320c8378c0","type":"comment","z":"a17f73eee8c0a729","name":"Toggle the hotbox lights and TVs when someone sleeps","info":"","x":1260,"y":920,"wires":[]},{"id":"1b3b271561ede431","type":"comment","z":"a17f73eee8c0a729","name":"Double press on the hotbox sleep button","info":"","x":220,"y":920,"wires":[]},{"id":"0589a32b791104e0","type":"change","z":"a17f73eee8c0a729","name":"","rules":[{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"payload.entity_id","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":1890,"y":980,"wires":[["af0dd82fa94b457f"]]},{"id":"9fdb22ec471ede35","type":"change","z":"a17f73eee8c0a729","name":"","rules":[{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"payload.entity_id","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":1910,"y":1020,"wires":[["d89f42e5f95976ed"]]},{"id":"16e7fb91db3af7ed","type":"server-state-changed","z":"a17f73eee8c0a729","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.sleeper_in_hotbox_down","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":200,"y":1000,"wires":[["623f4323d992a4fa"],["623f4323d992a4fa"]]},{"id":"623f4323d992a4fa","type":"trigger","z":"a17f73eee8c0a729","name":"","op1":"","op2":"1","op1type":"nul","op2type":"str","duration":"10","extend":false,"overrideDelay":false,"units":"hr","reset":"off","bytopic":"all","topic":"topic","outputs":1,"x":490,"y":1000,"wires":[["d0dd30b7c460c053"]]},{"id":"d0dd30b7c460c053","type":"api-call-service","z":"a17f73eee8c0a729","name":"Turn off Sleeper in Hotbox bool","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"homeassistant","service":"turn_off","areaId":[],"deviceId":[],"entityId":["input_boolean.sleeper_in_hotbox_down"],"data":"","dataType":"jsonata","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":710,"y":1000,"wires":[[]]},{"id":"c901c749ae865ef9","type":"server-state-changed","z":"a17f73eee8c0a729","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.sleeper_in_hotbox_down","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":1240,"y":1160,"wires":[["b8172514ff706b09"],[]]},{"id":"2ca7f17478daa076","type":"comment","z":"a17f73eee8c0a729","name":"Trigger on Sleeper boolean change","info":"","x":1220,"y":1120,"wires":[]},{"id":"b8172514ff706b09","type":"ha-get-entities","z":"a17f73eee8c0a729","name":"Get hotbox Media players","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"entity_id","logic":"is","value":"media_player\\.(?!.*?group.*?)(?!.*?display.*?)(?!.*?roku.*?).*hotbox.*","valueType":"re"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":1610,"y":1160,"wires":[["d54ea00bdee7d499"]]},{"id":"d4e5ac0df1fa3864","type":"comment","z":"a17f73eee8c0a729","name":"Pull hotbox down media players","info":"","x":1610,"y":1120,"wires":[]},{"id":"d54ea00bdee7d499","type":"change","z":"a17f73eee8c0a729","name":"","rules":[{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"payload.entity_id","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":1870,"y":1160,"wires":[["837c7885cdb7a55e","8fd47233580b3fea"]]},{"id":"bf60e0bd3afc2fdd","type":"comment","z":"a17f73eee8c0a729","name":"Is the input \"Xbox One\"? ","info":"","x":1900,"y":1600,"wires":[]},{"id":"98c1cccc2bb53bb6","type":"comment","z":"a17f73eee8c0a729","name":"Stop playback","info":"","x":2810,"y":1120,"wires":[]},{"id":"8ccacac9494ee667","type":"api-call-service","z":"a17f73eee8c0a729","name":"stop player","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"turn_off","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2810,"y":1160,"wires":[[]]},{"id":"237186ed03f52741","type":"api-call-service","z":"a17f73eee8c0a729","name":"mute player","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_mute","areaId":[],"deviceId":[],"entityId":[],"data":"{\"is_volume_muted\":\"true\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2330,"y":1160,"wires":[["e32356b61fc49f34","a22a8be707643fd8"]]},{"id":"e32356b61fc49f34","type":"api-current-state","z":"a17f73eee8c0a729","name":"Home_Group off","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"media_player.group_home_speakers","state_type":"str","blockInputOverrides":true,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":2580,"y":1160,"wires":[["8ccacac9494ee667"],[]]},{"id":"ac95e3abcfc1a10d","type":"comment","z":"a17f73eee8c0a729","name":"MAke sure home_group is not playing","info":"","x":2590,"y":1120,"wires":[]},{"id":"94913e1ac1efa8cf","type":"mqtt in","z":"a17f73eee8c0a729","name":"","topic":"zigbee2mqtt/remote_hotbox_down_dial","qos":"2","datatype":"json","broker":"21000c19b97da572","nl":false,"rap":true,"rh":0,"inputs":0,"x":190,"y":780,"wires":[["968f93b8a0e17a8f","999fed48de5f5a88"]]},{"id":"968f93b8a0e17a8f","type":"subflow:61f53235c712b2c2","z":"a17f73eee8c0a729","name":"","x":470,"y":780,"wires":[]},{"id":"66ee8459781b4746","type":"server-state-changed","z":"a17f73eee8c0a729","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.sleeper_in_hotbox_down","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"1","forType":"num","forUnits":"seconds","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":1240,"y":1360,"wires":[["03d1818d6e4d03fc"],["9b1f99cb3bbd0946"]]},{"id":"98c2c027ee5eeee9","type":"comment","z":"a17f73eee8c0a729","name":"Trigger on Sleeper boolean change","info":"","x":1220,"y":1320,"wires":[]},{"id":"03d1818d6e4d03fc","type":"api-call-service","z":"a17f73eee8c0a729","name":"Power off Hotbox Down TV","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"google_assistant_sdk","service":"send_text_command","areaId":[],"deviceId":[],"entityId":[],"data":"{\"command\":\"power off hotbox down TV\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1660,"y":1300,"wires":[[]]},{"id":"0f6b1d8651c9b547","type":"comment","z":"a17f73eee8c0a729","name":"Power off Hotbox Down TV through google SDK","info":"","x":1720,"y":1260,"wires":[]},{"id":"6193aa301369ecc1","type":"api-call-service","z":"a17f73eee8c0a729","name":"Power on Hotbox Down TV","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"google_assistant_sdk","service":"send_text_command","areaId":[],"deviceId":[],"entityId":[],"data":"{\"command\":\"power on hotbox down TV\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1740,"y":1400,"wires":[[]]},{"id":"8362e90798f6e786","type":"comment","z":"a17f73eee8c0a729","name":"Power on Hotbox Down TV through google SDK","info":"","x":1780,"y":2020,"wires":[]},{"id":"9608d3769a306c88","type":"server-state-changed","z":"a17f73eee8c0a729","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.sleeper_in_hotbox_down","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":1240,"y":1640,"wires":[["4b8f43c629bec0cd"],[]]},{"id":"91e7cecc7dbecd99","type":"comment","z":"a17f73eee8c0a729","name":"Trigger on Sleeper boolean change","info":"","x":1220,"y":1600,"wires":[]},{"id":"c9c9112b9f219ebc","type":"api-call-service","z":"a17f73eee8c0a729","name":"Shut down xbox","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"remote","service":"turn_off","areaId":[],"deviceId":[],"entityId":["remote.xboxone_remote"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2300,"y":1640,"wires":[[]]},{"id":"0f9df898ed43c2c9","type":"comment","z":"a17f73eee8c0a729","name":"Shut down Xbox","info":"","x":2300,"y":1600,"wires":[]},{"id":"4b8f43c629bec0cd","type":"api-current-state","z":"a17f73eee8c0a729","name":"Current TV input","server":"7ab5c227.a3ce8c","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"media_player.hotbox_top_roku","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":1600,"y":1640,"wires":[["444b4e57e28955dd","286351f16f292d7f"]]},{"id":"444b4e57e28955dd","type":"debug","z":"a17f73eee8c0a729","name":"debug 125","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1770,"y":1680,"wires":[]},{"id":"286351f16f292d7f","type":"switch","z":"a17f73eee8c0a729","name":"Is tv on xbox","property":"data.attributes.app_name","propertyType":"msg","rules":[{"t":"neq","v":"Xbox One","vt":"str"},{"t":"eq","v":"Xbox One","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":1890,"y":1640,"wires":[["c9c9112b9f219ebc"],["2aa00909aea38c63"]]},{"id":"520c293179ea4fdf","type":"inject","z":"a17f73eee8c0a729","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1411.82958984375,"y":1726.7178955078125,"wires":[["4b8f43c629bec0cd"]]},{"id":"52696ddce1e7401f","type":"comment","z":"a17f73eee8c0a729","name":"Power on Hotbox Down TV through google SDK","info":"","x":1720,"y":1360,"wires":[]},{"id":"2aa00909aea38c63","type":"ha-wait-until","z":"a17f73eee8c0a729","name":"Wait till top tv turns off","server":"7ab5c227.a3ce8c","version":2,"outputs":1,"entityId":"remote.hotbox_top_roku","entityIdFilterType":"exact","property":"state","comparator":"is","value":"off","valueType":"str","timeout":0,"timeoutType":"num","timeoutUnits":"seconds","checkCurrentState":true,"blockInputOverrides":true,"outputProperties":[],"x":2100,"y":1660,"wires":[["c9c9112b9f219ebc"]]},{"id":"9b1f99cb3bbd0946","type":"delay","z":"a17f73eee8c0a729","name":"","pauseType":"delay","timeout":"25","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":1540,"y":1400,"wires":[["6193aa301369ecc1"]]},{"id":"c2e209c279bb7993","type":"comment","z":"a17f73eee8c0a729","name":"Extract the current TV state entity","info":"","x":1590,"y":1600,"wires":[]},{"id":"69101c2f18536d2e","type":"server-state-changed","z":"a17f73eee8c0a729","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"media_player.hotbox_down_display","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"playing","halt_if_type":"str","halt_if_compare":"is_not","outputs":2,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":490,"y":300,"wires":[["c5712fabaac55607","fd9d5a1c595d2032"],["c5712fabaac55607"]]},{"id":"c5712fabaac55607","type":"debug","z":"a17f73eee8c0a729","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":790,"y":120,"wires":[]},{"id":"eb33f904396cbd66","type":"trigger","z":"a17f73eee8c0a729","name":"","op1":"","op2":"","op1type":"nul","op2type":"pay","duration":"1","extend":false,"overrideDelay":false,"units":"s","reset":"seT","bytopic":"all","topic":"topic","outputs":1,"x":1600,"y":260,"wires":[["d6ad282bdce810d5"]]},{"id":"d6ad282bdce810d5","type":"api-call-service","z":"a17f73eee8c0a729","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"cast","service":"show_lovelace_view","areaId":[],"deviceId":[],"entityId":["media_player.hotbox_down_display"],"data":"{\"dashboard_path\":\"lovelace-hub\",\"view_path\":\"hotbox-down-hub\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1790,"y":300,"wires":[[]]},{"id":"fd9d5a1c595d2032","type":"api-current-state","z":"a17f73eee8c0a729","name":"","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.sleeper_in_hotbox_down","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":940,"y":300,"wires":[["ba93755bea8e2617"],[]]},{"id":"7cba555a995aec1e","type":"server-state-changed","z":"a17f73eee8c0a729","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.sleeper_in_hotbox_down","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"","forType":"num","forUnits":"seconds","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":640,"y":540,"wires":[["78e4941095a5010b"],["9d612ca0ad4ca8a8"]]},{"id":"b9b878fa9596feaf","type":"comment","z":"a17f73eee8c0a729","name":"Trigger on Sleeper boolean change","info":"","x":620,"y":500,"wires":[]},{"id":"dcf660f8b8948b2b","type":"comment","z":"a17f73eee8c0a729","name":"Power off Google Hub","info":"","x":1040,"y":440,"wires":[]},{"id":"61b2575cefa66b52","type":"comment","z":"a17f73eee8c0a729","name":"Power on Google hub ","info":"","x":1040,"y":560,"wires":[]},{"id":"9d612ca0ad4ca8a8","type":"api-call-service","z":"a17f73eee8c0a729","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"cast","service":"show_lovelace_view","areaId":[],"deviceId":[],"entityId":["media_player.hotbox_down_display"],"data":"{\"dashboard_path\":\"lovelace-hub\",\"view_path\":\"hotbox-down-hub\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1070,"y":600,"wires":[["e47acf030a60c248"]]},{"id":"0bb593b82ff917d5","type":"inject","z":"a17f73eee8c0a729","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":920,"y":260,"wires":[["accd20fd1f421698"]]},{"id":"78e4941095a5010b","type":"api-call-service","z":"a17f73eee8c0a729","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"turn_off","areaId":[],"deviceId":[],"entityId":["media_player.hotbox_down_display"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1060,"y":480,"wires":[["47ee274040a3dce7"]]},{"id":"47ee274040a3dce7","type":"api-call-service","z":"a17f73eee8c0a729","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.kitchen_display_do_not_disturb"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1330,"y":480,"wires":[[]]},{"id":"e47acf030a60c248","type":"api-call-service","z":"a17f73eee8c0a729","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.kitchen_display_do_not_disturb"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1310,"y":600,"wires":[[]]},{"id":"ea4c8e0d6c281b50","type":"inject","z":"a17f73eee8c0a729","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":840,"y":400,"wires":[["78e4941095a5010b"]]},{"id":"96827ac3e2373cd3","type":"comment","z":"a17f73eee8c0a729","name":"Mute player","info":"","x":2330,"y":1120,"wires":[]},{"id":"82ee50da417e812f","type":"inject","z":"a17f73eee8c0a729","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":2000,"y":1060,"wires":[["b8172514ff706b09"]]},{"id":"837c7885cdb7a55e","type":"debug","z":"a17f73eee8c0a729","name":"debug 140","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1870,"y":1120,"wires":[]},{"id":"bd64a9a678c025a6","type":"comment","z":"a17f73eee8c0a729","name":"Mute player's volume","info":"","x":2160,"y":1220,"wires":[]},{"id":"9d2a8668e847d42d","type":"comment","z":"a17f73eee8c0a729","name":"Stop playback","info":"","x":2810,"y":1220,"wires":[]},{"id":"3cdc3e401e3b5a9b","type":"api-call-service","z":"a17f73eee8c0a729","name":"stop player","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"turn_off","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2810,"y":1260,"wires":[[]]},{"id":"eeb943f2106ae203","type":"api-call-service","z":"a17f73eee8c0a729","name":"mute player","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_mute","areaId":[],"deviceId":[],"entityId":[],"data":"{\"is_volume_muted\":\"true\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2350,"y":1260,"wires":[["1460ee0b7d569c83"]]},{"id":"1460ee0b7d569c83","type":"api-current-state","z":"a17f73eee8c0a729","name":"Home_Group off","server":"7ab5c227.a3ce8c","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"media_player.group_home_speakers","state_type":"str","blockInputOverrides":true,"outputProperties":[],"for":0,"forType":"num","forUnits":"minutes","x":2580,"y":1260,"wires":[["3cdc3e401e3b5a9b"],[]]},{"id":"ab5b0b4f8b2c7eb9","type":"comment","z":"a17f73eee8c0a729","name":"MAke sure home_group is not playing","info":"","x":2590,"y":1220,"wires":[]},{"id":"30c669689114040c","type":"api-call-service","z":"a17f73eee8c0a729","name":"turn on","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"turn_on","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2160,"y":1260,"wires":[["eeb943f2106ae203"]]},{"id":"9c272b23c1b648f5","type":"comment","z":"a17f73eee8c0a729","name":"Mute player","info":"","x":2350,"y":1300,"wires":[]},{"id":"a22a8be707643fd8","type":"debug","z":"a17f73eee8c0a729","name":"debug 141","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":2410,"y":1040,"wires":[]},{"id":"8fd47233580b3fea","type":"switch","z":"a17f73eee8c0a729","name":"!=off?","property":"payload.state","propertyType":"msg","rules":[{"t":"neq","v":"off","vt":"str"},{"t":"nnull"}],"checkall":"false","repair":false,"outputs":2,"x":2150,"y":1160,"wires":[["237186ed03f52741"],["30c669689114040c"]]},{"id":"a5be34c3d07501b5","type":"comment","z":"a17f73eee8c0a729","name":"Is player active?","info":"","x":2120,"y":1120,"wires":[]},{"id":"43f16058dcb2a562","type":"server-state-changed","z":"a17f73eee8c0a729","name":"","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.sleeper_in_hotbox_down","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","outputs":2,"output_only_on_state_change":false,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":1120,"y":1860,"wires":[["66ae81181e0a1e2e"],["6cc075bb83426ace"]]},{"id":"aaea214957665c6a","type":"ha-get-entities","z":"a17f73eee8c0a729","name":"Get all hotbox Media players","server":"7ab5c227.a3ce8c","version":0,"rules":[{"property":"entity_id","logic":"is","value":"media_player\\.(?!.*?group.*?).*hotbox.*","valueType":"re"}],"output_type":"split","output_empty_results":false,"output_location_type":"msg","output_location":"payload","output_results_count":1,"x":1800,"y":1860,"wires":[["5ed5523a6d5b2301"]]},{"id":"5ed5523a6d5b2301","type":"change","z":"a17f73eee8c0a729","name":"","rules":[{"t":"set","p":"payload.data.entity_id","pt":"msg","to":"payload.entity_id","tot":"msg","dc":true}],"action":"","property":"","from":"","to":"","reg":false,"x":2070,"y":1860,"wires":[["f672ca534b50d663"]]},{"id":"f672ca534b50d663","type":"api-call-service","z":"a17f73eee8c0a729","name":"unmute player","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"volume_mute","areaId":[],"deviceId":[],"entityId":[],"data":"{\"is_volume_muted\":\"false\"}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":2300,"y":1860,"wires":[[]]},{"id":"66ae81181e0a1e2e","type":"ha-wait-until","z":"a17f73eee8c0a729","name":"","server":"7ab5c227.a3ce8c","version":2,"outputs":2,"entityId":"binary_sensor.sensor_hotbox_exit_motion_occupancy","entityIdFilterType":"exact","property":"state","comparator":"is","value":"on","valueType":"str","timeout":"15","timeoutType":"num","timeoutUnits":"minutes","checkCurrentState":false,"blockInputOverrides":true,"outputProperties":[],"x":1540,"y":1860,"wires":[["aaea214957665c6a"],["aaea214957665c6a"]]},{"id":"6cc075bb83426ace","type":"change","z":"a17f73eee8c0a729","name":"","rules":[{"t":"set","p":"reset","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1400,"y":1920,"wires":[["66ae81181e0a1e2e"]]},{"id":"d4ac6fd80adcc69b","type":"inject","z":"a17f73eee8c0a729","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":820,"y":700,"wires":[["9d612ca0ad4ca8a8"]]},{"id":"a80da47fff0154fa","type":"inject","z":"a17f73eee8c0a729","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":1140,"y":180,"wires":[[]]},{"id":"accd20fd1f421698","type":"api-call-service","z":"a17f73eee8c0a729","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"media_player","service":"turn_off","areaId":[],"deviceId":[],"entityId":["media_player.hotbox_down_display"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1420,"y":240,"wires":[["eb33f904396cbd66"]]},{"id":"ba93755bea8e2617","type":"trigger","z":"a17f73eee8c0a729","name":"","op1":"","op2":"0","op1type":"pay","op2type":"str","duration":"-15","extend":false,"overrideDelay":false,"units":"min","reset":"seT","bytopic":"all","topic":"topic","outputs":1,"x":1270,"y":300,"wires":[["accd20fd1f421698"]]},{"id":"999fed48de5f5a88","type":"debug","z":"a17f73eee8c0a729","name":"debug 178","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":430,"y":680,"wires":[]},{"id":"4c6fbec4725b8424","type":"server-state-changed","z":"adab22047f9bb868","name":"Blind Button","server":"7ab5c227.a3ce8c","version":4,"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.remote_office_blind_button_action","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"(open|close)","halt_if_type":"re","halt_if_compare":"is","outputs":2,"output_only_on_state_change":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"x":250,"y":680,"wires":[["41e61ba57570116b"],[]]},{"id":"41e61ba57570116b","type":"switch","z":"adab22047f9bb868","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"open","vt":"str"},{"t":"eq","v":"close","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":430,"y":680,"wires":[["b0b758c58d0b03c8"],["d82e914953b96f55"]]},{"id":"b0b758c58d0b03c8","type":"api-call-service","z":"adab22047f9bb868","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"cover","service":"open_cover","areaId":[],"deviceId":[],"entityId":["cover.cover_office_blinds"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":660,"y":660,"wires":[[]]},{"id":"d82e914953b96f55","type":"api-call-service","z":"adab22047f9bb868","name":"","server":"7ab5c227.a3ce8c","version":5,"debugenabled":false,"domain":"cover","service":"close_cover","areaId":[],"deviceId":[],"entityId":["cover.cover_office_blinds"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":660,"y":720,"wires":[[]]},{"id":"e7114b01a6902584","type":"debug","z":"adab22047f9bb868","name":"debug 127","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":3000,"y":600,"wires":[]},{"id":"9679aaebc9bec251","type":"debug","z":"adab22047f9bb868","name":"debug 134","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1410,"y":500,"wires":[]},{"id":"307238d62657a26c","type":"mqtt in","z":"adab22047f9bb868","name":"","topic":"zigbee2mqtt/remote_office_dial","qos":"2","datatype":"json","broker":"21000c19b97da572","nl":false,"rap":true,"rh":0,"inputs":0,"x":130,"y":220,"wires":[["945bf5ac05c5d4c1"]]},{"id":"945bf5ac05c5d4c1","type":"subflow:61f53235c712b2c2","z":"adab22047f9bb868","name":"","x":490,"y":140,"wires":[]}]