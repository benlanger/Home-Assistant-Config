[
  {
    "id": "56c911ff62a860ba",
    "type": "tab",
    "label": "Bedroom",
    "disabled": false,
    "info": "",
    "env": []
  },
  {
    "id": "0afd2f2b2352a909",
    "type": "junction",
    "z": "56c911ff62a860ba",
    "x": 820,
    "y": 2720,
    "wires": [
      [
        "3829f58e5346acbe"
      ]
    ]
  },
  {
    "id": "f3c1d585e8c1c7aa",
    "type": "junction",
    "z": "56c911ff62a860ba",
    "x": 680,
    "y": 2720,
    "wires": [
      [
        "0afd2f2b2352a909"
      ]
    ]
  },
  {
    "id": "e711a4aa970a9ae5",
    "type": "junction",
    "z": "56c911ff62a860ba",
    "x": 440,
    "y": 2720,
    "wires": [
      [
        "236198ebec8250eb"
      ]
    ]
  },
  {
    "id": "45ba6c7a5dc2c856",
    "type": "junction",
    "z": "56c911ff62a860ba",
    "x": 300,
    "y": 2720,
    "wires": [
      [
        "e711a4aa970a9ae5"
      ]
    ]
  },
  {
    "id": "f639bebfc53ab0ca",
    "type": "junction",
    "z": "56c911ff62a860ba",
    "x": 460,
    "y": 2880,
    "wires": [
      [
        "78975ac16646d1d2"
      ]
    ]
  },
  {
    "id": "5a87f306db7cc2d8",
    "type": "junction",
    "z": "56c911ff62a860ba",
    "x": 300,
    "y": 2880,
    "wires": [
      [
        "f639bebfc53ab0ca"
      ]
    ]
  },
  {
    "id": "7f9505f93fed223b",
    "type": "junction",
    "z": "56c911ff62a860ba",
    "x": 300,
    "y": 2940,
    "wires": [
      [
        "585bc0c792956184"
      ]
    ]
  },
  {
    "id": "1b950bf56691e980",
    "type": "junction",
    "z": "56c911ff62a860ba",
    "x": 880,
    "y": 2840,
    "wires": [
      [
        "e0576eb5e30134c2"
      ]
    ]
  },
  {
    "id": "62afc933c5ab4425",
    "type": "junction",
    "z": "56c911ff62a860ba",
    "x": 740,
    "y": 2840,
    "wires": [
      [
        "1b950bf56691e980"
      ]
    ]
  },
  {
    "id": "585bc0c792956184",
    "type": "junction",
    "z": "56c911ff62a860ba",
    "x": 460,
    "y": 2940,
    "wires": [
      [
        "64d6748ddd537f10"
      ]
    ]
  },
  {
    "id": "51e1ef0d6364a338",
    "type": "junction",
    "z": "56c911ff62a860ba",
    "x": 1380,
    "y": 2940,
    "wires": [
      [
        "60a1fa9156969f48"
      ]
    ]
  },
  {
    "id": "fac8de6c16c3bc0d",
    "type": "junction",
    "z": "56c911ff62a860ba",
    "x": 880,
    "y": 3020,
    "wires": [
      [
        "37d18c429fbbf77d"
      ]
    ]
  },
  {
    "id": "422962b5a886c434",
    "type": "junction",
    "z": "56c911ff62a860ba",
    "x": 1020,
    "y": 2940,
    "wires": [
      [
        "b782f8d84067fbe5"
      ]
    ]
  },
  {
    "id": "dc9de2460902cda5",
    "type": "junction",
    "z": "56c911ff62a860ba",
    "x": 880,
    "y": 2940,
    "wires": [
      [
        "422962b5a886c434"
      ]
    ]
  },
  {
    "id": "37d18c429fbbf77d",
    "type": "junction",
    "z": "56c911ff62a860ba",
    "x": 1020,
    "y": 3020,
    "wires": [
      [
        "53028653048fea96"
      ]
    ]
  },
  {
    "id": "d5f57a683303872c",
    "type": "junction",
    "z": "56c911ff62a860ba",
    "x": 980,
    "y": 2500,
    "wires": [
      [
        "09b22e59ecc224df"
      ]
    ]
  },
  {
    "id": "5518bc361860479b",
    "type": "junction",
    "z": "56c911ff62a860ba",
    "x": 1500,
    "y": 2360,
    "wires": [
      [
        "0c4a805dea4c7427"
      ]
    ]
  },
  {
    "id": "bd147fda0c88cc70",
    "type": "junction",
    "z": "56c911ff62a860ba",
    "x": 960,
    "y": 2500,
    "wires": [
      [
        "d5f57a683303872c"
      ]
    ]
  },
  {
    "id": "79b4373c7f81277b",
    "type": "junction",
    "z": "56c911ff62a860ba",
    "x": 900,
    "y": 2360,
    "wires": [
      [
        "1fe679033954ae4e"
      ]
    ]
  },
  {
    "id": "7259d2ee7447680a",
    "type": "junction",
    "z": "56c911ff62a860ba",
    "x": 1780,
    "y": 2500,
    "wires": [
      [
        "fb2143f4c309b849"
      ]
    ]
  },
  {
    "id": "09b22e59ecc224df",
    "type": "junction",
    "z": "56c911ff62a860ba",
    "x": 1500,
    "y": 2500,
    "wires": [
      [
        "deb09c33c273799c"
      ]
    ]
  },
  {
    "id": "767790809a831eac",
    "type": "junction",
    "z": "56c911ff62a860ba",
    "x": 260,
    "y": 3300,
    "wires": [
      [
        "8350009f75c56ebb"
      ]
    ]
  },
  {
    "id": "52d630b4e77d7e77",
    "type": "junction",
    "z": "56c911ff62a860ba",
    "x": 240,
    "y": 3540,
    "wires": [
      [
        "d369acf347893c0c"
      ]
    ]
  },
  {
    "id": "72ad3c21a0eccc80",
    "type": "junction",
    "z": "56c911ff62a860ba",
    "x": 1020,
    "y": 4520,
    "wires": [
      [
        "19134c9f6301f620"
      ]
    ]
  },
  {
    "id": "3e8a41b674122b66",
    "type": "junction",
    "z": "56c911ff62a860ba",
    "x": 1160,
    "y": 4480,
    "wires": [
      [
        "7465762f5efa9bd6"
      ]
    ]
  },
  {
    "id": "7465762f5efa9bd6",
    "type": "junction",
    "z": "56c911ff62a860ba",
    "x": 1320,
    "y": 4500,
    "wires": [
      [
        "b8f8b3ddd7dd6fc0"
      ]
    ]
  },
  {
    "id": "f819df21174b26ee",
    "type": "junction",
    "z": "56c911ff62a860ba",
    "x": 1000,
    "y": 4600,
    "wires": [
      [
        "860a651fd82196b2"
      ]
    ]
  },
  {
    "id": "5d43ee01bb7b15cd",
    "type": "junction",
    "z": "56c911ff62a860ba",
    "x": 1000,
    "y": 4560,
    "wires": [
      [
        "ce0f449abcde3750"
      ]
    ]
  },
  {
    "id": "039a10fd2af9f969",
    "type": "junction",
    "z": "56c911ff62a860ba",
    "x": 1260,
    "y": 4560,
    "wires": [
      [
        "55f0a526ba729d77"
      ]
    ]
  },
  {
    "id": "bb1bca2bc9621ec6",
    "type": "junction",
    "z": "56c911ff62a860ba",
    "x": 1620,
    "y": 4600,
    "wires": [
      [
        "424cf08b2a94875d",
        "b715c3cb842ad2a5",
        "83deeefdbbac5a61"
      ]
    ]
  },
  {
    "id": "860a651fd82196b2",
    "type": "junction",
    "z": "56c911ff62a860ba",
    "x": 1260,
    "y": 4600,
    "wires": [
      [
        "0ac503a61ccf454c"
      ]
    ]
  },
  {
    "id": "a0cb7613100fad18",
    "type": "junction",
    "z": "56c911ff62a860ba",
    "x": 1520,
    "y": 4600,
    "wires": [
      [
        "bb1bca2bc9621ec6"
      ]
    ]
  },
  {
    "id": "bd1bb829a3c241ee",
    "type": "junction",
    "z": "56c911ff62a860ba",
    "x": 1940,
    "y": 4500,
    "wires": [
      [
        "98702dbb26e3ab8b"
      ]
    ]
  },
  {
    "id": "f64e5ed993c199f5",
    "type": "api-call-service",
    "z": "56c911ff62a860ba",
    "name": "Cololight on",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "light",
    "service": "turn_on",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "light.bedroom_cololight"
    ],
    "data": "{\"effect\":\"Cocktail Parade\"}",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "data"
      }
    ],
    "queue": "none",
    "x": 490,
    "y": 160,
    "wires": [
      []
    ]
  },
  {
    "id": "1b96bc646d4e56c7",
    "type": "server-state-changed",
    "z": "56c911ff62a860ba",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 4,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "light.bedroom_cololight",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "on",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 2,
    "output_only_on_state_change": true,
    "for": "0",
    "forType": "num",
    "forUnits": "minutes",
    "ignorePrevStateNull": false,
    "ignorePrevStateUnknown": false,
    "ignorePrevStateUnavailable": false,
    "ignoreCurrentStateUnknown": false,
    "ignoreCurrentStateUnavailable": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "eventData"
      },
      {
        "property": "topic",
        "propertyType": "msg",
        "value": "",
        "valueType": "triggerId"
      }
    ],
    "x": 170,
    "y": 160,
    "wires": [
      [
        "f64e5ed993c199f5"
      ],
      []
    ]
  },
  {
    "id": "bf4db16910c7618b",
    "type": "trigger-state",
    "z": "56c911ff62a860ba",
    "name": "Cover Closed and AC on",
    "server": "7ab5c227.a3ce8c",
    "version": 2,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityid": "switch.bedroom_ac",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "targetType": "entity_id",
        "targetValue": "cover.cover_bedroom_blinds",
        "propertyType": "property",
        "comparatorType": "<",
        "comparatorValueDatatype": "num",
        "comparatorValue": "26",
        "propertyValue": "attributes.current_position"
      },
      {
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "on",
        "propertyValue": "new_state.state"
      }
    ],
    "inputs": 0,
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "enableInput": false,
    "x": 150,
    "y": 440,
    "wires": [
      [
        "dc0f74507fa165b1"
      ],
      []
    ]
  },
  {
    "id": "dc0f74507fa165b1",
    "type": "api-call-service",
    "z": "56c911ff62a860ba",
    "name": "Blinds at 26% ",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "cover",
    "service": "set_cover_position",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "cover.cover_bedroom_blinds"
    ],
    "data": "{\"position\": \"26\"}",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 460,
    "y": 440,
    "wires": [
      []
    ]
  },
  {
    "id": "90d211d6a743e930",
    "type": "api-call-service",
    "z": "56c911ff62a860ba",
    "name": "CLose blinds",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "cover",
    "service": "set_cover_position",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "cover.cover_bedroom_blinds"
    ],
    "data": "{\"position\": \"0\"}",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 450,
    "y": 540,
    "wires": [
      []
    ]
  },
  {
    "id": "56c93fec23942ed9",
    "type": "api-call-service",
    "z": "56c911ff62a860ba",
    "name": "Blinds at 26% ",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "cover",
    "service": "set_cover_position",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "cover.cover_bedroom_blinds"
    ],
    "data": "{\"position\": \"26\"}",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 460,
    "y": 360,
    "wires": [
      []
    ]
  },
  {
    "id": "8f1b1ff4d20a8d6d",
    "type": "trigger-state",
    "z": "56c911ff62a860ba",
    "name": "Cover Closed and AC Off",
    "server": "7ab5c227.a3ce8c",
    "version": 2,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityid": "switch.bedroom_ac",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "targetType": "entity_id",
        "targetValue": "cover.cover_bedroom_blinds",
        "propertyType": "property",
        "comparatorType": "<",
        "comparatorValueDatatype": "num",
        "comparatorValue": "27",
        "propertyValue": "attributes.current_position"
      },
      {
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "off",
        "propertyValue": "new_state.state"
      }
    ],
    "inputs": 0,
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "enableInput": false,
    "x": 150,
    "y": 540,
    "wires": [
      [
        "90d211d6a743e930"
      ],
      []
    ]
  },
  {
    "id": "722aab7f36fe606a",
    "type": "trigger-state",
    "z": "56c911ff62a860ba",
    "name": "Closed Cover and AC on",
    "server": "7ab5c227.a3ce8c",
    "version": 2,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityid": "cover.cover_bedroom_blinds",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "property",
        "comparatorType": "<",
        "comparatorValueDatatype": "num",
        "comparatorValue": "26",
        "propertyValue": "new_state.attributes.current_position"
      },
      {
        "targetType": "entity_id",
        "targetValue": "switch.bedroom_ac",
        "propertyType": "current_state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "on",
        "propertyValue": "new_state.state"
      }
    ],
    "inputs": 0,
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "enableInput": false,
    "x": 150,
    "y": 360,
    "wires": [
      [
        "56c93fec23942ed9"
      ],
      []
    ]
  },
  {
    "id": "0200854bb6e793fc",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "Chose specific effect on lighting on",
    "info": "",
    "x": 160,
    "y": 200,
    "wires": []
  },
  {
    "id": "85a44af769293504",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "Trigger on cololight on",
    "info": "",
    "x": 160,
    "y": 120,
    "wires": []
  },
  {
    "id": "bafdd5fa51ef66e1",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "Select Cocktail effect",
    "info": "",
    "x": 490,
    "y": 120,
    "wires": []
  },
  {
    "id": "b991422029043762",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "If cover is under 26% and AC is on",
    "info": "",
    "x": 160,
    "y": 400,
    "wires": []
  },
  {
    "id": "d38eb955df6f7d83",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "Set cover to 26% open",
    "info": "",
    "x": 460,
    "y": 400,
    "wires": []
  },
  {
    "id": "981662dd196ab250",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "If cover is under 26% and AC is off",
    "info": "",
    "x": 160,
    "y": 500,
    "wires": []
  },
  {
    "id": "5108e856fc604908",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "Close blinds",
    "info": "",
    "x": 450,
    "y": 500,
    "wires": []
  },
  {
    "id": "bb96b4c786d1bcd0",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "If cover is under 26% and AC is on",
    "info": "",
    "x": 160,
    "y": 600,
    "wires": []
  },
  {
    "id": "745abffeb3ac07e0",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "Set cover to 26% open",
    "info": "",
    "x": 460,
    "y": 600,
    "wires": []
  },
  {
    "id": "590f6e877edea304",
    "type": "server-state-changed",
    "z": "56c911ff62a860ba",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 4,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "switch.bedroom_ac",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "(on)",
    "halt_if_type": "re",
    "halt_if_compare": "is",
    "outputs": 2,
    "output_only_on_state_change": true,
    "for": "0",
    "forType": "num",
    "forUnits": "minutes",
    "ignorePrevStateNull": false,
    "ignorePrevStateUnknown": false,
    "ignorePrevStateUnavailable": false,
    "ignoreCurrentStateUnknown": false,
    "ignoreCurrentStateUnavailable": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "eventData"
      },
      {
        "property": "topic",
        "propertyType": "msg",
        "value": "",
        "valueType": "triggerId"
      }
    ],
    "x": 180,
    "y": 1200,
    "wires": [
      [
        "f497510b82dd7301"
      ],
      [
        "420c70dfa3d8d0ec"
      ]
    ]
  },
  {
    "id": "ba2eb5bc9188d9ad",
    "type": "api-call-service",
    "z": "56c911ff62a860ba",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "media_player",
    "service": "volume_down",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "",
    "dataType": "jsonata",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 1130,
    "y": 1220,
    "wires": [
      []
    ]
  },
  {
    "id": "2d83a7425a360b6f",
    "type": "api-call-service",
    "z": "56c911ff62a860ba",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "media_player",
    "service": "volume_up",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "",
    "dataType": "jsonata",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 1130,
    "y": 1160,
    "wires": [
      []
    ]
  },
  {
    "id": "83089d56e084c667",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "AC turns on",
    "info": "",
    "x": 170,
    "y": 1160,
    "wires": []
  },
  {
    "id": "70bd27facdf67f36",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "Turn volume up",
    "info": "",
    "x": 1140,
    "y": 1120,
    "wires": []
  },
  {
    "id": "456d111f76c9e5ba",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "Turn volume down",
    "info": "",
    "x": 1130,
    "y": 1260,
    "wires": []
  },
  {
    "id": "4691cec247ae0d28",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "WIP TO MUTE THE SPEAKERS IN THE ROOM WHEN I DO SOMETHING",
    "info": "",
    "x": 380,
    "y": 1620,
    "wires": []
  },
  {
    "id": "7ce0151cf49af272",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "",
    "info": "",
    "x": 200,
    "y": 1720,
    "wires": []
  },
  {
    "id": "ba9ad4a01577490e",
    "type": "trigger-state",
    "z": "56c911ff62a860ba",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 2,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityid": "binary_sensor.maxi_s_ears_busy",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "on",
        "propertyValue": "new_state.state"
      }
    ],
    "inputs": 0,
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "enableInput": false,
    "x": 290,
    "y": 1660,
    "wires": [
      [
        "97782e8105e0aca6"
      ],
      [
        "892ae2c600ad5bc3"
      ]
    ]
  },
  {
    "id": "97782e8105e0aca6",
    "type": "api-call-service",
    "z": "56c911ff62a860ba",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "media_player",
    "service": "volume_mute",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "media_player.bedroom_speaker",
      "media_player.bedroom_ceiling_speaker",
      "media_player.dungeon_speaker"
    ],
    "data": "{\"is_volume_muted\": \"true\"}",
    "dataType": "jsonata",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 790,
    "y": 1660,
    "wires": [
      []
    ]
  },
  {
    "id": "892ae2c600ad5bc3",
    "type": "api-call-service",
    "z": "56c911ff62a860ba",
    "name": "unmute",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "media_player",
    "service": "volume_mute",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "media_player.bedroom_speaker",
      "media_player.bedroom_ceiling_speaker",
      "media_player.dungeon_speaker"
    ],
    "data": "{\"is_volume_muted\": \"false\"}",
    "dataType": "jsonata",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 580,
    "y": 1720,
    "wires": [
      []
    ]
  },
  {
    "id": "f497510b82dd7301",
    "type": "ha-get-entities",
    "z": "56c911ff62a860ba",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 0,
    "rules": [
      {
        "property": "entity_id",
        "logic": "is",
        "value": "media_player\\.bedroom(?!plex).*",
        "valueType": "re"
      },
      {
        "property": "state",
        "logic": "is",
        "value": "playing",
        "valueType": "str"
      },
      {
        "property": "attributes.is_volume_muted",
        "logic": "is",
        "value": "false",
        "valueType": "bool"
      }
    ],
    "output_type": "split",
    "output_empty_results": false,
    "output_location_type": "msg",
    "output_location": "payload",
    "output_results_count": 1,
    "x": 450,
    "y": 1160,
    "wires": [
      [
        "7e6b3ecd6a4aacaf"
      ]
    ]
  },
  {
    "id": "420c70dfa3d8d0ec",
    "type": "ha-get-entities",
    "z": "56c911ff62a860ba",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 0,
    "rules": [
      {
        "property": "entity_id",
        "logic": "is",
        "value": "media_player\\.bedroom(?!plex).*_speaker",
        "valueType": "re"
      },
      {
        "property": "state",
        "logic": "is",
        "value": "playing",
        "valueType": "str"
      },
      {
        "property": "attributes.is_volume_muted",
        "logic": "is",
        "value": "false",
        "valueType": "bool"
      }
    ],
    "output_type": "split",
    "output_empty_results": false,
    "output_location_type": "msg",
    "output_location": "payload",
    "output_results_count": 1,
    "x": 450,
    "y": 1220,
    "wires": [
      [
        "9912e9487152918c"
      ]
    ]
  },
  {
    "id": "7e6b3ecd6a4aacaf",
    "type": "change",
    "z": "56c911ff62a860ba",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "payload.data.entity_id",
        "pt": "msg",
        "to": "payload.entity_id",
        "tot": "msg",
        "dc": true
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 770,
    "y": 1160,
    "wires": [
      [
        "2d83a7425a360b6f"
      ]
    ]
  },
  {
    "id": "9912e9487152918c",
    "type": "change",
    "z": "56c911ff62a860ba",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "payload.data.entity_id",
        "pt": "msg",
        "to": "payload.entity_id",
        "tot": "msg",
        "dc": true
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 770,
    "y": 1220,
    "wires": [
      [
        "ba2eb5bc9188d9ad"
      ]
    ]
  },
  {
    "id": "50a0ed02b34007b2",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "Extract the entity id",
    "info": "",
    "x": 770,
    "y": 1120,
    "wires": []
  },
  {
    "id": "9fb5e92b2b1915a0",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "Get playing unmuted media players",
    "info": "",
    "x": 440,
    "y": 1120,
    "wires": []
  },
  {
    "id": "f7120ca1b394c661",
    "type": "ha-get-entities",
    "z": "56c911ff62a860ba",
    "name": "Get  Light entities",
    "server": "7ab5c227.a3ce8c",
    "version": 0,
    "rules": [
      {
        "property": "entity_id",
        "logic": "is",
        "value": "light.nzxt_kraken_x3_0_led.*",
        "valueType": "re"
      },
      {
        "property": "state",
        "logic": "is",
        "value": "on",
        "valueType": "str"
      }
    ],
    "output_type": "split",
    "output_empty_results": false,
    "output_location_type": "msg",
    "output_location": "payload",
    "output_results_count": 1,
    "x": 810,
    "y": 800,
    "wires": [
      [
        "99e20b0177f7561f"
      ]
    ]
  },
  {
    "id": "531000a71e6c28be",
    "type": "trigger",
    "z": "56c911ff62a860ba",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "pay",
    "op2type": "nul",
    "duration": "-5",
    "extend": false,
    "overrideDelay": false,
    "units": "s",
    "reset": "off",
    "bytopic": "all",
    "topic": "topic",
    "outputs": 1,
    "x": 580,
    "y": 800,
    "wires": [
      [
        "f7120ca1b394c661"
      ]
    ]
  },
  {
    "id": "3b635711e7577c2a",
    "type": "inject",
    "z": "56c911ff62a860ba",
    "name": "",
    "props": [
      {
        "p": "payload"
      },
      {
        "p": "topic",
        "vt": "str"
      }
    ],
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 560,
    "y": 840,
    "wires": [
      [
        "f7120ca1b394c661"
      ]
    ]
  },
  {
    "id": "99e20b0177f7561f",
    "type": "switch",
    "z": "56c911ff62a860ba",
    "name": "",
    "property": "payload.attributes.supported_color_modes",
    "propertyType": "msg",
    "rules": [
      {
        "t": "regex",
        "v": "(xy|hs)",
        "vt": "str",
        "case": false
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1050,
    "y": 800,
    "wires": [
      [
        "0087f0f75eb01d35"
      ]
    ]
  },
  {
    "id": "f2ac7dd61031a577",
    "type": "server-state-changed",
    "z": "56c911ff62a860ba",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 4,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "input_boolean.acid_time",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "on",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 2,
    "output_only_on_state_change": true,
    "for": "0",
    "forType": "num",
    "forUnits": "minutes",
    "ignorePrevStateNull": false,
    "ignorePrevStateUnknown": false,
    "ignorePrevStateUnavailable": false,
    "ignoreCurrentStateUnknown": false,
    "ignoreCurrentStateUnavailable": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "eventData"
      },
      {
        "property": "topic",
        "propertyType": "msg",
        "value": "",
        "valueType": "triggerId"
      }
    ],
    "x": 240,
    "y": 760,
    "wires": [
      [
        "531000a71e6c28be"
      ],
      [
        "531000a71e6c28be"
      ]
    ]
  },
  {
    "id": "0087f0f75eb01d35",
    "type": "switch",
    "z": "56c911ff62a860ba",
    "name": "Exclude groups",
    "property": "payload.attributes.entity_id",
    "propertyType": "msg",
    "rules": [
      {
        "t": "null"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1280,
    "y": 800,
    "wires": [
      [
        "331bd7216cf8fee5"
      ]
    ]
  },
  {
    "id": "331bd7216cf8fee5",
    "type": "function",
    "z": "56c911ff62a860ba",
    "name": "Generate Random saturated color",
    "func": "var entity_id = msg.payload.entity_id;\n\n\nvar hue = Math.floor(Math.random() * 360); //generate a random number up to 360\n\nvar hs_color = hue + \",100\";\nvar hs_color_array = hs_color.split(\",\");\nvar newMsg = {\n    \"payload\": {\n        \"data\": {\n            \"hs_color\": hs_color_array,\n            \"entity_id\": entity_id,\n            \"brightness_pct\": 100\n            \n}\n        }\n    }\n;\nreturn newMsg;",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1580,
    "y": 800,
    "wires": [
      [
        "2cf82a093dd760e3"
      ]
    ]
  },
  {
    "id": "2cf82a093dd760e3",
    "type": "api-call-service",
    "z": "56c911ff62a860ba",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "light",
    "service": "turn_on",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "",
    "dataType": "jsonata",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 1870,
    "y": 800,
    "wires": [
      []
    ]
  },
  {
    "id": "258cd36e9485d649",
    "type": "server-state-changed",
    "z": "56c911ff62a860ba",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 4,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "input_boolean.party_mode",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "on",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 2,
    "output_only_on_state_change": true,
    "for": "0",
    "forType": "num",
    "forUnits": "minutes",
    "ignorePrevStateNull": false,
    "ignorePrevStateUnknown": false,
    "ignorePrevStateUnavailable": false,
    "ignoreCurrentStateUnknown": false,
    "ignoreCurrentStateUnavailable": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "eventData"
      },
      {
        "property": "topic",
        "propertyType": "msg",
        "value": "",
        "valueType": "triggerId"
      }
    ],
    "x": 240,
    "y": 820,
    "wires": [
      [
        "531000a71e6c28be"
      ],
      [
        "531000a71e6c28be"
      ]
    ]
  },
  {
    "id": "da2979028867adeb",
    "type": "inject",
    "z": "56c911ff62a860ba",
    "name": "",
    "props": [
      {
        "p": "payload"
      },
      {
        "p": "topic",
        "vt": "str"
      }
    ],
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 420,
    "y": 700,
    "wires": [
      [
        "531000a71e6c28be"
      ]
    ]
  },
  {
    "id": "4dadb04b275734e6",
    "type": "server-state-changed",
    "z": "56c911ff62a860ba",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 4,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "sensor.bedroom_lights_color",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "",
    "halt_if_type": "re",
    "halt_if_compare": "is",
    "outputs": 1,
    "output_only_on_state_change": true,
    "for": "0",
    "forType": "num",
    "forUnits": "minutes",
    "ignorePrevStateNull": false,
    "ignorePrevStateUnknown": false,
    "ignorePrevStateUnavailable": false,
    "ignoreCurrentStateUnknown": false,
    "ignoreCurrentStateUnavailable": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "eventData"
      },
      {
        "property": "topic",
        "propertyType": "msg",
        "value": "",
        "valueType": "triggerId"
      }
    ],
    "x": 290,
    "y": 2040,
    "wires": [
      [
        "20c7b8b91e1321d1",
        "5157a396e885f85e",
        "d65fa189f58d8fe2"
      ]
    ]
  },
  {
    "id": "20c7b8b91e1321d1",
    "type": "function",
    "z": "56c911ff62a860ba",
    "name": "Extract RGB from entity and divive each value by 255 (color)",
    "func": "var rgb_value = msg.payload.replace(\"\\(\",\"\").replace(\"\\)\",\"\");\nconst color_array = rgb_value.split(\", \");\nvar RV = (color_array[0]  / 255);\nvar GV = (color_array[1]  / 255);\nvar BV = (color_array[2]  / 255);\n\nvar RVT = RV.toString().substring(0, 3);\nvar GVT = GV.toString().substring(0, 3);\nvar BVT = BV.toString().substring(0, 3);\n\nvar msg = {\n    \"payload\": {\n        \"data\": {\n            \"topic\": \"homeassistant/button/PC_Maxi_Desktop/Maxi_pc_customcommand/action\",\n            \"payload\": \"%wpe% -control applyProperties -properties RAW~\\(\\{\\\"color\\\":\\\"\" + RVT + \" \" + GVT + \" \" + BVT + \"\\\"\\}\\)~END\"\n        }\n    }\n\n}\nreturn msg;\n",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 720,
    "y": 2040,
    "wires": [
      [
        "47b6335b71c4ec73"
      ]
    ]
  },
  {
    "id": "47b6335b71c4ec73",
    "type": "api-call-service",
    "z": "56c911ff62a860ba",
    "name": "Send MQTT Command",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "mqtt",
    "service": "publish",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "",
    "dataType": "jsonata",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 1170,
    "y": 2040,
    "wires": [
      []
    ]
  },
  {
    "id": "5157a396e885f85e",
    "type": "function",
    "z": "56c911ff62a860ba",
    "name": "Extract RGB from entity and divive each value by 255 (Backgroundcolor)",
    "func": "var rgb_value = msg.payload.replace(\"\\(\",\"\").replace(\"\\)\",\"\");\nconst color_array = rgb_value.split(\", \");\nvar RV = (color_array[0]  / 255);\nvar GV = (color_array[1]  / 255);\nvar BV = (color_array[2]  / 255);\n\nvar RVT = RV.toString().substring(0, 3);\nvar GVT = GV.toString().substring(0, 3);\nvar BVT = BV.toString().substring(0, 3);\n\nvar msg = {\n    \"payload\": {\n        \"data\": {\n            \"topic\": \"homeassistant/button/PC_Maxi_Desktop/Maxi_pc_customcommand/action\",\n            \"payload\": \"%wpe% -control applyProperties -properties RAW~\\(\\{\\\"backgroundcolor\\\":\\\"\" + RVT + \" \" + GVT + \" \" + BVT + \"\\\"\\}\\)~END\"\n        }\n    }\n\n}\nreturn msg;\n",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 760,
    "y": 2000,
    "wires": [
      [
        "24fde9116e9678ee"
      ]
    ]
  },
  {
    "id": "24fde9116e9678ee",
    "type": "api-call-service",
    "z": "56c911ff62a860ba",
    "name": "Send MQTT Command",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "mqtt",
    "service": "publish",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "",
    "dataType": "jsonata",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 1170,
    "y": 2000,
    "wires": [
      []
    ]
  },
  {
    "id": "d65fa189f58d8fe2",
    "type": "function",
    "z": "56c911ff62a860ba",
    "name": "Extract RGB from entity and divive each value by 255 (clouds)",
    "func": "var rgb_value = msg.payload.replace(\"\\(\",\"\").replace(\"\\)\",\"\");\nconst color_array = rgb_value.split(\", \");\nvar RV = (color_array[0]  / 255);\nvar GV = (color_array[1]  / 255);\nvar BV = (color_array[2]  / 255);\n\nvar RVT = RV.toString().substring(0, 3);\nvar GVT = GV.toString().substring(0, 3);\nvar BVT = BV.toString().substring(0, 3);\n\nvar msg = {\n    \"payload\": {\n        \"data\": {\n            \"topic\": \"homeassistant/button/PC_Maxi_Desktop/Maxi_pc_customcommand/action\",\n            \"payload\": \"%wpe% -control applyProperties -properties RAW~\\(\\{\\\"clouds\\\":\\\"\" + RVT + \" \" + GVT + \" \" + BVT + \"\\\"\\}\\)~END\"\n        }\n    }\n\n}\nreturn msg;\n",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 730,
    "y": 2080,
    "wires": [
      [
        "1dbb2ec92ed06bce"
      ]
    ]
  },
  {
    "id": "1dbb2ec92ed06bce",
    "type": "api-call-service",
    "z": "56c911ff62a860ba",
    "name": "Send MQTT Command",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "mqtt",
    "service": "publish",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "",
    "dataType": "jsonata",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 1170,
    "y": 2080,
    "wires": [
      []
    ]
  },
  {
    "id": "01780bc3dd73580d",
    "type": "mqtt in",
    "z": "56c911ff62a860ba",
    "name": "",
    "topic": "zigbee2mqtt/remote_bedroom_dial",
    "qos": "2",
    "datatype": "json",
    "broker": "21000c19b97da572",
    "nl": false,
    "rap": true,
    "rh": 0,
    "inputs": 0,
    "x": 180,
    "y": 2380,
    "wires": [
      [
        "2529837d24d60972"
      ]
    ]
  },
  {
    "id": "45be97c8c7c6ddf5",
    "type": "server-state-changed",
    "z": "56c911ff62a860ba",
    "name": "Is chromecast off?",
    "server": "7ab5c227.a3ce8c",
    "version": 4,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "media_player.bedroom_chromecast",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 2,
    "output_only_on_state_change": true,
    "for": "0",
    "forType": "num",
    "forUnits": "minutes",
    "ignorePrevStateNull": false,
    "ignorePrevStateUnknown": false,
    "ignorePrevStateUnavailable": false,
    "ignoreCurrentStateUnknown": false,
    "ignoreCurrentStateUnavailable": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "eventData"
      },
      {
        "property": "topic",
        "propertyType": "msg",
        "value": "",
        "valueType": "triggerId"
      }
    ],
    "x": 170,
    "y": 2720,
    "wires": [
      [
        "45ba6c7a5dc2c856"
      ],
      []
    ]
  },
  {
    "id": "3829f58e5346acbe",
    "type": "api-call-service",
    "z": "56c911ff62a860ba",
    "name": "Change Input",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "media_player",
    "service": "select_source",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "media_player.bedroom_roku"
    ],
    "data": "{\"source\":\"PC\"}",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "data"
      }
    ],
    "queue": "none",
    "x": 940,
    "y": 2720,
    "wires": [
      []
    ]
  },
  {
    "id": "236198ebec8250eb",
    "type": "api-current-state",
    "z": "56c911ff62a860ba",
    "name": "Are screens on?",
    "server": "7ab5c227.a3ce8c",
    "version": 3,
    "outputs": 2,
    "halt_if": "on",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "entity_id": "switch.plug_bedroom_screens",
    "state_type": "str",
    "blockInputOverrides": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "entity"
      }
    ],
    "for": 0,
    "forType": "num",
    "forUnits": "minutes",
    "x": 560,
    "y": 2720,
    "wires": [
      [
        "f3c1d585e8c1c7aa"
      ],
      []
    ]
  },
  {
    "id": "5b104236d44d89a8",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "Is the chromecast off?",
    "info": "",
    "x": 180,
    "y": 2680,
    "wires": []
  },
  {
    "id": "53028653048fea96",
    "type": "api-call-service",
    "z": "56c911ff62a860ba",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "remote",
    "service": "turn_off",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "remote.bedroom_roku"
    ],
    "data": "",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 1150,
    "y": 3020,
    "wires": [
      []
    ]
  },
  {
    "id": "64d6748ddd537f10",
    "type": "api-current-state",
    "z": "56c911ff62a860ba",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 3,
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "entity_id": "binary_sensor.maxi_sleeping",
    "state_type": "str",
    "blockInputOverrides": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "entity"
      }
    ],
    "for": 0,
    "forType": "num",
    "forUnits": "minutes",
    "x": 670,
    "y": 2940,
    "wires": [
      [
        "dc9de2460902cda5"
      ],
      [
        "fac8de6c16c3bc0d"
      ]
    ]
  },
  {
    "id": "3759f1783ecd37e5",
    "type": "server-state-changed",
    "z": "56c911ff62a860ba",
    "name": "Are Screens on?",
    "server": "7ab5c227.a3ce8c",
    "version": 4,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "switch.plug_bedroom_screens",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "on",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 2,
    "output_only_on_state_change": true,
    "for": "0",
    "forType": "num",
    "forUnits": "minutes",
    "ignorePrevStateNull": false,
    "ignorePrevStateUnknown": false,
    "ignorePrevStateUnavailable": false,
    "ignoreCurrentStateUnknown": false,
    "ignoreCurrentStateUnavailable": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "eventData"
      },
      {
        "property": "topic",
        "propertyType": "msg",
        "value": "",
        "valueType": "triggerId"
      }
    ],
    "x": 160,
    "y": 2920,
    "wires": [
      [
        "5a87f306db7cc2d8"
      ],
      [
        "7f9505f93fed223b"
      ]
    ]
  },
  {
    "id": "b782f8d84067fbe5",
    "type": "api-current-state",
    "z": "56c911ff62a860ba",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 3,
    "outputs": 2,
    "halt_if": "on",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "entity_id": "remote.bedroom_roku",
    "state_type": "str",
    "blockInputOverrides": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "entity"
      }
    ],
    "for": 0,
    "forType": "num",
    "forUnits": "minutes",
    "x": 1210,
    "y": 2940,
    "wires": [
      [
        "51e1ef0d6364a338"
      ],
      []
    ]
  },
  {
    "id": "78975ac16646d1d2",
    "type": "api-current-state",
    "z": "56c911ff62a860ba",
    "name": "Chromecast is Off",
    "server": "7ab5c227.a3ce8c",
    "version": 3,
    "outputs": 2,
    "halt_if": "(paused|playing)",
    "halt_if_type": "re",
    "halt_if_compare": "is_not",
    "entity_id": "media_player.bedroom_chromecast",
    "state_type": "str",
    "blockInputOverrides": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "entity"
      }
    ],
    "for": 0,
    "forType": "num",
    "forUnits": "minutes",
    "x": 590,
    "y": 2880,
    "wires": [
      [
        "62afc933c5ab4425"
      ],
      []
    ]
  },
  {
    "id": "60a1fa9156969f48",
    "type": "api-call-service",
    "z": "56c911ff62a860ba",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "media_player",
    "service": "select_source",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "media_player.bedroom_roku"
    ],
    "data": "{\"source\": \"chromecast\"}",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 1670,
    "y": 2940,
    "wires": [
      []
    ]
  },
  {
    "id": "e0576eb5e30134c2",
    "type": "api-call-service",
    "z": "56c911ff62a860ba",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "media_player",
    "service": "select_source",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "media_player.bedroom_roku"
    ],
    "data": "{\"source\": \"PC\"}",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 1030,
    "y": 2840,
    "wires": [
      []
    ]
  },
  {
    "id": "b6d1c4da352bd314",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "Are the screens on?",
    "info": "",
    "x": 570,
    "y": 2680,
    "wires": []
  },
  {
    "id": "e537d2a780ce9c79",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "yes",
    "info": "",
    "x": 750,
    "y": 2720,
    "wires": []
  },
  {
    "id": "909c850d8473c58f",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "yes",
    "info": "",
    "x": 370,
    "y": 2720,
    "wires": []
  },
  {
    "id": "97a090e45b0c7ec2",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "Set input to PC",
    "info": "",
    "x": 940,
    "y": 2680,
    "wires": []
  },
  {
    "id": "953464f97d60fe10",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "Are the screens on?",
    "info": "",
    "x": 170,
    "y": 2880,
    "wires": []
  },
  {
    "id": "e0c0aadfaadda7dd",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "Is the chromecast off?",
    "info": "",
    "x": 600,
    "y": 2840,
    "wires": []
  },
  {
    "id": "54aef7e6bb373b64",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "yes",
    "info": "",
    "x": 370,
    "y": 2880,
    "wires": []
  },
  {
    "id": "21fbd0f97b9fb41e",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "yes",
    "info": "",
    "x": 810,
    "y": 2840,
    "wires": []
  },
  {
    "id": "4766ddcb2b8d0111",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "no",
    "info": "",
    "x": 370,
    "y": 2940,
    "wires": []
  },
  {
    "id": "2bd4a7b4a70c9ae1",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "Is maxi sleeping?",
    "info": "",
    "x": 660,
    "y": 2980,
    "wires": []
  },
  {
    "id": "e0e08f203bc43ccc",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "Set TV source as PC",
    "info": "",
    "x": 1030,
    "y": 2800,
    "wires": []
  },
  {
    "id": "4420ca23f3ce5c19",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "Is TV on?",
    "info": "",
    "x": 1180,
    "y": 2900,
    "wires": []
  },
  {
    "id": "7b42bb99378495d6",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "yes",
    "info": "",
    "x": 1450,
    "y": 2940,
    "wires": []
  },
  {
    "id": "f734bf69fc9636ff",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "no",
    "info": "",
    "x": 950,
    "y": 2940,
    "wires": []
  },
  {
    "id": "20163b4a2ec75263",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "yes",
    "info": "",
    "x": 950,
    "y": 3020,
    "wires": []
  },
  {
    "id": "eb1a62319bc90b10",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "Turn TV off",
    "info": "",
    "x": 1180,
    "y": 2980,
    "wires": []
  },
  {
    "id": "deb09c33c273799c",
    "type": "trigger",
    "z": "56c911ff62a860ba",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "pay",
    "op2type": "nul",
    "duration": "100",
    "extend": false,
    "overrideDelay": false,
    "units": "ms",
    "reset": "",
    "bytopic": "all",
    "topic": "topic",
    "outputs": 1,
    "x": 1620,
    "y": 2500,
    "wires": [
      [
        "7259d2ee7447680a"
      ]
    ]
  },
  {
    "id": "fb2143f4c309b849",
    "type": "switch",
    "z": "56c911ff62a860ba",
    "name": "",
    "property": "action",
    "propertyType": "msg",
    "rules": [
      {
        "t": "neq",
        "v": "",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1870,
    "y": 2500,
    "wires": [
      [
        "0a76d1b3ef445b11"
      ]
    ]
  },
  {
    "id": "1fe679033954ae4e",
    "type": "change",
    "z": "56c911ff62a860ba",
    "name": "set entity",
    "rules": [
      {
        "t": "set",
        "p": "payload.data.entity_id",
        "pt": "msg",
        "to": "media_player.dungeon_speaker,media_player.bedroom_ceiling_speaker,media_player.bedroom_speaker",
        "tot": "str",
        "dc": true
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1160,
    "y": 2360,
    "wires": [
      [
        "19e4edab9a1c9c36"
      ]
    ]
  },
  {
    "id": "5c7c08eeb0c4ce20",
    "type": "api-current-state",
    "z": "56c911ff62a860ba",
    "name": "speaker",
    "server": "7ab5c227.a3ce8c",
    "version": 3,
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is_not",
    "entity_id": "media_player.bedroom_speaker",
    "state_type": "str",
    "blockInputOverrides": false,
    "outputProperties": [
      {
        "property": "entity",
        "propertyType": "msg",
        "value": "",
        "valueType": "entity"
      }
    ],
    "for": 0,
    "forType": "num",
    "forUnits": "minutes",
    "override_topic": false,
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "x": 800,
    "y": 2380,
    "wires": [
      [
        "79b4373c7f81277b"
      ],
      [
        "bd147fda0c88cc70"
      ]
    ]
  },
  {
    "id": "1ce9b7d4ca4fba3c",
    "type": "switch",
    "z": "56c911ff62a860ba",
    "name": "",
    "property": "action",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "rotate_right",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "rotate_left",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "play_pause",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "skip_forward",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "skip_backward",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 5,
    "x": 2310,
    "y": 2500,
    "wires": [
      [
        "c395da374fdab735"
      ],
      [
        "41e08dfbb0e04a2a"
      ],
      [
        "25ea085a99170204"
      ],
      [
        "56c2574f49363475"
      ],
      []
    ]
  },
  {
    "id": "de676d463545890a",
    "type": "change",
    "z": "56c911ff62a860ba",
    "name": "Move action",
    "rules": [
      {
        "t": "set",
        "p": "action",
        "pt": "msg",
        "to": "payload.action",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 590,
    "y": 2380,
    "wires": [
      [
        "5c7c08eeb0c4ce20"
      ]
    ]
  },
  {
    "id": "3be1e0c8f5c69755",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "Set speakers entities",
    "info": "",
    "x": 1170,
    "y": 2320,
    "wires": []
  },
  {
    "id": "abe1cd1e08726b1e",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "Is speaker off?",
    "info": "",
    "x": 800,
    "y": 2340,
    "wires": []
  },
  {
    "id": "6376094a5e563400",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "No",
    "info": "",
    "x": 990,
    "y": 2360,
    "wires": []
  },
  {
    "id": "5f46d2a113cdf9cf",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "Yes",
    "info": "",
    "x": 990,
    "y": 2500,
    "wires": []
  },
  {
    "id": "be201149b072f263",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "Move payload.action to action",
    "info": "",
    "x": 580,
    "y": 2340,
    "wires": []
  },
  {
    "id": "c1541d070610956e",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "Check that action is not empty",
    "info": "",
    "x": 1880,
    "y": 2460,
    "wires": []
  },
  {
    "id": "0c4a805dea4c7427",
    "type": "switch",
    "z": "56c911ff62a860ba",
    "name": "",
    "property": "action",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "rotate_right",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "play_pause",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "rotate_left",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "skip_forward",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "skip_backward",
        "vt": "str"
      }
    ],
    "checkall": "false",
    "repair": false,
    "outputs": 5,
    "x": 1590,
    "y": 2360,
    "wires": [
      [
        "8cc0c1ba628498df"
      ],
      [
        "8a24becba7f06b80"
      ],
      [
        "c1946a64db4473ee"
      ],
      [
        "843ad0bd7a1da088"
      ],
      [
        "e3124f8324c3d69f"
      ]
    ]
  },
  {
    "id": "843ad0bd7a1da088",
    "type": "api-call-service",
    "z": "56c911ff62a860ba",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "media_player",
    "service": "media_next_track",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "",
    "dataType": "jsonata",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 1890,
    "y": 2320,
    "wires": [
      []
    ]
  },
  {
    "id": "8cc0c1ba628498df",
    "type": "api-call-service",
    "z": "56c911ff62a860ba",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "media_player",
    "service": "volume_up",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "",
    "dataType": "jsonata",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 1870,
    "y": 2200,
    "wires": [
      []
    ]
  },
  {
    "id": "8a24becba7f06b80",
    "type": "api-call-service",
    "z": "56c911ff62a860ba",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "media_player",
    "service": "media_play_pause",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "",
    "dataType": "jsonata",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 1890,
    "y": 2240,
    "wires": [
      []
    ]
  },
  {
    "id": "c1946a64db4473ee",
    "type": "api-call-service",
    "z": "56c911ff62a860ba",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "media_player",
    "service": "volume_down",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "",
    "dataType": "jsonata",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 1870,
    "y": 2280,
    "wires": [
      []
    ]
  },
  {
    "id": "0a76d1b3ef445b11",
    "type": "change",
    "z": "56c911ff62a860ba",
    "name": "set entity",
    "rules": [
      {
        "t": "delete",
        "p": "payload",
        "pt": "msg"
      },
      {
        "t": "set",
        "p": "payload.data.entity_id",
        "pt": "msg",
        "to": "light.group_bedroom_lights",
        "tot": "str",
        "dc": true
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 2100,
    "y": 2500,
    "wires": [
      [
        "1ce9b7d4ca4fba3c",
        "27a2d8f4858f1acd"
      ]
    ]
  },
  {
    "id": "8daa468074ad91b6",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "Set Lights entities",
    "info": "",
    "x": 2130,
    "y": 2460,
    "wires": []
  },
  {
    "id": "e3124f8324c3d69f",
    "type": "change",
    "z": "56c911ff62a860ba",
    "name": "set flow light mode = 1",
    "rules": [
      {
        "t": "set",
        "p": "lightmode",
        "pt": "flow",
        "to": "1",
        "tot": "num"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1820,
    "y": 2400,
    "wires": [
      [
        "2866114df72da874"
      ]
    ]
  },
  {
    "id": "066dfc535a4c0837",
    "type": "change",
    "z": "56c911ff62a860ba",
    "name": "set flow light mode = 0",
    "rules": [
      {
        "t": "set",
        "p": "lightmode",
        "pt": "flow",
        "to": "0",
        "tot": "num"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 2240,
    "y": 2400,
    "wires": [
      []
    ]
  },
  {
    "id": "2866114df72da874",
    "type": "trigger",
    "z": "56c911ff62a860ba",
    "name": "",
    "op1": "",
    "op2": "0",
    "op1type": "nul",
    "op2type": "str",
    "duration": "10",
    "extend": false,
    "overrideDelay": false,
    "units": "s",
    "reset": "",
    "bytopic": "all",
    "topic": "topic",
    "outputs": 1,
    "x": 2030,
    "y": 2400,
    "wires": [
      [
        "066dfc535a4c0837"
      ]
    ]
  },
  {
    "id": "19e4edab9a1c9c36",
    "type": "switch",
    "z": "56c911ff62a860ba",
    "name": "Light mode off?",
    "property": "lightmode",
    "propertyType": "flow",
    "rules": [
      {
        "t": "neq",
        "v": "1",
        "vt": "num"
      },
      {
        "t": "null"
      },
      {
        "t": "eq",
        "v": "1",
        "vt": "num"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 3,
    "x": 1380,
    "y": 2360,
    "wires": [
      [
        "5518bc361860479b"
      ],
      [
        "5518bc361860479b"
      ],
      [
        "09b22e59ecc224df"
      ]
    ]
  },
  {
    "id": "56c2574f49363475",
    "type": "api-call-service",
    "z": "56c911ff62a860ba",
    "name": "Max white brightness",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "light",
    "service": "turn_on",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "{\"brightness_pct\": 100,\"color_name\": \"white\"}",
    "dataType": "jsonata",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 2540,
    "y": 2580,
    "wires": [
      []
    ]
  },
  {
    "id": "70a54e82a47016b6",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "These nodes set a flow variable \"lightmode\" to \"1\" for 10 seconds before setting it to \"0\"",
    "info": "",
    "x": 2040,
    "y": 2360,
    "wires": []
  },
  {
    "id": "081622ed823bf530",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "Check if lightmode is on",
    "info": "",
    "x": 1380,
    "y": 2320,
    "wires": []
  },
  {
    "id": "6fab207376ba33bd",
    "type": "api-call-service",
    "z": "56c911ff62a860ba",
    "name": "Screens Turn On",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "switch",
    "service": "turn_on",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "switch.plug_bedroom_screens"
    ],
    "data": "",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "data"
      }
    ],
    "queue": "none",
    "x": 1030,
    "y": 3880,
    "wires": [
      []
    ]
  },
  {
    "id": "10150c00ffc0cbb7",
    "type": "api-current-state",
    "z": "56c911ff62a860ba",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 3,
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "entity_id": "light.bedroom_main",
    "state_type": "str",
    "blockInputOverrides": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "entity"
      },
      {
        "property": "topic",
        "propertyType": "msg",
        "value": "",
        "valueType": "triggerId"
      }
    ],
    "for": 0,
    "forType": "num",
    "forUnits": "minutes",
    "x": 570,
    "y": 3860,
    "wires": [
      [],
      [
        "3edcabdc80dca9a4",
        "6f2411dd5520a17b"
      ]
    ]
  },
  {
    "id": "6f2411dd5520a17b",
    "type": "api-call-service",
    "z": "56c911ff62a860ba",
    "name": "LavalampTurn On",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "light",
    "service": "turn_on",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "light.bedroom_cololight",
      "light.bedroom_lavalamp",
      "light.dungeon_plasmaball"
    ],
    "data": "{\"brightness_pct\":\"100\"}",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "data"
      }
    ],
    "queue": "none",
    "x": 890,
    "y": 3940,
    "wires": [
      []
    ]
  },
  {
    "id": "3edcabdc80dca9a4",
    "type": "api-current-state",
    "z": "56c911ff62a860ba",
    "name": "Off?",
    "server": "7ab5c227.a3ce8c",
    "version": 3,
    "outputs": 2,
    "halt_if": "on",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "entity_id": "switch.plug_bedroom_screens",
    "state_type": "str",
    "blockInputOverrides": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "entity"
      },
      {
        "property": "topic",
        "propertyType": "msg",
        "value": "",
        "valueType": "triggerId"
      }
    ],
    "for": 0,
    "forType": "num",
    "forUnits": "minutes",
    "x": 830,
    "y": 3860,
    "wires": [
      [],
      [
        "6fab207376ba33bd"
      ]
    ]
  },
  {
    "id": "776e29c29a700ebf",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "Detect motion in both bedrooms",
    "info": "",
    "x": 210,
    "y": 3240,
    "wires": []
  },
  {
    "id": "9c4876d3ee59c222",
    "type": "server-state-changed",
    "z": "56c911ff62a860ba",
    "name": "Motion Bedroom",
    "server": "7ab5c227.a3ce8c",
    "version": 4,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "binary_sensor.sensor_bedroom_motion_occupancy",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "on",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 2,
    "output_only_on_state_change": true,
    "for": "0",
    "forType": "num",
    "forUnits": "minutes",
    "ignorePrevStateNull": false,
    "ignorePrevStateUnknown": false,
    "ignorePrevStateUnavailable": false,
    "ignoreCurrentStateUnknown": false,
    "ignoreCurrentStateUnavailable": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "eventData"
      },
      {
        "property": "topic",
        "propertyType": "msg",
        "value": "",
        "valueType": "triggerId"
      }
    ],
    "x": 160,
    "y": 3280,
    "wires": [
      [
        "767790809a831eac"
      ],
      []
    ]
  },
  {
    "id": "e9a22764061fa841",
    "type": "server-state-changed",
    "z": "56c911ff62a860ba",
    "name": "Motion Dungeon",
    "server": "7ab5c227.a3ce8c",
    "version": 4,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "binary_sensor.sensor_dungeon_motion_occupancy",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "on",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 2,
    "output_only_on_state_change": true,
    "for": "0",
    "forType": "num",
    "forUnits": "minutes",
    "ignorePrevStateNull": false,
    "ignorePrevStateUnknown": false,
    "ignorePrevStateUnavailable": false,
    "ignoreCurrentStateUnknown": false,
    "ignoreCurrentStateUnavailable": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "eventData"
      },
      {
        "property": "topic",
        "propertyType": "msg",
        "value": "",
        "valueType": "triggerId"
      }
    ],
    "x": 160,
    "y": 3320,
    "wires": [
      [
        "767790809a831eac"
      ],
      []
    ]
  },
  {
    "id": "8350009f75c56ebb",
    "type": "api-current-state",
    "z": "56c911ff62a860ba",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 3,
    "outputs": 2,
    "halt_if": "on",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "entity_id": "binary_sensor.maxi_sleeping",
    "state_type": "str",
    "blockInputOverrides": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "entity"
      },
      {
        "property": "topic",
        "propertyType": "msg",
        "value": "",
        "valueType": "triggerId"
      }
    ],
    "for": 0,
    "forType": "num",
    "forUnits": "minutes",
    "x": 550,
    "y": 3300,
    "wires": [
      [
        "1ba06d9b72807126"
      ],
      []
    ]
  },
  {
    "id": "8e84dbb736508e34",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "Turn on night lights",
    "info": "",
    "x": 1190,
    "y": 3260,
    "wires": []
  },
  {
    "id": "1ba06d9b72807126",
    "type": "api-call-service",
    "z": "56c911ff62a860ba",
    "name": "Quotra Lamp on",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "light",
    "service": "turn_on",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "light.quotra_bedroom_light"
    ],
    "data": "",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 820,
    "y": 3300,
    "wires": [
      [
        "312f051da6281688"
      ]
    ]
  },
  {
    "id": "312f051da6281688",
    "type": "api-call-service",
    "z": "56c911ff62a860ba",
    "name": "Cololight on",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "light",
    "service": "turn_on",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "light.bedroom_cololight"
    ],
    "data": "{\"brightness_pct\":10,\"effect\":\"Cocktail Parade\"}",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 1010,
    "y": 3300,
    "wires": [
      [
        "85ce88d1c607f709"
      ]
    ]
  },
  {
    "id": "e61c06640673566c",
    "type": "api-call-service",
    "z": "56c911ff62a860ba",
    "name": "Quotra Lamp off",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "light",
    "service": "turn_off",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "light.quotra_bedroom_light"
    ],
    "data": "",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "data"
      }
    ],
    "queue": "none",
    "x": 1640,
    "y": 3300,
    "wires": [
      [
        "8bb11bda7fc7af73"
      ]
    ]
  },
  {
    "id": "8bb11bda7fc7af73",
    "type": "api-call-service",
    "z": "56c911ff62a860ba",
    "name": "Cololight off",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "light",
    "service": "turn_off",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "light.bedroom_cololight"
    ],
    "data": "",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "data"
      }
    ],
    "queue": "none",
    "x": 1830,
    "y": 3300,
    "wires": [
      [
        "a86ee3246f03b15e"
      ]
    ]
  },
  {
    "id": "ae0d50d9353f1911",
    "type": "trigger",
    "z": "56c911ff62a860ba",
    "name": "",
    "op1": "",
    "op2": "off",
    "op1type": "nul",
    "op2type": "str",
    "duration": "45",
    "extend": false,
    "overrideDelay": false,
    "units": "s",
    "reset": "open",
    "bytopic": "all",
    "topic": "topic",
    "outputs": 1,
    "x": 1410,
    "y": 3300,
    "wires": [
      [
        "e61c06640673566c"
      ]
    ]
  },
  {
    "id": "a86ee3246f03b15e",
    "type": "api-call-service",
    "z": "56c911ff62a860ba",
    "name": "Dungeon off",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "light",
    "service": "turn_off",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "light.dungeon_light"
    ],
    "data": "",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "data"
      }
    ],
    "queue": "none",
    "x": 2010,
    "y": 3300,
    "wires": [
      []
    ]
  },
  {
    "id": "85ce88d1c607f709",
    "type": "api-call-service",
    "z": "56c911ff62a860ba",
    "name": "Dungeon on",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "light",
    "service": "turn_on",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "light.dungeon_light"
    ],
    "data": "{\"brightness_pct\":1,\"color_name\":\"red\"}",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 1190,
    "y": 3300,
    "wires": [
      [
        "ae0d50d9353f1911"
      ]
    ]
  },
  {
    "id": "03f89b90923ada12",
    "type": "inject",
    "z": "56c911ff62a860ba",
    "name": "",
    "props": [
      {
        "p": "payload"
      },
      {
        "p": "topic",
        "vt": "str"
      }
    ],
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 240,
    "y": 3820,
    "wires": [
      []
    ]
  },
  {
    "id": "9bed38c77813b09d",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "Turn on night lights",
    "info": "",
    "x": 830,
    "y": 3260,
    "wires": []
  },
  {
    "id": "6ff557c4c85f1f47",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "Turn on night lights",
    "info": "",
    "x": 1010,
    "y": 3260,
    "wires": []
  },
  {
    "id": "9d976b75140b2f9e",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "Is Maxi sleeping?",
    "info": "",
    "x": 560,
    "y": 3260,
    "wires": []
  },
  {
    "id": "6460af32146e0c4a",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "wait 45 seconds",
    "info": "",
    "x": 1412,
    "y": 3258,
    "wires": []
  },
  {
    "id": "bcf23cd85cbad0c6",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "Turn of night lights",
    "info": "",
    "x": 1650,
    "y": 3260,
    "wires": []
  },
  {
    "id": "4bb72cbe6bcb6391",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "Turn of night lights",
    "info": "",
    "x": 1830,
    "y": 3260,
    "wires": []
  },
  {
    "id": "1b06f512f847af76",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "Turn of night lights",
    "info": "",
    "x": 2010,
    "y": 3260,
    "wires": []
  },
  {
    "id": "93ac24df9da4508d",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "Detect motion in both bedrooms",
    "info": "",
    "x": 190,
    "y": 3480,
    "wires": []
  },
  {
    "id": "979a10bd1d1fc4fc",
    "type": "server-state-changed",
    "z": "56c911ff62a860ba",
    "name": "Motion Bedroom",
    "server": "7ab5c227.a3ce8c",
    "version": 4,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "binary_sensor.sensor_bedroom_motion_occupancy",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "on",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 2,
    "output_only_on_state_change": true,
    "for": "0",
    "forType": "num",
    "forUnits": "minutes",
    "ignorePrevStateNull": false,
    "ignorePrevStateUnknown": false,
    "ignorePrevStateUnavailable": false,
    "ignoreCurrentStateUnknown": false,
    "ignoreCurrentStateUnavailable": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "eventData"
      },
      {
        "property": "topic",
        "propertyType": "msg",
        "value": "",
        "valueType": "triggerId"
      }
    ],
    "x": 140,
    "y": 3520,
    "wires": [
      [
        "52d630b4e77d7e77"
      ],
      []
    ]
  },
  {
    "id": "3c0a8978b5527753",
    "type": "server-state-changed",
    "z": "56c911ff62a860ba",
    "name": "Motion Dungeon",
    "server": "7ab5c227.a3ce8c",
    "version": 4,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "binary_sensor.sensor_dungeon_motion_occupancy",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "on",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 2,
    "output_only_on_state_change": true,
    "for": "0",
    "forType": "num",
    "forUnits": "minutes",
    "ignorePrevStateNull": false,
    "ignorePrevStateUnknown": false,
    "ignorePrevStateUnavailable": false,
    "ignoreCurrentStateUnknown": false,
    "ignoreCurrentStateUnavailable": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "eventData"
      },
      {
        "property": "topic",
        "propertyType": "msg",
        "value": "",
        "valueType": "triggerId"
      }
    ],
    "x": 140,
    "y": 3560,
    "wires": [
      [
        "52d630b4e77d7e77"
      ],
      []
    ]
  },
  {
    "id": "d369acf347893c0c",
    "type": "api-current-state",
    "z": "56c911ff62a860ba",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 3,
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "entity_id": "binary_sensor.maxi_sleeping",
    "state_type": "str",
    "blockInputOverrides": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "entity"
      },
      {
        "property": "topic",
        "propertyType": "msg",
        "value": "",
        "valueType": "triggerId"
      }
    ],
    "for": 0,
    "forType": "num",
    "forUnits": "minutes",
    "x": 550,
    "y": 3540,
    "wires": [
      [
        "c9be378d904127e5"
      ],
      []
    ]
  },
  {
    "id": "a59bc13f7db146be",
    "type": "api-current-state",
    "z": "56c911ff62a860ba",
    "name": "screens Off?",
    "server": "7ab5c227.a3ce8c",
    "version": 3,
    "outputs": 2,
    "halt_if": "on",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "entity_id": "switch.plug_bedroom_screens",
    "state_type": "str",
    "blockInputOverrides": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "entity"
      },
      {
        "property": "topic",
        "propertyType": "msg",
        "value": "",
        "valueType": "triggerId"
      }
    ],
    "for": 0,
    "forType": "num",
    "forUnits": "minutes",
    "x": 1270,
    "y": 3540,
    "wires": [
      [
        "2ae7ead99ef35184"
      ],
      []
    ]
  },
  {
    "id": "2ae7ead99ef35184",
    "type": "api-call-service",
    "z": "56c911ff62a860ba",
    "name": "Screens Turn On",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "switch",
    "service": "turn_on",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "switch.plug_bedroom_screens"
    ],
    "data": "",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "data"
      }
    ],
    "queue": "none",
    "x": 1510,
    "y": 3540,
    "wires": [
      []
    ]
  },
  {
    "id": "eb7886e47779f798",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "Is Maxi awake?",
    "info": "",
    "x": 560,
    "y": 3500,
    "wires": []
  },
  {
    "id": "d74e11d0d9adf30c",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "are the screens off?",
    "info": "",
    "x": 1270,
    "y": 3500,
    "wires": []
  },
  {
    "id": "19ed40e68b47702a",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "Turn screens on",
    "info": "",
    "x": 1500,
    "y": 3500,
    "wires": []
  },
  {
    "id": "c9be378d904127e5",
    "type": "api-current-state",
    "z": "56c911ff62a860ba",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 3,
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "entity_id": "media_player.bedroom_chromecast",
    "state_type": "str",
    "blockInputOverrides": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "entity"
      },
      {
        "property": "topic",
        "propertyType": "msg",
        "value": "",
        "valueType": "triggerId"
      }
    ],
    "for": 0,
    "forType": "num",
    "forUnits": "minutes",
    "x": 930,
    "y": 3540,
    "wires": [
      [
        "a59bc13f7db146be"
      ],
      []
    ]
  },
  {
    "id": "cee1b026bc1781d6",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "Is the TV not playing media?",
    "info": "",
    "x": 960,
    "y": 3500,
    "wires": []
  },
  {
    "id": "ce6f5961f3329bae",
    "type": "api-call-service",
    "z": "56c911ff62a860ba",
    "name": "Brightnen light",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "light",
    "service": "turn_on",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "{\"brightness_step_pct\": 10}",
    "dataType": "jsonata",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 3920,
    "y": 2460,
    "wires": [
      []
    ]
  },
  {
    "id": "44381b21f26a82e2",
    "type": "ha-get-entities",
    "z": "56c911ff62a860ba",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 0,
    "rules": [
      {
        "property": "",
        "logic": "is",
        "value": "",
        "valueType": "str"
      }
    ],
    "output_type": "split",
    "output_empty_results": false,
    "output_location_type": "msg",
    "output_location": "payload",
    "output_results_count": 1,
    "x": 3070,
    "y": 2460,
    "wires": [
      [
        "febc6f69607bb482",
        "31c842a432e40ed6"
      ]
    ]
  },
  {
    "id": "c395da374fdab735",
    "type": "function",
    "z": "56c911ff62a860ba",
    "name": "Extract room from motion sensor entity an extract off lights to regex",
    "func": "var group_light_entity_id = msg.payload.data.entity_id; // light group\nvar group_light_entity_id = group_light_entity_id.split(\".\");// split on the dot to separate domain and entity\n//var group_entity_split = group_light_entity_id[1].split(\"group\");\nvar room = group_light_entity_id[1].replace(\"_lights\", \"\").replace(\"group_\", \"\");\n\n\nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': \"light.\" + room ,  'valueType': 're' },{ 'property': 'state' ,  'logic': 'is' , 'value': \"on\" ,  'valueType': 'str' }];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object}\n\n}\nreturn msg;\n\n",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 2680,
    "y": 2460,
    "wires": [
      [
        "91a4363c73e59e07",
        "44381b21f26a82e2"
      ]
    ]
  },
  {
    "id": "3fe35a9df98d37b9",
    "type": "switch",
    "z": "56c911ff62a860ba",
    "name": "Brightness?",
    "property": "payload.attributes.brightness",
    "propertyType": "msg",
    "rules": [
      {
        "t": "lt",
        "v": "250",
        "vt": "str"
      },
      {
        "t": "gte",
        "v": "250",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 3510,
    "y": 2460,
    "wires": [
      [
        "3d9adea8a98a9521"
      ],
      [
        "ea17c26b26577823",
        "70066917f7712936"
      ]
    ]
  },
  {
    "id": "3d9adea8a98a9521",
    "type": "change",
    "z": "56c911ff62a860ba",
    "name": "set entity",
    "rules": [
      {
        "t": "set",
        "p": "payload.data.entity_id",
        "pt": "msg",
        "to": "payload.entity_id",
        "tot": "msg",
        "dc": true
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 3680,
    "y": 2460,
    "wires": [
      [
        "ce6f5961f3329bae"
      ]
    ]
  },
  {
    "id": "b06972483dde2445",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "Check Brightness",
    "info": "",
    "x": 3520,
    "y": 2420,
    "wires": []
  },
  {
    "id": "35e4b1a8ceee16f3",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "Set entity id",
    "info": "",
    "x": 3690,
    "y": 2420,
    "wires": []
  },
  {
    "id": "eab0a76879940e00",
    "type": "api-call-service",
    "z": "56c911ff62a860ba",
    "name": "Add white",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "light",
    "service": "turn_on",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "",
    "dataType": "jsonata",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 3900,
    "y": 2540,
    "wires": [
      []
    ]
  },
  {
    "id": "ea17c26b26577823",
    "type": "debug",
    "z": "56c911ff62a860ba",
    "name": "debug 61",
    "active": false,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "payload",
    "targetType": "msg",
    "statusVal": "",
    "statusType": "auto",
    "x": 3680,
    "y": 2500,
    "wires": []
  },
  {
    "id": "70066917f7712936",
    "type": "function",
    "z": "56c911ff62a860ba",
    "name": "White addist",
    "func": "// Declare variation\nvar saturation = msg.payload.attributes.hs_color[1];\nvar colorfinal = msg.payload.attributes.hs_color[0];\nvar entity_id = msg.payload.entity_id;\n\n// If saturation is over 10\nif(saturation > 10){\nvar saturationlesser = saturation - 10;\n} else if(saturation < 10){// If saturation is under 10\nvar saturationlesser = 0;\nvar colorfinal = 0;\n}\n else {\nvar saturationlesser = saturation;}\n\n\n\n\n\n\nvar newMsg = {\n    \"payload\": {\n            \"data\": {\n            \"hs_color\": [colorfinal, saturationlesser],\n            \"entity_id\": entity_id\n            }\n            }\n            \n   }\n\nreturn newMsg;\n\n\n",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 3690,
    "y": 2540,
    "wires": [
      [
        "091f86530d465f70",
        "eab0a76879940e00"
      ]
    ]
  },
  {
    "id": "091f86530d465f70",
    "type": "debug",
    "z": "56c911ff62a860ba",
    "name": "debug 62",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 3900,
    "y": 2500,
    "wires": []
  },
  {
    "id": "91a4363c73e59e07",
    "type": "debug",
    "z": "56c911ff62a860ba",
    "name": "debug 64",
    "active": false,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "payload",
    "targetType": "msg",
    "statusVal": "",
    "statusType": "auto",
    "x": 3080,
    "y": 2500,
    "wires": []
  },
  {
    "id": "29ac2e9fc90b0b57",
    "type": "debug",
    "z": "56c911ff62a860ba",
    "name": "debug 66",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "payload",
    "targetType": "msg",
    "statusVal": "",
    "statusType": "auto",
    "x": 3240,
    "y": 2560,
    "wires": []
  },
  {
    "id": "25ea085a99170204",
    "type": "api-call-service",
    "z": "56c911ff62a860ba",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "light",
    "service": "toggle",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "",
    "dataType": "jsonata",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 2520,
    "y": 2540,
    "wires": [
      []
    ]
  },
  {
    "id": "41e08dfbb0e04a2a",
    "type": "api-call-service",
    "z": "56c911ff62a860ba",
    "name": "Dim light",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "light",
    "service": "turn_on",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "{\"brightness_step_pct\": -10}",
    "dataType": "jsonata",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 2500,
    "y": 2500,
    "wires": [
      []
    ]
  },
  {
    "id": "febc6f69607bb482",
    "type": "trigger",
    "z": "56c911ff62a860ba",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "pay",
    "op2type": "nul",
    "duration": "300",
    "extend": false,
    "overrideDelay": false,
    "units": "ms",
    "reset": "",
    "bytopic": "topic",
    "topic": "payload.entity_id",
    "outputs": 1,
    "x": 3320,
    "y": 2460,
    "wires": [
      [
        "3fe35a9df98d37b9"
      ]
    ]
  },
  {
    "id": "6961b2c7d032d4bd",
    "type": "ha-get-entities",
    "z": "56c911ff62a860ba",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 0,
    "rules": [
      {
        "property": "",
        "logic": "is",
        "value": "",
        "valueType": "str"
      }
    ],
    "output_type": "split",
    "output_empty_results": false,
    "output_location_type": "msg",
    "output_location": "payload",
    "output_results_count": 1,
    "x": 2110,
    "y": 2580,
    "wires": [
      []
    ]
  },
  {
    "id": "27a2d8f4858f1acd",
    "type": "function",
    "z": "56c911ff62a860ba",
    "name": "Extract room from motion sensor entity an extract off lights to regex",
    "func": "var group_light_entity_id = msg.payload.data.entity_id; // light group\nvar group_light_entity_id = group_light_entity_id.split(\".\");// split on the dot to separate domain and entity\n//var group_entity_split = group_light_entity_id[1].split(\"group\");\nvar room = group_light_entity_id[1].replace(\"_lights\", \"\").replace(\"group_\", \"\");\n\n\nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': \"light.\" + room + \"_lights\" ,  'valueType': 're' },{ 'property': 'state' ,  'logic': 'is' , 'value': \"on\" ,  'valueType': 'str' }];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object}\n\n}\nreturn msg;\n\n",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1720,
    "y": 2580,
    "wires": [
      [
        "6961b2c7d032d4bd"
      ]
    ]
  },
  {
    "id": "31c842a432e40ed6",
    "type": "debug",
    "z": "56c911ff62a860ba",
    "name": "debug 60",
    "active": false,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "false",
    "statusVal": "",
    "statusType": "auto",
    "x": 3320,
    "y": 2500,
    "wires": []
  },
  {
    "id": "3c049bdac85dc7a3",
    "type": "function",
    "z": "56c911ff62a860ba",
    "name": "Extract room from dial mqtt name",
    "func": "var group_light_entity_id = msg.payload.device.friendlyName; // light group\nvar room = group_light_entity_id.replace(\"remote_\", \"\").replace(\"_dial\", \"\");\n\n\nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': \"light.group_\" + room + \"_lights\" ,  'valueType': 're' },{ 'property': 'state' ,  'logic': 'is' , 'value': \"on\" ,  'valueType': 'str' }];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object}\n\n}\nreturn msg;\n\n",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 400,
    "y": 2520,
    "wires": [
      [
        "ec5617525020a1fe",
        "c92143da1f1d9037"
      ]
    ]
  },
  {
    "id": "2529837d24d60972",
    "type": "debug",
    "z": "56c911ff62a860ba",
    "name": "debug 69",
    "active": false,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "false",
    "statusVal": "",
    "statusType": "auto",
    "x": 420,
    "y": 2380,
    "wires": []
  },
  {
    "id": "ec5617525020a1fe",
    "type": "ha-get-entities",
    "z": "56c911ff62a860ba",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 0,
    "rules": [
      {
        "property": "",
        "logic": "is",
        "value": "",
        "valueType": "str"
      }
    ],
    "output_type": "split",
    "output_empty_results": false,
    "output_location_type": "msg",
    "output_location": "payload",
    "output_results_count": 1,
    "x": 690,
    "y": 2520,
    "wires": [
      []
    ]
  },
  {
    "id": "c92143da1f1d9037",
    "type": "debug",
    "z": "56c911ff62a860ba",
    "name": "debug 70",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "false",
    "statusVal": "",
    "statusType": "auto",
    "x": 620,
    "y": 2480,
    "wires": []
  },
  {
    "id": "d432b74ed5bc885f",
    "type": "ha-get-entities",
    "z": "56c911ff62a860ba",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 0,
    "rules": [],
    "output_type": "split",
    "output_empty_results": false,
    "output_location_type": "msg",
    "output_location": "payload",
    "output_results_count": 1,
    "x": 1330,
    "y": 4940,
    "wires": [
      [
        "9848d3d557dc45a7"
      ]
    ]
  },
  {
    "id": "aff835383a56eb40",
    "type": "function",
    "z": "56c911ff62a860ba",
    "name": "Extract room from dial mqtt name and set regex to find light groups",
    "func": "var group_light_entity_id = msg.payload.device.friendlyName; // light group\nvar room = group_light_entity_id.replace(\"remote_\", \"\").replace(\"_dial\", \"\");\nvar action = msg.payload.action\n\nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': \"light.group_\" + room + \"_lights\" ,  'valueType': 're' },{ 'property': 'state' ,  'logic': 'is' , 'value': \"on\" ,  'valueType': 'str' }];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object},\n     \"action\": action,\n     \"room\": room\n\n}\nreturn msg;\n\n",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 960,
    "y": 4880,
    "wires": [
      [
        "d432b74ed5bc885f",
        "2d738e7cc26bf507"
      ]
    ]
  },
  {
    "id": "9bd077f7ed29fb10",
    "type": "mqtt in",
    "z": "56c911ff62a860ba",
    "name": "",
    "topic": "zigbee2mqtt/remote_bedroom_dial",
    "qos": "2",
    "datatype": "json",
    "broker": "21000c19b97da572",
    "nl": false,
    "rap": true,
    "rh": 0,
    "inputs": 0,
    "x": 200,
    "y": 4400,
    "wires": [
      [
        "7a7293667d475c2d",
        "acd5834be9900ca4"
      ]
    ]
  },
  {
    "id": "2d738e7cc26bf507",
    "type": "debug",
    "z": "56c911ff62a860ba",
    "name": "debug 71",
    "active": false,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 1420,
    "y": 4860,
    "wires": []
  },
  {
    "id": "46c0fe602f8a5f6d",
    "type": "change",
    "z": "56c911ff62a860ba",
    "name": "Move action",
    "rules": [
      {
        "t": "set",
        "p": "action",
        "pt": "msg",
        "to": "payload.action",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 410,
    "y": 4200,
    "wires": [
      []
    ]
  },
  {
    "id": "a4576c59e8771a1e",
    "type": "debug",
    "z": "56c911ff62a860ba",
    "name": "debug 72",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "false",
    "statusVal": "",
    "statusType": "auto",
    "x": 280,
    "y": 4180,
    "wires": []
  },
  {
    "id": "9848d3d557dc45a7",
    "type": "debug",
    "z": "56c911ff62a860ba",
    "name": "debug 77",
    "active": false,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 1420,
    "y": 4980,
    "wires": []
  },
  {
    "id": "d1d25525472e0a51",
    "type": "comment",
    "z": "56c911ff62a860ba",
    "name": "Check payload lenght",
    "info": "",
    "x": 1760,
    "y": 4960,
    "wires": []
  },
  {
    "id": "acd5834be9900ca4",
    "type": "subflow:61f53235c712b2c2",
    "z": "56c911ff62a860ba",
    "name": "",
    "x": 450,
    "y": 4400,
    "wires": []
  },
  {
    "id": "a724e1763b88fb2d",
    "type": "function",
    "z": "56c911ff62a860ba",
    "name": "Extract room from dial mqtt name and set regex to find chromecast playing",
    "func": "var group_light_entity_id = msg.payload.device.friendlyName; // light group\nvar room = group_light_entity_id.replace(\"remote_\", \"\").replace(\"_dial\", \"\");\nvar action = msg.payload.action\n\nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': \"media_player.\" + room + \"_chromecast\" ,  'valueType': 're' },{ 'property': 'state' ,  'logic': 'is' , 'value': \"playing\" ,  'valueType': 'str' }];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object},\n     \"action\": action,\n     \"room\": room\n\n}\nreturn msg;\n\n",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 360,
    "y": 4500,
    "wires": [
      [
        "0edce96971be17a5"
      ]
    ]
  },
  {
    "id": "0edce96971be17a5",
    "type": "ha-get-entities",
    "z": "56c911ff62a860ba",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 0,
    "rules": [],
    "output_type": "array",
    "output_empty_results": true,
    "output_location_type": "msg",
    "output_location": "payload",
    "output_results_count": 1,
    "x": 710,
    "y": 4500,
    "wires": [
      [
        "29efcf8c85caf49c"
      ]
    ]
  },
  {
    "id": "29efcf8c85caf49c",
    "type": "switch",
    "z": "56c911ff62a860ba",
    "name": "Device present?",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "nempty"
      },
      {
        "t": "empty"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 880,
    "y": 4500,
    "wires": [
      [
        "0ae8584150128610"
      ],
      [
        "72ad3c21a0eccc80"
      ]
    ]
  },
  {
    "id": "0ae8584150128610",
    "type": "switch",
    "z": "56c911ff62a860ba",
    "name": "muted?",
    "property": "payload[0].attributes.is_volume_muted",
    "propertyType": "msg",
    "rules": [
      {
        "t": "false"
      },
      {
        "t": "true"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 1060,
    "y": 4480,
    "wires": [
      [
        "3e8a41b674122b66"
      ],
      [
        "72ad3c21a0eccc80"
      ]
    ]
  },
  {
    "id": "19134c9f6301f620",
    "type": "function",
    "z": "56c911ff62a860ba",
    "name": "Extract room from dial mqtt name and set regex to find speaker playing",
    "func": "\nvar room = msg.room\nvar action = msg.action\n\nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': \"media_player.\" + room + \".*_speaker\" ,  'valueType': 're' },{ 'property': 'state' ,  'logic': 'is_not' , 'value': \"off\" ,  'valueType': 'str' }];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object},\n     \"action\": action,\n     \"room\": room\n\n}\nreturn msg;\n\n",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 350,
    "y": 4560,
    "wires": [
      [
        "6d5ab8ea39347484"
      ]
    ]
  },
  {
    "id": "6d5ab8ea39347484",
    "type": "ha-get-entities",
    "z": "56c911ff62a860ba",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 0,
    "rules": [],
    "output_type": "array",
    "output_empty_results": true,
    "output_location_type": "msg",
    "output_location": "payload",
    "output_results_count": 1,
    "x": 710,
    "y": 4560,
    "wires": [
      [
        "5b1c5c53e4af6d79",
        "1797aa4a8d603733"
      ]
    ]
  },
  {
    "id": "b8f8b3ddd7dd6fc0",
    "type": "split",
    "z": "56c911ff62a860ba",
    "name": "Split entities",
    "splt": "\\n",
    "spltType": "str",
    "arraySplt": 1,
    "arraySpltType": "len",
    "stream": false,
    "addname": "",
    "x": 1430,
    "y": 4500,
    "wires": [
      [
        "0ef8891178484047",
        "f58371ed96ce559c"
      ]
    ]
  },
  {
    "id": "5b1c5c53e4af6d79",
    "type": "switch",
    "z": "56c911ff62a860ba",
    "name": "Device present?",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "nempty"
      },
      {
        "t": "empty"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 880,
    "y": 4560,
    "wires": [
      [
        "5d43ee01bb7b15cd"
      ],
      [
        "f819df21174b26ee",
        "8bbdc3d386dc4ac9"
      ]
    ]
  },
  {
    "id": "55f0a526ba729d77",
    "type": "switch",
    "z": "56c911ff62a860ba",
    "name": "muted?",
    "property": "payload[0].attributes.is_volume_muted",
    "propertyType": "msg",
    "rules": [
      {
        "t": "false"
      },
      {
        "t": "true"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 1540,
    "y": 4560,
    "wires": [
      [
        "b8f8b3ddd7dd6fc0"
      ],
      [
        "bb1bca2bc9621ec6"
      ]
    ]
  },
  {
    "id": "0ef8891178484047",
    "type": "change",
    "z": "56c911ff62a860ba",
    "name": "set entity data",
    "rules": [
      {
        "t": "set",
        "p": "payload.data.entity_id",
        "pt": "msg",
        "to": "payload.entity_id",
        "tot": "msg",
        "dc": true
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1620,
    "y": 4500,
    "wires": [
      [
        "d86a7f55c8341be7"
      ]
    ]
  },
  {
    "id": "0ac503a61ccf454c",
    "type": "switch",
    "z": "56c911ff62a860ba",
    "name": "Play_Pause action?",
    "property": "action",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "play_pause",
        "vt": "str"
      },
      {
        "t": "nnull"
      }
    ],
    "checkall": "false",
    "repair": false,
    "outputs": 2,
    "x": 1380,
    "y": 4600,
    "wires": [
      [
        "a0cb7613100fad18"
      ],
      [
        "a0cb7613100fad18",
        "a82e490fcd04de19"
      ]
    ]
  },
  {
    "id": "d86a7f55c8341be7",
    "type": "switch",
    "z": "56c911ff62a860ba",
    "name": "Light mode off?",
    "property": "lightmode",
    "propertyType": "flow",
    "rules": [
      {
        "t": "neq",
        "v": "1",
        "vt": "num"
      },
      {
        "t": "null"
      },
      {
        "t": "eq",
        "v": "1",
        "vt": "num"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 3,
    "x": 1800,
    "y": 4500,
    "wires": [
      [
        "bd1bb829a3c241ee"
      ],
      [
        "bd1bb829a3c241ee"
      ],
      [
        "424cf08b2a94875d"
      ]
    ]
  },
  {
    "id": "ce0f449abcde3750",
    "type": "switch",
    "z": "56c911ff62a860ba",
    "name": "paused?",
    "property": "payload[0].state",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "playing",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "paused",
        "vt": "str"
      }
    ],
    "checkall": "false",
    "repair": false,
    "outputs": 2,
    "x": 1160,
    "y": 4560,
    "wires": [
      [
        "039a10fd2af9f969"
      ],
      [
        "860a651fd82196b2"
      ]
    ]
  },
  {
    "id": "424cf08b2a94875d",
    "type": "trigger",
    "z": "56c911ff62a860ba",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "pay",
    "op2type": "nul",
    "duration": "100",
    "extend": false,
    "overrideDelay": false,
    "units": "ms",
    "reset": "",
    "bytopic": "all",
    "topic": "topic",
    "outputs": 1,
    "x": 2020,
    "y": 4600,
    "wires": [
      [
        "e27ef39b11be745f",
        "0f961855656e3b5e"
      ]
    ]
  },
  {
    "id": "e27ef39b11be745f",
    "type": "switch",
    "z": "56c911ff62a860ba",
    "name": "",
    "property": "action",
    "propertyType": "msg",
    "rules": [
      {
        "t": "neq",
        "v": "",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 2170,
    "y": 4600,
    "wires": [
      [
        "2ee3681d34ec0b84",
        "6f386606d77706ef"
      ]
    ]
  },
  {
    "id": "98702dbb26e3ab8b",
    "type": "switch",
    "z": "56c911ff62a860ba",
    "name": "",
    "property": "action",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "rotate_right",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "play_pause",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "rotate_left",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "skip_forward",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "skip_backward",
        "vt": "str"
      }
    ],
    "checkall": "false",
    "repair": false,
    "outputs": 5,
    "x": 2030,
    "y": 4500,
    "wires": [
      [
        "81c37c4e877e6ff0"
      ],
      [
        "564a9d207f13fe52"
      ],
      [
        "c391ba60724b13ea"
      ],
      [
        "8df6afa74adc0e27"
      ],
      [
        "84f8ae901142c56a"
      ]
    ]
  },
  {
    "id": "2ee3681d34ec0b84",
    "type": "function",
    "z": "56c911ff62a860ba",
    "name": "Extract room from dial mqtt name and set regex to find light groups",
    "func": "\nvar room = msg.room;\nvar action = msg.action\n\nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': \"light.group_\" + room + \"_lights\" ,  'valueType': 're' }];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object},\n     \"action\": action,\n     \"room\": room\n\n}\nreturn msg;\n\n",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 2480,
    "y": 4600,
    "wires": [
      [
        "234c8d7a701568ad",
        "61849aafe6c42ca1"
      ]
    ]
  },
  {
    "id": "81c37c4e877e6ff0",
    "type": "api-call-service",
    "z": "56c911ff62a860ba",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "media_player",
    "service": "volume_up",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "",
    "dataType": "jsonata",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 2250,
    "y": 4380,
    "wires": [
      []
    ]
  },
  {
    "id": "564a9d207f13fe52",
    "type": "api-call-service",
    "z": "56c911ff62a860ba",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "media_player",
    "service": "media_play_pause",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "",
    "dataType": "jsonata",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 2290,
    "y": 4420,
    "wires": [
      []
    ]
  },
  {
    "id": "c391ba60724b13ea",
    "type": "api-call-service",
    "z": "56c911ff62a860ba",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "media_player",
    "service": "volume_down",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "",
    "dataType": "jsonata",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 2280,
    "y": 4460,
    "wires": [
      []
    ]
  },
  {
    "id": "8df6afa74adc0e27",
    "type": "api-call-service",
    "z": "56c911ff62a860ba",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "media_player",
    "service": "media_next_track",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "",
    "dataType": "jsonata",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 2310,
    "y": 4500,
    "wires": [
      []
    ]
  },
  {
    "id": "84f8ae901142c56a",
    "type": "change",
    "z": "56c911ff62a860ba",
    "name": "set flow light mode = 1",
    "rules": [
      {
        "t": "set",
        "p": "lightmode",
        "pt": "flow",
        "to": "1",
        "tot": "num"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 2220,
    "y": 4540,
    "wires": [
      [
        "1369ad4536f96f5b"
      ]
    ]
  },
  {
    "id": "234c8d7a701568ad",
    "type": "ha-get-entities",
    "z": "56c911ff62a860ba",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 0,
    "rules": [],
    "output_type": "array",
    "output_empty_results": true,
    "output_location_type": "msg",
    "output_location": "payload",
    "output_results_count": 1,
    "x": 2830,
    "y": 4600,
    "wires": [
      [
        "887387747c349432",
        "a04f6cf0b79c1b1e"
      ]
    ]
  },
  {
    "id": "1369ad4536f96f5b",
    "type": "trigger",
    "z": "56c911ff62a860ba",
    "name": "",
    "op1": "",
    "op2": "0",
    "op1type": "nul",
    "op2type": "str",
    "duration": "10",
    "extend": false,
    "overrideDelay": false,
    "units": "s",
    "reset": "",
    "bytopic": "all",
    "topic": "topic",
    "outputs": 1,
    "x": 2430,
    "y": 4540,
    "wires": [
      [
        "4f5c9e9b75ba2f11"
      ]
    ]
  },
  {
    "id": "887387747c349432",
    "type": "split",
    "z": "56c911ff62a860ba",
    "name": "Split entities",
    "splt": "\\n",
    "spltType": "str",
    "arraySplt": 1,
    "arraySpltType": "len",
    "stream": false,
    "addname": "",
    "x": 3010,
    "y": 4600,
    "wires": [
      [
        "02262693da18834e",
        "d65d6b8ff808825f"
      ]
    ]
  },
  {
    "id": "4f5c9e9b75ba2f11",
    "type": "change",
    "z": "56c911ff62a860ba",
    "name": "set flow light mode = 0",
    "rules": [
      {
        "t": "set",
        "p": "lightmode",
        "pt": "flow",
        "to": "0",
        "tot": "num"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 2640,
    "y": 4540,
    "wires": [
      []
    ]
  },
  {
    "id": "02262693da18834e",
    "type": "change",
    "z": "56c911ff62a860ba",
    "name": "set entity data",
    "rules": [
      {
        "t": "set",
        "p": "payload.data.entity_id",
        "pt": "msg",
        "to": "payload.entity_id",
        "tot": "msg",
        "dc": true
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 3200,
    "y": 4600,
    "wires": [
      [
        "61e78178a1842898",
        "d2822f755839c1e6"
      ]
    ]
  },
  {
    "id": "61e78178a1842898",
    "type": "switch",
    "z": "56c911ff62a860ba",
    "name": "",
    "property": "action",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "rotate_right",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "rotate_left",
        "vt": "str"
      },
      {
        "t": "cont",
        "v": "play_pause",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "skip_forward",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "skip_backward",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 5,
    "x": 3350,
    "y": 4600,
    "wires": [
      [
        "7387cadcd6ecb959"
      ],
      [
        "927046bee06012dd"
      ],
      [
        "a4881931c7c397c5",
        "d2822f755839c1e6"
      ],
      [
        "47e3940bdb68f95c"
      ],
      []
    ]
  },
  {
    "id": "7387cadcd6ecb959",
    "type": "function",
    "z": "56c911ff62a860ba",
    "name": "Extract room from motion sensor entity an extract off lights to regex",
    "func": "var room = msg.room;\n\n\nconst rules_object = [{ 'property': 'entity_id' ,  'logic': 'is' , 'value': \"light.\" + room ,  'valueType': 're' }];// arranges the array \n\nvar msg = {\n    \"payload\":{ \"rules\": rules_object}\n\n}\nreturn msg;\n\n",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 3680,
    "y": 4540,
    "wires": [
      [
        "ba60e73a129e0b13",
        "86ff53c15b013eb2"
      ]
    ]
  },
  {
    "id": "927046bee06012dd",
    "type": "api-call-service",
    "z": "56c911ff62a860ba",
    "name": "Dim light",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "light",
    "service": "turn_on",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "{\"brightness_step_pct\": -10}",
    "dataType": "jsonata",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 3500,
    "y": 4580,
    "wires": [
      []
    ]
  },
  {
    "id": "a4881931c7c397c5",
    "type": "api-call-service",
    "z": "56c911ff62a860ba",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "light",
    "service": "toggle",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "",
    "dataType": "jsonata",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 3720,
    "y": 4620,
    "wires": [
      []
    ]
  },
  {
    "id": "47e3940bdb68f95c",
    "type": "api-call-service",
    "z": "56c911ff62a860ba",
    "name": "Max white brightness",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "light",
    "service": "turn_on",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "{\"brightness_pct\": 100,\"color_name\": \"white\"}",
    "dataType": "jsonata",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 3540,
    "y": 4660,
    "wires": [
      []
    ]
  },
  {
    "id": "ba60e73a129e0b13",
    "type": "debug",
    "z": "56c911ff62a860ba",
    "name": "debug 153",
    "active": false,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "payload",
    "targetType": "msg",
    "statusVal": "",
    "statusType": "auto",
    "x": 4080,
    "y": 4580,
    "wires": []
  },
  {
    "id": "86ff53c15b013eb2",
    "type": "ha-get-entities",
    "z": "56c911ff62a860ba",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 0,
    "rules": [
      {
        "property": "",
        "logic": "is",
        "value": "",
        "valueType": "str"
      }
    ],
    "output_type": "split",
    "output_empty_results": false,
    "output_location_type": "msg",
    "output_location": "payload",
    "output_results_count": 1,
    "x": 4090,
    "y": 4520,
    "wires": [
      [
        "81e5d72ac9529d48",
        "e7ed4da3d89ee0c8"
      ]
    ]
  },
  {
    "id": "81e5d72ac9529d48",
    "type": "trigger",
    "z": "56c911ff62a860ba",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "pay",
    "op2type": "nul",
    "duration": "600",
    "extend": false,
    "overrideDelay": false,
    "units": "ms",
    "reset": "",
    "bytopic": "topic",
    "topic": "payload.entity_id",
    "outputs": 1,
    "x": 4320,
    "y": 4540,
    "wires": [
      [
        "389a0c874415626f"
      ]
    ]
  },
  {
    "id": "e7ed4da3d89ee0c8",
    "type": "debug",
    "z": "56c911ff62a860ba",
    "name": "debug 154",
    "active": false,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "false",
    "statusVal": "",
    "statusType": "auto",
    "x": 4320,
    "y": 4580,
    "wires": []
  },
  {
    "id": "389a0c874415626f",
    "type": "switch",
    "z": "56c911ff62a860ba",
    "name": "Brightness?",
    "property": "payload.attributes.brightness",
    "propertyType": "msg",
    "rules": [
      {
        "t": "null"
      },
      {
        "t": "lt",
        "v": "250",
        "vt": "str"
      },
      {
        "t": "gte",
        "v": "250",
        "vt": "str"
      }
    ],
    "checkall": "false",
    "repair": false,
    "outputs": 3,
    "x": 4510,
    "y": 4540,
    "wires": [
      [
        "d663a37c17f20669"
      ],
      [
        "d663a37c17f20669"
      ],
      [
        "a4907ebdc77e0b02",
        "76cd4e0002c94460"
      ]
    ]
  },
  {
    "id": "d663a37c17f20669",
    "type": "change",
    "z": "56c911ff62a860ba",
    "name": "set entity",
    "rules": [
      {
        "t": "set",
        "p": "payload.data.entity_id",
        "pt": "msg",
        "to": "payload.entity_id",
        "tot": "msg",
        "dc": true
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 4680,
    "y": 4540,
    "wires": [
      [
        "4203d41fadaa61b4"
      ]
    ]
  },
  {
    "id": "a4907ebdc77e0b02",
    "type": "debug",
    "z": "56c911ff62a860ba",
    "name": "debug 155",
    "active": false,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "payload",
    "targetType": "msg",
    "statusVal": "",
    "statusType": "auto",
    "x": 4680,
    "y": 4580,
    "wires": []
  },
  {
    "id": "76cd4e0002c94460",
    "type": "function",
    "z": "56c911ff62a860ba",
    "name": "White addist",
    "func": "// Declare variation\nvar saturation = msg.payload.attributes.hs_color[1];\nvar colorfinal = msg.payload.attributes.hs_color[0];\nvar entity_id = msg.payload.entity_id;\n\n// If saturation is over 10\nif(saturation > 10){\nvar saturationlesser = saturation - 10;\n} else if(saturation < 10){// If saturation is under 10\nvar saturationlesser = 0;\nvar colorfinal = 0;\n}\n else {\nvar saturationlesser = saturation;}\n\n\n\n\n\n\nvar newMsg = {\n    \"payload\": {\n            \"data\": {\n            \"hs_color\": [colorfinal, saturationlesser],\n            \"entity_id\": entity_id\n            }\n            }\n            \n   }\n\nreturn newMsg;\n\n\n",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 4690,
    "y": 4620,
    "wires": [
      [
        "33bfd0f56ab12662",
        "8f6bb1444c6788c2"
      ]
    ]
  },
  {
    "id": "4203d41fadaa61b4",
    "type": "api-call-service",
    "z": "56c911ff62a860ba",
    "name": "Brightnen light",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "light",
    "service": "turn_on",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "{\"brightness_step_pct\": 10}",
    "dataType": "jsonata",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 4920,
    "y": 4540,
    "wires": [
      []
    ]
  },
  {
    "id": "33bfd0f56ab12662",
    "type": "debug",
    "z": "56c911ff62a860ba",
    "name": "debug 156",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 4900,
    "y": 4580,
    "wires": []
  },
  {
    "id": "8f6bb1444c6788c2",
    "type": "api-call-service",
    "z": "56c911ff62a860ba",
    "name": "Add white",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "light",
    "service": "turn_on",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "",
    "dataType": "jsonata",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 4900,
    "y": 4620,
    "wires": [
      []
    ]
  },
  {
    "id": "18744539a62b9326",
    "type": "trigger",
    "z": "56c911ff62a860ba",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "pay",
    "op2type": "nul",
    "duration": "200",
    "extend": false,
    "overrideDelay": false,
    "units": "ms",
    "reset": "",
    "bytopic": "topic",
    "topic": "topic",
    "outputs": 1,
    "x": 2060,
    "y": 4340,
    "wires": [
      [
        "81c37c4e877e6ff0"
      ]
    ]
  },
  {
    "id": "d65d6b8ff808825f",
    "type": "debug",
    "z": "56c911ff62a860ba",
    "name": "split entity",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 3200,
    "y": 4500,
    "wires": []
  },
  {
    "id": "d2822f755839c1e6",
    "type": "debug",
    "z": "56c911ff62a860ba",
    "name": "debug 157",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": true,
    "complete": "payload",
    "targetType": "msg",
    "statusVal": "payload",
    "statusType": "msg",
    "x": 3530,
    "y": 4740,
    "wires": []
  },
  {
    "id": "b715c3cb842ad2a5",
    "type": "debug",
    "z": "56c911ff62a860ba",
    "name": "debug 158",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "false",
    "statusVal": "",
    "statusType": "auto",
    "x": 1750,
    "y": 4540,
    "wires": []
  },
  {
    "id": "0f961855656e3b5e",
    "type": "debug",
    "z": "56c911ff62a860ba",
    "name": "debug 159",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 2190,
    "y": 4680,
    "wires": []
  },
  {
    "id": "a04f6cf0b79c1b1e",
    "type": "debug",
    "z": "56c911ff62a860ba",
    "name": "debug 160",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 2910,
    "y": 4540,
    "wires": []
  },
  {
    "id": "6f386606d77706ef",
    "type": "debug",
    "z": "56c911ff62a860ba",
    "name": "debug 161",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 2370,
    "y": 4680,
    "wires": []
  },
  {
    "id": "61849aafe6c42ca1",
    "type": "debug",
    "z": "56c911ff62a860ba",
    "name": "debug 162",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 2770,
    "y": 4700,
    "wires": []
  },
  {
    "id": "f58371ed96ce559c",
    "type": "debug",
    "z": "56c911ff62a860ba",
    "name": "debug 163",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "false",
    "statusVal": "",
    "statusType": "auto",
    "x": 1710,
    "y": 4300,
    "wires": []
  },
  {
    "id": "a82e490fcd04de19",
    "type": "debug",
    "z": "56c911ff62a860ba",
    "name": "debug 164",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 1550,
    "y": 4680,
    "wires": []
  },
  {
    "id": "83deeefdbbac5a61",
    "type": "debug",
    "z": "56c911ff62a860ba",
    "name": "debug 165",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 1710,
    "y": 4620,
    "wires": []
  },
  {
    "id": "7466ff4627565211",
    "type": "debug",
    "z": "56c911ff62a860ba",
    "name": "debug 166",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "false",
    "statusVal": "",
    "statusType": "auto",
    "x": 950,
    "y": 4680,
    "wires": []
  },
  {
    "id": "7a7293667d475c2d",
    "type": "debug",
    "z": "56c911ff62a860ba",
    "name": "debug 167",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 430,
    "y": 4320,
    "wires": []
  },
  {
    "id": "1797aa4a8d603733",
    "type": "debug",
    "z": "56c911ff62a860ba",
    "name": "debug 168",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 910,
    "y": 4620,
    "wires": []
  },
  {
    "id": "8bbdc3d386dc4ac9",
    "type": "debug",
    "z": "56c911ff62a860ba",
    "name": "debug 169",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 1210,
    "y": 4640,
    "wires": []
  }
]