[
  {
    "id": "ad8c570ec4ac394a",
    "type": "tab",
    "label": "Automations",
    "disabled": false,
    "info": "",
    "env": []
  },
  {
    "id": "9442e076db99a2e1",
    "type": "junction",
    "z": "ad8c570ec4ac394a",
    "x": 2620,
    "y": 2080,
    "wires": [
      [
        "2c54900f0bdbbea5"
      ]
    ]
  },
  {
    "id": "630088e66f7238a1",
    "type": "junction",
    "z": "ad8c570ec4ac394a",
    "x": 720,
    "y": 2100,
    "wires": [
      [
        "74b80452ecae5b16"
      ]
    ]
  },
  {
    "id": "6ab4316b4ec28a96",
    "type": "junction",
    "z": "ad8c570ec4ac394a",
    "x": 1180,
    "y": 2220,
    "wires": [
      [
        "e216d39e85bfde74"
      ]
    ]
  },
  {
    "id": "c0843573bc3e1929",
    "type": "server-state-changed",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 4,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "input_boolean.party_mode",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "on",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 2,
    "output_only_on_state_change": true,
    "for": "0",
    "forType": "num",
    "forUnits": "minutes",
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "eventData"
      },
      {
        "property": "topic",
        "propertyType": "msg",
        "value": "",
        "valueType": "triggerId"
      }
    ],
    "x": 260,
    "y": 120,
    "wires": [
      [
        "8c6136816c372915"
      ],
      []
    ]
  },
  {
    "id": "8c6136816c372915",
    "type": "trigger",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "pay",
    "op2type": "nul",
    "duration": "15",
    "extend": false,
    "overrideDelay": false,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "topic": "topic",
    "outputs": 1,
    "x": 590,
    "y": 120,
    "wires": [
      [
        "02f7295b44608fe0"
      ]
    ]
  },
  {
    "id": "02f7295b44608fe0",
    "type": "ha-get-entities",
    "z": "ad8c570ec4ac394a",
    "name": "Get ChromecastMedia players",
    "server": "7ab5c227.a3ce8c",
    "version": 0,
    "rules": [
      {
        "property": "entity_id",
        "logic": "is",
        "value": "media_player\\.(?!plex).*_chromecast",
        "valueType": "re"
      },
      {
        "property": "state",
        "logic": "is",
        "value": "off",
        "valueType": "str"
      }
    ],
    "output_type": "split",
    "output_empty_results": false,
    "output_location_type": "msg",
    "output_location": "payload",
    "output_results_count": 1,
    "x": 910,
    "y": 120,
    "wires": [
      [
        "7b0bd74d9726336c"
      ]
    ]
  },
  {
    "id": "7b0bd74d9726336c",
    "type": "delay",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "pauseType": "rate",
    "timeout": "5",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "8",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "allowrate": false,
    "outputs": 1,
    "x": 1160,
    "y": 120,
    "wires": [
      [
        "1274d6c20ffd5f60"
      ]
    ]
  },
  {
    "id": "1274d6c20ffd5f60",
    "type": "change",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "payload.data.entity_id",
        "pt": "msg",
        "to": "payload.entity_id",
        "tot": "msg",
        "dc": true
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1410,
    "y": 120,
    "wires": [
      [
        "36f9f8deb6267ebb"
      ]
    ]
  },
  {
    "id": "36f9f8deb6267ebb",
    "type": "api-call-service",
    "z": "ad8c570ec4ac394a",
    "name": "play visuals",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "media_player",
    "service": "play_media",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "{\"media_content_id\":\"plex://{ \\\"playlist_name\\\": \\\"All visuals\\\", \\\"shuffle\\\": 1 }\",\"media_content_type\":\"playlist\"}",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 1650,
    "y": 120,
    "wires": [
      [
        "002b81243c26acf0"
      ]
    ]
  },
  {
    "id": "002b81243c26acf0",
    "type": "api-call-service",
    "z": "ad8c570ec4ac394a",
    "name": "Set volume to 0.1",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "media_player",
    "service": "volume_set",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "{\"volume_level\":\"0.1\"}",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 1850,
    "y": 120,
    "wires": [
      [
        "81a6bbceafeac20c"
      ]
    ]
  },
  {
    "id": "81a6bbceafeac20c",
    "type": "api-call-service",
    "z": "ad8c570ec4ac394a",
    "name": "Mute Volume",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "media_player",
    "service": "volume_mute",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "{\"is_volume_muted\": \"true\"}",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "data"
      }
    ],
    "queue": "none",
    "x": 2050,
    "y": 120,
    "wires": [
      []
    ]
  },
  {
    "id": "2f1afe0e5a874c4c",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Play soft visuals when party mode is triggered",
    "info": "",
    "x": 270,
    "y": 80,
    "wires": []
  },
  {
    "id": "96b1cb45b06ea375",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "15 minutes cooldown",
    "info": "",
    "x": 580,
    "y": 80,
    "wires": []
  },
  {
    "id": "5ef1e991bb7d875a",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Pull all inactive Chromecasts entities",
    "info": "",
    "x": 900,
    "y": 80,
    "wires": []
  },
  {
    "id": "ab53133d21bcf288",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "rate limit at 1 per 8s",
    "info": "",
    "x": 1150,
    "y": 80,
    "wires": []
  },
  {
    "id": "f6ec08d3069cc757",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Extract the entity id",
    "info": "",
    "x": 1410,
    "y": 80,
    "wires": []
  },
  {
    "id": "a9f03579f152484b",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Start the visuals playlist",
    "info": "",
    "x": 1640,
    "y": 80,
    "wires": []
  },
  {
    "id": "baac9591853a5457",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Set volume to 0.1",
    "info": "",
    "x": 1860,
    "y": 80,
    "wires": []
  },
  {
    "id": "bae3917b891c9b90",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "(bug mitigation)",
    "info": "The Google chromecasts don't always give the right volume, this forces an update",
    "x": 1860,
    "y": 160,
    "wires": []
  },
  {
    "id": "7ff5b1c7a5f56df7",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Mute the Tv",
    "info": "",
    "x": 2050,
    "y": 80,
    "wires": []
  },
  {
    "id": "6068ed8a2d16572e",
    "type": "trigger",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "pay",
    "op2type": "nul",
    "duration": "15",
    "extend": false,
    "overrideDelay": false,
    "units": "s",
    "reset": "",
    "bytopic": "all",
    "topic": "topic",
    "outputs": 1,
    "x": 590,
    "y": 1540,
    "wires": [
      [
        "5f1ff2606221f3da"
      ]
    ]
  },
  {
    "id": "5f1ff2606221f3da",
    "type": "ha-get-entities",
    "z": "ad8c570ec4ac394a",
    "name": "Get ChromecastMedia players",
    "server": "7ab5c227.a3ce8c",
    "version": 0,
    "rules": [
      {
        "property": "entity_id",
        "logic": "is",
        "value": "media_player\\.(?!plex).*_chromecast",
        "valueType": "re"
      },
      {
        "property": "state",
        "logic": "is",
        "value": "off",
        "valueType": "str"
      }
    ],
    "output_type": "split",
    "output_empty_results": false,
    "output_location_type": "msg",
    "output_location": "payload",
    "output_results_count": 1,
    "x": 910,
    "y": 1540,
    "wires": [
      [
        "11b8508e77092b82"
      ]
    ]
  },
  {
    "id": "11b8508e77092b82",
    "type": "delay",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "pauseType": "rate",
    "timeout": "5",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "8",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "allowrate": false,
    "outputs": 1,
    "x": 1160,
    "y": 1540,
    "wires": [
      [
        "7b39877584962e4a"
      ]
    ]
  },
  {
    "id": "7b39877584962e4a",
    "type": "change",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "payload.data.entity_id",
        "pt": "msg",
        "to": "payload.entity_id",
        "tot": "msg",
        "dc": true
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1410,
    "y": 1540,
    "wires": [
      [
        "a5c306f57feb5805"
      ]
    ]
  },
  {
    "id": "a5c306f57feb5805",
    "type": "api-call-service",
    "z": "ad8c570ec4ac394a",
    "name": "play visuals",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "media_player",
    "service": "play_media",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "{\"media_content_id\":\"plex://{ \\\"playlist_name\\\": \\\"All visuals\\\", \\\"shuffle\\\": 1 }\",\"media_content_type\":\"playlist\"}",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 1650,
    "y": 1540,
    "wires": [
      [
        "12fb54a46d00a846"
      ]
    ]
  },
  {
    "id": "12fb54a46d00a846",
    "type": "api-call-service",
    "z": "ad8c570ec4ac394a",
    "name": "Set volume to 0.1",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "media_player",
    "service": "volume_set",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "{\"volume_level\":\"0.1\"}",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 1850,
    "y": 1540,
    "wires": [
      [
        "398f48e21a51b004"
      ]
    ]
  },
  {
    "id": "398f48e21a51b004",
    "type": "api-call-service",
    "z": "ad8c570ec4ac394a",
    "name": "Mute Volume",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "media_player",
    "service": "volume_mute",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "{\"is_volume_muted\": \"true\"}",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "data"
      }
    ],
    "queue": "none",
    "x": 2050,
    "y": 1540,
    "wires": [
      []
    ]
  },
  {
    "id": "3586d6b055cb9233",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "15 seconds cooldown",
    "info": "",
    "x": 580,
    "y": 1500,
    "wires": []
  },
  {
    "id": "fb7caec077a03aff",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Pull all inactive Chromecasts entities",
    "info": "",
    "x": 900,
    "y": 1500,
    "wires": []
  },
  {
    "id": "ad9b491d1b77c5fa",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "rate limit at 1 per 8s",
    "info": "",
    "x": 1150,
    "y": 1500,
    "wires": []
  },
  {
    "id": "44479e23cca77b31",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Extract the entity id",
    "info": "",
    "x": 1410,
    "y": 1500,
    "wires": []
  },
  {
    "id": "96aaa4ef19a0bee5",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Start the visuals playlist",
    "info": "",
    "x": 1640,
    "y": 1500,
    "wires": []
  },
  {
    "id": "fa094f1bbbe3a0c1",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Set volume to 0.1",
    "info": "",
    "x": 1860,
    "y": 1500,
    "wires": []
  },
  {
    "id": "a2874602f41eaf53",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "(bug mitigation)",
    "info": "The Google chromecasts don't always give the right volume, this forces an update",
    "x": 1860,
    "y": 1580,
    "wires": []
  },
  {
    "id": "34ce572432324952",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Mute the Tv",
    "info": "",
    "x": 2050,
    "y": 1500,
    "wires": []
  },
  {
    "id": "a86e575a7e0d41c5",
    "type": "server-state-changed",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 4,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "input_boolean.acid_time",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "on",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 2,
    "output_only_on_state_change": true,
    "for": "0",
    "forType": "num",
    "forUnits": "minutes",
    "ignorePrevStateNull": false,
    "ignorePrevStateUnknown": false,
    "ignorePrevStateUnavailable": false,
    "ignoreCurrentStateUnknown": false,
    "ignoreCurrentStateUnavailable": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "eventData"
      },
      {
        "property": "topic",
        "propertyType": "msg",
        "value": "",
        "valueType": "triggerId"
      }
    ],
    "x": 260,
    "y": 1540,
    "wires": [
      [
        "6068ed8a2d16572e"
      ],
      []
    ]
  },
  {
    "id": "6a1551121912b3c7",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Play trippy visuals when acid mode is triggered",
    "info": "",
    "x": 260,
    "y": 1500,
    "wires": []
  },
  {
    "id": "917277eef2953310",
    "type": "trigger",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "pay",
    "op2type": "nul",
    "duration": "15",
    "extend": false,
    "overrideDelay": false,
    "units": "s",
    "reset": "",
    "bytopic": "all",
    "topic": "topic",
    "outputs": 1,
    "x": 590,
    "y": 260,
    "wires": [
      [
        "89d0d1d918564386"
      ]
    ]
  },
  {
    "id": "22ffd9edca8397c0",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "15 seconds cooldown",
    "info": "",
    "x": 580,
    "y": 220,
    "wires": []
  },
  {
    "id": "89d0d1d918564386",
    "type": "ha-get-entities",
    "z": "ad8c570ec4ac394a",
    "name": "Get  Light groups",
    "server": "7ab5c227.a3ce8c",
    "version": 0,
    "rules": [
      {
        "property": "entity_id",
        "logic": "is",
        "value": "light\\.(?!.*?all.*?)(?!.*?door.*?).*?_lights$",
        "valueType": "re"
      }
    ],
    "output_type": "split",
    "output_empty_results": false,
    "output_location_type": "msg",
    "output_location": "payload",
    "output_results_count": 1,
    "x": 810,
    "y": 260,
    "wires": [
      [
        "eadbb9bbbd90b04e"
      ]
    ]
  },
  {
    "id": "3feed2b2c6fdac36",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Pull all light groups",
    "info": "",
    "x": 810,
    "y": 220,
    "wires": []
  },
  {
    "id": "4daa01cac8181277",
    "type": "server-state-changed",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 4,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "input_boolean.kink_party",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "on",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 2,
    "output_only_on_state_change": true,
    "for": "0",
    "forType": "num",
    "forUnits": "minutes",
    "ignorePrevStateNull": false,
    "ignorePrevStateUnknown": false,
    "ignorePrevStateUnavailable": false,
    "ignoreCurrentStateUnknown": false,
    "ignoreCurrentStateUnavailable": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "eventData"
      },
      {
        "property": "topic",
        "propertyType": "msg",
        "value": "",
        "valueType": "triggerId"
      }
    ],
    "x": 260,
    "y": 1800,
    "wires": [
      [
        "a4034e3426b2b90d"
      ],
      []
    ]
  },
  {
    "id": "73896dfa4fb8d996",
    "type": "server-state-changed",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 4,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "input_boolean.party_mode",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "on",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 2,
    "output_only_on_state_change": true,
    "for": "0",
    "forType": "num",
    "forUnits": "minutes",
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "eventData"
      },
      {
        "property": "topic",
        "propertyType": "msg",
        "value": "",
        "valueType": "triggerId"
      }
    ],
    "x": 260,
    "y": 260,
    "wires": [
      [
        "917277eef2953310"
      ],
      []
    ]
  },
  {
    "id": "73ceade6131f58c4",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Change light groups to random colors on party mode",
    "info": "",
    "x": 270,
    "y": 220,
    "wires": []
  },
  {
    "id": "eadbb9bbbd90b04e",
    "type": "switch",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "property": "payload.attributes.supported_color_modes",
    "propertyType": "msg",
    "rules": [
      {
        "t": "regex",
        "v": "(xy|hs)",
        "vt": "str",
        "case": false
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1030,
    "y": 260,
    "wires": [
      [
        "295a50d373ea7d0b"
      ]
    ]
  },
  {
    "id": "9cf9611c81347b2e",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Check for color support",
    "info": "",
    "x": 1020,
    "y": 220,
    "wires": []
  },
  {
    "id": "295a50d373ea7d0b",
    "type": "function",
    "z": "ad8c570ec4ac394a",
    "name": "Generate Random saturated color",
    "func": "var entity_id = msg.payload.entity_id;\n\n\nvar hue = Math.floor(Math.random() * 360); //generate a random number up to 360\n\nvar hs_color = hue + \",60\";\nvar hs_color_array = hs_color.split(\",\");\nvar newMsg = {\n    \"payload\": {\n        \"data\": {\n            \"hs_color\": hs_color_array,\n            \"entity_id\": entity_id,\n            \"brightness_pct\": 100\n            \n}\n        }\n    }\n;\nreturn newMsg;",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1300,
    "y": 260,
    "wires": [
      [
        "c0e0e1dede43580b"
      ]
    ]
  },
  {
    "id": "c0e0e1dede43580b",
    "type": "api-call-service",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "light",
    "service": "turn_on",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "",
    "dataType": "jsonata",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 1590,
    "y": 260,
    "wires": [
      []
    ]
  },
  {
    "id": "920b0688b303f501",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Generated random HS 60% saturated color",
    "info": "",
    "x": 1300,
    "y": 220,
    "wires": []
  },
  {
    "id": "9e48d08f2620c2fb",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "also sets the entity_id",
    "info": "",
    "x": 1280,
    "y": 300,
    "wires": []
  },
  {
    "id": "e0608cb33087d9bd",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Call light_on service",
    "info": "",
    "x": 1590,
    "y": 220,
    "wires": []
  },
  {
    "id": "837d97adee6c9078",
    "type": "trigger",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "pay",
    "op2type": "nul",
    "duration": "15",
    "extend": false,
    "overrideDelay": false,
    "units": "s",
    "reset": "",
    "bytopic": "all",
    "topic": "topic",
    "outputs": 1,
    "x": 590,
    "y": 920,
    "wires": [
      [
        "739f28daa568c871"
      ]
    ]
  },
  {
    "id": "6c3c41c2885cb18e",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "15 seconds cooldown",
    "info": "",
    "x": 580,
    "y": 880,
    "wires": []
  },
  {
    "id": "739f28daa568c871",
    "type": "ha-get-entities",
    "z": "ad8c570ec4ac394a",
    "name": "Get  Light entities",
    "server": "7ab5c227.a3ce8c",
    "version": 0,
    "rules": [
      {
        "property": "entity_id",
        "logic": "is",
        "value": "light\\.(?!.*?group.*?)(?!.*?k95_rgb_2_led.*?)(?!.*?door.*?).*?_(?!.*?lights.*?).*",
        "valueType": "re"
      },
      {
        "property": "state",
        "logic": "is",
        "value": "on",
        "valueType": "str"
      }
    ],
    "output_type": "split",
    "output_empty_results": false,
    "output_location_type": "msg",
    "output_location": "payload",
    "output_results_count": 1,
    "x": 830,
    "y": 920,
    "wires": [
      [
        "ae64cb72a1c38399"
      ]
    ]
  },
  {
    "id": "cc2adca2c4baf2d5",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Try to Pull all lit single lights",
    "info": "",
    "x": 820,
    "y": 880,
    "wires": []
  },
  {
    "id": "5e9bf472a7d3c895",
    "type": "server-state-changed",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 4,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "input_boolean.acid_time",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "on",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 2,
    "output_only_on_state_change": true,
    "for": "0",
    "forType": "num",
    "forUnits": "minutes",
    "ignorePrevStateNull": false,
    "ignorePrevStateUnknown": false,
    "ignorePrevStateUnavailable": false,
    "ignoreCurrentStateUnknown": false,
    "ignoreCurrentStateUnavailable": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "eventData"
      },
      {
        "property": "topic",
        "propertyType": "msg",
        "value": "",
        "valueType": "triggerId"
      }
    ],
    "x": 260,
    "y": 920,
    "wires": [
      [
        "837d97adee6c9078"
      ],
      []
    ]
  },
  {
    "id": "760cb0b08e7989ae",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Change light to random colors on acid mode",
    "info": "",
    "x": 270,
    "y": 880,
    "wires": []
  },
  {
    "id": "ae64cb72a1c38399",
    "type": "switch",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "property": "payload.attributes.supported_color_modes",
    "propertyType": "msg",
    "rules": [
      {
        "t": "regex",
        "v": "(xy|hs)",
        "vt": "str",
        "case": false
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1070,
    "y": 920,
    "wires": [
      [
        "2f13453376465f8b"
      ]
    ]
  },
  {
    "id": "7941ec1c14bdf74c",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Check for color support",
    "info": "",
    "x": 1060,
    "y": 880,
    "wires": []
  },
  {
    "id": "4785df9fde6fcd4d",
    "type": "function",
    "z": "ad8c570ec4ac394a",
    "name": "Generate Random saturated color",
    "func": "var entity_id = msg.payload.entity_id;\n\n\nvar hue = Math.floor(Math.random() * 360); //generate a random number up to 360\n\nvar hs_color = hue + \",100\";\nvar hs_color_array = hs_color.split(\",\");\nvar newMsg = {\n    \"payload\": {\n        \"data\": {\n            \"hs_color\": hs_color_array,\n            \"entity_id\": entity_id,\n            \"brightness_pct\": 100\n            \n}\n        }\n    }\n;\nreturn newMsg;",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1600,
    "y": 920,
    "wires": [
      [
        "f42aed7de4812f9d"
      ]
    ]
  },
  {
    "id": "f42aed7de4812f9d",
    "type": "api-call-service",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "light",
    "service": "turn_on",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "",
    "dataType": "jsonata",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 1890,
    "y": 920,
    "wires": [
      []
    ]
  },
  {
    "id": "5112ea4aa4f5c26d",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Generated random HS 100% saturated color",
    "info": "",
    "x": 1610,
    "y": 880,
    "wires": []
  },
  {
    "id": "a74bc1ffd3fdd8f9",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Call light_on service",
    "info": "",
    "x": 1890,
    "y": 880,
    "wires": []
  },
  {
    "id": "0070875ba8af1c52",
    "type": "switch",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "property": "payload.attributes.supported_color_modes",
    "propertyType": "msg",
    "rules": [
      {
        "t": "regex",
        "v": "(xy|hs)",
        "vt": "str",
        "case": false
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1070,
    "y": 1800,
    "wires": [
      [
        "84d8286bfbe1661d"
      ]
    ]
  },
  {
    "id": "1fafb1100f03e73c",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Check for color support",
    "info": "",
    "x": 1060,
    "y": 1760,
    "wires": []
  },
  {
    "id": "84d8286bfbe1661d",
    "type": "function",
    "z": "ad8c570ec4ac394a",
    "name": "Generate semi-random saturated color",
    "func": "var entity_id = msg.payload.entity_id;\nvar hue = 'test';\n\nvar hue_under_20 = Math.floor(Math.random() * 20); //generate a random number up to 20\nvar hue_over_260 = Math.floor(Math.random() * 100) + 260; //generate a random number up to 360\nvar random_selector = Math.floor(Math.random() * 2); //generate a random number up to 2 ( 0 index)\n\nswitch(random_selector) {\n  case 0:\n    var hue = hue_under_20;\n    break;\n  case 1:\n    var hue = hue_over_260;\n    // code block\n    break;\n  case 2:\n    var hue = hue_over_260;\n    // code block\n  default:\n}\n\nvar hs_color = hue + \",100\";\nvar hs_color_array = hs_color.split(\",\");\nvar newMsg = {\n    \"payload\": {\n        \"data\": {\n            \"hs_color\": hs_color_array,\n            \"entity_id\": entity_id,\n            \"brightness_pct\": 100\n            \n}\n        }\n    }\n;\nreturn newMsg;",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1410,
    "y": 1800,
    "wires": [
      [
        "ce569981d15e01f9"
      ]
    ]
  },
  {
    "id": "ce569981d15e01f9",
    "type": "api-call-service",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "light",
    "service": "turn_on",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "",
    "dataType": "jsonata",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 1750,
    "y": 1800,
    "wires": [
      []
    ]
  },
  {
    "id": "8c788bb16d44c998",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Generated HS 100% saturated color between orange and purple",
    "info": "",
    "x": 1410,
    "y": 1760,
    "wires": []
  },
  {
    "id": "82b870106ace9712",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Call light_on service",
    "info": "",
    "x": 1750,
    "y": 1760,
    "wires": []
  },
  {
    "id": "a4034e3426b2b90d",
    "type": "trigger",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "pay",
    "op2type": "nul",
    "duration": "15",
    "extend": false,
    "overrideDelay": false,
    "units": "min",
    "reset": "",
    "bytopic": "all",
    "topic": "topic",
    "outputs": 1,
    "x": 590,
    "y": 1800,
    "wires": [
      [
        "57f236eb64968c51"
      ]
    ]
  },
  {
    "id": "57f236eb64968c51",
    "type": "ha-get-entities",
    "z": "ad8c570ec4ac394a",
    "name": "Get  Light groups",
    "server": "7ab5c227.a3ce8c",
    "version": 0,
    "rules": [
      {
        "property": "entity_id",
        "logic": "is",
        "value": "light\\.(?!.*?all.*?)(?!.*?door.*?).*?_lights$",
        "valueType": "re"
      }
    ],
    "output_type": "split",
    "output_empty_results": false,
    "output_location_type": "msg",
    "output_location": "payload",
    "output_results_count": 1,
    "x": 850,
    "y": 1800,
    "wires": [
      [
        "0070875ba8af1c52"
      ]
    ]
  },
  {
    "id": "266772944b486c06",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Pull all light groups",
    "info": "",
    "x": 850,
    "y": 1760,
    "wires": []
  },
  {
    "id": "0a48ce10e522d2be",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "also sets the entity_id",
    "info": "",
    "x": 1600,
    "y": 960,
    "wires": []
  },
  {
    "id": "d904d25bb9c212a0",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "also sets the entity_id",
    "info": "",
    "x": 1420,
    "y": 1840,
    "wires": []
  },
  {
    "id": "9e0d2a87c4862562",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "15 minutes cooldown",
    "info": "",
    "x": 580,
    "y": 1760,
    "wires": []
  },
  {
    "id": "d610007ced8096fb",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Change light to warmn colors on kink mode",
    "info": "",
    "x": 260,
    "y": 1760,
    "wires": []
  },
  {
    "id": "1ed233c0367b3522",
    "type": "random",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "low": "1",
    "high": "11",
    "inte": "true",
    "property": "number",
    "x": 1340,
    "y": 400,
    "wires": [
      [
        "50f03fb059f6ea65"
      ]
    ]
  },
  {
    "id": "50f03fb059f6ea65",
    "type": "function",
    "z": "ad8c570ec4ac394a",
    "name": "Playlist Selector",
    "func": "var number = msg.number;\nvar entity_id = msg.payload.entity_id\nif (number == 1) {\n  var playlist = \"Automatic Alternative\";\n} else if (number == 2) {\n  var playlist = \"Automatic Classical\";\n} else if (number == 3) {\n  var playlist = \"Automatic Country\";\n} else if (number == 4) {\n  var playlist = \"Automatic Funk\";\n} else if (number == 5) {\n  var playlist = \"Automatic Pop\";\n} else if (number == 6) {\n  var playlist = \"Automatic Psychedelic\";\n} else if (number == 7) {\n  var playlist = \"Automatic Punk\";\n} else if (number == 8) {\n  var playlist = \"Automatic Quebecois\";\n} else if (number == 9) {\n  var playlist = \"Automatic Reggaeton\";\n} else if (number == 10) {\n  var playlist = \"Automatic Rock\";\n} else if (number == 11) {\n  var playlist = \"Automatic Synthwave\";\n} else {\n    \n}\n\n\nvar newMsg = {\n    \"payload\": { \n        \"data\": {\n              \"media_content_id\": 'plex://{ \"playlist_name\":'+ ' \"' + playlist + '\", \"shuffle\": 1 }',\n              \"media_content_type\": \"playlist\",\n              \"entity_id\": entity_id\n            \n        }\n}\n};\nreturn newMsg;\n\n\n// a switch can be used instead of a unch of else ifs",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1620,
    "y": 400,
    "wires": [
      [
        "d751ec94f35faa0d"
      ]
    ]
  },
  {
    "id": "d751ec94f35faa0d",
    "type": "api-call-service",
    "z": "ad8c570ec4ac394a",
    "name": "play music",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "media_player",
    "service": "play_media",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 1890,
    "y": 400,
    "wires": [
      []
    ]
  },
  {
    "id": "a76efc4ab5b56f29",
    "type": "ha-get-entities",
    "z": "ad8c570ec4ac394a",
    "name": "Get Google cast groups",
    "server": "7ab5c227.a3ce8c",
    "version": 0,
    "rules": [
      {
        "property": "entity_id",
        "logic": "is",
        "value": "media_player\\.group_.*_speakers",
        "valueType": "re"
      },
      {
        "property": "state",
        "logic": "is_not",
        "value": "playing",
        "valueType": "str"
      },
      {
        "property": "entity_id",
        "logic": "is_not",
        "value": "(media_player.group_hotbox_upper_speakers|media_player.group_hotbox_lower_speakers)",
        "valueType": "re"
      }
    ],
    "output_type": "split",
    "output_empty_results": false,
    "output_location_type": "msg",
    "output_location": "payload",
    "output_results_count": 1,
    "x": 830,
    "y": 400,
    "wires": [
      [
        "3ba0c3863600c878"
      ]
    ]
  },
  {
    "id": "3ba0c3863600c878",
    "type": "delay",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "pauseType": "rate",
    "timeout": "5",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "8",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "allowrate": false,
    "outputs": 1,
    "x": 1060,
    "y": 400,
    "wires": [
      [
        "1ed233c0367b3522"
      ]
    ]
  },
  {
    "id": "8d85249887f86d9d",
    "type": "server-state-changed",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 4,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "input_boolean.party_mode",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "on",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 2,
    "output_only_on_state_change": true,
    "for": "0",
    "forType": "num",
    "forUnits": "minutes",
    "ignorePrevStateNull": false,
    "ignorePrevStateUnknown": false,
    "ignorePrevStateUnavailable": false,
    "ignoreCurrentStateUnknown": false,
    "ignoreCurrentStateUnavailable": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "eventData"
      },
      {
        "property": "topic",
        "propertyType": "msg",
        "value": "",
        "valueType": "triggerId"
      }
    ],
    "x": 260,
    "y": 400,
    "wires": [
      [
        "3a47a2d796c18ff9"
      ],
      []
    ]
  },
  {
    "id": "1aa7f611d51f17cf",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Start music in each room when party mode is on",
    "info": "",
    "x": 260,
    "y": 360,
    "wires": []
  },
  {
    "id": "9633b560f8bfa29c",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "rate limit at 1 per 8s",
    "info": "",
    "x": 1050,
    "y": 360,
    "wires": []
  },
  {
    "id": "c363de697b9a97da",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Pull all speaker groups",
    "info": "",
    "x": 840,
    "y": 360,
    "wires": []
  },
  {
    "id": "1bdf3bf4fbbe7434",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Generated number between 1 and 11",
    "info": "",
    "x": 1330,
    "y": 360,
    "wires": []
  },
  {
    "id": "d75eb19853b4aa27",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Select playlist with number",
    "info": "",
    "x": 1610,
    "y": 360,
    "wires": []
  },
  {
    "id": "7ded67246d82136e",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Send media_play service",
    "info": "",
    "x": 1870,
    "y": 360,
    "wires": []
  },
  {
    "id": "9f398a5cb9a82e8d",
    "type": "server-state-changed",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 4,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "input_boolean.acid_time",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "on",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 2,
    "output_only_on_state_change": true,
    "for": "0",
    "forType": "num",
    "forUnits": "minutes",
    "ignorePrevStateNull": false,
    "ignorePrevStateUnknown": false,
    "ignorePrevStateUnavailable": false,
    "ignoreCurrentStateUnknown": false,
    "ignoreCurrentStateUnavailable": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "eventData"
      },
      {
        "property": "topic",
        "propertyType": "msg",
        "value": "",
        "valueType": "triggerId"
      }
    ],
    "x": 280,
    "y": 1660,
    "wires": [
      [
        "f48fe17557cf66de"
      ],
      []
    ]
  },
  {
    "id": "9881a9f9ac028d1e",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Start music across the place when acid mode is on",
    "info": "",
    "x": 290,
    "y": 1620,
    "wires": []
  },
  {
    "id": "f48fe17557cf66de",
    "type": "api-current-state",
    "z": "ad8c570ec4ac394a",
    "name": "Home group",
    "server": "7ab5c227.a3ce8c",
    "version": 3,
    "outputs": 2,
    "halt_if": "playing",
    "halt_if_type": "str",
    "halt_if_compare": "is_not",
    "entity_id": "media_player.group_home_speakers",
    "state_type": "str",
    "blockInputOverrides": false,
    "outputProperties": [
      {
        "property": "entity",
        "propertyType": "msg",
        "value": "",
        "valueType": "entity"
      }
    ],
    "for": 0,
    "forType": "num",
    "forUnits": "minutes",
    "x": 650,
    "y": 1660,
    "wires": [
      [
        "dcbcfadfd0a359ad"
      ],
      []
    ]
  },
  {
    "id": "dcbcfadfd0a359ad",
    "type": "api-call-service",
    "z": "ad8c570ec4ac394a",
    "name": "play music",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "media_player",
    "service": "play_media",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "media_player.ytube_music_player"
    ],
    "data": "{\"media_content_id\":\"RDCLAK5uy_mJl9Qy6PpXvT-JbR4DJbGxG6UqOiWqWSg\",\"media_content_type\":\"playlist\"}",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 1070,
    "y": 1660,
    "wires": [
      []
    ]
  },
  {
    "id": "12c5ab640f39ceb6",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Make sure Home Group is not playing",
    "info": "",
    "x": 650,
    "y": 1620,
    "wires": []
  },
  {
    "id": "dfa27ea023fafd5b",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Send media_play command",
    "info": "",
    "x": 1080,
    "y": 1620,
    "wires": []
  },
  {
    "id": "3a47a2d796c18ff9",
    "type": "api-current-state",
    "z": "ad8c570ec4ac394a",
    "name": "Home group",
    "server": "7ab5c227.a3ce8c",
    "version": 3,
    "outputs": 2,
    "halt_if": "playing",
    "halt_if_type": "str",
    "halt_if_compare": "is_not",
    "entity_id": "media_player.group_home_speakers",
    "state_type": "str",
    "blockInputOverrides": false,
    "outputProperties": [],
    "for": 0,
    "forType": "num",
    "forUnits": "minutes",
    "x": 570,
    "y": 400,
    "wires": [
      [
        "a76efc4ab5b56f29"
      ],
      []
    ]
  },
  {
    "id": "471935cb5043caf9",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Make sure the home group is off",
    "info": "",
    "x": 590,
    "y": 360,
    "wires": []
  },
  {
    "id": "10b869bd689ae010",
    "type": "inject",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "props": [
      {
        "p": "payload"
      },
      {
        "p": "topic",
        "vt": "str"
      }
    ],
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 1900,
    "y": 2860,
    "wires": [
      [
        "f7a24cb6dbf4c660"
      ]
    ]
  },
  {
    "id": "f7a24cb6dbf4c660",
    "type": "ha-get-entities",
    "z": "ad8c570ec4ac394a",
    "name": "Get active hotbox Media players",
    "server": "7ab5c227.a3ce8c",
    "version": 0,
    "rules": [
      {
        "property": "entity_id",
        "logic": "is",
        "value": "media_player\\.(?!.*?group.*?)(?!.*?top.*?)(?!.*?plex.*?).*hotbox.*",
        "valueType": "re"
      }
    ],
    "output_type": "split",
    "output_empty_results": false,
    "output_location_type": "msg",
    "output_location": "payload",
    "output_results_count": 1,
    "x": 2110,
    "y": 2860,
    "wires": [
      [
        "07b3821af4b52692"
      ]
    ]
  },
  {
    "id": "07b3821af4b52692",
    "type": "debug",
    "z": "ad8c570ec4ac394a",
    "name": "debug 5",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "false",
    "statusVal": "",
    "statusType": "auto",
    "x": 2400,
    "y": 2860,
    "wires": []
  },
  {
    "id": "fc6bf96773f2d1a4",
    "type": "inject",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "props": [
      {
        "p": "payload"
      },
      {
        "p": "topic",
        "vt": "str"
      }
    ],
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 580,
    "y": 3200,
    "wires": [
      [
        "45e38d814857d3fd"
      ]
    ]
  },
  {
    "id": "89fbf9146439bc53",
    "type": "inject",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "props": [
      {
        "p": "payload"
      },
      {
        "p": "topic",
        "vt": "str"
      }
    ],
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 560,
    "y": 300,
    "wires": [
      [
        "89d0d1d918564386"
      ]
    ]
  },
  {
    "id": "05eca86f288814a6",
    "type": "inject",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "props": [
      {
        "p": "payload"
      },
      {
        "p": "topic",
        "vt": "str"
      }
    ],
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 940,
    "y": 980,
    "wires": [
      [
        "739f28daa568c871"
      ]
    ]
  },
  {
    "id": "2f13453376465f8b",
    "type": "switch",
    "z": "ad8c570ec4ac394a",
    "name": "Exclude groups",
    "property": "payload.attributes.entity_id",
    "propertyType": "msg",
    "rules": [
      {
        "t": "null"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1300,
    "y": 920,
    "wires": [
      [
        "4785df9fde6fcd4d"
      ]
    ]
  },
  {
    "id": "c681bfada6313045",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Exclude groups",
    "info": "",
    "x": 1260,
    "y": 880,
    "wires": []
  },
  {
    "id": "67d42729c9dfa729",
    "type": "server-state-changed",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 4,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "input_boolean.acid_time",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "on",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 2,
    "output_only_on_state_change": true,
    "for": "0",
    "forType": "num",
    "forUnits": "minutes",
    "ignorePrevStateNull": false,
    "ignorePrevStateUnknown": false,
    "ignorePrevStateUnavailable": false,
    "ignoreCurrentStateUnknown": false,
    "ignoreCurrentStateUnavailable": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "eventData"
      },
      {
        "property": "topic",
        "propertyType": "msg",
        "value": "",
        "valueType": "triggerId"
      }
    ],
    "x": 260,
    "y": 1880,
    "wires": [
      [
        "43c972f7629d8a1f"
      ],
      []
    ]
  },
  {
    "id": "73d18616b2404059",
    "type": "server-state-changed",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 4,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "input_boolean.kink_party",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "on",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 2,
    "output_only_on_state_change": true,
    "for": "0",
    "forType": "num",
    "forUnits": "minutes",
    "ignorePrevStateNull": false,
    "ignorePrevStateUnknown": false,
    "ignorePrevStateUnavailable": false,
    "ignoreCurrentStateUnknown": false,
    "ignoreCurrentStateUnavailable": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "eventData"
      },
      {
        "property": "topic",
        "propertyType": "msg",
        "value": "",
        "valueType": "triggerId"
      }
    ],
    "x": 260,
    "y": 1960,
    "wires": [
      [
        "43c972f7629d8a1f"
      ],
      []
    ]
  },
  {
    "id": "bbb1b673486b2a72",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Change light to warmn colors on kink mode",
    "info": "",
    "x": 260,
    "y": 1920,
    "wires": []
  },
  {
    "id": "43c972f7629d8a1f",
    "type": "ha-get-entities",
    "z": "ad8c570ec4ac394a",
    "name": "Get  Covers",
    "server": "7ab5c227.a3ce8c",
    "version": 0,
    "rules": [
      {
        "property": "entity_id",
        "logic": "is",
        "value": "^cover.*",
        "valueType": "re"
      }
    ],
    "output_type": "split",
    "output_empty_results": false,
    "output_location_type": "msg",
    "output_location": "payload",
    "output_results_count": 1,
    "x": 550,
    "y": 1920,
    "wires": [
      [
        "e9a2f694ad617051"
      ]
    ]
  },
  {
    "id": "934327820cd3b9db",
    "type": "api-call-service",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "cover",
    "service": "set_cover_position",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "{\"position\": 0 }",
    "dataType": "jsonata",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 1270,
    "y": 1920,
    "wires": [
      []
    ]
  },
  {
    "id": "e9a2f694ad617051",
    "type": "change",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "payload.data.entity_id",
        "pt": "msg",
        "to": "payload.entity_id",
        "tot": "msg",
        "dc": true
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 850,
    "y": 1920,
    "wires": [
      [
        "934327820cd3b9db"
      ]
    ]
  },
  {
    "id": "3de0e38b3391fa0f",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Extract the entity id",
    "info": "",
    "x": 850,
    "y": 1880,
    "wires": []
  },
  {
    "id": "e216d39e85bfde74",
    "type": "trigger",
    "z": "ad8c570ec4ac394a",
    "name": "trigger",
    "op1": "",
    "op2": "",
    "op1type": "pay",
    "op2type": "nul",
    "duration": "-27",
    "extend": false,
    "overrideDelay": true,
    "units": "s",
    "reset": "off",
    "bytopic": "all",
    "topic": "topic",
    "outputs": 1,
    "x": 1270,
    "y": 2160,
    "wires": [
      [
        "c35f86c38b307e2a",
        "48ff7c7b01ea4c37"
      ]
    ]
  },
  {
    "id": "60c802a803ab7630",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "resend every minute",
    "info": "",
    "x": 590,
    "y": 1960,
    "wires": []
  },
  {
    "id": "c35f86c38b307e2a",
    "type": "ha-get-entities",
    "z": "ad8c570ec4ac394a",
    "name": "Get  on Light entities",
    "server": "7ab5c227.a3ce8c",
    "version": 0,
    "rules": [
      {
        "property": "entity_id",
        "logic": "is",
        "value": "light\\.(?!.*?group.*?)(?!.*?workstation.*?)(?!.*?door.*?).*?_(?!.*?lights.*?).*",
        "valueType": "re"
      },
      {
        "property": "state",
        "logic": "is",
        "value": "on",
        "valueType": "str"
      }
    ],
    "output_type": "split",
    "output_empty_results": false,
    "output_location_type": "msg",
    "output_location": "payload",
    "output_results_count": 1,
    "x": 1500,
    "y": 2160,
    "wires": [
      [
        "d96013fcab1de88f"
      ]
    ]
  },
  {
    "id": "b8918acbc043e03b",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Try to Pull all single lights",
    "info": "",
    "x": 1490,
    "y": 2120,
    "wires": []
  },
  {
    "id": "c3523ad88b296bc0",
    "type": "server-state-changed",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 4,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "input_boolean.trippy_lights_effect",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "on",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 2,
    "output_only_on_state_change": true,
    "for": "0",
    "forType": "num",
    "forUnits": "minutes",
    "ignorePrevStateNull": false,
    "ignorePrevStateUnknown": false,
    "ignorePrevStateUnavailable": false,
    "ignoreCurrentStateUnknown": false,
    "ignoreCurrentStateUnavailable": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "eventData"
      },
      {
        "property": "topic",
        "propertyType": "msg",
        "value": "",
        "valueType": "triggerId"
      }
    ],
    "x": 260,
    "y": 2220,
    "wires": [
      [
        "4427e8d39681e34b"
      ],
      [
        "6ab4316b4ec28a96"
      ]
    ]
  },
  {
    "id": "b9b72ca9a47fe8bb",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Output the transition speed",
    "info": "",
    "x": 250,
    "y": 2060,
    "wires": []
  },
  {
    "id": "d96013fcab1de88f",
    "type": "switch",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "property": "payload.attributes.supported_color_modes",
    "propertyType": "msg",
    "rules": [
      {
        "t": "regex",
        "v": "(xy|hs)",
        "vt": "str",
        "case": false
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1730,
    "y": 2160,
    "wires": [
      [
        "f373e604f393df36"
      ]
    ]
  },
  {
    "id": "ce2a7725a9b135eb",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Check for color support",
    "info": "",
    "x": 1720,
    "y": 2120,
    "wires": []
  },
  {
    "id": "2c54900f0bdbbea5",
    "type": "function",
    "z": "ad8c570ec4ac394a",
    "name": "Generate Random saturated color",
    "func": "var entity_id = msg.payload.entity_id;\n\n\nvar hue = Math.floor(Math.random() * 360); //generate a random number up to 360\n\nvar hs_color = hue + \",100\";\nvar hs_color_array = hs_color.split(\",\");\nvar newMsg = {\n    \"payload\": {\n        \"data\": {\n            \"hs_color\": hs_color_array,\n            \"entity_id\": entity_id,\n            \"transition\": 30\n            \n}\n        }\n    }\n;\nreturn newMsg;",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 2920,
    "y": 2080,
    "wires": [
      [
        "36aeeb784b9b67d3"
      ]
    ]
  },
  {
    "id": "9742776084a6cf49",
    "type": "api-call-service",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "light",
    "service": "turn_on",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "",
    "dataType": "jsonata",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 3690,
    "y": 2080,
    "wires": [
      []
    ]
  },
  {
    "id": "c4aa529c3bfe0b04",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Generated random HS 100% saturated color",
    "info": "Generates fully saturdated zolors without any white",
    "x": 2930,
    "y": 2040,
    "wires": []
  },
  {
    "id": "572c1dd0e1c64066",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Call light_on service",
    "info": "",
    "x": 3690,
    "y": 2040,
    "wires": []
  },
  {
    "id": "f373e604f393df36",
    "type": "switch",
    "z": "ad8c570ec4ac394a",
    "name": "Exclude groups",
    "property": "payload.attributes.entity_id",
    "propertyType": "msg",
    "rules": [
      {
        "t": "null"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1940,
    "y": 2160,
    "wires": [
      [
        "301622d4f5b9283a"
      ]
    ]
  },
  {
    "id": "ffedbf625aa02554",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Exclude groups",
    "info": "",
    "x": 1940,
    "y": 2120,
    "wires": []
  },
  {
    "id": "301622d4f5b9283a",
    "type": "switch",
    "z": "ad8c570ec4ac394a",
    "name": "Exclude white lights",
    "property": "payload.attributes.hs_color[1]",
    "propertyType": "msg",
    "rules": [
      {
        "t": "gt",
        "v": "45",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 2250,
    "y": 2160,
    "wires": [
      [
        "266c35d39976b527"
      ]
    ]
  },
  {
    "id": "14e5b5fc211769db",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Exclude white lights",
    "info": "",
    "x": 2250,
    "y": 2120,
    "wires": []
  },
  {
    "id": "0ab6f9152439d8af",
    "type": "ha-get-entities",
    "z": "ad8c570ec4ac394a",
    "name": "Get on Light entities",
    "server": "7ab5c227.a3ce8c",
    "version": 0,
    "rules": [
      {
        "property": "entity_id",
        "logic": "is",
        "value": "light\\.(?!.*?all.*?)(?!.*?group.*?)(?!.*?door.*?)(?!.*?nate.*?).*?_(?!.*?lights.*?).*",
        "valueType": "re"
      },
      {
        "property": "state",
        "logic": "is",
        "value": "on",
        "valueType": "str"
      }
    ],
    "output_type": "split",
    "output_empty_results": false,
    "output_location_type": "msg",
    "output_location": "payload",
    "output_results_count": 1,
    "x": 580,
    "y": 2320,
    "wires": [
      [
        "81946780c56f602e"
      ]
    ]
  },
  {
    "id": "b6bdfe2b7847f2b7",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Try to Pull all single lights",
    "info": "",
    "x": 570,
    "y": 2280,
    "wires": []
  },
  {
    "id": "81946780c56f602e",
    "type": "switch",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "property": "payload.attributes.supported_color_modes",
    "propertyType": "msg",
    "rules": [
      {
        "t": "regex",
        "v": "(xy|hs)",
        "vt": "str",
        "case": false
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 810,
    "y": 2320,
    "wires": [
      [
        "39e0f12350ee7f1a"
      ]
    ]
  },
  {
    "id": "18201a36b62935e2",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Check for color support",
    "info": "",
    "x": 800,
    "y": 2280,
    "wires": []
  },
  {
    "id": "37b4f8618d88a9f6",
    "type": "api-call-service",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "light",
    "service": "turn_on",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "{\"color_name\": \"white\",\"transition\": 25}",
    "dataType": "jsonata",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 1930,
    "y": 2320,
    "wires": [
      []
    ]
  },
  {
    "id": "569a244b153689a5",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Call light_on service with 25s transition to white",
    "info": "",
    "x": 1940,
    "y": 2280,
    "wires": []
  },
  {
    "id": "39e0f12350ee7f1a",
    "type": "switch",
    "z": "ad8c570ec4ac394a",
    "name": "Exclude groups",
    "property": "payload.attributes.entity_id",
    "propertyType": "msg",
    "rules": [
      {
        "t": "null"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1020,
    "y": 2320,
    "wires": [
      [
        "29b0e978a2e3726e"
      ]
    ]
  },
  {
    "id": "070d31bd4f074398",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Exclude groups",
    "info": "",
    "x": 1020,
    "y": 2280,
    "wires": []
  },
  {
    "id": "29b0e978a2e3726e",
    "type": "switch",
    "z": "ad8c570ec4ac394a",
    "name": "Exclude white lights",
    "property": "payload.attributes.hs_color[1]",
    "propertyType": "msg",
    "rules": [
      {
        "t": "gt",
        "v": "45",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1330,
    "y": 2320,
    "wires": [
      [
        "ba8f1f9ba7caa887"
      ]
    ]
  },
  {
    "id": "d3bbe811fd5706fe",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Exclude white lights",
    "info": "",
    "x": 1330,
    "y": 2280,
    "wires": []
  },
  {
    "id": "71b5ac1ee70cb6db",
    "type": "server-state-changed",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 4,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "input_boolean.trippy_lights_effect",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 2,
    "output_only_on_state_change": true,
    "for": "0",
    "forType": "num",
    "forUnits": "minutes",
    "ignorePrevStateNull": false,
    "ignorePrevStateUnknown": false,
    "ignorePrevStateUnavailable": false,
    "ignoreCurrentStateUnknown": false,
    "ignoreCurrentStateUnavailable": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "eventData"
      },
      {
        "property": "topic",
        "propertyType": "msg",
        "value": "",
        "valueType": "triggerId"
      }
    ],
    "x": 260,
    "y": 2320,
    "wires": [
      [
        "0ab6f9152439d8af"
      ],
      []
    ]
  },
  {
    "id": "f53e3ff032543575",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Returns lights to normality when trippy lights is off",
    "info": "",
    "x": 260,
    "y": 2280,
    "wires": []
  },
  {
    "id": "ba8f1f9ba7caa887",
    "type": "change",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "payload.data.entity_id",
        "pt": "msg",
        "to": "payload.entity_id",
        "tot": "msg",
        "dc": true
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1590,
    "y": 2320,
    "wires": [
      [
        "37b4f8618d88a9f6"
      ]
    ]
  },
  {
    "id": "b63722f5e8efecb9",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Extract the entity id",
    "info": "",
    "x": 1590,
    "y": 2280,
    "wires": []
  },
  {
    "id": "266c35d39976b527",
    "type": "api-current-state",
    "z": "ad8c570ec4ac394a",
    "name": "Acid mode on?",
    "server": "7ab5c227.a3ce8c",
    "version": 3,
    "outputs": 2,
    "halt_if": "on",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "entity_id": "input_boolean.acid_time",
    "state_type": "str",
    "blockInputOverrides": true,
    "outputProperties": [],
    "for": 0,
    "forType": "num",
    "forUnits": "minutes",
    "x": 2460,
    "y": 2160,
    "wires": [
      [
        "9442e076db99a2e1"
      ],
      [
        "6376942863a60cd1"
      ]
    ]
  },
  {
    "id": "6376942863a60cd1",
    "type": "api-current-state",
    "z": "ad8c570ec4ac394a",
    "name": "Party Mode off?",
    "server": "7ab5c227.a3ce8c",
    "version": 3,
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "entity_id": "input_boolean.party_mode",
    "state_type": "str",
    "blockInputOverrides": true,
    "outputProperties": [],
    "for": 0,
    "forType": "num",
    "forUnits": "minutes",
    "x": 2660,
    "y": 2180,
    "wires": [
      [
        "2c54900f0bdbbea5"
      ],
      [
        "6df8b0ea967974ba"
      ]
    ]
  },
  {
    "id": "6df8b0ea967974ba",
    "type": "function",
    "z": "ad8c570ec4ac394a",
    "name": "Generate Random whiteish color",
    "func": "var entity_id = msg.payload.entity_id;\n\n\nvar hue = Math.floor(Math.random() * 360); //generate a random number up to 360\n\nvar hs_color = hue + \",60\";\nvar hs_color_array = hs_color.split(\",\");\nvar newMsg = {\n    \"payload\": {\n        \"data\": {\n            \"hs_color\": hs_color_array,\n            \"entity_id\": entity_id,\n            \"transition\": 30\n            \n}\n        }\n    }\n;\nreturn newMsg;",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 2920,
    "y": 2180,
    "wires": [
      [
        "b1f69e31bd7b64d3"
      ]
    ]
  },
  {
    "id": "7c96df0988a1f2e8",
    "type": "api-call-service",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "light",
    "service": "turn_on",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "",
    "dataType": "jsonata",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 3690,
    "y": 2180,
    "wires": [
      []
    ]
  },
  {
    "id": "2384cfdc8c9ff685",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Generated random HS 60% saturated color",
    "info": "",
    "x": 2940,
    "y": 2140,
    "wires": []
  },
  {
    "id": "ffdac1079452e050",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Call light_on service",
    "info": "",
    "x": 3690,
    "y": 2140,
    "wires": []
  },
  {
    "id": "8b33b34cd591cd12",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Is someone high?",
    "info": "",
    "x": 2470,
    "y": 2120,
    "wires": []
  },
  {
    "id": "95a2f4f003b52cc2",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Is it party time?",
    "info": "",
    "x": 2660,
    "y": 2140,
    "wires": []
  },
  {
    "id": "36aeeb784b9b67d3",
    "type": "api-current-state",
    "z": "ad8c570ec4ac394a",
    "name": "TRansition?",
    "server": "7ab5c227.a3ce8c",
    "version": 3,
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "entity_id": "input_number.trippy_lights_effect_speed",
    "state_type": "str",
    "blockInputOverrides": true,
    "outputProperties": [
      {
        "property": "payload.data.transition",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      }
    ],
    "for": 0,
    "forType": "num",
    "forUnits": "minutes",
    "x": 3190,
    "y": 2080,
    "wires": [
      [
        "8638760da61933b1",
        "87099afb4505603b"
      ]
    ]
  },
  {
    "id": "4427e8d39681e34b",
    "type": "api-current-state",
    "z": "ad8c570ec4ac394a",
    "name": "TRansition?",
    "server": "7ab5c227.a3ce8c",
    "version": 3,
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "entity_id": "input_number.trippy_lights_effect_speed",
    "state_type": "str",
    "blockInputOverrides": true,
    "outputProperties": [
      {
        "property": "delay",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      }
    ],
    "for": 0,
    "forType": "num",
    "forUnits": "minutes",
    "x": 550,
    "y": 2180,
    "wires": [
      [
        "630088e66f7238a1"
      ]
    ]
  },
  {
    "id": "b1f69e31bd7b64d3",
    "type": "api-current-state",
    "z": "ad8c570ec4ac394a",
    "name": "TRansition?",
    "server": "7ab5c227.a3ce8c",
    "version": 3,
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "entity_id": "input_number.trippy_lights_effect_speed",
    "state_type": "str",
    "blockInputOverrides": true,
    "outputProperties": [
      {
        "property": "payload.data.transition",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      }
    ],
    "for": 0,
    "forType": "num",
    "forUnits": "minutes",
    "x": 3190,
    "y": 2180,
    "wires": [
      [
        "986ec2990f7b1d2b"
      ]
    ]
  },
  {
    "id": "3ec9d48db7a29234",
    "type": "server-state-changed",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 4,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "input_number.trippy_lights_effect_speed",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "num",
    "haltifstate": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 1,
    "output_only_on_state_change": true,
    "for": "0",
    "forType": "num",
    "forUnits": "minutes",
    "ignorePrevStateNull": false,
    "ignorePrevStateUnknown": false,
    "ignorePrevStateUnavailable": false,
    "ignoreCurrentStateUnknown": false,
    "ignoreCurrentStateUnavailable": false,
    "outputProperties": [
      {
        "property": "delay",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      }
    ],
    "x": 290,
    "y": 2100,
    "wires": [
      [
        "630088e66f7238a1"
      ]
    ]
  },
  {
    "id": "0a7a7514d579949c",
    "type": "function",
    "z": "ad8c570ec4ac394a",
    "name": "Convert MS to S",
    "func": "var seconds = msg.delay * 1000;\n\nvar msg = {\n    \"delay\": seconds\n}\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1080,
    "y": 2160,
    "wires": [
      [
        "e216d39e85bfde74",
        "48ff7c7b01ea4c37"
      ]
    ]
  },
  {
    "id": "74b80452ecae5b16",
    "type": "api-current-state",
    "z": "ad8c570ec4ac394a",
    "name": "Effect on?",
    "server": "7ab5c227.a3ce8c",
    "version": 3,
    "outputs": 2,
    "halt_if": "on",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "entity_id": "input_boolean.trippy_lights_effect",
    "state_type": "str",
    "blockInputOverrides": true,
    "outputProperties": [],
    "for": 0,
    "forType": "num",
    "forUnits": "minutes",
    "x": 880,
    "y": 2180,
    "wires": [
      [
        "0a7a7514d579949c"
      ],
      []
    ]
  },
  {
    "id": "b46bfc99d6f67018",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Output the transition speed",
    "info": "",
    "x": 550,
    "y": 2140,
    "wires": []
  },
  {
    "id": "0e54e9dc17ebe8de",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Is the effect on?",
    "info": "",
    "x": 880,
    "y": 2140,
    "wires": []
  },
  {
    "id": "37bd44f22fee717e",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Trigger on \"trippy lights effect\" toggle",
    "info": "",
    "x": 260,
    "y": 2180,
    "wires": []
  },
  {
    "id": "42ddbc4a3d56b5b2",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Output the transition speed",
    "info": "",
    "x": 3210,
    "y": 2040,
    "wires": []
  },
  {
    "id": "816cb8557c929c95",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Output the transition speed",
    "info": "",
    "x": 3210,
    "y": 2140,
    "wires": []
  },
  {
    "id": "8638760da61933b1",
    "type": "api-current-state",
    "z": "ad8c570ec4ac394a",
    "name": "Saturation?",
    "server": "7ab5c227.a3ce8c",
    "version": 3,
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "entity_id": "input_number.trippy_lights_color_saturation",
    "state_type": "str",
    "blockInputOverrides": true,
    "outputProperties": [
      {
        "property": "payload.data.hs_color[1]",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      }
    ],
    "for": 0,
    "forType": "num",
    "forUnits": "minutes",
    "x": 3430,
    "y": 2080,
    "wires": [
      [
        "9742776084a6cf49",
        "7c6963761c4661a3"
      ]
    ]
  },
  {
    "id": "986ec2990f7b1d2b",
    "type": "api-current-state",
    "z": "ad8c570ec4ac394a",
    "name": "Saturation",
    "server": "7ab5c227.a3ce8c",
    "version": 3,
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "entity_id": "input_number.trippy_lights_color_saturation",
    "state_type": "str",
    "blockInputOverrides": true,
    "outputProperties": [
      {
        "property": "payload.data.hs_color[1]",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      }
    ],
    "for": 0,
    "forType": "num",
    "forUnits": "minutes",
    "x": 3430,
    "y": 2180,
    "wires": [
      [
        "7c96df0988a1f2e8"
      ]
    ]
  },
  {
    "id": "c00687f46b6065e4",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Output the color saturation",
    "info": "",
    "x": 3450,
    "y": 2040,
    "wires": []
  },
  {
    "id": "2fc677cffaf3712f",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Output the color saturation",
    "info": "",
    "x": 3450,
    "y": 2140,
    "wires": []
  },
  {
    "id": "87099afb4505603b",
    "type": "debug",
    "z": "ad8c570ec4ac394a",
    "name": "debug 12",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "false",
    "statusVal": "",
    "statusType": "auto",
    "x": 3360,
    "y": 1960,
    "wires": []
  },
  {
    "id": "7c6963761c4661a3",
    "type": "debug",
    "z": "ad8c570ec4ac394a",
    "name": "debug 13",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "false",
    "statusVal": "",
    "statusType": "auto",
    "x": 3540,
    "y": 1980,
    "wires": []
  },
  {
    "id": "48ff7c7b01ea4c37",
    "type": "debug",
    "z": "ad8c570ec4ac394a",
    "name": "debug 17",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "false",
    "statusVal": "",
    "statusType": "auto",
    "x": 1400,
    "y": 2040,
    "wires": []
  },
  {
    "id": "df7959a17666432e",
    "type": "server-state-changed",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 4,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "input_boolean.show_lyrics",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "on",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 2,
    "output_only_on_state_change": true,
    "for": "0",
    "forType": "num",
    "forUnits": "minutes",
    "ignorePrevStateNull": false,
    "ignorePrevStateUnknown": false,
    "ignorePrevStateUnavailable": false,
    "ignoreCurrentStateUnknown": false,
    "ignoreCurrentStateUnavailable": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "eventData"
      },
      {
        "property": "topic",
        "propertyType": "msg",
        "value": "",
        "valueType": "triggerId"
      }
    ],
    "x": 200,
    "y": 3380,
    "wires": [
      [
        "51ea5ee7a5dee235"
      ],
      [
        "3d2173d5d941fa22"
      ]
    ]
  },
  {
    "id": "45e38d814857d3fd",
    "type": "ha-get-entities",
    "z": "ad8c570ec4ac394a",
    "name": "Get ChromecastMedia players",
    "server": "7ab5c227.a3ce8c",
    "version": 0,
    "rules": [
      {
        "property": "entity_id",
        "logic": "is",
        "value": "media_player\\.(?!plex).*_chromecast",
        "valueType": "re"
      },
      {
        "property": "state",
        "logic": "is",
        "value": "off",
        "valueType": "str"
      }
    ],
    "output_type": "split",
    "output_empty_results": false,
    "output_location_type": "msg",
    "output_location": "payload",
    "output_results_count": 1,
    "x": 1190,
    "y": 3380,
    "wires": [
      [
        "f5f31a7289f1792a"
      ]
    ]
  },
  {
    "id": "f5f31a7289f1792a",
    "type": "delay",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "pauseType": "rate",
    "timeout": "5",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "2",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "allowrate": false,
    "outputs": 1,
    "x": 1440,
    "y": 3380,
    "wires": [
      [
        "55efad02a56cbde1"
      ]
    ]
  },
  {
    "id": "55efad02a56cbde1",
    "type": "change",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "payload.data.entity_id",
        "pt": "msg",
        "to": "payload.entity_id",
        "tot": "msg",
        "dc": true
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1690,
    "y": 3380,
    "wires": [
      [
        "47c2c09a0f9b8bd0"
      ]
    ]
  },
  {
    "id": "47c2c09a0f9b8bd0",
    "type": "api-call-service",
    "z": "ad8c570ec4ac394a",
    "name": "Cast lyrics",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "cast",
    "service": "show_lovelace_view",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "{\"dashboard_path\":\"lovelace-hub\",\"view_path\":\"karaoke\"}",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 1930,
    "y": 3380,
    "wires": [
      [
        "780929606df5a4fc"
      ]
    ]
  },
  {
    "id": "7c556ee0a47317f3",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Display lyrics on TVs when showlyrics mode is triggered",
    "info": "",
    "x": 240,
    "y": 3340,
    "wires": []
  },
  {
    "id": "b274fab4affe458f",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Pull all inactive Chromecasts entities",
    "info": "",
    "x": 1180,
    "y": 3340,
    "wires": []
  },
  {
    "id": "1c20b23ec241978b",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "rate limit at 1 per 8s",
    "info": "",
    "x": 1430,
    "y": 3340,
    "wires": []
  },
  {
    "id": "d6d5849a860e48f8",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Extract the entity id",
    "info": "",
    "x": 1690,
    "y": 3340,
    "wires": []
  },
  {
    "id": "c895a095762bdb40",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Start the visuals playlist",
    "info": "",
    "x": 1920,
    "y": 3340,
    "wires": []
  },
  {
    "id": "51ea5ee7a5dee235",
    "type": "api-current-state",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 3,
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is_not",
    "entity_id": "media_player.group_home_speakers",
    "state_type": "str",
    "blockInputOverrides": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "entity"
      }
    ],
    "for": 0,
    "forType": "num",
    "forUnits": "minutes",
    "override_topic": false,
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "x": 670,
    "y": 3380,
    "wires": [
      [
        "45e38d814857d3fd"
      ],
      []
    ]
  },
  {
    "id": "3d2173d5d941fa22",
    "type": "ha-get-entities",
    "z": "ad8c570ec4ac394a",
    "name": "Get ChromecastMedia players",
    "server": "7ab5c227.a3ce8c",
    "version": 0,
    "rules": [
      {
        "property": "entity_id",
        "logic": "is",
        "value": "media_player\\.(?!plex).*_chromecast",
        "valueType": "re"
      },
      {
        "property": "attributes.media_title",
        "logic": "is",
        "value": "lovelace-hub: Karaoke",
        "valueType": "str"
      }
    ],
    "output_type": "split",
    "output_empty_results": false,
    "output_location_type": "msg",
    "output_location": "payload",
    "output_results_count": 1,
    "x": 610,
    "y": 3520,
    "wires": [
      [
        "978e4a94ca1b50a1"
      ]
    ]
  },
  {
    "id": "978e4a94ca1b50a1",
    "type": "change",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "payload.data.entity_id",
        "pt": "msg",
        "to": "payload.entity_id",
        "tot": "msg",
        "dc": true
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1110,
    "y": 3520,
    "wires": [
      [
        "1e4987d26149bf33"
      ]
    ]
  },
  {
    "id": "1e4987d26149bf33",
    "type": "api-call-service",
    "z": "ad8c570ec4ac394a",
    "name": "Stop cast",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "media_player",
    "service": "turn_off",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 1340,
    "y": 3520,
    "wires": [
      []
    ]
  },
  {
    "id": "345108ed53660124",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Make sure Home group is playing",
    "info": "",
    "x": 670,
    "y": 3340,
    "wires": []
  },
  {
    "id": "1c893d951d205976",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Extract the entity id",
    "info": "",
    "x": 1090,
    "y": 3480,
    "wires": []
  },
  {
    "id": "8a1a8a7cadb580c7",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Stop the cast",
    "info": "",
    "x": 1330,
    "y": 3480,
    "wires": []
  },
  {
    "id": "780929606df5a4fc",
    "type": "api-call-service",
    "z": "ad8c570ec4ac394a",
    "name": "mute player",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "media_player",
    "service": "volume_mute",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "{\"is_volume_muted\":\"true\"}",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 2190,
    "y": 3380,
    "wires": [
      []
    ]
  },
  {
    "id": "5595b6a9f9d700dc",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Mute player",
    "info": "",
    "x": 2170,
    "y": 3340,
    "wires": []
  },
  {
    "id": "07cd581f9b3b5828",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Pull all lyrics casting Chromecasts entities",
    "info": "",
    "x": 620,
    "y": 3480,
    "wires": []
  },
  {
    "id": "6ffdc8b6e02bfc69",
    "type": "trigger-state",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 2,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityid": "binary_sensor.front_door_person_occupancy",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "on",
        "propertyValue": "new_state.state"
      },
      {
        "targetType": "entity_id",
        "targetValue": "input_boolean.waiting_pakidge",
        "propertyType": "current_state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "on",
        "propertyValue": "new_state.state"
      }
    ],
    "inputs": 0,
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "enableInput": false,
    "x": 290,
    "y": 2780,
    "wires": [
      [
        "7db0dc91253bee08"
      ],
      []
    ]
  },
  {
    "id": "a3905471250639d1",
    "type": "api-call-service",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "notify",
    "service": "mobile_app_galaxy_s10",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "{\"message\":\"Someone is nearing the door\",\"title\":\"Pakidge Attempt?\",\"data\":{\"image\":\"https://hass.purgatoire.ca/local/pakidge.jpg\"}}",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 1080,
    "y": 2780,
    "wires": [
      []
    ]
  },
  {
    "id": "7db0dc91253bee08",
    "type": "api-call-service",
    "z": "ad8c570ec4ac394a",
    "name": "Save pakidge.jpg",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "camera",
    "service": "snapshot",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "camera.front_door"
    ],
    "data": "{\"filename\":\"/config/www/pakidge.jpg\"}",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 670,
    "y": 2780,
    "wires": [
      [
        "a3905471250639d1"
      ]
    ]
  },
  {
    "id": "ba864598c9411636",
    "type": "inject",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "props": [
      {
        "p": "payload"
      },
      {
        "p": "topic",
        "vt": "str"
      }
    ],
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 440,
    "y": 2720,
    "wires": [
      [
        "7db0dc91253bee08"
      ]
    ]
  },
  {
    "id": "41b866c68f11b71c",
    "type": "api-call-service",
    "z": "ad8c570ec4ac394a",
    "name": "play acid visuals",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "media_player",
    "service": "play_media",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "{\"media_content_id\":\"plex://{ \\\"playlist_name\\\": \\\"Automatic Acid Visuals\\\", \\\"shuffle\\\": 1 }\",\"media_content_type\":\"playlist\"}",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 1660,
    "y": 1580,
    "wires": [
      []
    ]
  },
  {
    "id": "9ebb3cde717d14a5",
    "type": "api-call-service",
    "z": "ad8c570ec4ac394a",
    "name": "play party visuals",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "media_player",
    "service": "play_media",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "{\"media_content_id\":\"plex://{ \\\"playlist_name\\\": \\\"Automatic Soft Visuals\\\", \\\"shuffle\\\": 1 }\",\"media_content_type\":\"playlist\"}",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 1650,
    "y": 160,
    "wires": [
      []
    ]
  },
  {
    "id": "3c0539b0f3b00da5",
    "type": "trigger",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "pay",
    "op2type": "nul",
    "duration": "1",
    "extend": false,
    "overrideDelay": false,
    "units": "s",
    "reset": "",
    "bytopic": "all",
    "topic": "topic",
    "outputs": 1,
    "x": 580,
    "y": 1060,
    "wires": [
      [
        "73d7d43d57b2e30f"
      ]
    ]
  },
  {
    "id": "c37b606f5c9c2ae7",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "15 seconds cooldown",
    "info": "",
    "x": 580,
    "y": 1020,
    "wires": []
  },
  {
    "id": "73d7d43d57b2e30f",
    "type": "ha-get-entities",
    "z": "ad8c570ec4ac394a",
    "name": "Get  Light entities",
    "server": "7ab5c227.a3ce8c",
    "version": 0,
    "rules": [
      {
        "property": "entity_id",
        "logic": "is",
        "value": "light\\.(?!.*?group.*?)(?!.*?k95_rgb_2_led.*?)(?!.*?door.*?).*?_(?!.*?lights.*?).*",
        "valueType": "re"
      },
      {
        "property": "state",
        "logic": "is",
        "value": "on",
        "valueType": "str"
      }
    ],
    "output_type": "split",
    "output_empty_results": false,
    "output_location_type": "msg",
    "output_location": "payload",
    "output_results_count": 1,
    "x": 830,
    "y": 1060,
    "wires": [
      [
        "345651af8bf55493"
      ]
    ]
  },
  {
    "id": "bc07ec44273636ee",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Try to Pull all lit single lights",
    "info": "",
    "x": 820,
    "y": 1020,
    "wires": []
  },
  {
    "id": "f0105def6dddb0f9",
    "type": "server-state-changed",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 4,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "input_boolean.random_colors",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "on",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 2,
    "output_only_on_state_change": true,
    "for": "0",
    "forType": "num",
    "forUnits": "minutes",
    "ignorePrevStateNull": false,
    "ignorePrevStateUnknown": false,
    "ignorePrevStateUnavailable": false,
    "ignoreCurrentStateUnknown": false,
    "ignoreCurrentStateUnavailable": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "eventData"
      },
      {
        "property": "topic",
        "propertyType": "msg",
        "value": "",
        "valueType": "triggerId"
      }
    ],
    "x": 270,
    "y": 1060,
    "wires": [
      [
        "3c0539b0f3b00da5"
      ],
      []
    ]
  },
  {
    "id": "698c1c86b99cb219",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Change light to random colors on press",
    "info": "",
    "x": 250,
    "y": 1020,
    "wires": []
  },
  {
    "id": "345651af8bf55493",
    "type": "switch",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "property": "payload.attributes.supported_color_modes",
    "propertyType": "msg",
    "rules": [
      {
        "t": "regex",
        "v": "(xy|hs)",
        "vt": "str",
        "case": false
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1070,
    "y": 1060,
    "wires": [
      [
        "2566d728b2774429"
      ]
    ]
  },
  {
    "id": "97e7d322435425a6",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Check for color support",
    "info": "",
    "x": 1060,
    "y": 1020,
    "wires": []
  },
  {
    "id": "670a7e87eea13cda",
    "type": "function",
    "z": "ad8c570ec4ac394a",
    "name": "Generate Random saturated color",
    "func": "var entity_id = msg.payload.entity_id;\n\n\nvar hue = Math.floor(Math.random() * 360); //generate a random number up to 360\n\nvar hs_color = hue + \",100\";\nvar hs_color_array = hs_color.split(\",\");\nvar newMsg = {\n    \"payload\": {\n        \"data\": {\n            \"hs_color\": hs_color_array,\n            \"entity_id\": entity_id,\n            \"brightness_pct\": 100\n            \n}\n        }\n    }\n;\nreturn newMsg;",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1600,
    "y": 1060,
    "wires": [
      [
        "3346af2c31e1d041"
      ]
    ]
  },
  {
    "id": "3346af2c31e1d041",
    "type": "api-call-service",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "light",
    "service": "turn_on",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "",
    "dataType": "jsonata",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 1890,
    "y": 1060,
    "wires": [
      [
        "219fcd606607f1a5"
      ]
    ]
  },
  {
    "id": "20a6bc2656df7cd3",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Generated random HS 100% saturated color",
    "info": "",
    "x": 1610,
    "y": 1020,
    "wires": []
  },
  {
    "id": "4a9b7c8566e06d0e",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Call light_on service",
    "info": "",
    "x": 1890,
    "y": 1020,
    "wires": []
  },
  {
    "id": "8458c6541c1a983b",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "also sets the entity_id",
    "info": "",
    "x": 1600,
    "y": 1100,
    "wires": []
  },
  {
    "id": "2566d728b2774429",
    "type": "switch",
    "z": "ad8c570ec4ac394a",
    "name": "Exclude groups",
    "property": "payload.attributes.entity_id",
    "propertyType": "msg",
    "rules": [
      {
        "t": "null"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1300,
    "y": 1060,
    "wires": [
      [
        "670a7e87eea13cda"
      ]
    ]
  },
  {
    "id": "3beee483420df235",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Exclude groups",
    "info": "",
    "x": 1260,
    "y": 1020,
    "wires": []
  },
  {
    "id": "204355a813037618",
    "type": "api-call-service",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "homeassistant",
    "service": "turn_off",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "input_boolean.random_colors"
    ],
    "data": "",
    "dataType": "jsonata",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 2300,
    "y": 1060,
    "wires": [
      []
    ]
  },
  {
    "id": "7fc55e4a8583516a",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Turn off boolean input",
    "info": "",
    "x": 2280,
    "y": 1020,
    "wires": []
  },
  {
    "id": "219fcd606607f1a5",
    "type": "trigger",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "op1": "",
    "op2": "1",
    "op1type": "nul",
    "op2type": "str",
    "duration": "1",
    "extend": false,
    "overrideDelay": false,
    "units": "s",
    "reset": "",
    "bytopic": "all",
    "topic": "topic",
    "outputs": 1,
    "x": 2080,
    "y": 1060,
    "wires": [
      [
        "204355a813037618"
      ]
    ]
  },
  {
    "id": "3da9382f8b5fb7a1",
    "type": "trigger",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "pay",
    "op2type": "nul",
    "duration": "1",
    "extend": false,
    "overrideDelay": false,
    "units": "s",
    "reset": "",
    "bytopic": "all",
    "topic": "topic",
    "outputs": 1,
    "x": 580,
    "y": 1200,
    "wires": [
      [
        "5d0ddef411b27f47"
      ]
    ]
  },
  {
    "id": "262788e499c293fa",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "15 seconds cooldown",
    "info": "",
    "x": 580,
    "y": 1160,
    "wires": []
  },
  {
    "id": "5d0ddef411b27f47",
    "type": "ha-get-entities",
    "z": "ad8c570ec4ac394a",
    "name": "Get  Light entities",
    "server": "7ab5c227.a3ce8c",
    "version": 0,
    "rules": [
      {
        "property": "entity_id",
        "logic": "is",
        "value": "light\\.(?!.*?group.*?)(?!.*?k95_rgb_2_led.*?)(?!.*?door.*?).*?_(?!.*?lights.*?).*",
        "valueType": "re"
      },
      {
        "property": "state",
        "logic": "is",
        "value": "on",
        "valueType": "str"
      }
    ],
    "output_type": "split",
    "output_empty_results": false,
    "output_location_type": "msg",
    "output_location": "payload",
    "output_results_count": 1,
    "x": 830,
    "y": 1200,
    "wires": [
      [
        "97c76ddf1df579b3"
      ]
    ]
  },
  {
    "id": "66c314369e60a72d",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Try to Pull all lit single lights",
    "info": "",
    "x": 820,
    "y": 1160,
    "wires": []
  },
  {
    "id": "7983f47f3129f7f4",
    "type": "server-state-changed",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 4,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "input_boolean.random_pastel_colors",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "on",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 2,
    "output_only_on_state_change": true,
    "for": "0",
    "forType": "num",
    "forUnits": "minutes",
    "ignorePrevStateNull": false,
    "ignorePrevStateUnknown": false,
    "ignorePrevStateUnavailable": false,
    "ignoreCurrentStateUnknown": false,
    "ignoreCurrentStateUnavailable": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "eventData"
      },
      {
        "property": "topic",
        "propertyType": "msg",
        "value": "",
        "valueType": "triggerId"
      }
    ],
    "x": 290,
    "y": 1220,
    "wires": [
      [
        "3da9382f8b5fb7a1"
      ],
      []
    ]
  },
  {
    "id": "4eec48e8082a1681",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Change light to random colors on press",
    "info": "",
    "x": 250,
    "y": 1160,
    "wires": []
  },
  {
    "id": "97c76ddf1df579b3",
    "type": "switch",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "property": "payload.attributes.supported_color_modes",
    "propertyType": "msg",
    "rules": [
      {
        "t": "regex",
        "v": "(xy|hs)",
        "vt": "str",
        "case": false
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1070,
    "y": 1200,
    "wires": [
      [
        "289f7ecb38c37668"
      ]
    ]
  },
  {
    "id": "adaef3244b408911",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Check for color support",
    "info": "",
    "x": 1060,
    "y": 1160,
    "wires": []
  },
  {
    "id": "2a75e80c9ffc8381",
    "type": "function",
    "z": "ad8c570ec4ac394a",
    "name": "Generate Random pastel color",
    "func": "var entity_id = msg.payload.entity_id;\n\n\nvar hue = Math.floor(Math.random() * 360); //generate a random number up to 360\n\nvar hs_color = hue + \",45\";\nvar hs_color_array = hs_color.split(\",\");\nvar newMsg = {\n    \"payload\": {\n        \"data\": {\n            \"hs_color\": hs_color_array,\n            \"entity_id\": entity_id,\n            \"brightness_pct\": 100\n            \n}\n        }\n    }\n;\nreturn newMsg;",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1590,
    "y": 1200,
    "wires": [
      [
        "450fecf41250af0e"
      ]
    ]
  },
  {
    "id": "450fecf41250af0e",
    "type": "api-call-service",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "light",
    "service": "turn_on",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "",
    "dataType": "jsonata",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 1890,
    "y": 1200,
    "wires": [
      [
        "ddd33f2c5c20b48f"
      ]
    ]
  },
  {
    "id": "ee3668c3dd83cca1",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Generated random HS 55% saturated color",
    "info": "",
    "x": 1600,
    "y": 1160,
    "wires": []
  },
  {
    "id": "14c65687277f04db",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Call light_on service",
    "info": "",
    "x": 1890,
    "y": 1160,
    "wires": []
  },
  {
    "id": "35668b9eed9b225e",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "also sets the entity_id",
    "info": "",
    "x": 1600,
    "y": 1240,
    "wires": []
  },
  {
    "id": "289f7ecb38c37668",
    "type": "switch",
    "z": "ad8c570ec4ac394a",
    "name": "Exclude groups",
    "property": "payload.attributes.entity_id",
    "propertyType": "msg",
    "rules": [
      {
        "t": "null"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1300,
    "y": 1200,
    "wires": [
      [
        "2a75e80c9ffc8381"
      ]
    ]
  },
  {
    "id": "04cb1fa9cdb294b1",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Exclude groups",
    "info": "",
    "x": 1260,
    "y": 1160,
    "wires": []
  },
  {
    "id": "2fedca693f45ba39",
    "type": "api-call-service",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "homeassistant",
    "service": "turn_off",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "input_boolean.random_pastel_colors"
    ],
    "data": "",
    "dataType": "jsonata",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 2300,
    "y": 1200,
    "wires": [
      []
    ]
  },
  {
    "id": "d0b078b7d3db8067",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Turn off boolean input",
    "info": "",
    "x": 2280,
    "y": 1160,
    "wires": []
  },
  {
    "id": "ddd33f2c5c20b48f",
    "type": "trigger",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "op1": "",
    "op2": "1",
    "op1type": "nul",
    "op2type": "str",
    "duration": "1",
    "extend": false,
    "overrideDelay": false,
    "units": "s",
    "reset": "",
    "bytopic": "all",
    "topic": "topic",
    "outputs": 1,
    "x": 2080,
    "y": 1200,
    "wires": [
      [
        "2fedca693f45ba39"
      ]
    ]
  },
  {
    "id": "9ea5b4675a9552da",
    "type": "inject",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "props": [
      {
        "p": "payload"
      },
      {
        "p": "topic",
        "vt": "str"
      }
    ],
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 340,
    "y": 1260,
    "wires": [
      []
    ]
  },
  {
    "id": "1a3303ec40ac0553",
    "type": "server-state-changed",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 4,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "sensor.bootminutes",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "4.0",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 2,
    "output_only_on_state_change": true,
    "for": "0",
    "forType": "num",
    "forUnits": "minutes",
    "ignorePrevStateNull": false,
    "ignorePrevStateUnknown": false,
    "ignorePrevStateUnavailable": false,
    "ignoreCurrentStateUnknown": false,
    "ignoreCurrentStateUnavailable": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "eventData"
      },
      {
        "property": "topic",
        "propertyType": "msg",
        "value": "",
        "valueType": "triggerId"
      }
    ],
    "x": 240,
    "y": 1360,
    "wires": [
      [
        "93bd849e2a65db7c"
      ],
      []
    ]
  },
  {
    "id": "e53f8e582441f86d",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Reload pages when HASS rebooted 4 minutes ago",
    "info": "",
    "x": 290,
    "y": 1320,
    "wires": []
  },
  {
    "id": "93bd849e2a65db7c",
    "type": "ha-get-entities",
    "z": "ad8c570ec4ac394a",
    "name": "Get  Load URL button entities",
    "server": "7ab5c227.a3ce8c",
    "version": 0,
    "rules": [
      {
        "property": "entity_id",
        "logic": "is",
        "value": "button\\..*load_start_url",
        "valueType": "re"
      }
    ],
    "output_type": "split",
    "output_empty_results": false,
    "output_location_type": "msg",
    "output_location": "payload",
    "output_results_count": 1,
    "x": 580,
    "y": 1360,
    "wires": [
      [
        "80fc6823ccb5d5ae"
      ]
    ]
  },
  {
    "id": "adec6b2878e1b2f4",
    "type": "api-call-service",
    "z": "ad8c570ec4ac394a",
    "name": "press button",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "button",
    "service": "press",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "data"
      }
    ],
    "queue": "none",
    "x": 1270,
    "y": 1360,
    "wires": [
      []
    ]
  },
  {
    "id": "80fc6823ccb5d5ae",
    "type": "change",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "payload.data.entity_id",
        "pt": "msg",
        "to": "payload.entity_id",
        "tot": "msg",
        "dc": true
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 930,
    "y": 1360,
    "wires": [
      [
        "adec6b2878e1b2f4"
      ]
    ]
  },
  {
    "id": "859e7d46c2fe7e54",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Extract the entity id",
    "info": "",
    "x": 910,
    "y": 1320,
    "wires": []
  },
  {
    "id": "93b42f29dfa02678",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Get FKB reload butons",
    "info": "",
    "x": 600,
    "y": 1320,
    "wires": []
  },
  {
    "id": "84f783a81b45f8cf",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Press Button",
    "info": "",
    "x": 1250,
    "y": 1320,
    "wires": []
  },
  {
    "id": "29d792dddbf23293",
    "type": "trigger",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "pay",
    "op2type": "nul",
    "duration": "1",
    "extend": false,
    "overrideDelay": false,
    "units": "s",
    "reset": "",
    "bytopic": "all",
    "topic": "topic",
    "outputs": 1,
    "x": 580,
    "y": 740,
    "wires": [
      [
        "f74f4229dd1ff813"
      ]
    ]
  },
  {
    "id": "981b8d49db044650",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "15 seconds cooldown",
    "info": "",
    "x": 580,
    "y": 700,
    "wires": []
  },
  {
    "id": "f74f4229dd1ff813",
    "type": "ha-get-entities",
    "z": "ad8c570ec4ac394a",
    "name": "Get  Light entities",
    "server": "7ab5c227.a3ce8c",
    "version": 0,
    "rules": [
      {
        "property": "entity_id",
        "logic": "is",
        "value": "light\\.(?!.*?group.*?)(?!.*?k95_rgb_2_led.*?)(?!.*?door.*?).*?_(?!.*?lights.*?).*",
        "valueType": "re"
      },
      {
        "property": "state",
        "logic": "is",
        "value": "on",
        "valueType": "str"
      }
    ],
    "output_type": "split",
    "output_empty_results": false,
    "output_location_type": "msg",
    "output_location": "payload",
    "output_results_count": 1,
    "x": 830,
    "y": 740,
    "wires": [
      [
        "8b52838755e2eff7"
      ]
    ]
  },
  {
    "id": "b391718b61e5d75b",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Try to Pull all lit single lights",
    "info": "",
    "x": 820,
    "y": 700,
    "wires": []
  },
  {
    "id": "51e95d967df464aa",
    "type": "server-state-changed",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 4,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "input_button.generate_warm_colors",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 1,
    "output_only_on_state_change": true,
    "for": "0",
    "forType": "num",
    "forUnits": "minutes",
    "ignorePrevStateNull": false,
    "ignorePrevStateUnknown": false,
    "ignorePrevStateUnavailable": false,
    "ignoreCurrentStateUnknown": false,
    "ignoreCurrentStateUnavailable": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "eventData"
      },
      {
        "property": "topic",
        "propertyType": "msg",
        "value": "",
        "valueType": "triggerId"
      }
    ],
    "x": 290,
    "y": 740,
    "wires": [
      [
        "29d792dddbf23293"
      ]
    ]
  },
  {
    "id": "220c74292b512bb5",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Change light to warm saturated colors on press",
    "info": "",
    "x": 280,
    "y": 700,
    "wires": []
  },
  {
    "id": "8b52838755e2eff7",
    "type": "switch",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "property": "payload.attributes.supported_color_modes",
    "propertyType": "msg",
    "rules": [
      {
        "t": "regex",
        "v": "(xy|hs)",
        "vt": "str",
        "case": false
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1070,
    "y": 740,
    "wires": [
      [
        "85cd0f79967163cb"
      ]
    ]
  },
  {
    "id": "bf981747e6c1918a",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Check for color support",
    "info": "",
    "x": 1060,
    "y": 700,
    "wires": []
  },
  {
    "id": "0612fa506e02a3d5",
    "type": "function",
    "z": "ad8c570ec4ac394a",
    "name": "Generate warm saturated color ( to edit)",
    "func": "var entity_id = msg.payload.entity_id;\n\nvar r = Math.round(Math.random() * 4)\nvar hue1 = (Math.round(Math.random() * 100) + 250); //generate a random number up to 150\nvar hue2 = Math.round(Math.random() * 40); //generate a random number up to 150\n//var huef = hue + 250;\nvar saturation = (Math.round(Math.random() * 20) + 80 )\nswitch(r) {\n  case 1:\n    var hue = hue1\n    break;\n  case 2:\n    var hue = hue1\n    break;\n  case 3:\n    var hue = hue1\n    break;\n  case 4:\n    var hue = hue2\n    break;\n}\n\nvar hs_color = hue + \",\" + saturation;\n\n\n\n\nvar hs_color_array = hs_color.split(\",\");\nvar newMsg = {\n    \"payload\": {\n        \"data\": {\n            \"hs_color\": hs_color_array,\n            \"entity_id\": entity_id,\n            \"brightness_pct\": 100,\n            \n            \n}\n        }\n    }\n;\nreturn newMsg;",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1580,
    "y": 740,
    "wires": [
      [
        "751677464ccc03dd"
      ]
    ]
  },
  {
    "id": "751677464ccc03dd",
    "type": "api-call-service",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "light",
    "service": "turn_on",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "",
    "dataType": "jsonata",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 1890,
    "y": 740,
    "wires": [
      [
        "10aa3a14e006ce9e"
      ]
    ]
  },
  {
    "id": "8bda6b787a1395f6",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Generated random HS 100% saturated color",
    "info": "",
    "x": 1590,
    "y": 700,
    "wires": []
  },
  {
    "id": "99ad64fcaaeda74d",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Call light_on service",
    "info": "",
    "x": 1890,
    "y": 700,
    "wires": []
  },
  {
    "id": "85cd0f79967163cb",
    "type": "switch",
    "z": "ad8c570ec4ac394a",
    "name": "Exclude groups",
    "property": "payload.attributes.entity_id",
    "propertyType": "msg",
    "rules": [
      {
        "t": "null"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1300,
    "y": 740,
    "wires": [
      [
        "0612fa506e02a3d5"
      ]
    ]
  },
  {
    "id": "1fcd6d42544866f3",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Exclude groups",
    "info": "",
    "x": 1260,
    "y": 700,
    "wires": []
  },
  {
    "id": "10aa3a14e006ce9e",
    "type": "trigger",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "op1": "",
    "op2": "1",
    "op1type": "nul",
    "op2type": "str",
    "duration": "1",
    "extend": false,
    "overrideDelay": false,
    "units": "s",
    "reset": "",
    "bytopic": "all",
    "topic": "topic",
    "outputs": 1,
    "x": 2080,
    "y": 740,
    "wires": [
      [
        "9fec3d7fae47d13f"
      ]
    ]
  },
  {
    "id": "9fec3d7fae47d13f",
    "type": "api-call-service",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "homeassistant",
    "service": "turn_off",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "input_boolean.random_colors"
    ],
    "data": "",
    "dataType": "jsonata",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 2300,
    "y": 740,
    "wires": [
      []
    ]
  },
  {
    "id": "53876ef0816021a4",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Turn off boolean input",
    "info": "",
    "x": 2280,
    "y": 700,
    "wires": []
  },
  {
    "id": "b753b69a69ca3b78",
    "type": "trigger",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "pay",
    "op2type": "nul",
    "duration": "1",
    "extend": false,
    "overrideDelay": false,
    "units": "s",
    "reset": "",
    "bytopic": "all",
    "topic": "topic",
    "outputs": 1,
    "x": 620,
    "y": 820,
    "wires": [
      [
        "0ed3a88c554f5fa5"
      ]
    ]
  },
  {
    "id": "b9d979f327628d68",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "15 seconds cooldown",
    "info": "",
    "x": 580,
    "y": 780,
    "wires": []
  },
  {
    "id": "0ed3a88c554f5fa5",
    "type": "ha-get-entities",
    "z": "ad8c570ec4ac394a",
    "name": "Get  Light entities",
    "server": "7ab5c227.a3ce8c",
    "version": 0,
    "rules": [
      {
        "property": "entity_id",
        "logic": "is",
        "value": "light\\.(?!.*?group.*?)(?!.*?k95_rgb_2_led.*?)(?!.*?door.*?).*?_(?!.*?lights.*?).*",
        "valueType": "re"
      },
      {
        "property": "state",
        "logic": "is",
        "value": "on",
        "valueType": "str"
      }
    ],
    "output_type": "split",
    "output_empty_results": false,
    "output_location_type": "msg",
    "output_location": "payload",
    "output_results_count": 1,
    "x": 830,
    "y": 820,
    "wires": [
      [
        "39f1dad06948485b"
      ]
    ]
  },
  {
    "id": "5d9fd93a5a9ba944",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Try to Pull all lit single lights",
    "info": "",
    "x": 820,
    "y": 780,
    "wires": []
  },
  {
    "id": "5a1b1f514bf0e0c6",
    "type": "server-state-changed",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 4,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "input_button.generate_light_warm_colors",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 1,
    "output_only_on_state_change": true,
    "for": "0",
    "forType": "num",
    "forUnits": "minutes",
    "ignorePrevStateNull": false,
    "ignorePrevStateUnknown": false,
    "ignorePrevStateUnavailable": false,
    "ignoreCurrentStateUnknown": false,
    "ignoreCurrentStateUnavailable": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "eventData"
      },
      {
        "property": "topic",
        "propertyType": "msg",
        "value": "",
        "valueType": "triggerId"
      }
    ],
    "x": 310,
    "y": 820,
    "wires": [
      [
        "b753b69a69ca3b78"
      ]
    ]
  },
  {
    "id": "74a39ee43a487dc8",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Change light to warm saturated colors on press",
    "info": "",
    "x": 280,
    "y": 780,
    "wires": []
  },
  {
    "id": "39f1dad06948485b",
    "type": "switch",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "property": "payload.attributes.supported_color_modes",
    "propertyType": "msg",
    "rules": [
      {
        "t": "regex",
        "v": "(xy|hs)",
        "vt": "str",
        "case": false
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1070,
    "y": 820,
    "wires": [
      [
        "2b24bf370ac1466a"
      ]
    ]
  },
  {
    "id": "fdb1f5ee72473536",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Check for color support",
    "info": "",
    "x": 1060,
    "y": 780,
    "wires": []
  },
  {
    "id": "8c7ece9de0998cea",
    "type": "function",
    "z": "ad8c570ec4ac394a",
    "name": "Generate warm pale  color ( to edit)",
    "func": "var entity_id = msg.payload.entity_id;\n\nvar r = Math.round(Math.random() * 4)\nvar hue1 = (Math.round(Math.random() * 60) + 300); //generate a random number up to 300->360\nvar hue2 = Math.round(Math.random() * 30); //generate a random number up to 30\n//var huef = hue + 250;\nvar saturation = (Math.round(Math.random() * 20) + 40 ); // generate random saturation from 80 to 100\nswitch(r) {\n  case 1:\n    var hue = hue1\n    break;\n  case 2:\n    var hue = hue1\n    break;\n  case 3:\n    var hue = hue1\n    break;\n  case 4:\n    var hue = hue2\n    break;\n}\n\nvar hs_color = hue + \",\" + saturation;\n\n\n\n\nvar hs_color_array = hs_color.split(\",\");\nvar newMsg = {\n    \"payload\": {\n        \"data\": {\n            \"hs_color\": hs_color_array,\n            \"entity_id\": entity_id,\n            \"brightness_pct\": 100,\n            \n            \n}\n        }\n    }\n;\nreturn newMsg;",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1560,
    "y": 820,
    "wires": [
      [
        "8409535fc3549229"
      ]
    ]
  },
  {
    "id": "8409535fc3549229",
    "type": "api-call-service",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "light",
    "service": "turn_on",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "",
    "dataType": "jsonata",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 1890,
    "y": 820,
    "wires": [
      [
        "c19304865aab8aa4"
      ]
    ]
  },
  {
    "id": "26a522ed4fa01f58",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Generated random HS 100% saturated color",
    "info": "",
    "x": 1590,
    "y": 780,
    "wires": []
  },
  {
    "id": "0664378320eb1efa",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Call light_on service",
    "info": "",
    "x": 1890,
    "y": 780,
    "wires": []
  },
  {
    "id": "2b24bf370ac1466a",
    "type": "switch",
    "z": "ad8c570ec4ac394a",
    "name": "Exclude groups",
    "property": "payload.attributes.entity_id",
    "propertyType": "msg",
    "rules": [
      {
        "t": "null"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1300,
    "y": 820,
    "wires": [
      [
        "8c7ece9de0998cea"
      ]
    ]
  },
  {
    "id": "4d2276ac66bc5288",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Exclude groups",
    "info": "",
    "x": 1260,
    "y": 780,
    "wires": []
  },
  {
    "id": "c19304865aab8aa4",
    "type": "trigger",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "op1": "",
    "op2": "1",
    "op1type": "nul",
    "op2type": "str",
    "duration": "1",
    "extend": false,
    "overrideDelay": false,
    "units": "s",
    "reset": "",
    "bytopic": "all",
    "topic": "topic",
    "outputs": 1,
    "x": 2080,
    "y": 820,
    "wires": [
      [
        "f7c96e6c05323061"
      ]
    ]
  },
  {
    "id": "f7c96e6c05323061",
    "type": "api-call-service",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "homeassistant",
    "service": "turn_off",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "input_boolean.random_colors"
    ],
    "data": "",
    "dataType": "jsonata",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 2300,
    "y": 820,
    "wires": [
      []
    ]
  },
  {
    "id": "5f9f4c4ecb82917d",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Turn off boolean input",
    "info": "",
    "x": 2280,
    "y": 780,
    "wires": []
  },
  {
    "id": "db856ada2b0e4640",
    "type": "inject",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "props": [
      {
        "p": "payload"
      },
      {
        "p": "topic",
        "vt": "str"
      }
    ],
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 400,
    "y": 880,
    "wires": [
      [
        "b753b69a69ca3b78"
      ]
    ]
  },
  {
    "id": "fbadb1bd0f9239ec",
    "type": "server-state-changed",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 4,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "input_button.start_visuals",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 1,
    "output_only_on_state_change": true,
    "for": "0",
    "forType": "num",
    "forUnits": "minutes",
    "ignorePrevStateNull": false,
    "ignorePrevStateUnknown": false,
    "ignorePrevStateUnavailable": false,
    "ignoreCurrentStateUnknown": false,
    "ignoreCurrentStateUnavailable": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "eventData"
      },
      {
        "property": "topic",
        "propertyType": "msg",
        "value": "",
        "valueType": "triggerId"
      }
    ],
    "x": 260,
    "y": 160,
    "wires": [
      [
        "02f7295b44608fe0"
      ]
    ]
  },
  {
    "id": "cacda7a9a81473d7",
    "type": "server-state-changed",
    "z": "ad8c570ec4ac394a",
    "name": "office speaker",
    "server": "7ab5c227.a3ce8c",
    "version": 4,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "media_player.office_speaker",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "playing",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 2,
    "output_only_on_state_change": true,
    "for": "",
    "forType": "num",
    "forUnits": "seconds",
    "ignorePrevStateNull": false,
    "ignorePrevStateUnknown": false,
    "ignorePrevStateUnavailable": false,
    "ignoreCurrentStateUnknown": true,
    "ignoreCurrentStateUnavailable": true,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "eventData"
      },
      {
        "property": "topic",
        "propertyType": "msg",
        "value": "",
        "valueType": "triggerId"
      }
    ],
    "x": 190,
    "y": 2600,
    "wires": [
      [
        "5cdf0ad8625565cf",
        "508ad8a8eeb35324"
      ],
      []
    ]
  },
  {
    "id": "5cdf0ad8625565cf",
    "type": "function",
    "z": "ad8c570ec4ac394a",
    "name": "Extract artist and set musicbrainz query",
    "func": "var artist = msg.data.new_state.attributes.media_artist; // light group\n\nvar url = \"https://musicbrainz.org/ws/2/artist/?query=name:\" + artist;\n\n\nvar msg = {\n     \"url\": url\n\n}\nreturn msg;\n",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 560,
    "y": 2600,
    "wires": [
      [
        "9736e74e51f5418f"
      ]
    ]
  },
  {
    "id": "9736e74e51f5418f",
    "type": "http request",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "method": "GET",
    "ret": "txt",
    "paytoqs": "ignore",
    "url": "",
    "tls": "",
    "persist": false,
    "proxy": "",
    "insecureHTTPParser": false,
    "authType": "",
    "senderr": false,
    "headers": [],
    "x": 850,
    "y": 2600,
    "wires": [
      [
        "e8a8887e387464a5"
      ]
    ]
  },
  {
    "id": "e8a8887e387464a5",
    "type": "xml",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "property": "payload",
    "attr": "",
    "chr": "",
    "x": 1050,
    "y": 2600,
    "wires": [
      [
        "37604b826333d5fd"
      ]
    ]
  },
  {
    "id": "37604b826333d5fd",
    "type": "function",
    "z": "ad8c570ec4ac394a",
    "name": "Extract Artist for API call to Lidarr",
    "func": "var id = msg.payload.metadata[\"artist-list\"][0].artist[0].$.id;\nvar url = \"http://192.168.0.20:8686/api/v1/artist\";\nvar name = msg.payload.metadata[\"artist-list\"][0].artist[0].name[0];\n\nvar msg = {\n     \"url\": url,\n     \"payload\": {\n          \"ArtistName\": name,\n          \"Path\": \"/media/Music/\" + name,\n          \"rootFolderPath\": \"/media/Music\",\n          \"ForeignArtistId\": id,\n          \"QualityProfileId\": \"1\",\n          \"MetadataProfileId\": \"1\",\n          \"Monitored\": true\n     }\n\n};\nreturn msg;\n",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1300,
    "y": 2600,
    "wires": [
      [
        "4538b6ad3f79553c"
      ]
    ]
  },
  {
    "id": "4538b6ad3f79553c",
    "type": "http request",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "method": "POST",
    "ret": "txt",
    "paytoqs": "body",
    "url": "",
    "tls": "",
    "persist": false,
    "proxy": "",
    "insecureHTTPParser": false,
    "authType": "bearer",
    "senderr": false,
    "headers": [],
    "x": 1550,
    "y": 2600,
    "wires": [
      []
    ]
  },
  {
    "id": "7f0d446eb6ffe153",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Check Office Speaker for playback",
    "info": "",
    "x": 220,
    "y": 2560,
    "wires": []
  },
  {
    "id": "2980e3c451118b65",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Extract Artist for musicbrainz Querry to get the ID",
    "info": "",
    "x": 560,
    "y": 2560,
    "wires": []
  },
  {
    "id": "0420076dc7a48b5a",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Get musicbrainz ",
    "info": "",
    "x": 860,
    "y": 2560,
    "wires": []
  },
  {
    "id": "234fee3f8cb73e95",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Convert to XML",
    "info": "",
    "x": 1060,
    "y": 2560,
    "wires": []
  },
  {
    "id": "9f523d93671ce062",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Extract data for Lidarr callback",
    "info": "",
    "x": 1300,
    "y": 2560,
    "wires": []
  },
  {
    "id": "e7e89501f6a98860",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Add to Lidarr",
    "info": "",
    "x": 1550,
    "y": 2560,
    "wires": []
  },
  {
    "id": "f8f5bf9b0d30c346",
    "type": "function",
    "z": "ad8c570ec4ac394a",
    "name": "Extract artist adn set musicbrainz query",
    "func": "var artist = msg.data.new_state.attributes.media_artist; // light group\n\nvar url = \"https://musicbrainz.org/ws/2/artist/?query=name:\" + artist;\n\n\nvar msg = {\n     \"url\": url\n\n}\nreturn msg;\n",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1060,
    "y": 2460,
    "wires": [
      [
        "0d81f057bbe78e63"
      ]
    ]
  },
  {
    "id": "0d81f057bbe78e63",
    "type": "http request",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "method": "GET",
    "ret": "txt",
    "paytoqs": "ignore",
    "url": "",
    "tls": "",
    "persist": false,
    "proxy": "",
    "insecureHTTPParser": false,
    "authType": "",
    "senderr": false,
    "headers": [],
    "x": 1330,
    "y": 2460,
    "wires": [
      [
        "c9b13a0cb8d5fa9e"
      ]
    ]
  },
  {
    "id": "c9b13a0cb8d5fa9e",
    "type": "xml",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "property": "payload",
    "attr": "",
    "chr": "",
    "x": 1530,
    "y": 2460,
    "wires": [
      [
        "883df9e4fec82592"
      ]
    ]
  },
  {
    "id": "11f7f07f06a3100b",
    "type": "debug",
    "z": "ad8c570ec4ac394a",
    "name": "debug 187",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": true,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "msg",
    "x": 2230,
    "y": 2460,
    "wires": []
  },
  {
    "id": "883df9e4fec82592",
    "type": "function",
    "z": "ad8c570ec4ac394a",
    "name": "Extract Artist for API call to Lidarr",
    "func": "var id = msg.payload.metadata[\"artist-list\"][0].artist[0].$.id;\nvar url = \"http://192.168.0.20:8686/api/v1/artist\";\nvar name = msg.payload.metadata[\"artist-list\"][0].artist[0].name[0];\n\nvar msg = {\n     \"url\": url,\n     \"payload\": {\n          \"ArtistName\": name,\n          \"Path\": \"/media/Music/\" + name,\n          \"rootFolderPath\": \"/media/Music\",\n          \"ForeignArtistId\": id,\n          \"QualityProfileId\": \"1\",\n          \"MetadataProfileId\": \"1\",\n          \"Monitored\": true\n     }\n\n};\nreturn msg;\n",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1780,
    "y": 2460,
    "wires": [
      [
        "52e7d05571c3a468"
      ]
    ]
  },
  {
    "id": "52e7d05571c3a468",
    "type": "http request",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "method": "POST",
    "ret": "txt",
    "paytoqs": "body",
    "url": "",
    "tls": "",
    "persist": false,
    "proxy": "",
    "insecureHTTPParser": false,
    "authType": "bearer",
    "senderr": false,
    "headers": [],
    "x": 2030,
    "y": 2460,
    "wires": [
      [
        "11f7f07f06a3100b"
      ]
    ]
  },
  {
    "id": "6da15ed217dbdf18",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Check chromecasts  for playback",
    "info": "",
    "x": 270,
    "y": 2420,
    "wires": []
  },
  {
    "id": "e1becd8d910fb35e",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Extract Artist for musicbrainz Querry to get the ID",
    "info": "",
    "x": 1040,
    "y": 2420,
    "wires": []
  },
  {
    "id": "6f25be8013cce348",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Get musicbrainz ",
    "info": "",
    "x": 1320,
    "y": 2420,
    "wires": []
  },
  {
    "id": "ccdd79fcfecdcdbb",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Convert to XML",
    "info": "",
    "x": 1540,
    "y": 2420,
    "wires": []
  },
  {
    "id": "61f7ccb6633e9168",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Extract data for Lidarr callback",
    "info": "",
    "x": 1800,
    "y": 2420,
    "wires": []
  },
  {
    "id": "c5baf31ad785840e",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Add to Lidarr",
    "info": "",
    "x": 2030,
    "y": 2420,
    "wires": []
  },
  {
    "id": "c0cf1ab032bfe32e",
    "type": "delay",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "pauseType": "rate",
    "timeout": "5",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "10",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": true,
    "allowrate": false,
    "outputs": 1,
    "x": 780,
    "y": 2460,
    "wires": [
      [
        "f8f5bf9b0d30c346"
      ]
    ]
  },
  {
    "id": "124401ce5fc13749",
    "type": "switch",
    "z": "ad8c570ec4ac394a",
    "name": "Music?",
    "property": "data.new_state.attributes.media_content_type",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "music",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 620,
    "y": 2460,
    "wires": [
      [
        "c0cf1ab032bfe32e"
      ]
    ]
  },
  {
    "id": "e5080b410dc4f987",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Confirm music is playing",
    "info": "",
    "x": 630,
    "y": 2420,
    "wires": []
  },
  {
    "id": "2ab2787cb74a6743",
    "type": "server-state-changed",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 4,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "media_player\\.(?!.*?plex.*?)[a-z_]*_chromecast",
    "entityidfiltertype": "regex",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "playing",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 2,
    "output_only_on_state_change": true,
    "for": 0,
    "forType": "num",
    "forUnits": "minutes",
    "ignorePrevStateNull": false,
    "ignorePrevStateUnknown": false,
    "ignorePrevStateUnavailable": false,
    "ignoreCurrentStateUnknown": false,
    "ignoreCurrentStateUnavailable": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "eventData"
      },
      {
        "property": "topic",
        "propertyType": "msg",
        "value": "",
        "valueType": "triggerId"
      }
    ],
    "x": 310,
    "y": 2460,
    "wires": [
      [
        "124401ce5fc13749"
      ],
      []
    ]
  },
  {
    "id": "508ad8a8eeb35324",
    "type": "debug",
    "z": "ad8c570ec4ac394a",
    "name": "debug 219",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 310,
    "y": 2680,
    "wires": []
  },
  {
    "id": "6d654bed6ce79d26",
    "type": "trigger",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "op1": "",
    "op2": "",
    "op1type": "pay",
    "op2type": "nul",
    "duration": "1",
    "extend": false,
    "overrideDelay": false,
    "units": "s",
    "reset": "",
    "bytopic": "all",
    "topic": "topic",
    "outputs": 1,
    "x": 580,
    "y": 580,
    "wires": [
      [
        "3e380e11087941f4"
      ]
    ]
  },
  {
    "id": "6cb9d7d32622f240",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "15 seconds cooldown",
    "info": "",
    "x": 580,
    "y": 540,
    "wires": []
  },
  {
    "id": "3e380e11087941f4",
    "type": "ha-get-entities",
    "z": "ad8c570ec4ac394a",
    "name": "Get  kitchen group entities",
    "server": "7ab5c227.a3ce8c",
    "version": 0,
    "rules": [
      {
        "property": "entity_id",
        "logic": "is",
        "value": "light\\.(?!.*?all.*?)(.*?group.*?).*?_(.*?lights.*?).*",
        "valueType": "re"
      },
      {
        "property": "state",
        "logic": "is",
        "value": "on",
        "valueType": "str"
      }
    ],
    "output_type": "split",
    "output_empty_results": false,
    "output_location_type": "msg",
    "output_location": "payload",
    "output_results_count": 1,
    "x": 850,
    "y": 580,
    "wires": [
      [
        "d4e8bf3b495fca62"
      ]
    ]
  },
  {
    "id": "cf9c016bea0146d9",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Try to Pull all lit single groups",
    "info": "",
    "x": 820,
    "y": 540,
    "wires": []
  },
  {
    "id": "f2d5facb5df5fc89",
    "type": "server-state-changed",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 4,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "input_button.generate_fake_white",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 1,
    "output_only_on_state_change": true,
    "for": "",
    "forType": "num",
    "forUnits": "minutes",
    "ignorePrevStateNull": false,
    "ignorePrevStateUnknown": false,
    "ignorePrevStateUnavailable": false,
    "ignoreCurrentStateUnknown": false,
    "ignoreCurrentStateUnavailable": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "eventData"
      },
      {
        "property": "topic",
        "propertyType": "msg",
        "value": "",
        "valueType": "triggerId"
      }
    ],
    "x": 290,
    "y": 580,
    "wires": [
      [
        "6d654bed6ce79d26"
      ]
    ]
  },
  {
    "id": "79761279678b7417",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Change light to fake white on press ",
    "info": "",
    "x": 240,
    "y": 540,
    "wires": []
  },
  {
    "id": "d4e8bf3b495fca62",
    "type": "switch",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "property": "payload.attributes.supported_color_modes",
    "propertyType": "msg",
    "rules": [
      {
        "t": "regex",
        "v": "(xy|hs)",
        "vt": "str",
        "case": false
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 1070,
    "y": 580,
    "wires": [
      [
        "11a092549f82e3f1",
        "beb66e34d1b616b3"
      ]
    ]
  },
  {
    "id": "d1186d554482977f",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Check for color support",
    "info": "",
    "x": 1060,
    "y": 540,
    "wires": []
  },
  {
    "id": "0aa5225356e7f714",
    "type": "api-call-service",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "light",
    "service": "turn_on",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "",
    "dataType": "jsonata",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 2130,
    "y": 600,
    "wires": [
      [
        "f5fe4ede1dcb28cf"
      ]
    ]
  },
  {
    "id": "efa1b136670eb59b",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Generated random HS 100% saturated color",
    "info": "",
    "x": 1590,
    "y": 540,
    "wires": []
  },
  {
    "id": "1f88c189b04c6768",
    "type": "comment",
    "z": "ad8c570ec4ac394a",
    "name": "Call light_on service",
    "info": "",
    "x": 2170,
    "y": 560,
    "wires": []
  },
  {
    "id": "11a092549f82e3f1",
    "type": "debug",
    "z": "ad8c570ec4ac394a",
    "name": "debug 260",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "payload",
    "targetType": "msg",
    "statusVal": "",
    "statusType": "auto",
    "x": 1290,
    "y": 480,
    "wires": []
  },
  {
    "id": "a79fdeeab8077e74",
    "type": "debug",
    "z": "ad8c570ec4ac394a",
    "name": "debug 261",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 1670,
    "y": 620,
    "wires": []
  },
  {
    "id": "beb66e34d1b616b3",
    "type": "function",
    "z": "ad8c570ec4ac394a",
    "name": "Generate fake white",
    "func": "\nlet entity_ids = msg.payload.attributes.entity_id;\n\nlet complementaryColors = generateRandomComplementaryColors( entity_ids);\n\n\nfunction generateRandomComplementaryColors(entity_ids) {\n    let complementaryColors = [];\n    let numColors = entity_ids.length;\n    let h = Math.floor(Math.random() * 360);\n    let s = 100;\n    for (let i = 0; i < numColors; i++) {\n        h = (h + (360 / numColors)) % 360;\n        complementaryColors.push({ entity_id: entity_ids[i].toString(), hs_color: [h, s] });\n    }\n    return complementaryColors;\n}\n\n\nvar newMsg = {\"payload\":    complementaryColors \n\n           };\n\nreturn newMsg;",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1320,
    "y": 580,
    "wires": [
      [
        "a79fdeeab8077e74",
        "2b49c035fb659639"
      ]
    ]
  },
  {
    "id": "2b49c035fb659639",
    "type": "split",
    "z": "ad8c570ec4ac394a",
    "name": "Split entities",
    "splt": "\\n",
    "spltType": "str",
    "arraySplt": 1,
    "arraySpltType": "len",
    "stream": false,
    "addname": "",
    "x": 1690,
    "y": 500,
    "wires": [
      [
        "b3cad8ff2777804e"
      ]
    ]
  },
  {
    "id": "ebc0d05df3462685",
    "type": "debug",
    "z": "ad8c570ec4ac394a",
    "name": "debug 263",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 2170,
    "y": 500,
    "wires": []
  },
  {
    "id": "b3cad8ff2777804e",
    "type": "change",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "rules": [
      {
        "t": "move",
        "p": "payload",
        "pt": "msg",
        "to": "payload.data",
        "tot": "msg"
      },
      {
        "t": "set",
        "p": "payload.data.brightness_pct",
        "pt": "msg",
        "to": "100",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1880,
    "y": 500,
    "wires": [
      [
        "0aa5225356e7f714",
        "ebc0d05df3462685"
      ]
    ]
  },
  {
    "id": "f5fe4ede1dcb28cf",
    "type": "debug",
    "z": "ad8c570ec4ac394a",
    "name": "debug 264",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 2330,
    "y": 580,
    "wires": []
  },
  {
    "id": "6350223e7f4f5744",
    "type": "inject",
    "z": "ad8c570ec4ac394a",
    "name": "",
    "props": [
      {
        "p": "payload"
      },
      {
        "p": "topic",
        "vt": "str"
      }
    ],
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 1540,
    "y": 460,
    "wires": [
      [
        "3e380e11087941f4"
      ]
    ]
  },
  {
    "id": "8f02a589652254a0",
    "type": "ha-get-entities",
    "z": "ad8c570ec4ac394a",
    "name": "Get  Light group entities",
    "server": "7ab5c227.a3ce8c",
    "version": 0,
    "rules": [
      {
        "property": "entity_id",
        "logic": "is",
        "value": "light\\.(?!.*?all.*?)(.*?group.*?).*?_(.*?lights.*?).*",
        "valueType": "re"
      },
      {
        "property": "state",
        "logic": "is",
        "value": "on",
        "valueType": "str"
      }
    ],
    "output_type": "split",
    "output_empty_results": false,
    "output_location_type": "msg",
    "output_location": "payload",
    "output_results_count": 1,
    "x": 850,
    "y": 460,
    "wires": [
      []
    ]
  }
]