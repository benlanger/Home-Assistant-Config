[
  {
    "id": "450c81641a10c42d",
    "type": "tab",
    "label": "Face Reco",
    "disabled": false,
    "info": "",
    "env": []
  },
  {
    "id": "daa042542b94f545",
    "type": "group",
    "z": "450c81641a10c42d",
    "style": {
      "stroke": "#999999",
      "stroke-opacity": "1",
      "fill": "none",
      "fill-opacity": "1",
      "label": true,
      "label-position": "nw",
      "color": "#a4a4a4"
    },
    "nodes": [
      "026da4d507207193",
      "5d870c3cae125238",
      "21e884512b585c28",
      "a6411babbdf53e5b",
      "36616d1ccd9b6c9e",
      "57ac30854bd6c1c8",
      "f94192aa45f7dba1",
      "6423b2c425560d42",
      "d0a4cc0dbf14f69d",
      "f27991bfbd64b9b9",
      "840c8452fea3e6e9"
    ],
    "x": 154,
    "y": 299,
    "w": 591,
    "h": 322
  },
  {
    "id": "38b109a5d10ff26d",
    "type": "junction",
    "z": "450c81641a10c42d",
    "x": 2900,
    "y": 1260,
    "wires": [
      [
        "f422810e7e1914b6"
      ]
    ]
  },
  {
    "id": "96070bddb26b6c9e",
    "type": "junction",
    "z": "450c81641a10c42d",
    "x": 2800,
    "y": 1260,
    "wires": [
      [
        "38b109a5d10ff26d"
      ]
    ]
  },
  {
    "id": "91cd40af7f2cd956",
    "type": "junction",
    "z": "450c81641a10c42d",
    "x": 2600,
    "y": 1380,
    "wires": [
      [
        "6c1872d6510312f9"
      ]
    ]
  },
  {
    "id": "6c1872d6510312f9",
    "type": "junction",
    "z": "450c81641a10c42d",
    "x": 2700,
    "y": 1380,
    "wires": [
      [
        "1ffd8297d33ce07d"
      ]
    ]
  },
  {
    "id": "1ffd8297d33ce07d",
    "type": "junction",
    "z": "450c81641a10c42d",
    "x": 2940,
    "y": 1380,
    "wires": [
      [
        "589a3f8b2961adce"
      ]
    ]
  },
  {
    "id": "e7a9cf41f73c99c1",
    "type": "junction",
    "z": "450c81641a10c42d",
    "x": 3500,
    "y": 1280,
    "wires": [
      [
        "54a07d5786c0af49"
      ]
    ]
  },
  {
    "id": "1e06a97fc5de2f98",
    "type": "junction",
    "z": "450c81641a10c42d",
    "x": 3640,
    "y": 1220,
    "wires": [
      [
        "19e1dce6a1046296"
      ]
    ]
  },
  {
    "id": "19e1dce6a1046296",
    "type": "junction",
    "z": "450c81641a10c42d",
    "x": 3660,
    "y": 1240,
    "wires": [
      [
        "9fe78a4010227152"
      ]
    ]
  },
  {
    "id": "5acb3e3de8c5b17b",
    "type": "junction",
    "z": "450c81641a10c42d",
    "x": 3060,
    "y": 1340,
    "wires": [
      [
        "9a3c4deebc1f79d4"
      ]
    ]
  },
  {
    "id": "589a3f8b2961adce",
    "type": "junction",
    "z": "450c81641a10c42d",
    "x": 3100,
    "y": 1380,
    "wires": [
      [
        "99a5842425262fe7"
      ]
    ]
  },
  {
    "id": "af19fdacd71359c6",
    "type": "junction",
    "z": "450c81641a10c42d",
    "x": 3000,
    "y": 1340,
    "wires": [
      [
        "5acb3e3de8c5b17b"
      ]
    ]
  },
  {
    "id": "f5587072212db77b",
    "type": "junction",
    "z": "450c81641a10c42d",
    "x": 3240,
    "y": 1340,
    "wires": [
      [
        "50c10993b072d895"
      ]
    ]
  },
  {
    "id": "99a5842425262fe7",
    "type": "junction",
    "z": "450c81641a10c42d",
    "x": 3280,
    "y": 1380,
    "wires": [
      [
        "0aee512896affe9e"
      ]
    ]
  },
  {
    "id": "9a3c4deebc1f79d4",
    "type": "junction",
    "z": "450c81641a10c42d",
    "x": 3180,
    "y": 1340,
    "wires": [
      [
        "f5587072212db77b"
      ]
    ]
  },
  {
    "id": "730f5f8e34438ea7",
    "type": "junction",
    "z": "450c81641a10c42d",
    "x": 3420,
    "y": 1340,
    "wires": [
      [
        "149f29c5ca6bc3f3"
      ]
    ]
  },
  {
    "id": "0aee512896affe9e",
    "type": "junction",
    "z": "450c81641a10c42d",
    "x": 3460,
    "y": 1380,
    "wires": [
      [
        "13f5412d8e9f0744",
        "4996b5a3516c8bf9"
      ]
    ]
  },
  {
    "id": "50c10993b072d895",
    "type": "junction",
    "z": "450c81641a10c42d",
    "x": 3360,
    "y": 1340,
    "wires": [
      [
        "730f5f8e34438ea7"
      ]
    ]
  },
  {
    "id": "464cb39e0f997312",
    "type": "junction",
    "z": "450c81641a10c42d",
    "x": 3820,
    "y": 1340,
    "wires": [
      [
        "4fcfe3ad2c4a55dd"
      ]
    ]
  },
  {
    "id": "149f29c5ca6bc3f3",
    "type": "junction",
    "z": "450c81641a10c42d",
    "x": 3740,
    "y": 1340,
    "wires": [
      [
        "464cb39e0f997312"
      ]
    ]
  },
  {
    "id": "b6b9cbbb3d9f7d31",
    "type": "junction",
    "z": "450c81641a10c42d",
    "x": 4300,
    "y": 1420,
    "wires": [
      [
        "128c9da2f61e9a86"
      ]
    ]
  },
  {
    "id": "a6ee972424e25404",
    "type": "junction",
    "z": "450c81641a10c42d",
    "x": 4060,
    "y": 1460,
    "wires": [
      [
        "789d2e65e771e941"
      ]
    ]
  },
  {
    "id": "21c8c9ef879dd219",
    "type": "junction",
    "z": "450c81641a10c42d",
    "x": 4320,
    "y": 1280,
    "wires": [
      [
        "78dc3c650c8dc2ca",
        "99828ddfbdbdbcd6"
      ]
    ]
  },
  {
    "id": "cafb1e589f35c470",
    "type": "junction",
    "z": "450c81641a10c42d",
    "x": 2800,
    "y": 1300,
    "wires": [
      [
        "933ce75a01434f69"
      ]
    ]
  },
  {
    "id": "933ce75a01434f69",
    "type": "junction",
    "z": "450c81641a10c42d",
    "x": 2900,
    "y": 1300,
    "wires": [
      [
        "af19fdacd71359c6"
      ]
    ]
  },
  {
    "id": "d295dacce255c29b",
    "type": "junction",
    "z": "450c81641a10c42d",
    "x": 2360,
    "y": 1080,
    "wires": [
      [
        "c56fe8b20a7f90a1"
      ]
    ]
  },
  {
    "id": "f8c3bad32eedc603",
    "type": "junction",
    "z": "450c81641a10c42d",
    "x": 2360,
    "y": 1120,
    "wires": [
      [
        "76d8e20a37643152"
      ]
    ]
  },
  {
    "id": "c56fe8b20a7f90a1",
    "type": "junction",
    "z": "450c81641a10c42d",
    "x": 2500,
    "y": 1080,
    "wires": [
      [
        "f0885d09dd221150"
      ]
    ]
  },
  {
    "id": "76d8e20a37643152",
    "type": "junction",
    "z": "450c81641a10c42d",
    "x": 2500,
    "y": 1120,
    "wires": [
      []
    ]
  },
  {
    "id": "64c326277e598dcd",
    "type": "server-events",
    "z": "450c81641a10c42d",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 2,
    "eventType": "mobile_app_notification_action",
    "exposeToHomeAssistant": false,
    "eventData": "",
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "waitForRunning": true,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "eventData"
      },
      {
        "property": "topic",
        "propertyType": "msg",
        "value": "$outputData(\"eventData\").event_type",
        "valueType": "jsonata"
      },
      {
        "property": "event_type",
        "propertyType": "msg",
        "value": "$outputData(\"eventData\").event_type",
        "valueType": "jsonata"
      }
    ],
    "x": 350,
    "y": 80,
    "wires": [
      [
        "d9da3f994551ca6c"
      ]
    ]
  },
  {
    "id": "d9da3f994551ca6c",
    "type": "switch",
    "z": "450c81641a10c42d",
    "name": "Enter text?",
    "property": "payload.event.action_1_title",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "Enter Text",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 670,
    "y": 80,
    "wires": [
      [
        "1ffef80cf9b50e60"
      ]
    ]
  },
  {
    "id": "e38a31f12e417ca3",
    "type": "function",
    "z": "450c81641a10c42d",
    "name": "Javascript code",
    "func": "var text = msg.payload.event.reply_text;\n\n\n\nvar newMsg = {\n    \"text\": msg.payload.event.image,\n    \"payload\": {\n        \"data\": {\n            \"value\": text\n        }\n    }\n};\nreturn newMsg;",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1160,
    "y": 80,
    "wires": [
      [
        "1659698d4abd266c"
      ]
    ]
  },
  {
    "id": "1659698d4abd266c",
    "type": "api-call-service",
    "z": "450c81641a10c42d",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "input_text",
    "service": "set_value",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "input_text.front_door_phone_text"
    ],
    "data": "",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 1480,
    "y": 80,
    "wires": [
      [
        "447fe301a941b8f3"
      ]
    ]
  },
  {
    "id": "7406062f8995db1c",
    "type": "api-call-service",
    "z": "450c81641a10c42d",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "input_text",
    "service": "set_value",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "input_text.front_door_phone_text"
    ],
    "data": "{\"value\":\"Empty\"}",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 1960,
    "y": 80,
    "wires": [
      []
    ]
  },
  {
    "id": "1ffef80cf9b50e60",
    "type": "switch",
    "z": "450c81641a10c42d",
    "name": "Reply function?",
    "property": "payload.event.action",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "REPLY",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 920,
    "y": 80,
    "wires": [
      [
        "e38a31f12e417ca3"
      ]
    ]
  },
  {
    "id": "447fe301a941b8f3",
    "type": "ha-wait-until",
    "z": "450c81641a10c42d",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 2,
    "outputs": 2,
    "entityId": "lock.lock_front_door",
    "entityIdFilterType": "exact",
    "property": "state",
    "comparator": "is",
    "value": "locked",
    "valueType": "str",
    "timeout": "120",
    "timeoutType": "num",
    "timeoutUnits": "seconds",
    "checkCurrentState": false,
    "blockInputOverrides": true,
    "outputProperties": [],
    "entityLocation": "data",
    "entityLocationType": "none",
    "x": 1700,
    "y": 80,
    "wires": [
      [
        "7406062f8995db1c"
      ],
      [
        "7406062f8995db1c"
      ]
    ]
  },
  {
    "id": "c0f99e79c11a8afe",
    "type": "api-call-service",
    "z": "450c81641a10c42d",
    "name": "Turn on Door Rang",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "homeassistant",
    "service": "turn_on",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "input_boolean.door_rang"
    ],
    "data": "",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "1",
        "valueType": "str"
      }
    ],
    "queue": "none",
    "x": 410,
    "y": 1280,
    "wires": [
      []
    ]
  },
  {
    "id": "b096c4dadcba5f39",
    "type": "api-call-service",
    "z": "450c81641a10c42d",
    "name": "Save faceshot image For Processing",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "camera",
    "service": "snapshot",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "camera.faceshot_go2rtc"
    ],
    "data": "",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 850,
    "y": 1340,
    "wires": [
      [
        "60905036d5e0e18f"
      ]
    ]
  },
  {
    "id": "1ad406d0cb57b30c",
    "type": "function",
    "z": "450c81641a10c42d",
    "name": "Set filename to timestamp.jpg",
    "func": "var timestamp = Date.now();\n\nvar newMsg = {\n    \"payload\": {\n        \"data\": { \"filename\": \"/config/www/facecam/\" + timestamp + \".jpg\" }}};\nreturn newMsg;\n",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 450,
    "y": 1340,
    "wires": [
      [
        "b096c4dadcba5f39",
        "7d939edc1204269c"
      ]
    ]
  },
  {
    "id": "60905036d5e0e18f",
    "type": "function",
    "z": "450c81641a10c42d",
    "name": "Convert path to http path",
    "func": "var path = msg.payload.data.filename;\nvar http_path = path.replace('/config/www/', 'http://192.168.0.14:3000/api/recognize?url=http://192.168.0.15:8123/local/');\n\nvar newMsg = { \n          \"url\": http_path\n        \n};\nreturn newMsg;\n\n",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1150,
    "y": 1340,
    "wires": [
      [
        "05f8cef37c645940"
      ]
    ]
  },
  {
    "id": "05f8cef37c645940",
    "type": "http request",
    "z": "450c81641a10c42d",
    "name": "GET request with link to current image on faceshot camera",
    "method": "GET",
    "ret": "obj",
    "paytoqs": "query",
    "url": "",
    "tls": "",
    "persist": false,
    "proxy": "",
    "insecureHTTPParser": false,
    "authType": "",
    "senderr": false,
    "headers": [],
    "x": 1580,
    "y": 1340,
    "wires": [
      [
        "a757e9e084a63171",
        "1b2009d7457c414d"
      ]
    ]
  },
  {
    "id": "c5a435a10e0237a1",
    "type": "function",
    "z": "450c81641a10c42d",
    "name": "JavascriptNotification setter Reolink",
    "func": "var name = \"Someone\";\nvar url1 = \"https://hass.purgatoire.ca/local/reolinkring.jpg\";\nvar url2 = \"https://hass.purgatoire.ca/local/ring.jpg\";\nvar random = Date.now();\n\nvar newMsg = {\n\t\"payload\": {\n\t\t\"data\": {\n\t\t\t\"message\": \"Doorbell Alert\",\n\t\t\t\"title\": name + \" is at the door\",\n\t\t\t\"data\": {\n\t\t\t\t\"sticky\": 'true',\n\t\t\t\t\"clickAction\": '/phone-landing/reolink?kiosk=1',\n\t\t\t\t\"priority\": 'high',\n\t\t\t\t\"image\": url1 + \"?\" + random,\n\t\t\t\t\"actions\": [{\n\t\t\t\t\t\t\"action\": \"REPLY\",\n\t\t\t\t\t\t\"title\": \"Enter Text\"\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"action\": \"unlock_door\",\n\t\t\t\t\t\t\"title\": \"Unlock The Door\"\n\t\t\t\t\t}\n\n\t\t\t\t]\n\t\t\t}\n\t\t}\n\t}\n};\nreturn newMsg;",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 3900,
    "y": 1420,
    "wires": [
      [
        "b6b9cbbb3d9f7d31",
        "a6ee972424e25404"
      ]
    ]
  },
  {
    "id": "13f5412d8e9f0744",
    "type": "api-call-service",
    "z": "450c81641a10c42d",
    "name": "Save Reolink.jpg for notif",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "camera",
    "service": "snapshot",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "camera.front_door_go2rtc"
    ],
    "data": "{\"filename\":\"/config/www/reolinkring.jpg\"}",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 3610,
    "y": 1400,
    "wires": [
      [
        "c5a435a10e0237a1"
      ]
    ]
  },
  {
    "id": "2929b2bc450dd368",
    "type": "switch",
    "z": "450c81641a10c42d",
    "name": "confidence over 80%?",
    "property": "match.confidence",
    "propertyType": "msg",
    "rules": [
      {
        "t": "gt",
        "v": "80",
        "vt": "num"
      },
      {
        "t": "lt",
        "v": "80",
        "vt": "num"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 2640,
    "y": 1280,
    "wires": [
      [
        "96070bddb26b6c9e"
      ],
      [
        "cafb1e589f35c470"
      ]
    ]
  },
  {
    "id": "7d7bac7229fbc3a3",
    "type": "comment",
    "z": "450c81641a10c42d",
    "name": "No",
    "info": "",
    "x": 2650,
    "y": 1380,
    "wires": []
  },
  {
    "id": "128c9da2f61e9a86",
    "type": "change",
    "z": "450c81641a10c42d",
    "name": "Set Data for mass alert",
    "rules": [
      {
        "t": "move",
        "p": "payload.data.title",
        "pt": "msg",
        "to": "message",
        "tot": "msg"
      },
      {
        "t": "set",
        "p": "color_value",
        "pt": "msg",
        "to": "[0,0,255]",
        "tot": "json"
      },
      {
        "t": "set",
        "p": "dbrigthness",
        "pt": "msg",
        "to": "100",
        "tot": "num"
      },
      {
        "t": "set",
        "p": "video",
        "pt": "msg",
        "to": "on",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "video_content",
        "pt": "msg",
        "to": "payload.data.data.image",
        "tot": "msg",
        "dc": true
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 4440,
    "y": 1400,
    "wires": [
      [
        "18941321b47b01a9"
      ]
    ]
  },
  {
    "id": "18941321b47b01a9",
    "type": "subflow:233ac7dcd801a802",
    "z": "450c81641a10c42d",
    "name": "",
    "x": 4710,
    "y": 1380,
    "wires": []
  },
  {
    "id": "72b7a8fc72115492",
    "type": "api-current-state",
    "z": "450c81641a10c42d",
    "name": "Acid time off",
    "server": "7ab5c227.a3ce8c",
    "version": 3,
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "entity_id": "input_boolean.acid_time",
    "state_type": "str",
    "blockInputOverrides": false,
    "outputProperties": [],
    "for": 0,
    "forType": "num",
    "forUnits": "minutes",
    "x": 3210,
    "y": 1260,
    "wires": [
      [
        "8a3c016bfb720319"
      ],
      [
        "9a3c4deebc1f79d4"
      ]
    ]
  },
  {
    "id": "8a3c016bfb720319",
    "type": "api-current-state",
    "z": "450c81641a10c42d",
    "name": "kink off",
    "server": "7ab5c227.a3ce8c",
    "version": 3,
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "entity_id": "input_boolean.kink_party",
    "state_type": "str",
    "blockInputOverrides": false,
    "outputProperties": [],
    "for": 0,
    "forType": "num",
    "forUnits": "minutes",
    "override_topic": false,
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "x": 3380,
    "y": 1260,
    "wires": [
      [
        "cbe71e8c31c91a64",
        "e7a9cf41f73c99c1"
      ],
      [
        "50c10993b072d895"
      ]
    ]
  },
  {
    "id": "54a07d5786c0af49",
    "type": "api-current-state",
    "z": "450c81641a10c42d",
    "name": "Waiting Friend?",
    "server": "7ab5c227.a3ce8c",
    "version": 3,
    "outputs": 2,
    "halt_if": "on",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "entity_id": "input_boolean.waiting_someone",
    "state_type": "str",
    "blockInputOverrides": false,
    "outputProperties": [
      {
        "property": "partyon",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "partydata",
        "propertyType": "msg",
        "value": "",
        "valueType": "entity"
      }
    ],
    "for": 0,
    "forType": "num",
    "forUnits": "minutes",
    "x": 3640,
    "y": 1300,
    "wires": [
      [
        "19e1dce6a1046296"
      ],
      [
        "149f29c5ca6bc3f3"
      ]
    ]
  },
  {
    "id": "cbe71e8c31c91a64",
    "type": "api-current-state",
    "z": "450c81641a10c42d",
    "name": "Party on",
    "server": "7ab5c227.a3ce8c",
    "version": 3,
    "outputs": 2,
    "halt_if": "on",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "entity_id": "input_boolean.party_mode",
    "state_type": "str",
    "blockInputOverrides": false,
    "outputProperties": [],
    "for": 0,
    "forType": "num",
    "forUnits": "minutes",
    "override_topic": false,
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "x": 3540,
    "y": 1220,
    "wires": [
      [
        "1e06a97fc5de2f98"
      ],
      [
        "54a07d5786c0af49"
      ]
    ]
  },
  {
    "id": "f422810e7e1914b6",
    "type": "api-current-state",
    "z": "450c81641a10c42d",
    "name": "Waiting Uber off",
    "server": "7ab5c227.a3ce8c",
    "version": 3,
    "outputs": 2,
    "halt_if": "on",
    "halt_if_type": "str",
    "halt_if_compare": "is_not",
    "entity_id": "input_boolean.waiting_uber",
    "state_type": "str",
    "blockInputOverrides": false,
    "outputProperties": [],
    "for": 0,
    "forType": "num",
    "forUnits": "minutes",
    "x": 3000,
    "y": 1260,
    "wires": [
      [
        "72b7a8fc72115492"
      ],
      [
        "af19fdacd71359c6"
      ]
    ]
  },
  {
    "id": "cabc1736dc584d7d",
    "type": "api-current-state",
    "z": "450c81641a10c42d",
    "name": "Maxi is present in the front",
    "server": "7ab5c227.a3ce8c",
    "version": 3,
    "outputs": 2,
    "halt_if": "(office|closet)",
    "halt_if_type": "re",
    "halt_if_compare": "is",
    "entity_id": "sensor.maxi_location",
    "state_type": "str",
    "blockInputOverrides": false,
    "outputProperties": [
      {
        "property": "partyon",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "partydata",
        "propertyType": "msg",
        "value": "",
        "valueType": "entity"
      }
    ],
    "for": 0,
    "forType": "num",
    "forUnits": "minutes",
    "x": 3940,
    "y": 1260,
    "wires": [
      [
        "3833068b40c659e5",
        "61c0ad6a1211de3c",
        "c20f9c4e8982d2cf",
        "4e382e238eace54a"
      ],
      [
        "464cb39e0f997312"
      ]
    ]
  },
  {
    "id": "f319f8df438f1828",
    "type": "comment",
    "z": "450c81641a10c42d",
    "name": "No",
    "info": "",
    "x": 3010,
    "y": 1300,
    "wires": []
  },
  {
    "id": "a1030f85d7a7b137",
    "type": "comment",
    "z": "450c81641a10c42d",
    "name": "No",
    "info": "",
    "x": 3190,
    "y": 1300,
    "wires": []
  },
  {
    "id": "c4c57a99a656baf9",
    "type": "comment",
    "z": "450c81641a10c42d",
    "name": "No",
    "info": "",
    "x": 3370,
    "y": 1300,
    "wires": []
  },
  {
    "id": "d64aa4088012144a",
    "type": "comment",
    "z": "450c81641a10c42d",
    "name": "No",
    "info": "",
    "x": 3950,
    "y": 1340,
    "wires": []
  },
  {
    "id": "4e382e238eace54a",
    "type": "function",
    "z": "450c81641a10c42d",
    "name": "Notif setter",
    "func": "var name = msg.match.name;\nvar url = msg.responseUrl.split('?');\nvar urlfinal = url[1].replace('url=http://192.168.0.15:8123/', 'https://hass.purgatoire.ca/');\n\nvar newMsg = {\n\t\"payload\": {\n\t\t\"data\": {\n\t\t\t\"message\": \"Doorbell Alert\",\n\t\t\t\"title\": name + \" is being let in\",\n\t\t\t\"data\": {\n\t\t\t\t\"sticky\": 'true',\n\t\t\t\t\"clickAction\": '/phone-landing/reolink?kiosk=1',\n\t\t\t\t\"priority\": 'high',\n\t\t\t\t\"image\": urlfinal\n\t\t\t}\n\t\t}\n\t}\n};\nreturn newMsg;\n",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 4210,
    "y": 1280,
    "wires": [
      [
        "21c8c9ef879dd219"
      ]
    ]
  },
  {
    "id": "99828ddfbdbdbcd6",
    "type": "change",
    "z": "450c81641a10c42d",
    "name": "Set Data for mass alert",
    "rules": [
      {
        "t": "move",
        "p": "payload.data.title",
        "pt": "msg",
        "to": "message",
        "tot": "msg"
      },
      {
        "t": "set",
        "p": "color_value",
        "pt": "msg",
        "to": "[200,200.0]",
        "tot": "json"
      },
      {
        "t": "set",
        "p": "dbrigthness",
        "pt": "msg",
        "to": "100",
        "tot": "num"
      },
      {
        "t": "set",
        "p": "video",
        "pt": "msg",
        "to": "on",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "video_content",
        "pt": "msg",
        "to": "payload.data.data.image",
        "tot": "msg",
        "dc": true
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 4440,
    "y": 1360,
    "wires": [
      [
        "18941321b47b01a9"
      ]
    ]
  },
  {
    "id": "9fe78a4010227152",
    "type": "delay",
    "z": "450c81641a10c42d",
    "name": "1M/S",
    "pauseType": "queue",
    "timeout": "5",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": true,
    "allowrate": false,
    "outputs": 1,
    "x": 3730,
    "y": 1240,
    "wires": [
      [
        "cabc1736dc584d7d"
      ]
    ]
  },
  {
    "id": "3833068b40c659e5",
    "type": "function",
    "z": "450c81641a10c42d",
    "name": "Name Payload",
    "func": "var name = msg.match.name;\n\nvar newMsg = {\n    \"payload\": {\n        \"data\": {\n            \"value\": name\n        }}};\nreturn newMsg;\n",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 4200,
    "y": 1220,
    "wires": [
      [
        "bc0edcf904abdb95"
      ]
    ]
  },
  {
    "id": "bc0edcf904abdb95",
    "type": "api-call-service",
    "z": "450c81641a10c42d",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "input_text",
    "service": "set_value",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "input_text.recognized_face"
    ],
    "data": "",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 4400,
    "y": 1220,
    "wires": [
      []
    ]
  },
  {
    "id": "cbcf55f52da90504",
    "type": "comment",
    "z": "450c81641a10c42d",
    "name": "No",
    "info": "",
    "x": 3550,
    "y": 1260,
    "wires": []
  },
  {
    "id": "8d97603bce8b64bb",
    "type": "api-call-service",
    "z": "450c81641a10c42d",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "notify",
    "service": "mobile_app_phone_fold4",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 4650,
    "y": 1280,
    "wires": [
      []
    ]
  },
  {
    "id": "b6e59cd9595ed79c",
    "type": "api-call-service",
    "z": "450c81641a10c42d",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "notify",
    "service": "mobile_app_phone_fold4",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 4670,
    "y": 1460,
    "wires": [
      []
    ]
  },
  {
    "id": "a31229c83d998a1a",
    "type": "server-state-changed",
    "z": "450c81641a10c42d",
    "name": "Doorbell",
    "server": "7ab5c227.a3ce8c",
    "version": 4,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "sensor.remote_doorbell_button_action",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "single",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 2,
    "output_only_on_state_change": true,
    "for": 0,
    "forType": "num",
    "forUnits": "minutes",
    "ignorePrevStateNull": true,
    "ignorePrevStateUnknown": true,
    "ignorePrevStateUnavailable": true,
    "ignoreCurrentStateUnknown": true,
    "ignoreCurrentStateUnavailable": true,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "eventData"
      },
      {
        "property": "topic",
        "propertyType": "msg",
        "value": "",
        "valueType": "triggerId"
      }
    ],
    "x": 60,
    "y": 1340,
    "wires": [
      [
        "7eaa4e1be97de177"
      ],
      []
    ]
  },
  {
    "id": "82a9919e4680d971",
    "type": "comment",
    "z": "450c81641a10c42d",
    "name": "Receive the actionable notification",
    "info": "",
    "x": 360,
    "y": 40,
    "wires": []
  },
  {
    "id": "77e91b817ef5acf7",
    "type": "comment",
    "z": "450c81641a10c42d",
    "name": "Check if the action is \"enter text\"",
    "info": "",
    "x": 670,
    "y": 40,
    "wires": []
  },
  {
    "id": "a1a3cebdf8ffe30c",
    "type": "comment",
    "z": "450c81641a10c42d",
    "name": "Confirm that this is a reply",
    "info": "",
    "x": 910,
    "y": 40,
    "wires": []
  },
  {
    "id": "6d202afea355b26a",
    "type": "comment",
    "z": "450c81641a10c42d",
    "name": "Set the text as the data value",
    "info": "",
    "x": 1180,
    "y": 40,
    "wires": []
  },
  {
    "id": "30a94d4d8ba45924",
    "type": "comment",
    "z": "450c81641a10c42d",
    "name": "Set the phone screen text",
    "info": "",
    "x": 1470,
    "y": 40,
    "wires": []
  },
  {
    "id": "97d555b41a081a9a",
    "type": "comment",
    "z": "450c81641a10c42d",
    "name": "Reset the phone screen text",
    "info": "",
    "x": 1960,
    "y": 40,
    "wires": []
  },
  {
    "id": "7e36b02423ed5780",
    "type": "comment",
    "z": "450c81641a10c42d",
    "name": "Wait till door locks",
    "info": "",
    "x": 1710,
    "y": 40,
    "wires": []
  },
  {
    "id": "7d5af98421225e69",
    "type": "switch",
    "z": "450c81641a10c42d",
    "name": "'Who is this?'?",
    "property": "payload.event.action_1_title",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "Who is this?",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 620,
    "y": 220,
    "wires": [
      [
        "92086f4b0cddef66"
      ]
    ]
  },
  {
    "id": "9a56d9a48613392f",
    "type": "function",
    "z": "450c81641a10c42d",
    "name": "Javascript",
    "func": "var name = msg.data.event.reply_text;\n\nvar newMsg = {\n \"url\": \"http://192.168.0.14:3000/api/train/retrain/\" + name,\n \"data\": msg.data\n };\n\nreturn newMsg;",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1640,
    "y": 220,
    "wires": [
      [
        "5b3a71af383f3e88"
      ]
    ]
  },
  {
    "id": "c4c2882ea1e0c324",
    "type": "server-events",
    "z": "450c81641a10c42d",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 2,
    "eventType": "mobile_app_notification_action",
    "exposeToHomeAssistant": false,
    "eventData": "",
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "waitForRunning": true,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "eventData"
      },
      {
        "property": "topic",
        "propertyType": "msg",
        "value": "$outputData(\"eventData\").event_type",
        "valueType": "jsonata"
      },
      {
        "property": "event_type",
        "propertyType": "msg",
        "value": "$outputData(\"eventData\").event_type",
        "valueType": "jsonata"
      }
    ],
    "x": 350,
    "y": 220,
    "wires": [
      [
        "7d5af98421225e69"
      ]
    ]
  },
  {
    "id": "5b3a71af383f3e88",
    "type": "http request",
    "z": "450c81641a10c42d",
    "name": "HTTP request",
    "method": "GET",
    "ret": "txt",
    "paytoqs": "ignore",
    "url": "",
    "tls": "",
    "persist": false,
    "proxy": "",
    "insecureHTTPParser": false,
    "authType": "",
    "senderr": false,
    "headers": [],
    "x": 1960,
    "y": 220,
    "wires": [
      [
        "fbe6702c9c2ef8a5",
        "c1e1f7400ca4a9b1"
      ]
    ]
  },
  {
    "id": "fbe6702c9c2ef8a5",
    "type": "function",
    "z": "450c81641a10c42d",
    "name": "Javascript",
    "func": "var snapshot = msg.data.event.image;\nvar name = msg.data.event.reply_text;\nvar newMsg = {\n \"payload\": {\n  \"data\": {\n  \"message\": \"Faces learning for\" + \" \" + name,\n  \"data\": {\n    \"image\": snapshot\n  }\n}\n }\n};\nreturn newMsg;\n",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 2190,
    "y": 220,
    "wires": [
      [
        "ecb2c917f34c8209"
      ]
    ]
  },
  {
    "id": "ecb2c917f34c8209",
    "type": "api-call-service",
    "z": "450c81641a10c42d",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "notify",
    "service": "notify",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 2430,
    "y": 220,
    "wires": [
      []
    ]
  },
  {
    "id": "92086f4b0cddef66",
    "type": "switch",
    "z": "450c81641a10c42d",
    "name": "",
    "property": "payload.event.action",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "REPLY",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 910,
    "y": 220,
    "wires": [
      [
        "2162299248bfc1b7"
      ]
    ]
  },
  {
    "id": "c64d9ed7449de049",
    "type": "exec",
    "z": "450c81641a10c42d",
    "command": "",
    "addpay": "command",
    "append": "",
    "useSpawn": "false",
    "timer": "",
    "winHide": false,
    "oldrc": false,
    "name": "Command wget ",
    "x": 1400,
    "y": 220,
    "wires": [
      [
        "9a56d9a48613392f"
      ],
      [],
      []
    ]
  },
  {
    "id": "2162299248bfc1b7",
    "type": "function",
    "z": "450c81641a10c42d",
    "name": "Javascript",
    "func": "var image = msg.payload.event.image;\nvar name = msg.payload.event.reply_text;\nvar newMsg = {\n    \"command\": \"mkdir \" + \"/config/www/doubletake/\" + name + \";wget \" + image  + \" -P /config/www/doubletake/\" + name,\n    \"data\": msg.payload\n};\nreturn newMsg;\n",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1160,
    "y": 220,
    "wires": [
      [
        "c64d9ed7449de049"
      ]
    ]
  },
  {
    "id": "cc8a04e83d793ac9",
    "type": "comment",
    "z": "450c81641a10c42d",
    "name": "Receive the actionable notification",
    "info": "",
    "x": 340,
    "y": 180,
    "wires": []
  },
  {
    "id": "d44564743e5c8b0e",
    "type": "comment",
    "z": "450c81641a10c42d",
    "name": "Check if the action is \"Who is this?\"",
    "info": "",
    "x": 640,
    "y": 180,
    "wires": []
  },
  {
    "id": "85dfa9b62c0fa7c7",
    "type": "comment",
    "z": "450c81641a10c42d",
    "name": "Confirm that this is a reply",
    "info": "",
    "x": 890,
    "y": 180,
    "wires": []
  },
  {
    "id": "7996f5f43b656f29",
    "type": "comment",
    "z": "450c81641a10c42d",
    "name": "Set WGET command",
    "info": "This requires to have a folder that is mounted on the Double-take machine and linked to the .storage/train folder",
    "x": 1160,
    "y": 180,
    "wires": []
  },
  {
    "id": "93333520d588e4e2",
    "type": "comment",
    "z": "450c81641a10c42d",
    "name": "Call Wget command",
    "info": "",
    "x": 1390,
    "y": 180,
    "wires": []
  },
  {
    "id": "2df6bced72655465",
    "type": "comment",
    "z": "450c81641a10c42d",
    "name": "Set GET command to train on new images",
    "info": "",
    "x": 1660,
    "y": 180,
    "wires": []
  },
  {
    "id": "4f381e20f259850e",
    "type": "comment",
    "z": "450c81641a10c42d",
    "name": "LAunch the GET command",
    "info": "",
    "x": 1950,
    "y": 180,
    "wires": []
  },
  {
    "id": "5d62fb0b5e7396cd",
    "type": "comment",
    "z": "450c81641a10c42d",
    "name": "Set notification message",
    "info": "",
    "x": 2190,
    "y": 180,
    "wires": []
  },
  {
    "id": "e0703e656d7adf08",
    "type": "comment",
    "z": "450c81641a10c42d",
    "name": "confirm the images are ingressed ",
    "info": "",
    "x": 2450,
    "y": 180,
    "wires": []
  },
  {
    "id": "abbeeaa80a7faea6",
    "type": "comment",
    "z": "450c81641a10c42d",
    "name": "Check for doorbell events",
    "info": "",
    "x": 130,
    "y": 1300,
    "wires": []
  },
  {
    "id": "cb7ec906f237ece7",
    "type": "comment",
    "z": "450c81641a10c42d",
    "name": "This takes care of the phone door welcome text",
    "info": "",
    "x": 500,
    "y": 1240,
    "wires": []
  },
  {
    "id": "d7214089b00ab89f",
    "type": "comment",
    "z": "450c81641a10c42d",
    "name": "Set the desired timestamp",
    "info": "",
    "x": 450,
    "y": 1380,
    "wires": []
  },
  {
    "id": "381de1a0cc1e483a",
    "type": "comment",
    "z": "450c81641a10c42d",
    "name": "Call the snapshot function",
    "info": "",
    "x": 830,
    "y": 1380,
    "wires": []
  },
  {
    "id": "82c911781c9c12de",
    "type": "comment",
    "z": "450c81641a10c42d",
    "name": "Set url for HTML callback",
    "info": "",
    "x": 1170,
    "y": 1380,
    "wires": []
  },
  {
    "id": "3d49a535ef2b4dac",
    "type": "comment",
    "z": "450c81641a10c42d",
    "name": "This calls double-take with our image and looks for a match",
    "info": "",
    "x": 1570,
    "y": 1300,
    "wires": []
  },
  {
    "id": "78e3db5e7ee67034",
    "type": "comment",
    "z": "450c81641a10c42d",
    "name": "Those set the two notifications ( one per cam)",
    "info": "",
    "x": 3910,
    "y": 1380,
    "wires": []
  },
  {
    "id": "c087d16d86c3397c",
    "type": "comment",
    "z": "450c81641a10c42d",
    "name": "Here we have the inside broadcasts",
    "info": "",
    "x": 4700,
    "y": 1340,
    "wires": []
  },
  {
    "id": "dc949857755b4c3a",
    "type": "inject",
    "z": "450c81641a10c42d",
    "name": "",
    "props": [
      {
        "p": "payload"
      },
      {
        "p": "topic",
        "vt": "str"
      }
    ],
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 4240,
    "y": 1020,
    "wires": [
      []
    ]
  },
  {
    "id": "7eaa4e1be97de177",
    "type": "delay",
    "z": "450c81641a10c42d",
    "name": "",
    "pauseType": "rate",
    "timeout": "5",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "30",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": true,
    "allowrate": false,
    "outputs": 1,
    "x": 220,
    "y": 1340,
    "wires": [
      [
        "1ad406d0cb57b30c",
        "c0f99e79c11a8afe"
      ]
    ]
  },
  {
    "id": "78dc3c650c8dc2ca",
    "type": "delay",
    "z": "450c81641a10c42d",
    "name": "",
    "pauseType": "delay",
    "timeout": "1",
    "timeoutUnits": "milliseconds",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "allowrate": false,
    "outputs": 1,
    "x": 4430,
    "y": 1280,
    "wires": [
      [
        "8d97603bce8b64bb"
      ]
    ]
  },
  {
    "id": "789d2e65e771e941",
    "type": "delay",
    "z": "450c81641a10c42d",
    "name": "",
    "pauseType": "delay",
    "timeout": "1",
    "timeoutUnits": "milliseconds",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "allowrate": false,
    "outputs": 1,
    "x": 4450,
    "y": 1460,
    "wires": [
      [
        "b6e59cd9595ed79c"
      ]
    ]
  },
  {
    "id": "61c0ad6a1211de3c",
    "type": "ha-wait-until",
    "z": "450c81641a10c42d",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 2,
    "outputs": 2,
    "entityId": "input_boolean.face_recognized",
    "entityIdFilterType": "exact",
    "property": "state",
    "comparator": "is_not",
    "value": "UNKNOWN",
    "valueType": "str",
    "timeout": "2",
    "timeoutType": "num",
    "timeoutUnits": "minutes",
    "checkCurrentState": true,
    "blockInputOverrides": true,
    "outputProperties": [],
    "x": 4180,
    "y": 1180,
    "wires": [
      [
        "2715d2fa9a416117"
      ],
      []
    ]
  },
  {
    "id": "2715d2fa9a416117",
    "type": "api-call-service",
    "z": "450c81641a10c42d",
    "name": "unLock Door",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "lock",
    "service": "unlock",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "lock.lock_front_door"
    ],
    "data": "",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "1",
        "valueType": "str"
      }
    ],
    "queue": "none",
    "x": 4350,
    "y": 1180,
    "wires": [
      []
    ]
  },
  {
    "id": "c1e1f7400ca4a9b1",
    "type": "function",
    "z": "450c81641a10c42d",
    "name": "Name Payload",
    "func": "var name = msg.data.event.reply_text;\n\nvar newMsg = {\n    \"payload\": {\n        \"data\": {\n            \"value\": name\n        }}};\nreturn newMsg;\n",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 2200,
    "y": 300,
    "wires": [
      [
        "e006b7220963bd05"
      ]
    ]
  },
  {
    "id": "e006b7220963bd05",
    "type": "api-call-service",
    "z": "450c81641a10c42d",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "input_text",
    "service": "set_value",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "input_text.recognized_face"
    ],
    "data": "",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 2400,
    "y": 300,
    "wires": [
      [
        "92daef79e0bacfea"
      ]
    ]
  },
  {
    "id": "92daef79e0bacfea",
    "type": "ha-wait-until",
    "z": "450c81641a10c42d",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 2,
    "outputs": 2,
    "entityId": "input_text.recognized_face",
    "entityIdFilterType": "exact",
    "property": "state",
    "comparator": "is_not",
    "value": "UNKNOWN",
    "valueType": "str",
    "timeout": "2",
    "timeoutType": "num",
    "timeoutUnits": "minutes",
    "checkCurrentState": true,
    "blockInputOverrides": true,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "unlock",
        "valueType": "str"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "str"
      }
    ],
    "x": 2640,
    "y": 300,
    "wires": [
      [
        "f91b9dda5f1e9458",
        "154770427fb7e553"
      ],
      []
    ]
  },
  {
    "id": "f91b9dda5f1e9458",
    "type": "api-call-service",
    "z": "450c81641a10c42d",
    "name": "unLock Door",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "lock",
    "service": "unlock",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "lock.lock_front_door"
    ],
    "data": "",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "1",
        "valueType": "str"
      }
    ],
    "queue": "none",
    "x": 2850,
    "y": 300,
    "wires": [
      []
    ]
  },
  {
    "id": "af8d08f7992d25cf",
    "type": "inject",
    "z": "450c81641a10c42d",
    "name": "",
    "props": [
      {
        "p": "payload"
      },
      {
        "p": "topic",
        "vt": "str"
      }
    ],
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 120,
    "y": 1400,
    "wires": [
      [
        "7eaa4e1be97de177"
      ]
    ]
  },
  {
    "id": "026da4d507207193",
    "type": "trigger-state",
    "z": "450c81641a10c42d",
    "g": "daa042542b94f545",
    "name": "Locked and Recognized",
    "server": "7ab5c227.a3ce8c",
    "version": 2,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityid": "lock.lock_front_door",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "locked"
      },
      {
        "targetType": "entity_id",
        "targetValue": "input_boolean.face_recognized",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "on"
      }
    ],
    "inputs": 0,
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "enableInput": false,
    "x": 280,
    "y": 420,
    "wires": [
      [
        "5d870c3cae125238"
      ],
      []
    ]
  },
  {
    "id": "5d870c3cae125238",
    "type": "api-call-service",
    "z": "450c81641a10c42d",
    "g": "daa042542b94f545",
    "name": "Turn off \"Face Recognized\"",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "homeassistant",
    "service": "turn_off",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "input_boolean.face_recognized"
    ],
    "data": "",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 599,
    "y": 418,
    "wires": [
      []
    ]
  },
  {
    "id": "21e884512b585c28",
    "type": "trigger-state",
    "z": "450c81641a10c42d",
    "g": "daa042542b94f545",
    "name": "Locked and Rang",
    "server": "7ab5c227.a3ce8c",
    "version": 2,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityid": "lock.lock_front_door",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "locked"
      },
      {
        "targetType": "entity_id",
        "targetValue": "input_boolean.door_rang",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "on"
      }
    ],
    "inputs": 0,
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "enableInput": false,
    "x": 260,
    "y": 480,
    "wires": [
      [
        "a6411babbdf53e5b"
      ],
      []
    ]
  },
  {
    "id": "a6411babbdf53e5b",
    "type": "api-call-service",
    "z": "450c81641a10c42d",
    "g": "daa042542b94f545",
    "name": "Turn off \"Door rang\"",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "homeassistant",
    "service": "turn_off",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "input_boolean.door_double_rang",
      "input_boolean.door_rang"
    ],
    "data": "",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 579,
    "y": 478,
    "wires": [
      []
    ]
  },
  {
    "id": "154770427fb7e553",
    "type": "api-call-service",
    "z": "450c81641a10c42d",
    "name": "toggle boolean",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "homeassistant",
    "service": "turn_off",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "input_boolean.face_recognized",
      "input_boolean.waiting_someone"
    ],
    "data": "",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 2860,
    "y": 260,
    "wires": [
      []
    ]
  },
  {
    "id": "c20f9c4e8982d2cf",
    "type": "debug",
    "z": "450c81641a10c42d",
    "name": "debug 259",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 3970,
    "y": 980,
    "wires": []
  },
  {
    "id": "36616d1ccd9b6c9e",
    "type": "api-call-service",
    "z": "450c81641a10c42d",
    "g": "daa042542b94f545",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "input_text",
    "service": "set_value",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "input_text.recognized_face"
    ],
    "data": " {             \"value\": \"UNKNOWN\"         }",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 580,
    "y": 540,
    "wires": [
      []
    ]
  },
  {
    "id": "57ac30854bd6c1c8",
    "type": "trigger-state",
    "z": "450c81641a10c42d",
    "g": "daa042542b94f545",
    "name": "Locked and Recoed name",
    "server": "7ab5c227.a3ce8c",
    "version": 2,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityid": "lock.lock_front_door",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "locked"
      },
      {
        "targetType": "entity_id",
        "targetValue": "input_text.recognized_face",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is_not",
        "comparatorValueDatatype": "str",
        "comparatorValue": "UNKNOWN"
      }
    ],
    "inputs": 0,
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "enableInput": false,
    "x": 290,
    "y": 540,
    "wires": [
      [
        "36616d1ccd9b6c9e"
      ],
      []
    ]
  },
  {
    "id": "f94192aa45f7dba1",
    "type": "trigger-state",
    "z": "450c81641a10c42d",
    "g": "daa042542b94f545",
    "name": "Locked and Waiting",
    "server": "7ab5c227.a3ce8c",
    "version": 2,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityid": "lock.lock_front_door",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "locked"
      },
      {
        "targetType": "entity_id",
        "targetValue": "input_boolean.waiting_someone",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "on"
      }
    ],
    "inputs": 0,
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "enableInput": false,
    "x": 270,
    "y": 380,
    "wires": [
      [
        "6423b2c425560d42"
      ],
      []
    ]
  },
  {
    "id": "6423b2c425560d42",
    "type": "api-call-service",
    "z": "450c81641a10c42d",
    "g": "daa042542b94f545",
    "name": "Turn off \"Waiting someone\"",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "homeassistant",
    "service": "turn_off",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "input_boolean.waiting_someone"
    ],
    "data": "",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 599,
    "y": 378,
    "wires": [
      []
    ]
  },
  {
    "id": "d0a4cc0dbf14f69d",
    "type": "api-call-service",
    "z": "450c81641a10c42d",
    "g": "daa042542b94f545",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "input_text",
    "service": "set_value",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "input_text.front_door_phone_text"
    ],
    "data": " {             \"value\": \"Empty\"         }",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 580,
    "y": 580,
    "wires": [
      []
    ]
  },
  {
    "id": "f27991bfbd64b9b9",
    "type": "trigger-state",
    "z": "450c81641a10c42d",
    "g": "daa042542b94f545",
    "name": "Locked and Door text != Empty",
    "server": "7ab5c227.a3ce8c",
    "version": 2,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityid": "lock.lock_front_door",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "locked"
      },
      {
        "targetType": "entity_id",
        "targetValue": "input_text.front_door_phone_text",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is_not",
        "comparatorValueDatatype": "str",
        "comparatorValue": "Empty"
      }
    ],
    "inputs": 0,
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "enableInput": false,
    "x": 310,
    "y": 580,
    "wires": [
      [
        "d0a4cc0dbf14f69d"
      ],
      []
    ]
  },
  {
    "id": "840c8452fea3e6e9",
    "type": "comment",
    "z": "450c81641a10c42d",
    "g": "daa042542b94f545",
    "name": "This takes care of resetting the boolean inputs",
    "info": "",
    "x": 410,
    "y": 340,
    "wires": []
  },
  {
    "id": "a757e9e084a63171",
    "type": "debug",
    "z": "450c81641a10c42d",
    "name": "Double Take",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 1970,
    "y": 1280,
    "wires": []
  },
  {
    "id": "d1f98d054c33d13f",
    "type": "debug",
    "z": "450c81641a10c42d",
    "name": "Match.msg",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 2610,
    "y": 1240,
    "wires": []
  },
  {
    "id": "4996b5a3516c8bf9",
    "type": "debug",
    "z": "450c81641a10c42d",
    "name": "NO",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 3570,
    "y": 1360,
    "wires": []
  },
  {
    "id": "4fcfe3ad2c4a55dd",
    "type": "function",
    "z": "450c81641a10c42d",
    "name": "Notif setter",
    "func": "var name = msg.match.name;\nvar url = msg.responseUrl.split('?');\nvar urlfinal = url[1].replace('url=http://192.168.0.15:8123/', 'https://hass.purgatoire.ca/');\n\nvar newMsg = {\n\t\"payload\": {\n\t\t\"data\": {\n\t\t\t\"message\": \"Doorbell Alert\",\n\t\t\t\"title\": name + \" is at the door\",\n\t\t\t\"data\": {\n\t\t\t\t\"sticky\": 'true',\n\t\t\t\t\"clickAction\": '/phone-landing/reolink?kiosk=1',\n\t\t\t\t\"priority\": 'high',\n\t\t\t\t\"image\": urlfinal\n\t\t\t}\n\t\t}\n\t}\n};\nreturn newMsg;\n",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 4210,
    "y": 1340,
    "wires": [
      [
        "21c8c9ef879dd219"
      ]
    ]
  },
  {
    "id": "599abaa10da5079b",
    "type": "server-state-changed",
    "z": "450c81641a10c42d",
    "name": "Fron door Faceshot zone",
    "server": "7ab5c227.a3ce8c",
    "version": 4,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "binary_sensor.faceshot_zone_person_occupancy",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "on",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 2,
    "output_only_on_state_change": true,
    "for": 0,
    "forType": "num",
    "forUnits": "minutes",
    "ignorePrevStateNull": true,
    "ignorePrevStateUnknown": true,
    "ignorePrevStateUnavailable": true,
    "ignoreCurrentStateUnknown": true,
    "ignoreCurrentStateUnavailable": true,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "eventData"
      },
      {
        "property": "topic",
        "propertyType": "msg",
        "value": "",
        "valueType": "triggerId"
      }
    ],
    "x": 170,
    "y": 960,
    "wires": [
      [
        "e2b03208242c4a94"
      ],
      []
    ]
  },
  {
    "id": "edba0fe6b1dbaf23",
    "type": "api-call-service",
    "z": "450c81641a10c42d",
    "name": "Save faceshot image For Processing",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "camera",
    "service": "snapshot",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "camera.front_door_go2rtc"
    ],
    "data": "",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 970,
    "y": 960,
    "wires": [
      [
        "94f04e317b42ce95"
      ]
    ]
  },
  {
    "id": "ff0675c15d140b3b",
    "type": "function",
    "z": "450c81641a10c42d",
    "name": "Set filename to timestamp.jpg",
    "func": "var timestamp = Date.now();\n\nvar newMsg = {\n    \"payload\": {\n        \"data\": { \"filename\": \"/config/www/frontdoor/\" + timestamp + \".jpg\" }}};\nreturn newMsg;\n",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 650,
    "y": 960,
    "wires": [
      [
        "edba0fe6b1dbaf23"
      ]
    ]
  },
  {
    "id": "e2b03208242c4a94",
    "type": "delay",
    "z": "450c81641a10c42d",
    "name": "",
    "pauseType": "rate",
    "timeout": "5",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": true,
    "allowrate": false,
    "outputs": 1,
    "x": 390,
    "y": 960,
    "wires": [
      [
        "ff0675c15d140b3b"
      ]
    ]
  },
  {
    "id": "134516bbd0fc3aa8",
    "type": "comment",
    "z": "450c81641a10c42d",
    "name": "Detect when someone is approaching the camera",
    "info": "",
    "x": 240,
    "y": 920,
    "wires": []
  },
  {
    "id": "7eeb609276c7f1cc",
    "type": "comment",
    "z": "450c81641a10c42d",
    "name": "Take a snapshot of \"Front Door\"",
    "info": "",
    "x": 830,
    "y": 920,
    "wires": []
  },
  {
    "id": "7ccd00653d2a6970",
    "type": "inject",
    "z": "450c81641a10c42d",
    "name": "Maximiliano at the door",
    "props": [
      {
        "p": "url",
        "v": "http://192.168.0.14:3000/api/recognize?url=http://192.168.0.15:8123/local/facecam/1685486849252.jpg",
        "vt": "str"
      },
      {
        "p": "payload"
      },
      {
        "p": "header",
        "v": "{\"x-powered-by\":\"Express\",\"access-control-allow-origin\":\"*\",\"content-type\":\"application/json; charset=utf-8\",\"content-length\":\"466\",\"etag\":\"W/\\\"1d2-771MsXgJg7l9k65KvI2TTjtNxEY\\\"\",\"date\":\"Tue, 30 May 2023 22:47:30 GMT\",\"connection\":\"close\",\"x-node-red-request-node\":\"2a059ed6\"}",
        "vt": "json"
      },
      {
        "p": "responseUrl",
        "v": "http://192.168.0.14:3000/api/recognize?url=http://192.168.0.15:8123/local/facecam/1685486849252.jpg",
        "vt": "str"
      },
      {
        "p": "statusCode",
        "v": "200",
        "vt": "str"
      },
      {
        "p": "redirectList",
        "v": "[]",
        "vt": "str"
      },
      {
        "p": "retry",
        "v": "0",
        "vt": "str"
      }
    ],
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "{\"id\":\"4325b99f-f422-4fd3-bf96-70f4df250548\",\"duration\":0.53,\"timestamp\":\"2023-05-30T22:47:30.099Z\",\"attempts\":1,\"camera\":\"manual\",\"zones\":[],\"counts\":{\"person\":1,\"match\":1,\"miss\":0,\"unknown\":0},\"matches\":[{\"name\":\"maximiliano\",\"confidence\":99.66,\"match\":true,\"box\":{\"top\":285,\"left\":255,\"width\":489,\"height\":531},\"type\":\"manual\",\"duration\":0.45,\"detector\":\"compreface\",\"filename\":\"3ad0cf51-59b9-432e-9af2-458f525f6e38.jpg\",\"base64\":null}],\"misses\":[],\"unknowns\":[]}",
    "payloadType": "json",
    "x": 1640,
    "y": 1260,
    "wires": [
      [
        "a757e9e084a63171"
      ]
    ]
  },
  {
    "id": "a7940206a5f7ccf8",
    "type": "join",
    "z": "450c81641a10c42d",
    "name": "",
    "mode": "custom",
    "build": "array",
    "property": "payload",
    "propertyType": "msg",
    "key": "payload.matches",
    "joiner": "\\n",
    "joinerType": "str",
    "accumulate": false,
    "timeout": "3",
    "count": "2",
    "reduceRight": false,
    "reduceExp": "",
    "reduceInit": "",
    "reduceInitType": "num",
    "reduceFixup": "",
    "x": 1930,
    "y": 1400,
    "wires": [
      [
        "b4e6db4ae6877020",
        "e0babb6b4fecaf49"
      ]
    ]
  },
  {
    "id": "b445c6a8730b4b53",
    "type": "debug",
    "z": "450c81641a10c42d",
    "name": "debug 270",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 1530,
    "y": 960,
    "wires": []
  },
  {
    "id": "6fd08c073f5e2828",
    "type": "inject",
    "z": "450c81641a10c42d",
    "name": "",
    "props": [
      {
        "p": "payload"
      },
      {
        "p": "topic",
        "vt": "str"
      }
    ],
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "x": 300,
    "y": 1000,
    "wires": [
      [
        "e2b03208242c4a94"
      ]
    ]
  },
  {
    "id": "94f04e317b42ce95",
    "type": "change",
    "z": "450c81641a10c42d",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "front_door_faceshot_path",
        "pt": "flow",
        "to": "payload.data.filename",
        "tot": "msg",
        "dc": true
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1280,
    "y": 960,
    "wires": [
      [
        "b445c6a8730b4b53"
      ]
    ]
  },
  {
    "id": "389db4774d51444d",
    "type": "change",
    "z": "450c81641a10c42d",
    "name": "",
    "rules": [
      {
        "t": "move",
        "p": "front_door_faceshot_path",
        "pt": "flow",
        "to": "payload.data.filename",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 890,
    "y": 1460,
    "wires": [
      [
        "063e82eadc094e7d"
      ]
    ]
  },
  {
    "id": "063e82eadc094e7d",
    "type": "function",
    "z": "450c81641a10c42d",
    "name": "Convert path to http path",
    "func": "var path = msg.payload.data.filename;\nvar http_path = path.replace('/config/www/', 'http://192.168.0.14:3000/api/recognize?url=http://192.168.0.15:8123/local/');\n\nvar newMsg = { \n          \"url\": http_path\n        \n};\nreturn newMsg;\n\n",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1170,
    "y": 1460,
    "wires": [
      [
        "ae04649aa9de1c90"
      ]
    ]
  },
  {
    "id": "ae04649aa9de1c90",
    "type": "http request",
    "z": "450c81641a10c42d",
    "name": "GET request with link to current image on faceshot camera",
    "method": "GET",
    "ret": "obj",
    "paytoqs": "query",
    "url": "",
    "tls": "",
    "persist": false,
    "proxy": "",
    "insecureHTTPParser": false,
    "authType": "",
    "senderr": false,
    "headers": [],
    "x": 1580,
    "y": 1460,
    "wires": [
      [
        "1b2009d7457c414d"
      ]
    ]
  },
  {
    "id": "b4e6db4ae6877020",
    "type": "debug",
    "z": "450c81641a10c42d",
    "name": "Join",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 2210,
    "y": 1500,
    "wires": []
  },
  {
    "id": "6c805544f48fea6b",
    "type": "inject",
    "z": "450c81641a10c42d",
    "name": "Maximiliano at the door",
    "props": [
      {
        "p": "url",
        "v": "http://192.168.0.14:3000/api/recognize?url=http://192.168.0.15:8123/local/facecam/1685486849252.jpg",
        "vt": "str"
      },
      {
        "p": "payload"
      },
      {
        "p": "header",
        "v": "{\"x-powered-by\":\"Express\",\"access-control-allow-origin\":\"*\",\"content-type\":\"application/json; charset=utf-8\",\"content-length\":\"466\",\"etag\":\"W/\\\"1d2-771MsXgJg7l9k65KvI2TTjtNxEY\\\"\",\"date\":\"Tue, 30 May 2023 22:47:30 GMT\",\"connection\":\"close\",\"x-node-red-request-node\":\"2a059ed6\"}",
        "vt": "json"
      },
      {
        "p": "responseUrl",
        "v": "http://192.168.0.14:3000/api/recognize?url=http://192.168.0.15:8123/local/facecam/1685486849252.jpg",
        "vt": "str"
      },
      {
        "p": "statusCode",
        "v": "200",
        "vt": "str"
      },
      {
        "p": "redirectList",
        "v": "[]",
        "vt": "str"
      },
      {
        "p": "retry",
        "v": "0",
        "vt": "str"
      },
      {
        "p": "parts",
        "v": "1",
        "vt": "num"
      }
    ],
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "{\"id\":\"4325b99f-f422-4fd3-bf96-70f4df250548\",\"duration\":0.53,\"timestamp\":\"2023-05-30T22:47:30.099Z\",\"attempts\":1,\"camera\":\"manual\",\"zones\":[],\"counts\":{\"person\":1,\"match\":1,\"miss\":0,\"unknown\":0},\"matches\":[{\"name\":\"maximiliano\",\"confidence\":99.66,\"match\":true,\"box\":{\"top\":285,\"left\":255,\"width\":489,\"height\":531},\"type\":\"manual\",\"duration\":0.45,\"detector\":\"compreface\",\"filename\":\"3ad0cf51-59b9-432e-9af2-458f525f6e38.jpg\",\"base64\":null}],\"misses\":[],\"unknowns\":[]}",
    "payloadType": "json",
    "x": 1500,
    "y": 1380,
    "wires": [
      [
        "1b2009d7457c414d"
      ]
    ]
  },
  {
    "id": "027f7f85bd053936",
    "type": "inject",
    "z": "450c81641a10c42d",
    "name": "Maximiliano at the door",
    "props": [
      {
        "p": "url",
        "v": "http://192.168.0.14:3000/api/recognize?url=http://192.168.0.15:8123/local/facecam/1685486849252.jpg",
        "vt": "str"
      },
      {
        "p": "payload"
      },
      {
        "p": "header",
        "v": "{\"x-powered-by\":\"Express\",\"access-control-allow-origin\":\"*\",\"content-type\":\"application/json; charset=utf-8\",\"content-length\":\"466\",\"etag\":\"W/\\\"1d2-771MsXgJg7l9k65KvI2TTjtNxEY\\\"\",\"date\":\"Tue, 30 May 2023 22:47:30 GMT\",\"connection\":\"close\",\"x-node-red-request-node\":\"2a059ed6\"}",
        "vt": "json"
      },
      {
        "p": "responseUrl",
        "v": "http://192.168.0.14:3000/api/recognize?url=http://192.168.0.15:8123/local/facecam/1685486849252.jpg",
        "vt": "str"
      },
      {
        "p": "statusCode",
        "v": "200",
        "vt": "str"
      },
      {
        "p": "redirectList",
        "v": "[]",
        "vt": "str"
      },
      {
        "p": "retry",
        "v": "0",
        "vt": "str"
      },
      {
        "p": "parts",
        "v": "2",
        "vt": "num"
      }
    ],
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "topic": "",
    "payload": "{\"id\":\"4325b99f-f422-4fd3-bf96-70f4df250548\",\"duration\":0.53,\"timestamp\":\"2023-05-30T22:47:30.099Z\",\"attempts\":1,\"camera\":\"manual\",\"zones\":[],\"counts\":{\"person\":1,\"match\":1,\"miss\":0,\"unknown\":0},\"matches\":[{\"name\":\"maximiliano\",\"confidence\":59.66,\"match\":true,\"box\":{\"top\":285,\"left\":255,\"width\":489,\"height\":531},\"type\":\"manual\",\"duration\":0.45,\"detector\":\"compreface\",\"filename\":\"3ad0cf51-59b9-432e-9af2-458f525f6e38.jpg\",\"base64\":null}],\"misses\":[],\"unknowns\":[]}",
    "payloadType": "json",
    "x": 1500,
    "y": 1420,
    "wires": [
      [
        "1b2009d7457c414d"
      ]
    ]
  },
  {
    "id": "17e329b6ac53871f",
    "type": "function",
    "z": "450c81641a10c42d",
    "name": "Face Extractor compare by CHATGPT",
    "func": "var data = msg.payload;\nlet highestConfidence = null;\n\ndata.matches.forEach((matchArray) => {\n\tmatchArray.forEach((matchObj) => {\n\t\tif (highestConfidence === null || matchObj.confidence > highestConfidence.confidence) {\n\t\t\thighestConfidence = matchObj;\n\t\t}\n\t});\n});\n\nvar newMsg = { \n\t\"match\": highestConfidence\n\t\t\n\t\n}\n\nreturn newMsg;\n",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 2070,
    "y": 1540,
    "wires": [
      []
    ]
  },
  {
    "id": "6cf321a7b89133c1",
    "type": "debug",
    "z": "450c81641a10c42d",
    "name": "ChatGPT",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 2400,
    "y": 1340,
    "wires": []
  },
  {
    "id": "af5c4879977768eb",
    "type": "switch",
    "z": "450c81641a10c42d",
    "name": "Are there matches?",
    "property": "payload.counts.match",
    "propertyType": "msg",
    "rules": [
      {
        "t": "gt",
        "v": "0",
        "vt": "num"
      },
      {
        "t": "eq",
        "v": "0",
        "vt": "num"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 2230,
    "y": 1100,
    "wires": [
      [
        "d295dacce255c29b"
      ],
      [
        "f8c3bad32eedc603"
      ]
    ]
  },
  {
    "id": "f0885d09dd221150",
    "type": "change",
    "z": "450c81641a10c42d",
    "name": "Set msg.match",
    "rules": [
      {
        "t": "set",
        "p": "match",
        "pt": "msg",
        "to": "payload.matches[0]",
        "tot": "msg",
        "dc": true
      },
      {
        "t": "set",
        "p": "match.camera",
        "pt": "msg",
        "to": "payload.camera",
        "tot": "msg",
        "dc": true
      },
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 2360,
    "y": 1040,
    "wires": [
      []
    ]
  },
  {
    "id": "0f3727c6be7d985e",
    "type": "comment",
    "z": "450c81641a10c42d",
    "name": "No",
    "info": "",
    "x": 2470,
    "y": 1120,
    "wires": []
  },
  {
    "id": "d2c02c47bf8cfdc5",
    "type": "comment",
    "z": "450c81641a10c42d",
    "name": "Yes",
    "info": "",
    "x": 2410,
    "y": 1080,
    "wires": []
  },
  {
    "id": "1b5e8dc4ed913300",
    "type": "switch",
    "z": "450c81641a10c42d",
    "name": "Match Not Null?",
    "property": "match.matches",
    "propertyType": "msg",
    "rules": [
      {
        "t": "nnull"
      },
      {
        "t": "null"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 2440,
    "y": 1380,
    "wires": [
      [
        "2929b2bc450dd368"
      ],
      [
        "91cd40af7f2cd956"
      ]
    ]
  },
  {
    "id": "58245fb216b23619",
    "type": "comment",
    "z": "450c81641a10c42d",
    "name": "Yes",
    "info": "",
    "x": 2850,
    "y": 1260,
    "wires": []
  },
  {
    "id": "329a33b7758b5ead",
    "type": "comment",
    "z": "450c81641a10c42d",
    "name": "No",
    "info": "",
    "x": 2850,
    "y": 1300,
    "wires": []
  },
  {
    "id": "e0babb6b4fecaf49",
    "type": "function",
    "z": "450c81641a10c42d",
    "name": "Face Extractor compare by CHATGPT",
    "func": "const data = msg.payload;\n\n// Initialize variables to track the highest confidence and corresponding payload\nlet highestConfidence = -Infinity;\nlet payloadWithHighestConfidence = null;\n\n// Iterate over each payload object\ndata.forEach(payload => {\n\tconst matches = payload.matches;\n\n\t// Iterate over the matches within the payload\n\tmatches.forEach(match => {\n\t\tconst confidence = match.confidence;\n\n\t\t// Check if the current confidence is higher than the highest recorded confidence\n\t\tif (confidence > highestConfidence) {\n\t\t\thighestConfidence = confidence;\n\t\t\tpayloadWithHighestConfidence = payload;\n\t\t}\n\t});\n});\n\nvar newMsg = { \n\t\"match\": payloadWithHighestConfidence\n\t\t\n\t\n}\n\nreturn newMsg;\n",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 2190,
    "y": 1380,
    "wires": [
      [
        "1b5e8dc4ed913300",
        "6cf321a7b89133c1"
      ]
    ]
  },
  {
    "id": "1b2009d7457c414d",
    "type": "change",
    "z": "450c81641a10c42d",
    "name": "",
    "rules": [
      {
        "t": "move",
        "p": "responseUrl",
        "pt": "msg",
        "to": "payload.responseUrl",
        "tot": "msg"
      },
      {
        "t": "move",
        "p": "url",
        "pt": "msg",
        "to": "payload.url",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1740,
    "y": 1400,
    "wires": [
      [
        "a7940206a5f7ccf8"
      ]
    ]
  },
  {
    "id": "7d939edc1204269c",
    "type": "switch",
    "z": "450c81641a10c42d",
    "name": "flow.front_door_faceshot_path not null",
    "property": "front_door_faceshot_path",
    "propertyType": "flow",
    "rules": [
      {
        "t": "nnull"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 570,
    "y": 1460,
    "wires": [
      [
        "389db4774d51444d"
      ]
    ]
  }
]