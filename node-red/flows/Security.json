[
  {
    "id": "89a78322a7b36ae2",
    "type": "tab",
    "label": "Security",
    "disabled": false,
    "info": "",
    "env": []
  },
  {
    "id": "2474feca55a52fa6",
    "type": "junction",
    "z": "89a78322a7b36ae2",
    "x": 380,
    "y": 220,
    "wires": [
      [
        "3aab6d918795a654"
      ]
    ]
  },
  {
    "id": "8122f10a246c277c",
    "type": "junction",
    "z": "89a78322a7b36ae2",
    "x": 240,
    "y": 220,
    "wires": [
      [
        "2474feca55a52fa6"
      ]
    ]
  },
  {
    "id": "abb0c74fb33494a7",
    "type": "junction",
    "z": "89a78322a7b36ae2",
    "x": 780,
    "y": 220,
    "wires": [
      [
        "9912d2deccb46658"
      ]
    ]
  },
  {
    "id": "feda33fbeb16ebd6",
    "type": "junction",
    "z": "89a78322a7b36ae2",
    "x": 640,
    "y": 220,
    "wires": [
      [
        "abb0c74fb33494a7"
      ]
    ]
  },
  {
    "id": "1fc38a6d436e5401",
    "type": "junction",
    "z": "89a78322a7b36ae2",
    "x": 1420,
    "y": 1000,
    "wires": [
      [
        "995c67a6597ab468",
        "73634a14fd698218",
        "26c3ccc9500c7846"
      ]
    ]
  },
  {
    "id": "13107f5a195ecdd5",
    "type": "api-call-service",
    "z": "89a78322a7b36ae2",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "notify",
    "service": "mobile_app_phone_galaxy_fold_4",
    "areaId": [],
    "deviceId": [],
    "entityId": [],
    "data": "{ \"message\": \"INTRUDER ALERT\", \"data\": {} }",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "data"
      }
    ],
    "queue": "none",
    "x": 1610,
    "y": 220,
    "wires": [
      []
    ]
  },
  {
    "id": "3aab6d918795a654",
    "type": "api-current-state",
    "z": "89a78322a7b36ae2",
    "name": "alarm armed away?",
    "server": "7ab5c227.a3ce8c",
    "version": 3,
    "outputs": 2,
    "halt_if": "armed_away",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "entity_id": "alarm_control_panel.home_alarm",
    "state_type": "str",
    "blockInputOverrides": false,
    "outputProperties": [],
    "for": 0,
    "forType": "num",
    "forUnits": "minutes",
    "x": 510,
    "y": 220,
    "wires": [
      [
        "feda33fbeb16ebd6"
      ],
      []
    ]
  },
  {
    "id": "f24e0f769fba9600",
    "type": "change",
    "z": "89a78322a7b36ae2",
    "name": "Security",
    "rules": [
      {
        "t": "delete",
        "p": "payload",
        "pt": "msg"
      },
      {
        "t": "set",
        "p": "message",
        "pt": "msg",
        "to": "Get the fuck out, Police has been Contacted. The cameras have you recorded.",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 2000,
    "y": 220,
    "wires": [
      [
        "161fa57ab473b724"
      ]
    ]
  },
  {
    "id": "6873123afe62e21f",
    "type": "server-state-changed",
    "z": "89a78322a7b36ae2",
    "name": "Motion?",
    "server": "7ab5c227.a3ce8c",
    "version": 4,
    "exposeToHomeAssistant": false,
    "haConfig": [
      {
        "property": "name",
        "value": ""
      },
      {
        "property": "icon",
        "value": ""
      }
    ],
    "entityidfilter": "binary_sensor\\.sensor([a-z\"_\"])*_occupancy",
    "entityidfiltertype": "regex",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "on",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 2,
    "output_only_on_state_change": false,
    "for": "0",
    "forType": "num",
    "forUnits": "minutes",
    "ignorePrevStateNull": false,
    "ignorePrevStateUnknown": false,
    "ignorePrevStateUnavailable": false,
    "ignoreCurrentStateUnknown": false,
    "ignoreCurrentStateUnavailable": false,
    "outputProperties": [
      {
        "property": "payload",
        "propertyType": "msg",
        "value": "",
        "valueType": "entityState"
      },
      {
        "property": "data",
        "propertyType": "msg",
        "value": "",
        "valueType": "eventData"
      },
      {
        "property": "topic",
        "propertyType": "msg",
        "value": "",
        "valueType": "triggerId"
      }
    ],
    "x": 150,
    "y": 220,
    "wires": [
      [
        "8122f10a246c277c"
      ],
      []
    ]
  },
  {
    "id": "9912d2deccb46658",
    "type": "api-call-service",
    "z": "89a78322a7b36ae2",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "light",
    "service": "turn_off",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "light.all_lights"
    ],
    "data": "",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 910,
    "y": 220,
    "wires": [
      [
        "abf72664ee5876c3"
      ]
    ]
  },
  {
    "id": "161fa57ab473b724",
    "type": "subflow:233ac7dcd801a802",
    "z": "89a78322a7b36ae2",
    "name": "",
    "x": 2210,
    "y": 220,
    "wires": []
  },
  {
    "id": "ece23f848ca93ba3",
    "type": "comment",
    "z": "89a78322a7b36ae2",
    "name": "Motion anywhere?",
    "info": "",
    "x": 150,
    "y": 180,
    "wires": []
  },
  {
    "id": "736fce70133cc368",
    "type": "comment",
    "z": "89a78322a7b36ae2",
    "name": "Yes",
    "info": "",
    "x": 310,
    "y": 220,
    "wires": []
  },
  {
    "id": "2c49ba6874cad203",
    "type": "comment",
    "z": "89a78322a7b36ae2",
    "name": "Armed away alarm?",
    "info": "",
    "x": 510,
    "y": 180,
    "wires": []
  },
  {
    "id": "f00ef8a51da77fb0",
    "type": "comment",
    "z": "89a78322a7b36ae2",
    "name": "Yes",
    "info": "",
    "x": 710,
    "y": 220,
    "wires": []
  },
  {
    "id": "11184af31ac91a72",
    "type": "comment",
    "z": "89a78322a7b36ae2",
    "name": "Turn all lights off",
    "info": "",
    "x": 900,
    "y": 180,
    "wires": []
  },
  {
    "id": "3a178507934682ad",
    "type": "comment",
    "z": "89a78322a7b36ae2",
    "name": "5 seconds cooldown",
    "info": "",
    "x": 1110,
    "y": 180,
    "wires": []
  },
  {
    "id": "34aa8682666b12a0",
    "type": "comment",
    "z": "89a78322a7b36ae2",
    "name": "Notify my phone",
    "info": "",
    "x": 1600,
    "y": 180,
    "wires": []
  },
  {
    "id": "c3e8f5a282cadc1d",
    "type": "comment",
    "z": "89a78322a7b36ae2",
    "name": "Set Announcement",
    "info": "",
    "x": 2010,
    "y": 180,
    "wires": []
  },
  {
    "id": "b39099b6cb17c497",
    "type": "comment",
    "z": "89a78322a7b36ae2",
    "name": "Send Announcement",
    "info": "",
    "x": 2210,
    "y": 180,
    "wires": []
  },
  {
    "id": "abf72664ee5876c3",
    "type": "delay",
    "z": "89a78322a7b36ae2",
    "name": "",
    "pauseType": "rate",
    "timeout": "5",
    "timeoutUnits": "seconds",
    "rate": "1",
    "nbRateUnits": "1",
    "rateUnits": "second",
    "randomFirst": "1",
    "randomLast": "5",
    "randomUnits": "seconds",
    "drop": false,
    "allowrate": false,
    "outputs": 1,
    "x": 1110,
    "y": 220,
    "wires": [
      [
        "4932da4542af5a26",
        "2f3fe23dec8fe0a2"
      ]
    ]
  },
  {
    "id": "4932da4542af5a26",
    "type": "debug",
    "z": "89a78322a7b36ae2",
    "name": "debug 68",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "statusVal": "",
    "statusType": "auto",
    "x": 1280,
    "y": 100,
    "wires": []
  },
  {
    "id": "2f3fe23dec8fe0a2",
    "type": "function",
    "z": "89a78322a7b36ae2",
    "name": "Javascript",
    "func": "var sensor = msg.topic;\n\nvar newMsg = {\n\t\"payload\": {\n\t\t\"data\": {\n\t\t\t\"title\": \"Security Alert\",\n\t\t\t\"message\": sensor + \" has been triggered\"\n\t\t}\n\t}\n};\nreturn newMsg;",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1300,
    "y": 220,
    "wires": [
      [
        "13107f5a195ecdd5"
      ]
    ]
  },
  {
    "id": "9abc6bf90bea613e",
    "type": "switch",
    "z": "89a78322a7b36ae2",
    "name": "action: unlock_failure_invalid_schedule",
    "property": "payload.action",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "unlock_failure_invalid_schedule",
        "vt": "str"
      }
    ],
    "checkall": "false",
    "repair": false,
    "outputs": 1,
    "x": 450,
    "y": 1100,
    "wires": [
      [
        "4841450949c7d9e5"
      ]
    ]
  },
  {
    "id": "4841450949c7d9e5",
    "type": "trigger",
    "z": "89a78322a7b36ae2",
    "name": "Conditional unlock",
    "op1": "",
    "op2": "",
    "op1type": "pay",
    "op2type": "nul",
    "duration": "1",
    "extend": false,
    "overrideDelay": false,
    "units": "ms",
    "reset": "",
    "bytopic": "all",
    "topic": "topic",
    "outputs": 1,
    "x": 750,
    "y": 1100,
    "wires": [
      [
        "0f6f3939fc31b412"
      ]
    ]
  },
  {
    "id": "1b59826fbe1d34e5",
    "type": "switch",
    "z": "89a78322a7b36ae2",
    "name": "WHO",
    "property": "payload.action_user",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "4",
        "vt": "num"
      },
      {
        "t": "eq",
        "v": "6",
        "vt": "num"
      },
      {
        "t": "eq",
        "v": "2",
        "vt": "num"
      },
      {
        "t": "eq",
        "v": "13",
        "vt": "num"
      }
    ],
    "checkall": "false",
    "repair": false,
    "outputs": 4,
    "x": 1130,
    "y": 1020,
    "wires": [
      [
        "768294738567315f"
      ],
      [
        "f5f19fea537c849a"
      ],
      [
        "8f0c3df71928ed70"
      ],
      [
        "6aa93395c75d3c04"
      ]
    ]
  },
  {
    "id": "f5f19fea537c849a",
    "type": "change",
    "z": "89a78322a7b36ae2",
    "name": "fay",
    "rules": [
      {
        "t": "set",
        "p": "message",
        "pt": "msg",
        "to": "Fay has arrived",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "payload.name",
        "pt": "msg",
        "to": "Fay",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1310,
    "y": 1020,
    "wires": [
      [
        "1fc38a6d436e5401"
      ]
    ]
  },
  {
    "id": "768294738567315f",
    "type": "change",
    "z": "89a78322a7b36ae2",
    "name": "Nate",
    "rules": [
      {
        "t": "set",
        "p": "message",
        "pt": "msg",
        "to": "Nate has arrived",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "payload.name",
        "pt": "msg",
        "to": "Nate",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1310,
    "y": 980,
    "wires": [
      [
        "1fc38a6d436e5401"
      ]
    ]
  },
  {
    "id": "0f6f3939fc31b412",
    "type": "api-current-state",
    "z": "89a78322a7b36ae2",
    "name": "Maxi home?",
    "server": "7ab5c227.a3ce8c",
    "version": 3,
    "outputs": 2,
    "halt_if": "home",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "entity_id": "person.maximiliano",
    "state_type": "str",
    "blockInputOverrides": false,
    "outputProperties": [],
    "for": 0,
    "forType": "num",
    "forUnits": "minutes",
    "x": 970,
    "y": 1100,
    "wires": [
      [
        "1b59826fbe1d34e5"
      ],
      []
    ]
  },
  {
    "id": "995c67a6597ab468",
    "type": "subflow:233ac7dcd801a802",
    "z": "89a78322a7b36ae2",
    "name": "",
    "x": 1650,
    "y": 1020,
    "wires": []
  },
  {
    "id": "17022c97071074b8",
    "type": "api-call-service",
    "z": "89a78322a7b36ae2",
    "name": "toggle boolean",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "homeassistant",
    "service": "turn_on",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "input_boolean.face_recognized"
    ],
    "data": "",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 2060,
    "y": 1080,
    "wires": [
      [
        "2ae2baa69569d00f"
      ]
    ]
  },
  {
    "id": "2ae2baa69569d00f",
    "type": "ha-wait-until",
    "z": "89a78322a7b36ae2",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 2,
    "outputs": 2,
    "entityId": "lock.lock_front_door",
    "entityIdFilterType": "exact",
    "property": "state",
    "comparator": "is",
    "value": "locked",
    "valueType": "str",
    "timeout": "50",
    "timeoutType": "num",
    "timeoutUnits": "seconds",
    "checkCurrentState": true,
    "blockInputOverrides": true,
    "outputProperties": [],
    "x": 2220,
    "y": 1080,
    "wires": [
      [
        "72e7725486573888"
      ],
      [
        "72e7725486573888"
      ]
    ]
  },
  {
    "id": "72e7725486573888",
    "type": "api-call-service",
    "z": "89a78322a7b36ae2",
    "name": "toggle boolean",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "homeassistant",
    "service": "turn_off",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "input_boolean.face_recognized",
      "input_boolean.waiting_someone"
    ],
    "data": "",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 2400,
    "y": 1080,
    "wires": [
      [
        "23ac817267ade3a3"
      ]
    ]
  },
  {
    "id": "23ac817267ade3a3",
    "type": "api-call-service",
    "z": "89a78322a7b36ae2",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "input_text",
    "service": "set_value",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "input_text.recognized_face"
    ],
    "data": " {             \"value\": \"UNKNOWN\"         }",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 2610,
    "y": 1080,
    "wires": [
      []
    ]
  },
  {
    "id": "26c3ccc9500c7846",
    "type": "api-call-service",
    "z": "89a78322a7b36ae2",
    "name": "unLock Door",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "lock",
    "service": "unlock",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "lock.lock_front_door"
    ],
    "data": "",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 1750,
    "y": 1080,
    "wires": [
      [
        "4058f004bd6e6039"
      ]
    ]
  },
  {
    "id": "4058f004bd6e6039",
    "type": "ha-wait-until",
    "z": "89a78322a7b36ae2",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 2,
    "outputs": 2,
    "entityId": "lock.lock_front_door",
    "entityIdFilterType": "exact",
    "property": "state",
    "comparator": "is",
    "value": "unlocked",
    "valueType": "str",
    "timeout": "2",
    "timeoutType": "num",
    "timeoutUnits": "minutes",
    "checkCurrentState": true,
    "blockInputOverrides": true,
    "outputProperties": [],
    "x": 1900,
    "y": 1080,
    "wires": [
      [
        "17022c97071074b8"
      ],
      []
    ]
  },
  {
    "id": "f2830de63ada8f0e",
    "type": "api-call-service",
    "z": "89a78322a7b36ae2",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "input_text",
    "service": "set_value",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "input_text.recognized_face"
    ],
    "data": " {             \"value\": \"UNKNOWN\"         }",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 2030,
    "y": 1360,
    "wires": [
      []
    ]
  },
  {
    "id": "73634a14fd698218",
    "type": "function",
    "z": "89a78322a7b36ae2",
    "name": "Name Payload",
    "func": "var name = msg.payload.name;\n\nvar newMsg = {\n    \"payload\": {\n        \"data\": {\n            \"value\": name\n        }}};\nreturn newMsg;\n",
    "outputs": 1,
    "noerr": 0,
    "initialize": "",
    "finalize": "",
    "libs": [],
    "x": 1740,
    "y": 960,
    "wires": [
      [
        "dc9c1a9c0274250e"
      ]
    ]
  },
  {
    "id": "dc9c1a9c0274250e",
    "type": "api-call-service",
    "z": "89a78322a7b36ae2",
    "name": "",
    "server": "7ab5c227.a3ce8c",
    "version": 5,
    "debugenabled": false,
    "domain": "input_text",
    "service": "set_value",
    "areaId": [],
    "deviceId": [],
    "entityId": [
      "input_text.recognized_face"
    ],
    "data": "",
    "dataType": "json",
    "mergeContext": "",
    "mustacheAltTags": false,
    "outputProperties": [],
    "queue": "none",
    "x": 1950,
    "y": 960,
    "wires": [
      []
    ]
  },
  {
    "id": "8f0c3df71928ed70",
    "type": "change",
    "z": "89a78322a7b36ae2",
    "name": "alexe",
    "rules": [
      {
        "t": "set",
        "p": "message",
        "pt": "msg",
        "to": "Alexe has arrived",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "payload.name",
        "pt": "msg",
        "to": "Alexe",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1304.673583984375,
    "y": 1068.3333740234375,
    "wires": [
      [
        "1fc38a6d436e5401"
      ]
    ]
  },
  {
    "id": "eb3e489f030d78b0",
    "type": "mqtt in",
    "z": "89a78322a7b36ae2",
    "name": "",
    "topic": "zigbee2mqtt/lock_front_door",
    "qos": "2",
    "datatype": "json",
    "broker": "21000c19b97da572",
    "nl": false,
    "rap": true,
    "rh": 0,
    "inputs": 0,
    "x": 200,
    "y": 1040,
    "wires": [
      [
        "9abc6bf90bea613e"
      ]
    ]
  },
  {
    "id": "6aa93395c75d3c04",
    "type": "change",
    "z": "89a78322a7b36ae2",
    "name": "Carla",
    "rules": [
      {
        "t": "set",
        "p": "message",
        "pt": "msg",
        "to": "Carla has arrived",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "payload.name",
        "pt": "msg",
        "to": "Carla",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1310,
    "y": 1120,
    "wires": [
      [
        "1fc38a6d436e5401"
      ]
    ]
  }
]