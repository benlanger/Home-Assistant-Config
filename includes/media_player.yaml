
########################## MAXI PC ##########################
  
#  - name: "Maxi PC MediaPlayer"
#    platform: hass_agent_mediaplayer
#    host: 192.168.0.69
#    port: 5115

####################################################################

# WIIM PLAYERS #


#  - platform: linkplay
#    host: 192.168.40.78
#    name: Wiim Office
#    volume_step: 10
#    icecast_metadata: 'StationNameSongTitle'
#    multiroom_wifidirect: False
#  - platform: linkplay
#    host: 192.168.40.76
#    name: Wiim Closet
#    volume_step: 10
#    icecast_metadata: 'StationNameSongTitle'
#    multiroom_wifidirect: False
#  - platform: linkplay
#    host: 192.168.40.74
#    name: Wiim LivingRoom
#    volume_step: 10
#    icecast_metadata: 'StationNameSongTitle'
#    multiroom_wifidirect: False


########################## TEMPLATE MEDIA PLAYERS ##########################
 
  - platform: media_player_template
    media_players: !include /config/includes/template_media_player.yaml




########################## UNIVERSAL MEDIA PLAYERS ##########################


 
  ##########################  OFFICE  ##########################
  - platform: universal
    name: Universal Office Speakers
    children:
      - media_player.mass_home_group
      - media_player.office_wiim_speaker
      - media_player.office_speaker
    commands:
      volume_mute:
        service: media_player.volume_mute
        target:
          entity_id: 
            - media_player.office_speaker
            - media_player.office_wiim_speaker
        data:
          is_volume_muted: true
      volume_set:
        service: media_player.volume_set
        target:
          entity_id: 
            - media_player.office_speaker
            - media_player.office_wiim_speaker
        data:
          volume_level: "{{ volume_level }}"
      volume_up:
        service: media_player.volume_up
        target:
          entity_id: 
            - media_player.office_speaker
            - media_player.office_wiim_speaker
      volume_down:
        service: media_player.volume_down
        target:
          entity_id: 
            - media_player.office_speaker
            - media_player.office_wiim_speaker
    attributes:
      is_volume_muted: media_player.office_wiim_speaker|is_volume_muted
      volume_level: media_player.office_wiim_speaker|volume_level

  ##########################  LIVINGROOM  ########################## 

  - platform: universal
    name: Universal Livingroom Speakers
    children:
      - media_player.mass_home_group
      - media_player.livingroom_speaker
      - media_player.livingroom_wiim_speaker
    commands:
      volume_mute:
        service: media_player.volume_mute
        target:
          entity_id: 
            - media_player.livingroom_speaker
            - media_player.livingroom_wiim_speaker
        data:
          is_volume_muted: true
      volume_set:
        service: media_player.volume_set
        target:
          entity_id: 
            - media_player.livingroom_speaker
            - media_player.livingroom_wiim_speaker
        data:
          volume_level: "{{ volume_level }}"
      volume_up:
        service: media_player.volume_up
        target:
          entity_id: 
            - media_player.livingroom_speaker
            - media_player.livingroom_wiim_speaker
      volume_down:
        service: media_player.volume_down
        target:
          entity_id: 
            - media_player.livingroom_speaker
            - media_player.livingroom_wiim_speaker
    attributes:
      is_volume_muted: media_player.livingroom_wiim_speaker|is_volume_muted
      volume_level: media_player.livingroom_wiim_speaker|volume_level

      
  ##########################  kitchen  ########################## 

  - platform: universal
    name: Universal kitchen Speakers
    children:
      - media_player.mass_home_group
      - media_player.kitchen_speaker
      - media_player.kitchen_wiim_speaker
    commands:
      volume_mute:
        service: media_player.volume_mute
        target:
          entity_id: 
            - media_player.kitchen_speaker
            - media_player.kitchen_wiim_speaker
        data:
          is_volume_muted: true
      volume_set:
        service: media_player.volume_set
        target:
          entity_id: 
            - media_player.kitchen_speaker
            - media_player.kitchen_wiim_speaker
        data:
          volume_level: "{{ volume_level }}"
      volume_up:
        service: media_player.volume_up
        target:
          entity_id: 
            - media_player.kitchen_speaker
            - media_player.kitchen_wiim_speaker
      volume_down:
        service: media_player.volume_down
        target:
          entity_id: 
            - media_player.kitchen_speaker
            - media_player.kitchen_wiim_speaker
    attributes:
      is_volume_muted: media_player.kitchen_wiim_speaker|is_volume_muted
      volume_level: media_player.kitchen_wiim_speaker|volume_level


  ##########################  bathroom  ########################## 

  - platform: universal
    name: Universal bathroom Speakers
    active_child_template: >-
        {% if states('media_player.bathroom_music_speaker') != "off" %}
          media_player.bathroom_music_speaker
        {% elif states('media_player.bathroom_speaker') != "off" %}
          media_player.bathroom_speaker
        {% else %}
          none
        {% endif %}        


  ##########################  closet  ########################## 

  - platform: universal
    name: Universal Closet speaker
    children:
      - media_player.mass_closet_wiim_speaker  
      - media_player.closet_wiim_speaker      
    commands:
      volume_mute:
        service: media_player.volume_mute
        target:
          entity_id: 
            - media_player.closet_wiim_speaker            
        data:
          is_volume_muted: true
      volume_set:
        service: media_player.volume_set
        target:
          entity_id: 
            - media_player.closet_wiim_speaker            
        data:
          volume_level: "{{ volume_level }}"
      volume_up:
        service: media_player.volume_up
        target:
          entity_id: 
            - media_player.closet_wiim_speaker            
      volume_down:
        service: media_player.volume_down
        target:
          entity_id: 
            - media_player.closet_wiim_speaker            
    attributes:
      is_volume_muted: media_player.closet_wiim_speaker|is_volume_muted
      volume_level: media_player.closet_wiim_speaker|volume_level

  ##########################  hotbox top  ########################## 

  - platform: universal
    name: Universal hotbox top Speakers
    children:
      - media_player.mass_home_group
      - media_player.hotbox_top_speaker      
    commands:
      volume_mute:
        service: media_player.volume_mute
        target:
          entity_id: 
            - media_player.hotbox_top_speaker            
        data:
          is_volume_muted: true
      volume_set:
        service: media_player.volume_set
        target:
          entity_id: 
            - media_player.hotbox_top_speaker            
        data:
          volume_level: "{{ volume_level }}"
      volume_up:
        service: media_player.volume_up
        target:
          entity_id: 
            - media_player.hotbox_top_speaker            
      volume_down:
        service: media_player.volume_down
        target:
          entity_id: 
            - media_player.hotbox_top_speaker            
    attributes:
      is_volume_muted: media_player.hotbox_top_speaker|is_volume_muted
      volume_level: media_player.hotbox_top_speaker|volume_level


  ##########################  hotbox down ########################## 

  - platform: universal
    name: Universal hotbox down Speakers
    children:
      - media_player.mass_home_group
      - media_player.hotbox_down_wiim_speaker      
    commands:
      volume_mute:
        service: media_player.volume_mute
        target:
          entity_id: 
            - media_player.hotbox_down_wiim_speaker            
        data:
          is_volume_muted: true
      volume_set:
        service: media_player.volume_set
        target:
          entity_id: 
            - media_player.hotbox_down_wiim_speaker            
        data:
          volume_level: "{{ volume_level }}"
      volume_up:
        service: media_player.volume_up
        target:
          entity_id: 
            - media_player.hotbox_down_wiim_speaker            
      volume_down:
        service: media_player.volume_down
        target:
          entity_id: 
            - media_player.hotbox_down_wiim_speaker            
    attributes:
      is_volume_muted: media_player.hotbox_down_wiim_speaker|is_volume_muted
      volume_level: media_player.hotbox_down_wiim_speaker|volume_level

      
  ########################## Chillingroom  ########################## 

  - platform: universal
    name: Universal Chillingroom Speakers
    children:
      - media_player.mass_home_group
      - media_player.chillingroom_speaker      
    commands:
      volume_mute:
        service: media_player.volume_mute
        target:
          entity_id: 
            - media_player.chillingroom_speaker            
        data:
          is_volume_muted: true
      volume_set:
        service: media_player.volume_set
        target:
          entity_id: 
            - media_player.chillingroom_speaker            
        data:
          volume_level: "{{ volume_level }}"
      volume_up:
        service: media_player.volume_up
        target:
          entity_id: 
            - media_player.chillingroom_speaker            
      volume_down:
        service: media_player.volume_down
        target:
          entity_id: 
            - media_player.chillingroom_speaker            
    attributes:
      is_volume_muted: media_player.chillingroom_speaker|is_volume_muted
      volume_level: media_player.chillingroom_speaker|volume_level

      
  ########################## Hallway  ########################## 

  - platform: universal
    name: Universal Hallway Speakers
    children:
      - media_player.mass_home_group
      - media_player.hallway_speaker      
    commands:
      volume_mute:
        service: media_player.volume_mute
        target:
          entity_id: 
            - media_player.hallway_speaker            
        data:
          is_volume_muted: true
      volume_set:
        service: media_player.volume_set
        target:
          entity_id: 
            - media_player.hallway_speaker            
        data:
          volume_level: "{{ volume_level }}"
      volume_up:
        service: media_player.volume_up
        target:
          entity_id: 
            - media_player.hallway_speaker            
      volume_down:
        service: media_player.volume_down
        target:
          entity_id: 
            - media_player.hallway_speaker            
    attributes:
      is_volume_muted: media_player.hallway_speaker|is_volume_muted
      volume_level: media_player.hallway_speaker|volume_level





  ##########################  following speaker ########################## 

  - platform: universal
    name: Universal following speaker
    active_child_template: >-      
                  {% set location = states('sensor.maxi_location_v3') %}  
                  {% set ns = namespace( entities = [], final_entities = []  )%}
                  {% for media_player in states.media_player %} 
                    {% if location in media_player.entity_id  and "universal" in media_player.entity_id and media_player.state != "unavailable" and media_player.state != "off" %}
                      {% set entity = media_player.entity_id %}
                      {% set state = media_player.state %}
                      {% set ns.entities = ns.entities + [entity] %}
                    {% endif %}                  
                  {% endfor %}                  
                  {% for entity in ns.entities %}  
                      {% set state = states( entity ) %}
                      {% if "speaker" in entity and state != none %}
                        {% set ns.final_entities = ns.final_entities + [entity] %}
                      {% endif %}
                  {% endfor %}
                  {% if ns.final_entities | length > 0 %}
                  {{ ns.final_entities.0 }}
                  {% else %}
                    none
                  {% endif %}