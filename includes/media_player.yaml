  - name: "Maxi PC MediaPlayer"
    platform: hass_agent_mediaplayer
    host: 192.168.0.69
    port: 5115


  - platform: media_player_template
    media_players:
      template_group_home_speakers:
        friendly_name: Template Group Home Speakers
        device_class: speaker
        value_template: >
                {% set ns = namespace( cast_entity = "media_player.group_home_speakers", template_entity = "" ) %}
                {% set ns.final_entity = ns.cast_entity %}   {# Declare Varibles#}                
                {% for media_player in states.media_player %} 
                  {% if "plex" in media_player.entity_id  %}
                    {% set entity = media_player.entity_id %}
                    {% set media_title = state_attr( entity, 'media_title') %}
                      {% if state_attr( ns.final_entity, 'media_title') %}
                        {% if ( media_title | string ) in state_attr( ns.cast_entity, 'media_title') %}
                        {% set ns.template_entity = entity %}
                        {% endif %}
                      {% endif %}
                  {% endif %}
                {% endfor %}
                {% if ns.final_entity != ns.cast_entity %}
                  {{states(ns.final_entity)}}
                {% elif state_attr( ns.cast_entity, 'media_title')  %} 
                  {{states(ns.cast_entity)}}
                {% else %}
                  off
                {% endif %}
        next:
          service: media_player.media_seek
          data_template:
            entity_id: media_player.group_home_speakers
            seek_position: 56000
        turn_on:
          service: media_player.turn_on
          data_template:
            entity_id: media_player.group_home_speakers
        stop:
          service: media_player.media_stop
          data_template:
            entity_id: media_player.group_home_speakers
        turn_off:
          service: media_player.turn_off
          data_template:
            entity_id: media_player.group_home_speakers
        volume_up:
          service: media_player.volume_up
          data_template:
            entity_id: media_player.group_home_speakers
        play:
          service: media_player.media_play
          data_template:
            entity_id: media_player.group_home_speakers
        pause:
          service: media_player.media_pause
          data_template:
            entity_id: media_player.group_home_speakers
        volume_down:
          service: media_player.volume_down
          data_template:
            entity_id: media_player.group_home_speakers
        mute:
          service: media_player.volume_mute
          data_template:
            entity_id: media_player.group_home_speakers
        set_volume:
          service: media_player.volume_set
          data_template:
            entity_id: media_player.group_home_speakers
            volume_level: "{{ volume }}"
        current_is_muted_template: "{{state_attr( 'media_player.group_home_speakers', 'is_volume_muted') }}"
        media_image_url_template: >
                {% set ns = namespace( cast_entity = "media_player.group_home_speakers", template_entity = "" ) %}
                {% set ns.final_entity = ns.cast_entity %}   {# Declare Variables#}                
                {% for media_player in states.media_player %} 
                  {% if "plex" in media_player.entity_id  %}
                    {% set entity = media_player.entity_id %}
                    {% set media_title = state_attr( entity, 'media_title') %}
                      {% if state_attr( ns.final_entity, 'media_title') %}
                        {% if ( media_title | string ) in state_attr( ns.cast_entity, 'media_title') %}
                        {% set ns.template_entity = entity %}
                        {% endif %}
                      {% endif %}
                  {% endif %}
                {% endfor %}
                {% if ns.template_entity != ns.cast_entity and ns.template_entity != "" %}                   
                  {{state_attr(ns.template_entity, 'entity_picture')}}
                {% elif state_attr( ns.cast_entity, 'entity_picture')  %} 
                  {{state_attr(ns.cast_entity, 'entity_picture')}} 
                {% else %}
                  off
                {% endif %}
        title_template: "{{state_attr( 'media_player.group_home_speakers', 'media_title') }}"
        album_template: "{{ state_attr( 'media_player.group_home_speakers', 'media_album_name')}}"
        artist_template: "{{ state_attr( 'media_player.group_home_speakers', 'media_album_artist') }}"
        unique_id: template_group_home_speakers
        media_content_type_template: music



      template_hotbox_down_wiim_speaker:
        friendly_name: Template Hotbox Wiim Speaker
        device_class: speaker
        value_template: >
                {% set ns = namespace( cast_entity = "media_player.hotbox_down_wiim_speaker", template_entity = "" ) %}
                {% set ns.final_entity = ns.cast_entity %}   {# Declare Varibles#}                
                {% for media_player in states.media_player %} 
                  {% if "plex" in media_player.entity_id  %}
                    {% set entity = media_player.entity_id %}
                    {% set media_title = state_attr( entity, 'media_title') %}
                      {% if state_attr( ns.final_entity, 'media_title') %}
                        {% if ( media_title | string ) in state_attr( ns.cast_entity, 'media_title') %}
                        {% set ns.template_entity = entity %}
                        {% endif %}
                      {% endif %}
                  {% endif %}
                {% endfor %}
                {% if ns.final_entity != ns.cast_entity %}
                  {{states(ns.template_entity)}}
                {% elif state_attr( ns.cast_entity, 'media_title')  %} 
                  {{states(ns.cast_entity)}}
                {% else %}
                  off
                {% endif %}
        next:
          service: media_player.media_seek
          data_template:
            entity_id: media_player.hotbox_down_wiim_speaker
            seek_position: 56000
        turn_on:
          service: media_player.turn_on
          data_template:
            entity_id: media_player.hotbox_down_wiim_speaker
        stop:
          service: media_player.media_stop
          data_template:
            entity_id: media_player.hotbox_down_wiim_speaker
        turn_off:
          service: media_player.turn_off
          data_template:
            entity_id: media_player.hotbox_down_wiim_speaker
        volume_up:
          service: media_player.volume_up
          data_template:
            entity_id: media_player.hotbox_down_wiim_speaker
        play:
          service: media_player.media_play
          data_template:
            entity_id: media_player.hotbox_down_wiim_speaker
        pause:
          service: media_player.media_pause
          data_template:
            entity_id: media_player.hotbox_down_wiim_speaker
        volume_down:
          service: media_player.volume_down
          data_template:
            entity_id: media_player.hotbox_down_wiim_speaker
        mute:
          service: media_player.volume_mute
          data_template:
            entity_id: media_player.hotbox_down_wiim_speaker
        set_volume:
          service: media_player.volume_set
          data_template:
            entity_id: media_player.hotbox_down_wiim_speaker
            volume_level: "{{ volume }}"
        current_is_muted_template: "{{state_attr( 'media_player.hotbox_down_wiim_speaker', 'is_volume_muted') }}"
        media_image_url_template: >
                {% set ns = namespace( cast_entity = "media_player.hotbox_down_wiim_speaker", template_entity = "" ) %}
                {% set ns.final_entity = ns.cast_entity %}   {# Declare Variables#}                
                {% for media_player in states.media_player %} 
                  {% if "plex" in media_player.entity_id  %}
                    {% set entity = media_player.entity_id %}
                    {% set media_title = state_attr( entity, 'media_title') %}
                      {% if state_attr( ns.final_entity, 'media_title') %}
                        {% if ( media_title | string ) in state_attr( ns.cast_entity, 'media_title') %}
                        {% set ns.template_entity = entity %}
                        {% endif %}
                      {% endif %}
                  {% endif %}
                {% endfor %}
                {% if ns.template_entity != ns.cast_entity and ns.template_entity != "" %}                   
                  {{state_attr(ns.template_entity, 'entity_picture')}}
                {% elif state_attr( ns.cast_entity, 'entity_picture')  %} 
                  {{state_attr(ns.cast_entity, 'entity_picture')}} 
                {% else %}
                  off
                {% endif %}
        title_template: "{{state_attr( 'media_player.hotbox_down_wiim_speaker', 'media_title') }}"
        album_template: "{{ state_attr( 'media_player.hotbox_down_wiim_speaker', 'media_album_name')}}"
        artist_template: "{{ state_attr( 'media_player.hotbox_down_wiim_speaker', 'media_album_artist') }}"
        unique_id: template_hotbox_down_wiim_speaker
        media_content_type_template: music



      template_hotbox_down_chromecast:
        friendly_name: Template Hotbox Down Chromecast
        device_class: speaker
        value_template: >
                {% set ns = namespace( final_entity = "" )%}
                {% for media_player in states.media_player %} 
                  {% if "plex" in media_player.entity_id  %}
                    {% set entity = media_player.entity_id %}
                    {% set media_series_title = state_attr( entity, 'media_series_title') %}
                      {% if state_attr( 'media_player.hotbox_down_chromecast', 'media_series_title') %}
                        {% if ( media_series_title | string ) in state_attr( 'media_player.hotbox_down_chromecast', 'media_series_title') %}
                        {% set ns.final_entity = entity %}
                        {% endif %}
                      {% endif %}
                  {% endif %}
                {% endfor %}
                {% if ns.final_entity != "" %}
                {{states(ns.final_entity)}}
                {% else %}
                off
                {% endif %}
        next:
          service: media_player.media_seek
          data_template:
            entity_id: media_player.hotbox_down_chromecast
            seek_position: 56000
        turn_on:
          service: media_player.turn_on
          data_template:
            entity_id: media_player.hotbox_down_chromecast
        stop:
          service: media_player.media_stop
          data_template:
            entity_id: media_player.hotbox_down_chromecast
        turn_off:
          service: media_player.turn_off
          data_template:
            entity_id: media_player.hotbox_down_chromecast
        volume_up:
          service: media_player.volume_up
          data_template:
            entity_id: media_player.hotbox_down_chromecast
        volume_down:
          service: media_player.volume_down
          data_template:
            entity_id: media_player.hotbox_down_chromecast
        mute:
          service: media_player.volume_mute
          data_template:
            entity_id: media_player.hotbox_down_chromecast
        set_volume:
          service: media_player.volume_set
          data_template:
            entity_id: media_player.hotbox_down_chromecast
            volume_level: "{{ volume }}"
        current_is_muted_template: "{{state_attr( 'media_player.hotbox_down_chromecast', 'is_volume_muted') }}"
        media_image_url_template: >
                {% set ns = namespace( final_entity = "" )%}
                {% for media_player in states.media_player %} 
                  {% if "plex" in media_player.entity_id  %}
                    {% set entity = media_player.entity_id %}
                    {% set media_series_title = state_attr( entity, 'media_series_title') %}
                      {% if state_attr( 'media_player.hotbox_down_chromecast', 'media_series_title') %}
                        {% if ( media_series_title | string ) in state_attr( 'media_player.hotbox_down_chromecast', 'media_series_title') %}
                        {% set ns.final_entity = entity %}
                        {% endif %}
                      {% endif %}
                  {% endif %}
                {% endfor %}
                {% if ns.template_entity != ns.cast_entity and ns.template_entity != "" %}                   
                  {{state_attr(ns.template_entity, 'entity_picture')}}
                {% elif state_attr( ns.cast_entity, 'entity_picture')  %} 
                  {{state_attr(ns.cast_entity, 'entity_picture')}} 
                {% else %}
                {% endif %}
        media_series_title_template: "{{state_attr( 'media_player.hotbox_down_chromecast', 'media_series_title') }}"
        media_episode_template: "{{state_attr( 'media_player.hotbox_down_chromecast', 'media_episode') }}"
        media_season_template: "{{state_attr( 'media_player.hotbox_down_chromecast', 'media_season') }}"
        unique_id: template_hotbox_down_chromecast




      template_livingroom_wiim_speaker:
        friendly_name: Template Livingroom Wiim Speaker
        device_class: speaker
        value_template: >
                {% set ns = namespace( cast_entity = "media_player.livingroom_wiim_speaker", template_entity = "" ) %}
                {% set ns.final_entity = ns.cast_entity %}   {# Declare Varibles#}                
                {% for media_player in states.media_player %} 
                  {% if "plex" in media_player.entity_id  %}
                    {% set entity = media_player.entity_id %}
                    {% set media_title = state_attr( entity, 'media_title') %}
                      {% if state_attr( ns.final_entity, 'media_title') %}
                        {% if ( media_title | string ) in state_attr( ns.cast_entity, 'media_title') %}
                        {% set ns.template_entity = entity %}
                        {% endif %}
                      {% endif %}
                  {% endif %}
                {% endfor %}
                {% if ns.final_entity != ns.cast_entity %}
                  {{states(ns.template_entity)}}
                {% elif state_attr( ns.cast_entity, 'media_title')  %} 
                  {{states(ns.cast_entity)}}
                {% else %}
                  off
                {% endif %}
        next:
          service: media_player.media_seek
          data_template:
            entity_id: media_player.livingroom_wiim_speaker
            seek_position: 56000
        turn_on:
          service: media_player.turn_on
          data_template:
            entity_id: media_player.livingroom_wiim_speaker
        stop:
          service: media_player.media_stop
          data_template:
            entity_id: media_player.livingroom_wiim_speaker
        turn_off:
          service: media_player.turn_off
          data_template:
            entity_id: media_player.livingroom_wiim_speaker
        volume_up:
          service: media_player.volume_up
          data_template:
            entity_id: media_player.livingroom_wiim_speaker
        play:
          service: media_player.media_play
          data_template:
            entity_id: media_player.livingroom_wiim_speaker
        pause:
          service: media_player.media_pause
          data_template:
            entity_id: media_player.livingroom_wiim_speaker
        volume_down:
          service: media_player.volume_down
          data_template:
            entity_id: media_player.livingroom_wiim_speaker
        mute:
          service: media_player.volume_mute
          data_template:
            entity_id: media_player.livingroom_wiim_speaker
        set_volume:
          service: media_player.volume_set
          data_template:
            entity_id: media_player.livingroom_wiim_speaker
            volume_level: "{{ volume }}"
        current_is_muted_template: "{{state_attr( 'media_player.livingroom_wiim_speaker', 'is_volume_muted') }}"
        media_image_url_template: >
                {% set ns = namespace( cast_entity = "media_player.livingroom_wiim_speaker", template_entity = "" ) %}
                {% set ns.final_entity = ns.cast_entity %}   {# Declare Variables#}                
                {% for media_player in states.media_player %} 
                  {% if "plex" in media_player.entity_id  %}
                    {% set entity = media_player.entity_id %}
                    {% set media_title = state_attr( entity, 'media_title') %}
                      {% if state_attr( ns.final_entity, 'media_title') %}
                        {% if ( media_title | string ) in state_attr( ns.cast_entity, 'media_title') %}
                        {% set ns.template_entity = entity %}
                        {% endif %}
                      {% endif %}
                  {% endif %}
                {% endfor %}
                {% if ns.template_entity != ns.cast_entity and ns.template_entity != "" %}                   
                  {{state_attr(ns.template_entity, 'entity_picture')}}
                {% elif state_attr( ns.cast_entity, 'entity_picture')  %} 
                  {{state_attr(ns.cast_entity, 'entity_picture')}} 
                {% else %}
                  off
                {% endif %}
        title_template: "{{state_attr( 'media_player.livingroom_wiim_speaker', 'media_title') }}"
        album_template: "{{ state_attr( 'media_player.livingroom_wiim_speaker', 'media_album_name')}}"
        artist_template: "{{ state_attr( 'media_player.livingroom_wiim_speaker', 'media_album_artist') }}"
        unique_id: template_livingroom_wiim_speaker
        media_content_type_template: music




      template_office_wiim_speaker:
        friendly_name: Template Office Wiim Speaker
        device_class: speaker
        value_template: >
                {% set ns = namespace( cast_entity = "media_player.office_speaker", template_entity = "" ) %}
                {% set ns.final_entity = ns.cast_entity %}   {# Declare Varibles#}                
                {% for media_player in states.media_player %} 
                  {% if "plex" in media_player.entity_id  %}
                    {% set entity = media_player.entity_id %}
                    {% set media_title = state_attr( entity, 'media_title') %}
                      {% if state_attr( ns.final_entity, 'media_title') %}
                        {% if ( media_title | string ) in state_attr( ns.cast_entity, 'media_title') %}
                        {% set ns.template_entity = entity %}
                        {% endif %}
                      {% endif %}
                  {% endif %}
                {% endfor %}
                {% if ns.final_entity != ns.cast_entity %}
                  {{states(ns.template_entity)}}
                {% elif state_attr( ns.cast_entity, 'media_title')  %} 
                   {{states(ns.cast_entity)}}
                {% else %}
                  off
                {% endif %}
        next:
          service: media_player.media_seek
          data_template:
            entity_id: media_player.office_speaker
            seek_position: 56000
        turn_on:
          service: media_player.turn_on
          data_template:
            entity_id: media_player.office_speaker
        stop:
          service: media_player.media_stop
          data_template:
            entity_id: media_player.office_speaker
        turn_off:
          service: media_player.turn_off
          data_template:
            entity_id: media_player.office_speaker
        volume_up:
          service: media_player.volume_up
          data_template:
            entity_id: media_player.office_speaker
        play:
          service: media_player.media_play
          data_template:
            entity_id: media_player.office_speaker
        pause:
          service: media_player.media_pause
          data_template:
            entity_id: media_player.office_speaker
        volume_down:
          service: media_player.volume_down
          data_template:
            entity_id: media_player.office_speaker
        mute:
          service: media_player.volume_mute
          data_template:
            entity_id: media_player.office_speaker
        set_volume:
          service: media_player.volume_set
          data_template:
            entity_id: media_player.office_speaker
            volume_level: "{{ volume }}"
        current_is_muted_template: "{{state_attr( 'media_player.office_speaker', 'is_volume_muted') }}"
        media_image_url_template: >
                {% set ns = namespace( cast_entity = "media_player.office_speaker", template_entity = "" ) %}
                {% set ns.final_entity = ns.cast_entity %}   {# Declare Variables#}                
                {% for media_player in states.media_player %} 
                  {% if "plex" in media_player.entity_id  %}
                    {% set entity = media_player.entity_id %}
                    {% set media_title = state_attr( entity, 'media_title') %}
                      {% if state_attr( ns.final_entity, 'media_title') %}
                        {% if ( media_title | string ) in state_attr( ns.cast_entity, 'media_title') %}
                        {% set ns.template_entity = entity %}
                        {% endif %}
                      {% endif %}
                  {% endif %}
                {% endfor %}
                {% if ns.template_entity != ns.cast_entity and ns.template_entity != "" %}                   
                  {{state_attr(ns.template_entity, 'entity_picture')}}
                {% elif state_attr( ns.cast_entity, 'entity_picture')  %} 
                  {{state_attr(ns.cast_entity, 'entity_picture')}} 
                {% else %}
                  off
                {% endif %}
        title_template: "{{state_attr( 'media_player.office_speaker', 'media_title') }}"
        album_template: "{{ state_attr( 'media_player.office_speaker', 'media_album_name')}}"
        artist_template: "{{ state_attr( 'media_player.office_speaker', 'media_album_artist') }}"
        unique_id: template_office_wiim_speaker
        media_content_type_template: music


        
      template_kitchen_speaker:
        friendly_name: Template Kitchen Speaker
        device_class: speaker
        value_template: >
                {% set ns = namespace( cast_entity = "media_player.kitchen_speaker", template_entity = "" ) %}
                {% set ns.final_entity = ns.cast_entity %}   {# Declare Varibles#}                
                {% for media_player in states.media_player %} 
                  {% if "plex" in media_player.entity_id  %}
                    {% set entity = media_player.entity_id %}
                    {% set media_title = state_attr( entity, 'media_title') %}
                      {% if state_attr( ns.final_entity, 'media_title') %}
                        {% if ( media_title | string ) in state_attr( ns.cast_entity, 'media_title') %}
                        {% set ns.template_entity = entity %}
                        {% endif %}
                      {% endif %}
                  {% endif %}
                {% endfor %}
                {% if ns.final_entity != ns.cast_entity %}
                  {{states(ns.template_entity)}}
                {% elif state_attr( ns.cast_entity, 'media_title')  %} 
                  {{states(ns.cast_entity)}}
                {% else %}
                  off
                {% endif %}
        next:
          service: media_player.media_seek
          data_template:
            entity_id: media_player.kitchen_speaker
            seek_position: 56000
        turn_on:
          service: media_player.turn_on
          data_template:
            entity_id: media_player.kitchen_speaker
        stop:
          service: media_player.media_stop
          data_template:
            entity_id: media_player.kitchen_speaker
        turn_off:
          service: media_player.turn_off
          data_template:
            entity_id: media_player.kitchen_speaker
        volume_up:
          service: media_player.volume_up
          data_template:
            entity_id: media_player.kitchen_speaker
        play:
          service: media_player.media_play
          data_template:
            entity_id: media_player.kitchen_speaker
        pause:
          service: media_player.media_pause
          data_template:
            entity_id: media_player.kitchen_speaker
        volume_down:
          service: media_player.volume_down
          data_template:
            entity_id: media_player.kitchen_speaker
        mute:
          service: media_player.volume_mute
          data_template:
            entity_id: media_player.kitchen_speaker
        set_volume:
          service: media_player.volume_set
          data_template:
            entity_id: media_player.kitchen_speaker
            volume_level: "{{ volume }}"
        current_is_muted_template: "{{state_attr( 'media_player.kitchen_speaker', 'is_volume_muted') }}"
        media_image_url_template: >
                {% set ns = namespace( cast_entity = "media_player.kitchen_speaker", template_entity = "" ) %}
                {% set ns.final_entity = ns.cast_entity %}   {# Declare Variables#}                
                {% for media_player in states.media_player %} 
                  {% if "plex" in media_player.entity_id  %}
                    {% set entity = media_player.entity_id %}
                    {% set media_title = state_attr( entity, 'media_title') %}
                      {% if state_attr( ns.final_entity, 'media_title') %}
                        {% if ( media_title | string ) in state_attr( ns.cast_entity, 'media_title') %}
                        {% set ns.template_entity = entity %}
                        {% endif %}
                      {% endif %}
                  {% endif %}
                {% endfor %}
                {% if ns.template_entity != ns.cast_entity and ns.template_entity != "" %}                   
                  {{state_attr(ns.template_entity, 'entity_picture')}}
                {% elif state_attr( ns.cast_entity, 'entity_picture')  %} 
                  {{state_attr(ns.cast_entity, 'entity_picture')}} 
                {% else %}
                  off
                {% endif %}
        title_template: "{{state_attr( 'media_player.kitchen_speaker', 'media_title') }}"
        album_template: "{{ state_attr( 'media_player.kitchen_speaker', 'media_album_name')}}"
        artist_template: "{{ state_attr( 'media_player.kitchen_speaker', 'media_album_artist') }}"
        unique_id: template_kitchen_speaker
        media_content_type_template: music

        
      template_hallway_speaker:
        friendly_name: Template Hallway Speaker
        device_class: speaker
        value_template: >
                {% set ns = namespace( cast_entity = "media_player.hallway_speaker", template_entity = "" ) %}
                {% set ns.final_entity = ns.cast_entity %}   {# Declare Varibles#}                
                {% for media_player in states.media_player %} 
                  {% if "plex" in media_player.entity_id  %}
                    {% set entity = media_player.entity_id %}
                    {% set media_title = state_attr( entity, 'media_title') %}
                      {% if state_attr( ns.final_entity, 'media_title') %}
                        {% if ( media_title | string ) in state_attr( ns.cast_entity, 'media_title') %}
                        {% set ns.template_entity = entity %}
                        {% endif %}
                      {% endif %}
                  {% endif %}
                {% endfor %}
                {% if ns.final_entity != ns.cast_entity %}
                  {{states(ns.template_entity)}}
                {% elif state_attr( ns.cast_entity, 'media_title')  %} 
                  {{states(ns.cast_entity)}}
                {% else %}
                  off
                {% endif %}
        next:
          service: media_player.media_seek
          data_template:
            entity_id: media_player.hallway_speaker
            seek_position: 56000
        turn_on:
          service: media_player.turn_on
          data_template:
            entity_id: media_player.hallway_speaker
        stop:
          service: media_player.media_stop
          data_template:
            entity_id: media_player.hallway_speaker
        turn_off:
          service: media_player.turn_off
          data_template:
            entity_id: media_player.hallway_speaker
        volume_up:
          service: media_player.volume_up
          data_template:
            entity_id: media_player.hallway_speaker
        play:
          service: media_player.media_play
          data_template:
            entity_id: media_player.hallway_speaker
        pause:
          service: media_player.media_pause
          data_template:
            entity_id: media_player.hallway_speaker
        volume_down:
          service: media_player.volume_down
          data_template:
            entity_id: media_player.hallway_speaker
        mute:
          service: media_player.volume_mute
          data_template:
            entity_id: media_player.hallway_speaker
        set_volume:
          service: media_player.volume_set
          data_template:
            entity_id: media_player.hallway_speaker
            volume_level: "{{ volume }}"
        current_is_muted_template: "{{state_attr( 'media_player.kitchen_speaker', 'is_volume_muted') }}"
        media_image_url_template: >
                {% set ns = namespace( cast_entity = "media_player.kitchen_speaker", template_entity = "" ) %}
                {% set ns.final_entity = ns.cast_entity %}   {# Declare Variables#}                
                {% for media_player in states.media_player %} 
                  {% if "plex" in media_player.entity_id  %}
                    {% set entity = media_player.entity_id %}
                    {% set media_title = state_attr( entity, 'media_title') %}
                      {% if state_attr( ns.final_entity, 'media_title') %}
                        {% if ( media_title | string ) in state_attr( ns.cast_entity, 'media_title') %}
                        {% set ns.template_entity = entity %}
                        {% endif %}
                      {% endif %}
                  {% endif %}
                {% endfor %}
                {% if ns.final_entity != ns.cast_entity %}                  
                  {{state_attr(ns.template_entity, 'entity_picture')}}
                {% elif state_attr( ns.cast_entity, 'media_title')  %} 
                  {{state_attr(ns.cast_entity, 'entity_picture')}} 
                {% else %}
                  off
                {% endif %}
        title_template: "{{state_attr( 'media_player.kitchen_speaker', 'media_title') }}"
        album_template: "{{ state_attr( 'media_player.kitchen_speaker', 'media_album_name')}}"
        artist_template: "{{ state_attr( 'media_player.kitchen_speaker', 'media_album_artist') }}"
        unique_id: template_hallway_speaker
        media_content_type_template: music